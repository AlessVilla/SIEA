<!DOCTYPE html>
<html lang="en">
<!-- Descargar SweetAlert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">
<head>
  <!-- Agrega la biblioteca Google API Client Library para JavaScript -->
  <script src="https://apis.google.com/js/api.js"></script>
  <!-- incluye el plugin de anotación de Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js"></script>
  <!-- Agrega el SDK de Firebase -->
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>
  <!-- Agrega el bloque del SDK de Firebase Realtime Database -->
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-database.js"></script>
  <!-- Agrega el bloque del SDK de Firebase Authentication -->
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
  <!-- Agrega el bloque del SDK de Firebase Cloud Firestore -->
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <!-- Agrega la biblioteca para enviar correos en Email.js -->  
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <!-- Agrega la biblioteca para enviar correos por API Gmail -->  
  <script src="https://apis.google.com/js/client.js"></script>
  <!-- Agrega la biblioteca para enviar correos por SMTPJS -->  
  <script src="https://smtpjs.com/v3/smtp.js"></script>
  <!-- Importar el google auth provider para autenticar con google -->  
  <!-- <script import { GoogleAuthProvider } from "firebase/auth"></script> -->  
  <!-- Agrega la biblioteca para enviar correos por SMTPJS -->  
  <script src="https://smtpjs.com/v3/smtp.js"></script>
  <!-- Incluye html2canvas.js usando una CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
  <!-- Agrega la biblioteca Google API Client -->  
  <script src="https://apis.google.com/js/api.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="stylesheet" href="style.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIEA 💚💙</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Incluir Chart.js desde una CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Incluir el archivo JavaScript desde la carpeta config dentro del repositorio -->
  <script>
    // firebase-config.js
    var firebaseConfig = {
        apiKey: "AIzaSyBoPvkQzuVG5LA_HXqw34MiHzB4Y3ro7Kw",
        authDomain: "bddreservaaneiapuninorte.firebaseapp.com",
        projectId: "bddreservaaneiapuninorte",
        storageBucket: "bddreservaaneiapuninorte.appspot.com",
        messagingSenderId: "227754886829",
        appId: "1:227754886829:web:00047755b1aaa727242824",
        measurementId: "G-S0LH1M6FQ4" // Esta línea es opcional, solo si estás utilizando Firebase Analytics
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();
    const firestore = firebase.firestore();
  </script>

  <title>SIEA (Sistema Integral de Espacios ANEIAP)</title>
  <style>
    body {
      /* Establece la imagen de fondo */
      background-image: url('https://i.ibb.co/gzwRXW2/FOTO-FONDO-SIEA-SNC2023-1.jpg');
      /* Fija la imagen de fondo para que no se desplace con el contenido */
      background-attachment: fixed;
      /* Escala la imagen para cubrir todo el cuerpo */
      background-size: contain;
      /* Centra la imagen */
      background-position: center;
      /* Establece un color de fondo de respaldo */
      background-color: #0b2447; /* Este color será visible si la imagen no se carga */
    }
    .black-text {
      color: black;
    }
    @font-face {
      font-family: 'Century Gothic';
      src: url('ruta/a/la/fuente/CenturyGothic.woff2') format('woff2'),
          url('ruta/a/la/fuente/CenturyGothic.woff') format('woff');
      /* Agrega más formatos de fuentes si es necesario */
      font-weight: normal;
      font-style: normal;
    }
    /* Estilos para el contenedor de la imagen */
    .centered-text {
      text-align: center;
    }
    .image-container {
      display: flex;
      justify-content: center;
      animation: slide-in 2s ease-in-out;
    }
    @keyframes slide-in {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(0);
      }
    }
    .image-container img {
      max-width: 15%;
      height: auto;
      transition: transform 6s ease-in-out;
    }
    .image-container img:hover {
      transform: rotate(4320deg);
    }
    /* Estilos para el cuadro de datos generales del evento */
    .datos-generales,
    .datos-organizador,
    .datos-ponente {
      background-color: rgb(253, 198, 166);
      padding: 10px;
      margin-bottom: 20px;
    }
    /* Estilos para los campos de formulario */
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      font-size: 18px;
    }
    select, textarea, input[type="text"], input[type="date"], input[type="email"], input[type="tel"] {
      width: 100%;
      margin-top: 5px;
      font-size: 18px;
    }
    h2 {
      font-size: 22px;
      text-transform: uppercase;
    }
    .reserva {
      background-color: darkgreen;
      color: white;
      padding: 5px 10px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      font-size: 20px;
    }
    .row {
      display: flex;
      justify-content: space-between;
    }
    .row .half {
      width: 48%;
    }
    .third {
      flex-basis: 33.33%;
      padding: 0 15px;
      box-sizing: border-box;
    }
    .disponibilidad-group {
      margin-bottom: 15px;
      background-color: #c3d6ffD9; /* Color de fondo azul muy claro */
      padding: 10px;
      border: 1px solid #0004ffD9; /* Borde azul */
      border-radius: 8px; /* Bordes redondeados para el contenedor */
    }
    .reservar-group {
      margin-bottom: 15px;
      background-color: #a8f7a1; /* Color de fondo verde muy claro */
      padding: 10px;
      border: 1px solid #15ff00; /* Borde verde claro */
      border-radius: 8px; /* Bordes redondeados para el contenedor */
    }
    .editar-group {
      margin-bottom: 15px;
      background-color: #ffc67cD9; /* Color de fondo rojo muy claro */
      padding: 10px;
      border: 1px solid #ff9100D9; /* Borde rojo */
      border-radius: 8px; /* Bordes redondeados para el contenedor */
    }
    .eliminar-group {
      margin-bottom: 15px;
      background-color: #fd8c8cD9; /* Color de fondo rojo muy claro */
      padding: 10px;
      border: 1px solid #ff0000D9; /* Borde rojo */
      border-radius: 8px; /* Bordes redondeados para el contenedor */
    }
    .acordeon4-content-inner {
      margin-bottom: 15px;
      background-color: #D55DFF; /* Color de fondo rojo muy claro */
      padding: 10px;
      border: 1px solid #9900CC; /* Borde rojo */
      border-radius: 8px; /* Bordes redondeados para el contenedor */
    }
    .actualizar-group {
      margin-bottom: 15px;
      background-color: #ccccccD9; /* Color de fondo rojo muy claro */
      padding: 10px;
      border: 1px solid #4d4d4dD9; /* Borde rojo */
      border-radius: 8px; /* Bordes redondeados para el contenedor */
    }
    .radio-buttons-container {
      display: flex;
      justify-content: center;
      gap: 20px; /* Espacio entre los botones SÍ y NO */
    }
    .custom-file-input {
      display: inline-block;
      position: relative;
    }
    .custom-file-input input[type="file"] {
      opacity: 0;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      cursor: pointer;
    }
    .custom-file-input label {
      background-color: #3498db;
      color: #fff;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }    
    .field-container {
      background-color: #fff;
      padding: 10px; /* Ajusta el valor según el espacio deseado entre el contenido y el borde */
      border-radius: 5px; /* Ajusta el valor para cambiar la curvatura de las esquinas */
    }
    /* Estilos para los acordeones */
    .acordeon0, .acordeon1, .acordeon2, .acordeon3, .acordeon4, .acordeon5 {
      color: white;
      padding: 5px 10px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      font-size: 20px;
      margin-bottom: 10px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .acordeon0 {
      background-color: #307B98;
    }
    .acordeon0-content, .acordeon1-content, .acordeon2-content, .acordeon3-content, .acordeon4-content, .acordeon5-content {
      background-color: white;
      padding: 10px;
      margin-bottom: 20px;
    }
    .acordeon1 {
      background-color: #00B30F;
    }
    .acordeon2 {
      background-color: #F47B28;
    }
    .acordeon3 {
      background-color: #DC1E1E;
    }
    .acordeon4 {
      background-color: #600082;
    }
    .acordeon5 {
      background-color: #4d4d4d;
    }
    .button-consultar-disponibilidad, .button-reservar, .button-consultar, .button-consultar, .button-evaluar, .button-eliminar, .button-actualizar, .button-generar-informe {
      color: white;
      padding: 5px 10px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      font-size: 18px;
      margin-bottom: 10px; /* Añadido para separar el botón de los campos */
      width: 353px; /* Ocupar el ancho del contenedor */
    }
    .button-descargas {
      color: white;
      padding: 5px 10px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      font-size: 16px;
      margin-bottom: 10px; /* Añadido para separar el botón de los campos */
      width: 173px; /* Ocupar el ancho del contenedor */
    }
    .button-consultar-disponibilidad {
      background-color: rgb(0, 4, 255);
    }
    .button-reservar {
      background-color: rgb(0, 141, 37);
    }
    .button-consultar {
      background-color: #ffa500;
    }
    .button-eliminar {
      background-color: red;
    }
    .button-evaluar {
      background-color: #600082;
    }
    .button-actualizar {
      background-color: #4d4d4d;
    }
    .button-generar-informe {
      background-color: #32ce13;
    }
    .button-login {
      color: #000000;
      background-color: #FDF55F;
      padding: 5px 10px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      font-size: 18px;
      margin-bottom: 10px; /* Añadido para separar el botón de los campos */
      width: 120px; /* Ocupar el ancho del contenedor */
    }
    .button-cambio-contrasena {
      color: #000000;
      background-color: #FDF55F;
      padding: 5px 10px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      font-size: 18px;
      margin-bottom: 10px; /* Añadido para separar el botón de los campos */
      width: 230px; /* Ocupar el ancho del contenedor */
    }
    /* Estilo para los campos de correo del forms y contraseña */
    input[type="email"],
    input[type="password"] {
      font-size: 18px; /* Mismo tamaño de fuente que el botón */
      padding: 5px 10px;
      margin-bottom: 10px; /* Espaciado inferior */
      width: 150px; /* Ocupar el ancho del contenedor */
    }
    .input-password-large {
        width: 300px; /* Ancho específico para ciertos campos de contraseña */
        font-size: 18px; /* Mismo tamaño de fuente que el botón */
        padding: 5px 10px;
        margin-bottom: 10px; /* Espaciado inferior */
    }
    input[type="cambio-text"] {
      font-size: 18px; /* Mismo tamaño de fuente que el botón */
      padding: 5px 10px;
      margin-bottom: 10px; /* Espaciado inferior */
      width: 300px; /* Ocupar el ancho del contenedor */
    }
    .disponibilidad-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .disponibilidad-item {
      width: 100px;
      height: 50px;
      margin: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-weight: bold;
      font-size: 16px;
    }
    .disponibilidad-item.green {
      background-color: #00B30F;
    }
    .disponibilidad-item.red {
      background-color: red;
    }
    .disponibilidad-item.gray {
      background-color: rgb(230, 230, 230);
      color: black;
    }
    /* Estilos para las pestañas */
    .tab-container {
      display: flex;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid #9900CCBF;
      background-color: #f7d1f3BF;
      border-radius: 8px 8px 0 0;
    }
    .tab:hover {
      background-color: #f0f0f0;
    }
    /* Estilos para los contenidos de las pestañas */
    .tab-content {
      display: none;
      padding: 10px;
      border: 3px solid #D55DFFBF;
      background-color: #f7d1f3BF;
      border-radius: 20 20px 20px 20px;
      width: 100%
    }
    /* Mostrar el contenido de la pestaña activa */
    .tab-content.active {
      display: block;
    }    
    /* Estilos para el botón */
    #modo-switch {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 60px; /* Aumenta el ancho del botón */
      height: 40px; /* Aumenta la altura del botón */
      background-color: #777777; /* Color de fondo del botón en light mode */
      border-radius: 50%; /* Hace que el botón sea circular */
      cursor: pointer;
      border: none;
      outline: none;
      padding: 2px;
      display: flex; /* Para centrar verticalmente el emoji */
      justify-content: center; /* Para centrar horizontalmente el emoji */
      align-items: center; /* Para centrar verticalmente el emoji */
    }
    /* Estilos para el ícono del sol */
    .icon::before {
      content: "\2600"; /* Código Unicode para el sol */
      font-size: 28px; /* Aumenta el tamaño del emoji */
      color: #ffcc00; /* Color del sol en light mode */
      display: inline-block;
    }
    /* Estilos para el ícono de la luna */
    .dark-mode .icon::before {
      content: "\1F319"; /* Código Unicode para la luna */
      color: #333; /* Color de la luna en dark mode */
    }
    body.light-mode {
      background-color: white; /* Fondo blanco en el modo claro */
      transition: background-color 1s ease; /* Efecto de transición suave */
    }
    body.dark-mode {
      background-color: rgb(29, 29, 29); /* Fondo negro en el modo oscuro */
      transition: background-color 1s ease; /* Efecto de transición suave */
    }
    body {
      transition: background-color 1s ease; /* Efecto de transición suave para todo el cuerpo */
      font-family: 'Century Gothic', sans-serif;
    }
    /* Estilo del texto en modo claro */
    .light-mode {
      color: black; /* Color del texto en modo claro */
    }
    .logo.light-mode {
      display: none; /* Oculta el logo del dark mode por defecto */
    }
    /* Estilo del texto en modo oscuro */
    .dark-mode .light-mode {
      color: white; /* Color del texto en modo oscuro */
    }
    /* Estilos para los títulos de documentos */
    .document-title a {
      text-decoration: none;
      color: black;
      font-weight: bold;
    }
    /* Estilos para los enlaces "AQUÍ" */
    .document-link a {
      text-decoration: none;
      color: blue;
      font-weight: bold;
    }
    /* Estilos para el icono de Word */
    .document-link img {
      width: 16px;
      height: 16px;
      margin-left: 5px;
    }
    .swal2-content {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .swal2-input {
        font-size: 16px; /* Aumenta el tamaño de la fuente */
        padding: 10px; /* Más padding para hacer el input más grande */
    }
    .toggle-password {
        cursor: pointer;
        position: absolute;
        margin-left: 0px;
        margin-top: 25px; /* Ajusta según sea necesario */
    }
    /* Estilos para la tabla resumen */
    #tabla-resumen {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow-x: auto; /* Permitir desplazamiento horizontal */
    }
    #tabla-resumen-container {
    width: 100%;
    overflow-x: auto; /* Permitir desplazamiento horizontal si es necesario */
    }
    #tabla-resumen th,
    #tabla-resumen td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }
    #tabla-resumen th {
        background-color: #76c04e;
    }
    #tabla-resumen tbody tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    #tabla-resumen tbody tr:hover {
        background-color: #76c04e;
        transition: background-color 0.3s ease;
    }
    #tabla-resumen td:nth-child(n + 8) {
        text-align: center;
    }
    #tabla-resumen td:nth-child(13) {

        font-size: 10px;
        overflow: hidden;
    }
    /* Ajuste de anchos de columnas */
    #tabla-resumen th,
    #tabla-resumen td {
        width: auto; /* Permitir que las columnas se ajusten automáticamente */
    }
    #tabla-evaluaciones {
    width: 100%;
    border-collapse: collapse;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    overflow-x: auto; /* Permitir desplazamiento horizontal */
    }
    #tabla-evaluaciones th,
    #tabla-evaluaciones td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }
    #tabla-evaluaciones th {
        background-color: #76c04e;
    }
    #tabla-evaluaciones tbody tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    #tabla-evaluaciones tbody tr:hover {
        background-color: #76c04e;
        transition: background-color 0.3s ease;
    }
    /* Ajuste de anchos de columnas */
    #tabla-evaluaciones th,
    #tabla-evaluaciones td {
        width: auto; /* Permitir que las columnas se ajusten automáticamente */
    }
    /* Alineación de columnas */
    #tabla-evaluaciones td:nth-child(1),
    #tabla-evaluaciones td:nth-child(2),
    #tabla-evaluaciones td:nth-child(7) {
        text-align: left; /* Columnas de nombre del asistente, correo asistente y comentarios alineadas a la izquierda */
    }
    #tabla-evaluaciones td {
        text-align: center; /* Resto de columnas centradas */
    }
    /* Estilos para el contenedor del calendario */
    #calendario-semanal {
      margin: 20px auto; /* Margen externo para centrar el calendario */
      width: 100%; /* Ancho del calendario */
    }
    /* Estilos para la tabla del calendario */
    .calendario-semanal-table {
      width: 100%; /* Ancho de la tabla */
      border-collapse: collapse; /* Colapso de bordes de celda */
    }
    /* Estilos para las celdas del encabezado */
    .calendario-semanal-table th {
      background-color: #618796; /* Color de fondo */
      padding: 10px; /* Espaciado interno */
      text-align: left; /* Alineación de texto a la izquierda */
      border-bottom: 1px solid #ddd; /* Borde inferior */
      color: #fff; /* Color del texto */
    }
    /* Estilos para las celdas del cuerpo */
    .calendario-semanal-table td {
      padding: 10px; /* Espaciado interno */
      border-bottom: 1px solid #ddd; /* Borde inferior */
    }
    /* Estilos para las filas impares del cuerpo */
    .calendario-semanal-table tbody tr:nth-child(odd) {
      background-color: #f9f9f9; /* Color de fondo para filas impares */
    }
    /* Estilos para la primera columna (día de la semana) */
    .calendario-semanal-table tbody td:first-child {
      width: 15%; /* Ancho del 10% para la primera columna */
    }
    /* Estilos para la segunda columna (eventos reservados) */
    .calendario-semanal-table tbody td:nth-child(2) {
      width: 85%; /* Ancho del 90% para la segunda columna */
      margin: 0; /* Eliminar margen interno del párrafo */
    }
    /* Estilos para las filas al pasar el mouse */
    .calendario-semanal-table tbody tr:hover {
      background-color: #76c04e; /* Cambio de color al pasar el mouse */
      cursor: pointer; /* Cambio de cursor al pasar el mouse */
    }
    /* Estilos para centrar los encabezados */
    .calendario-semanal-table th {
      text-align: center; /* Alineación centrada */
    }
    .login-container {
      display: flex;
      align-items: center; /* Centra verticalmente los elementos */
    }
    .login-container form {
      margin-right: 10px; /* Espacio entre el formulario y el botón */
    }

  </style>
</head>
<body class="dark-mode">

  <div id="loading-overlay" class="loading-overlay">
    <div id="loading-message">
      <!-- El contenido de tu pantalla de carga aquí -->
    </div>
  </div>

    <!-- Agrega la referencia al script de jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/1.0.27/jspdf.plugin.autotable.min.js"></script>
    <!-- Botón de modo de visualización-->
    <!--<button id="modo-switch" class="light-mode">
      <span class="icon"></span>
    </button>-->

  <!-- Formulario con campos de correo, contraseña y botón para iniciar sesión-->
  <form>
    <input type="email" id="correo" name="correo" required placeholder="Correo ANEIAP">
    <input type="password" id="contrasena" name="contrasena" required placeholder="Contraseña" onkeydown="if(event.keyCode === 13) validar_login()">
    <button type="button" id="btnInformeFI" class="button-descargas" onclick="generarInformePDF(event)" style="background-color: #67dd19; color: white; display: none;">Generar Informe FI</button>
    <button type="button" id="btnInformeIE" class="button-descargas" onclick="generarInformeIE(event)" style="background-color: #1926dd; color: white; display: none;">Generar Informe IE</button>
    <button type="button" class="button-descargas" onclick="generarAgendaFormativa(event)" style="background-color: #006d37; color: white;">Agenda Formativa</button>

    <button type="button" class="button-admin" onclick="EjecutarAdmin(event)" style="font-size: 12px; padding: 2px 5px; border: none; background: none; cursor: pointer;">✏</button>  
  </form>
  <button type="button" class="button-login" onclick="validar_login()">Loguéate</button>
  <button type="button" class="button-cambio-contrasena" onclick="cambiar_contrasena()">Cambiar Contraseña</button>
  <!-- Elemento para mostrar el saludo -->
  <div id="saludoUsuario" style="color: orange;">¡Hola, ANEIAPo!</div>

  <!-- Proceso para insertar el logo de la herramienta de SIEA y adicionalmente detalles iniciales y generales de la página -->
  <h1 style="text-align: center;" class="light-mode">Bienvenido a SIEA (Sistema Integral de Espacios ANEIAP)</h1>

  <div class="image-container">
    <img src="https://i.ibb.co/WGC5G0Y/Copia-de-Logos-proyectos-2023-2-4.png" alt="Logo Light Mode" class="logo light-mode">
    <img src="https://i.ibb.co/Wt7rx9Y/Equipo-Nacional-de-Datos-1.png" alt="Logo Dark Mode" class="logo dark-mode">
  </div>
  <!-- Las pestañas para tener contactos,  -->
  <div class="tab-container">
    <div class="tab" onclick="showTab(1)"><b>AYUDA</b></div>
    <div class="tab" onclick="showTab(2)"><b>TUTORIAL</b></div>
    <div class="tab" onclick="showTab(3)"><b>⬅️</b></div>
    <!-- Agrega más pestañas según sea necesario -->

      <div id="tab-content-1" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2 style="margin: 0;">GENERA UN TICKET PARA OBTENER AYUDA DEL ADMINISTRADOR 🎟️</h2>
          <div style="text-align: right;">
            <button style="width: 150px; height: 20px;" onclick="enviarTicket()">ENVIAR TICKET</button>
            <br>
            <button style="width: 150px; height: 20px;" onclick="limpiarTicket()">BORRAR TODO</button>
          </div>
        </div>
            <!-- PRIMERA FILA DE LA SECCIÓN TICKET CON NOMBRE, CORREO Y TIPO DE TICKET -->
            <div class="disponibilidad-group">
            <div class="row">
                <div class="third">
                    <!-- CAMPO PARA NOMBRE QUE ES OBLIGATORIO -->
                    <label for="nombre">Nombre *</label>
                    <input type="text" id="nombre" name="nombre" required placeholder="Tu nombre completo">
                </div>
                <div class="third">
                    <!-- CAMPO PARA COLOCAR EL CORREO ANEIAP (DEBE TERMINAR EN @ANEIAP.CO) -->
                    <label for="correo-ticket">Correo *</label>
                    <input type="text" id="correo-ticket" name="correo-ticket" required placeholder="Tu correo ANEIAP para el caso" pattern="^[a-zA-Z0-9._%+-]+@aneiap\.co$">
                </div>
                <div class="third">
                    <!-- CAMPO PARA EL TIPO DEL TICKET (ES UNA LISTA DESPLEGABLE) -->
                    <label for="tipo-ticket">Tipo *</label>
                    <select id="tipo-ticket" name="tipo-ticket" required>
                      <option value="" disabled selected>Seleccione un tipo</option>
                      <option value="Consulta General">Consulta General</option>
                      <option value="Solicitud de Ponentes">Solicitud de Ponentes</option>
                      <option value="Edición de Reserva">Edición de Reserva</option>
                      <option value="Asistencia de Reserva">Asistencia de Cuenta</option>
                      <option value="Problema Técnico">Problema Técnico</option>
                      <option value="Solicitud de Características">Solicitud de Características</option>
                      <option value="Error en la Aplicación">Error en la Aplicación</option>
                      <option value="Solicitud de Capacitación">Solicitud de Capacitación</option>
                      <option value="Reporte de Abuso o Violación de Políticas">Reporte de Abuso o Violación de Políticas</option>
                      <option value="Otros">Otros</option>
                        <!-- Agrega más opciones según sea necesario -->
                    </select>
                </div>
            </div>
            <!-- SEGUNDA FILA DE LA SECCIÓN TICKET CON EXPLICACIÓN DEL CASO, CELULAR Y LINK DE DRIVE PARA EVIDENCIAS -->
            <div class="row">
                <div class="third">
                    <!-- CAMPO DONDE EL USUARIO ESCRIBIRÁ DE FORMA MUY DETALLADA LO QUE OCURRIÓ EN EL CASO -->
                    <label for="explicacion">Explicación caso *</label>
                    <textarea id="explicacion" name="explicacion" rows="1" required placeholder="Describe detalladamente tu caso"></textarea>
                </div>
                <div class="third">
                    <!-- CAMPO DONDE EL USUARIO ESCRIBIRÁ SU NÚMERO DE CELUAR, DEBE SER UN VALOR QUE EMPIECE EN 3 Y TENGA EN TOTAL 10 DÍGITOS -->
                    <label for="celular">Número de tel. *</label>
                    <input type="tel" id="celular" name="celular" required placeholder="Digita tu número de celular" pattern="^3\d{9}$">
                </div>
                <div class="third">
                    <!-- CAMPO DONDE SE ADJUNTARÁ UN LINK DE GOOGLE DRIVE VÁLIDO (OPCIONAL) -->
                    <label for="link-drive">Drive evidencias</label>
                    <textarea id="link-drive" name="link-drive" rows="1" required placeholder="Adjunta link de evidencias en Drive"></textarea>
                </div>
            </div>
          </div>
        </p>
        <h2>INSTRUCCIONES GENERALES 📖</h2>
        <p>
          <div class="disponibilidad-group">
            <div class="row">
            <div class="half">
            <label for="texto2"><b>1️⃣ Todo campo con un asterisco (*) es obligatorio.</b></label>
            <label for="texto3"><b>3️⃣ Las reservas se aprobarán o rechazarán automáticamente dependiendo de la disponibilidad.</b></label>
            </div>
            <div class="half">
            <label for="texto4"><b>2️⃣ Las claves de eventos son personales e intransferibles.</b></label>
            <label for="texto5"><b>4️⃣ Si eliminas una reserva, la perderás para siempre. Todas las reservas mantienen su prioridad incluso si las editas.</b></label>
            </div>
            </div>
          </div>
        </p>
      </div>

      <div id="tab-content-2" class="tab-content">
        <h2>CRÉDITOS, PROPIEDAD Y DOCUMENTACIÓN 💾</h2>
        <p>
          <div class="disponibilidad-group">
          <label for="texto6"><b>- Herramienta creada por Alessandro Villanueva Cantillo, miembro profesional capítulo UNINORTE, puedes dar tus sugerencias, preguntas, reclamos e inquietudes sobre la herramienta al dar click "<a href="http://wa.me/3002252099" target="_blank">AQUÍ</a>"</b></label>
          <label for="texto7"><b>- 🧡 Sé consciente de lo que tenemos y no abuses de la herramienta creando reservas de forma innecesaria o editándola muchas veces, la herramienta tiene limitaciones de almacenamiento y por cada transacción se va agotando 🧡.</b></label>
          <label for="texto8"><b>- Agradecimientos a Said Yanett UNINORTE (logo).</b></label>
          </div>
          <h2>CONSULTA AQUÍ LA DOCUMENTACIÓN DE SIEA 👇🏽📚</h2>
          <div class="disponibilidad-group">
          <p>
            <!--<div class="disponibilidad-group">-->
            <div class="row">
              <!-- Primer documento -->
              <div class="fourth">
                <div class="document">
                  <div class="document-info">
                    <div class="document-title">
                      <a href="https://docs.google.com/document/d/1iTie_bVnFOtKuowy-cCEVALB_oqwg13c/edit?usp=drive_link&ouid=117265505210218235288&rtpof=true&sd=true" target="_blank">🤍 MANUAL DE USUARIO</a>
                    </div>
                    <div class="document-link">
                      <img src="https://i.ibb.co/6DmT312/microsoft-word-macos-bigsur-icon.png" alt="Icono de Word">
                      <a href="https://docs.google.com/document/d/1iTie_bVnFOtKuowy-cCEVALB_oqwg13c/edit?usp=drive_link&ouid=117265505210218235288&rtpof=true&sd=true" target="_blank">AQUÍ</a>
                    </div>
                  </div>
                </div>
              </div>
        
              <!-- Segundo documento -->
              <div class="fourth">
                <div class="document">
                  <div class="document-info">
                    <div class="document-title">
                      <a href="https://docs.google.com/document/d/1xsZgOV8BIxjP31iFnsVrf9Qbf604Wqx_/edit?usp=drive_link&ouid=117265505210218235288&rtpof=true&sd=true" target="_blank">💙 MANUAL ADMINISTRADOR</a>
                    </div>
                    <div class="document-link">
                      <img src="https://i.ibb.co/6DmT312/microsoft-word-macos-bigsur-icon.png" alt="Icono de Word">
                      <a href="https://docs.google.com/document/d/1xsZgOV8BIxjP31iFnsVrf9Qbf604Wqx_/edit?usp=drive_link&ouid=117265505210218235288&rtpof=true&sd=true" target="_blank">AQUÍ</a>
                    </div>
                  </div>
                </div>
              </div>
        
              <!-- Tercer documento -->
              <div class="fourth">
                <div class="document">
                  <div class="document-info">
                    <div class="document-title">
                      <a href="https://docs.google.com/document/d/19dzW0FTPuVoviKiUzshE6tU1HedSrPox/edit?usp=drive_link&ouid=117265505210218235288&rtpof=true&sd=true" target="_blank">🖤 POLÍTICAS DE DATOS</a>
                    </div>
                    <div class="document-link">
                      <img src="https://i.ibb.co/6DmT312/microsoft-word-macos-bigsur-icon.png" alt="Icono de Word">
                      <a href="https://docs.google.com/document/d/19dzW0FTPuVoviKiUzshE6tU1HedSrPox/edit?usp=drive_link&ouid=117265505210218235288&rtpof=true&sd=true" target="_blank">AQUÍ</a>
                    </div>
                  </div>
                </div>
              </div>

              <div class="fourth">
                <div class="document">
                    <div class="document-info">
                        <div class="document-title">
                            <a href="https://drive.google.com/drive/folders/1mnJEmg3-aQD7HCsMaeek6aVbzNUE75cX?usp=sharing" target="_blank">🎥 VIDEOTUTORIALES</a>
                        </div>
                        <div class="document-link">
                            <a href="https://drive.google.com/drive/folders/1mnJEmg3-aQD7HCsMaeek6aVbzNUE75cX?usp=sharing" target="_blank">⏯️AQUÍ</a>
                        </div>
                    </div>
                </div>
              </div>

            </div>
            <!--</div>-->
          </p>
          
          </div>
        </p>
      </div>

      <div id="tab-content-3" class="tab-content">
        <h2></h2>
        <p>
        </p>
      </div>
      <!-- Agrega más contenidos de pestañas según sea necesario -->
  </div>

  <script src="script.js"></script>
  <div class="main-content">
    <!-- El contenido principal de tu página va aquí -->
  </div>

  <!-- DETALLES DEL ACORDEÓN 0 QUE CORRESPONDE A CONSULTAR LA DISPONIBILIDAD DEL CAPÍTULO EN CIERTA(S) FECHA(S)-->
  <div class="acordeon0" onclick="toggleConsultaDisponibilidad()">CONSULTAR DISPONIBILIDAD 🔍</div>
  <div id="acordeon0-content" style="display: none;">
    <div class="acordeon0-content-inner">
      <div class="disponibilidad-group">
        <button id="alternarConsulta" class="boton-alternar-consulta" onclick="alternarConsulta()">Consultar disponibilidad semanal</button>
        <div id="consultaDiaria" style="display: block;">
          <div class="row">
            <!-- Mitad izquierda con el campo para seleccionar la fecha -->
            <div class="half">
              <label for="fecha-consulta"><b>Selecciona el día en el que deseas ver disponibilidad: *</b></label>
              <input type="date" id="fecha-consulta" placeholder="Selecciona la fecha para consultar la disponibilidad.">
            </div>
            <!-- Mitad derecha con el campo para seleccionar el capítulo -->
            <div class="half">
              <label for="capitulo-consulta"><b>Capítulo del que deseas consultar disponibilidad: *</b></label>
              <select id="capitulo-consulta">
                <option value="" disabled selected hidden>Selecciona el capítulo para el que aplica la reserva.</option>
                <option value="uniguajira">UNIGUAJIRA</option>
                <option value="unimagdalena">UNIMAGDALENA</option>
                <option value="uniatlantico">UNIATLÁNTICO</option>
                <option value="uninorte">UNINORTE</option>
                <option value="unisimon">UNISIMÓN</option>
                <option value="cuc">CUC</option>
                <option value="librequilla">LIBREQUILLA</option>
                <option value="utb">UTB</option>
                <option value="upbmonteria">UPBMONTERÍA</option>
                <option value="unicordoba">UNICÓRDOBA</option>
                <option value="areandina">AREANDINA</option>
                <option value="ufps">UFPS</option>
                <option value="unalmed">UNALMED</option>
                <option value="udea">UDEA</option>
                <option value="upbmed">UPBMED</option>
                <option value="utp">UTP</option>
                <option value="unalma">UNALMA</option>
                <option value="udistrital">UDISTRITAL</option>
                <option value="unalbog">UNALBOG</option>
                <option value="univalle">UNIVALLE</option>
                <option value="icesi">ICESI</option>
                <option value="usc">USC</option>
                <option value="librecali">LIBRECALI</option>
                <option value="nacional">ANEIAP NACIONAL</option>
              </select>
            </div>
          </div>
          <!--<button class="button-consultar-disponibilidad" onclick="ConsultarDisponibilidadReservas()">Consultar disponibilidad diaria</button>-->
          <div class="disponibilidad-container">
            <!-- Lógica para mostrar la disponibilidad -->
            <div class="disponibilidad-item gray">08:00 - 08:30</div>
            <div class="disponibilidad-item gray">08:30 - 09:00</div>
            <div class="disponibilidad-item gray">09:00 - 09:30</div>
            <div class="disponibilidad-item gray">09:30 - 10:00</div>
            <div class="disponibilidad-item gray">10:00 - 10:30</div>
            <div class="disponibilidad-item gray">10:30 - 11:00</div>
            <div class="disponibilidad-item gray">11:00 - 11:30</div>
            <div class="disponibilidad-item gray">11:30 - 12:00</div>
            <div class="disponibilidad-item gray">12:00 - 12:30</div>
            <div class="disponibilidad-item gray">12:30 - 13:00</div>
            <div class="disponibilidad-item gray">13:00 - 13:30</div>
            <div class="disponibilidad-item gray">13:30 - 14:00</div>
            <div class="disponibilidad-item gray">14:00 - 14:30</div>
            <div class="disponibilidad-item gray">14:30 - 15:00</div>
            <div class="disponibilidad-item gray">15:00 - 15:30</div>
            <div class="disponibilidad-item gray">15:30 - 16:00</div>
            <div class="disponibilidad-item gray">16:00 - 16:30</div>
            <div class="disponibilidad-item gray">16:30 - 17:00</div>
            <div class="disponibilidad-item gray">17:00 - 17:30</div>
            <div class="disponibilidad-item gray">17:30 - 18:00</div>
            <div class="disponibilidad-item gray">18:00 - 18:30</div>
            <div class="disponibilidad-item gray">18:30 - 19:00</div>
            <div class="disponibilidad-item gray">19:00 - 19:30</div>
            <div class="disponibilidad-item gray">19:30 - 20:00</div>
            <div class="disponibilidad-item gray">20:00 - 20:30</div>
            <div class="disponibilidad-item gray">20:30 - 21:00</div>
            <div class="disponibilidad-item gray">21:00 - 21:30</div>
            <div class="disponibilidad-item gray">21:30 - 22:00</div>
          </div>
          <label for="eventos-programados"><b>Acá aparecerán la lista de eventos programados para el capítulo en esa fecha:</b></label>
          <div class="disponibilidad-group">
            <div id="eventos-programados"></div>
          </div>
        </div>
    <!-- Nueva sección semanal dentro del acordeón 0 -->
    <div id="consultaSemanal" style="display: none;">
        <div class="row">
          <!-- Parte para seleccionar la fecha -->
          <div class="half">
            <label for="fecha-consulta-semanal"><b>Selecciona el día en el que deseas consultar: *</b></label>
            <input type="date" id="fecha-consulta-semanal" placeholder="Selecciona la fecha para consultar la disponibilidad.">
            <!--<button class="button-consultar-disponibilidad" onclick="ConsultarDisponibilidadSemanal()">Consultar disponibilidad semanal</button>-->
          </div>
          <!-- Parte para seleccionar el capítulo -->
          <div class="half">
            <label for="capitulo-consulta-semanal"><b>Capítulo del que deseas consultar disponibilidad: *</b></label>
            <select id="capitulo-consulta-semanal">
              <option value="" disabled selected hidden>Selecciona el capítulo para el que aplica la reserva.</option>
              <option value="uniguajira">UNIGUAJIRA</option>
              <option value="unimagdalena">UNIMAGDALENA</option>
              <option value="uniatlantico">UNIATLÁNTICO</option>
              <option value="uninorte">UNINORTE</option>
              <option value="unisimon">UNISIMÓN</option>
              <option value="cuc">CUC</option>
              <option value="librequilla">LIBREQUILLA</option>
              <option value="utb">UTB</option>
              <option value="upbmonteria">UPBMONTERÍA</option>
              <option value="unicordoba">UNICÓRDOBA</option>
              <option value="areandina">AREANDINA</option>
              <option value="ufps">UFPS</option>
              <option value="unalmed">UNALMED</option>
              <option value="udea">UDEA</option>
              <option value="upbmed">UPBMED</option>
              <option value="utp">UTP</option>
              <option value="unalma">UNALMA</option>
              <option value="udistrital">UDISTRITAL</option>
              <option value="unalbog">UNALBOG</option>
              <option value="univalle">UNIVALLE</option>
              <option value="icesi">ICESI</option>
              <option value="usc">USC</option>
              <option value="librecali">LIBRECALI</option>
              <option value="nacional">ANEIAP NACIONAL</option>
            </select>
          </div>
        </div>
        <p id="semana-seleccionada"></p>
        <div id="calendario-semanal">
          <table class="calendario-semanal-table">
            <thead>
              <tr>
                <th style="width: 15%;">Día de la semana</th>
                <th style="width: 85%;">Eventos reservados</th>
              </tr>
            </thead>
            <tbody id="cuerpo-calendario-semanal">
              <!-- Las filas se generarán dinámicamente con JavaScript -->
            </tbody>
          </table>
        </div>
        <div id="espacios-programados-semanal">
          <!-- Aquí se mostrará la lista de espacios reservados para la semana -->
        </div>
      </div>
    </div>
    <!-- Fin de la sección semanal -->
    </div>
  </div>
  <!-- DETALLES DEL ACORDEÓN 1 QUE CORRESPONDE A REGISTRAR LA RESERVA DEL EVENTO-->
  <div class="acordeon1" onclick="window.location.href = 'https://alessvilla.github.io/SIEA/public/index_reservar.html'">REGISTRA TU ESPACIO ✏️</div>
  <div id="acordeon1-content" style="display: none;">
    <div class="acordeon1-content-inner">
      <div class="reservar-group">
      <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS GENERALES DEL EVENTO 🦉</p></h2>
      <div class="row">
      <div class="half">
      <label for="nombre-evento"><b>Nombre del evento: *</b></label>
      <input type="text" id="nombre-evento" placeholder="Ingresa el nombre de tu evento.">
      <label for="fecha-evento"><b>Fecha del evento: *</b></label>
      <input type="date" id="fecha-evento">
      <label for="hora-evento"><b>Hora del evento: *</b></label>
      <select id="hora-evento">
        <option value="" disabled selected hidden>Selecciona la hora de la reserva.</option>
        <option value="480">08:00</option>
        <option value="510">08:30</option>
        <option value="540">09:00</option>
        <option value="570">09:30</option>
        <option value="600">10:00</option>
        <option value="630">10:30</option>
        <option value="660">11:00</option>
        <option value="690">11:30</option>
        <option value="720">12:00</option>
        <option value="750">12:30</option>
        <option value="780">13:00</option>
        <option value="810">13:30</option>
        <option value="840">14:00</option>
        <option value="870">14:30</option>
        <option value="900">15:00</option>
        <option value="930">15:30</option>
        <option value="960">16:00</option>
        <option value="990">16:30</option>
        <option value="1020">17:00</option>
        <option value="1050">17:30</option>
        <option value="1080">18:00</option>
        <option value="1110">18:30</option>
        <option value="1140">19:00</option>
        <option value="1170">19:30</option>
        <option value="1200">20:00</option>
        <option value="1230">20:30</option>
        <option value="1260">21:00</option>
      </select>
      </div>
      <div class="half">
      <label for="duracion-evento"><b>Duración del evento (en horas): *</b></label>
      <select id="duracion-evento">
        <option value="" disabled selected hidden>Selecciona la duración del evento.</option>
        <option value="30">media hora</option>
        <option value="60">1 hora</option>
        <option value="90">1 hora y media</option>
        <option value="120">2 horas</option>
        <option value="150">2 horas y media</option>
        <option value="180">3 horas</option>
        <option value="210">3 horas y media</option>
        <option value="240">4 horas</option>
        <option value="270">4 horas y media</option>
        <option value="300">5 horas</option>
        <option value="330">5 horas y media</option>
        <option value="360">6 horas</option>
      </select>
      <label for="modalidad-evento"><b>Modalidad del evento: *</b></label>
      <select id="modalidad-evento" onchange="toggleUbicacionPlataforma()">
        <option value="" disabled selected hidden>Selecciona la modalidad del evento.</option>
        <option value="virtual">Virtual</option>
        <option value="presencial">Presencial</option>
      </select>
      <div id="ubicacion-plataforma-container" style="display: none;">
        <label for="ubicacion-plataforma"><b>Ubicación/Plataforma en la reserva: *</b></label>
        <select id="ubicacion-plataforma">
          <option value="" disabled selected hidden>Selecciona la plataforma para el evento.</option>
          <option value="meet">Meet</option>
          <option value="zoom">Zoom</option>
          <option value="teams">Teams</option>
          <option value="otro">Otro</option>
        </select>
      </div>
      <div id="lugar-presencial-container" style="display: none;">
        <label for="lugar-presencial"><b>Especifica el lugar físico del evento en la reserva: *</b></label>
        <input type="text" id="lugar-presencial" placeholder="Escribe el lugar donde el evento se realizará.">
      </div>
      </div>
      </div>
      <div class="row">
      <div class="half">
      <label for="plan-evento"><b>Plan del evento: *</b></label>
      <textarea id="plan-evento" rows="5" placeholder="Detalla el paso a paso de lo que se realizará en el evento y cuáles son las estrategias para garantizar que este sí se lleve a cabo de forma exitosa."></textarea>
      </div>
      <div class="half">
      <label for="observaciones-evento"><b>Observaciones del evento:</b></label>
      <textarea id="observaciones-evento" rows="5" placeholder="Especifica cualquier observación adicional que desees que sea tenida en cuenta para el desarrollo del evento."></textarea>
      </div>
      </div>
      <div class="row">
        <div class="half">
          <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS DEL ORGANIZADOR</p></h2>
          <label for="nombre-organizador"><b>Nombre del organizador: *</b></label>
          <input type="text" id="nombre-organizador" placeholder="Ingresa tu nombre.">
          <div class="row">
            <div class="half">
                <label for="email-organizador"><b>Email del organizador: *</b></label>
                <input type="text" id="email-organizador" placeholder="Ingresa tu email.">
            </div>
            <div class="half">
                <label for="capitulo-organizador"><b>Capítulo del organizador: *</b></label>
                <select id="capitulo-organizador">
                  <option value="" disabled selected hidden>Selecciona el capítulo para el que aplica la reserva.</option>
                  <option value="uniguajira">UNIGUAJIRA</option>
                  <option value="unimagdalena">UNIMAGDALENA</option>
                  <option value="uniatlantico">UNIATLÁNTICO</option>
                  <option value="uninorte">UNINORTE</option>
                  <option value="unisimon">UNISIMÓN</option>
                  <option value="cuc">CUC</option>
                  <option value="librequilla">LIBREQUILLA</option>
                  <option value="utb">UTB</option>
                  <option value="upbmonteria">UPBMONTERÍA</option>
                  <option value="unicordoba">UNICÓRDOBA</option>
                  <option value="areandina">AREANDINA</option>
                  <option value="ufps">UFPS</option>
                  <option value="unalmed">UNALMED</option>
                  <option value="udea">UDEA</option>
                  <option value="upbmed">UPBMED</option>
                  <option value="utp">UTP</option>
                  <option value="unalma">UNALMA</option>
                  <option value="udistrital">UDISTRITAL</option>
                  <option value="unalbog">UNALBOG</option>
                  <option value="univalle">UNIVALLE</option>
                  <option value="icesi">ICESI</option>
                  <option value="usc">USC</option>
                  <option value="librecali">LIBRECALI</option>
                  <option value="nacional">ANEIAP NACIONAL</option>
                </select>
            </div>
          </div>
          <label for="telefono-organizador"><b>Teléfono del organizador: *</b></label>
          <input type="tel" id="telefono-organizador" placeholder="Ingresa tu número de teléfono.">
        </div>
        <div class="half">
          <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS DEL PONENTE</p></h2>
          <label for="nombre-ponente"><b>Nombre del ponente: *</b></label>
          <input type="text" id="nombre-ponente" placeholder="Ingresa el nombre del ponente.">
          <label for="email-ponente"><b>Email del ponente:</b></label>
          <input type="text" id="email-ponente" placeholder="Ingresa el email del ponente.">
          <label for="telefono-ponente"><b>Teléfono del ponente:</b></label>
          <input type="tel" id="telefono-ponente" placeholder="Ingresa el número de teléfono del ponente.">
        </div>
      </div>
      <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS PARA EL COMITÉ DE PIEZAS</p></h2>
      <div class="row">
        <div class="third">
          <label for="publicidad-comite"><b>¿Deseas que el comité de piezas capitular te realice la publicidad del espacio? *</b></label>
          <select id="publicidad-comite">
            <option value="si">SÍ</option>
            <option value="no">NO</option>
          </select>
        </div>
        <div class="third">
          <label for="observaciones-publicidad"><b>Observaciones a tener en cuenta para que el comité de piezas tenga en cuenta al hacer tu publicidad:</b></label>
          <textarea id="observaciones-publicidad" rows="1" placeholder="Ingresa observaciones para la publicidad del evento."></textarea>
        </div>
        <div class="third">
          <label for="foto-ponente"><b>Enlace de Google Drive de la foto del ponente para que el comité de publicidad la coloque en la pieza:</b></label>
          <input type="text" id="foto-ponente" placeholder="Ingresa el enlace de Google Drive, debe estar compartido para cualquier correo.">
        </div>
      </div>
      <button class="button-reservar" onclick="registrarEvento()">Registrar evento</button>
      </div>
    </div>
  </div>
  <!-- DETALLES DEL ACORDEÓN 2 QUE CORRESPONDE A CONSULTAR LA RESERVA DE UN EVENTO-->
  <div class="acordeon2" onclick="toggleEditarReserva()">EDITA TU RESERVA 📝</div>
  <div id="acordeon2-content" style="display: none;">
    <div class="acordeon2-content-inner">
      <div class="editar-group">
      <label for="clave-evento-reserva"><b>Digita la clave del evento en la reserva: *</b></label>
      <input type="text" id="clave-evento-reserva" placeholder="Ingresa la clave del evento que fue enviada a tu correo de forma automática al momento de reservar el espacio.">
      
      <button class="button-consultar" onclick="consultarReserva()">Consultar reserva</button>
      </div>

      <!-- Campos para la consulta de reserva -->
      <div id="datos-reserva-container" style="display: none;">
        <div class="editar-group">
        <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS DE TU RESERVA 📚</p></h2>
        <div class="row">
        <div class="half">
        <label for="nombre-evento-reserva"><b>Nombre del evento en la reserva: *</b></label>
        <input type="text" id="nombre-evento-reserva" placeholder="Acá aparecerá el nombre del evento de la reserva.">
        <label for="fecha-evento-reserva"><b>Fecha del evento en la reserva: *</b></label>
        <input type="date" id="fecha-evento-reserva">
        <label for="hora-evento-reserva"><b>Hora del evento en la reserva: *</b></label>
        <select id="hora-evento-reserva">
            <option value="" disabled selected hidden>Selecciona la hora que tiene la reserva.</option>
            <option value="480">08:00</option>
            <option value="510">08:30</option>
            <option value="540">09:00</option>
            <option value="570">09:30</option>
            <option value="600">10:00</option>
            <option value="630">10:30</option>
            <option value="660">11:00</option>
            <option value="690">11:30</option>
            <option value="720">12:00</option>
            <option value="750">12:30</option>
            <option value="780">13:00</option>
            <option value="810">13:30</option>
            <option value="840">14:00</option>
            <option value="870">14:30</option>
            <option value="900">15:00</option>
            <option value="930">15:30</option>
            <option value="960">16:00</option>
            <option value="990">16:30</option>
            <option value="1020">17:00</option>
            <option value="1050">17:30</option>
            <option value="1080">18:00</option>
            <option value="1110">18:30</option>
            <option value="1140">19:00</option>
            <option value="1170">19:30</option>
            <option value="1200">20:00</option>
            <option value="1230">20:30</option>
            <option value="1260">21:00</option>
        </select>
        </div>
        <div class="half">
        <label for="duracion-evento-reserva"><b>Duración del evento en la reserva (en horas): *</b></label>
        <select id="duracion-evento-reserva">
            <option value="" disabled selected hidden>Selecciona la duración de la reserva.</option>
            <option value="30">media hora</option>
            <option value="60">1 hora</option>
            <option value="90">1 hora y media</option>
            <option value="120">2 horas</option>
            <option value="150">2 horas y media</option>
            <option value="180">3 horas</option>
            <option value="210">3 horas y media</option>
            <option value="240">4 horas</option>
            <option value="270">4 horas y media</option>
            <option value="300">5 horas</option>
            <option value="330">5 horas y media</option>
            <option value="360">6 horas</option>
        </select>
        <label for="modalidad-evento-reserva"><b>Modalidad del evento en la reserva: *</b></label>
        <select id="modalidad-evento-reserva" onchange="toggleUbicacionPlataformaReserva()">
            <option value="" disabled selected hidden>Selecciona la modalidad que colocaste en la reserva.</option>
          <option value="virtual">Virtual</option>
          <option value="presencial">Presencial</option>
        </select>
        <div id="ubicacion-plataforma-reserva-container" style="display: none;">
          <label for="ubicacion-plataforma-reserva"><b>Ubicación/Plataforma en la reserva: *</b></label>
          <select id="ubicacion-plataforma-reserva">
            <option value="" disabled selected hidden>Selecciona la plataforma que colocaste en la reserva.</option>
            <option value="meet">Meet</option>
            <option value="zoom">Zoom</option>
            <option value="teams">Teams</option>
            <option value="otro">Otro</option>
          </select>
        </div>
        <div id="lugar-presencial-reserva-container" style="display: none;">
          <label for="lugar-presencial-reserva"><b>Especifica el lugar físico del evento en la reserva: *</b></label>
          <input type="text" id="lugar-presencial-reserva" placeholder="Escribe el lugar donde el evento se realizará.">
        </div>
        </div>
        </div>
        <div class="row">
        <div class="half">
        <label for="plan-evento-reserva"><b>Plan del evento en la reserva: *</b></label>
        <textarea id="plan-evento-reserva" rows="5" placeholder="Acá aparecerá el plan del evento de la reserva."></textarea>
        </div>
        <div class="half">
        <label for="observaciones-evento-reserva"><b>Observaciones del evento en la reserva:</b></label>
        <textarea id="observaciones-evento-reserva" rows="5" placeholder="Acá aparecerán las observaciones adicionales de la reserva."></textarea>
        </div>    
        </div>
        <div class="row">
          <div class="half">
            <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS DEL ORGANIZADOR</p></h2>
            <label for="nombre-organizador-reserva"><b>Nombre del organizador en la reserva: *</b></label>
            <input type="text" id="nombre-organizador-reserva" placeholder="Acá aparecerá el nombre del organizador de la reserva.">
            <div class="row">
              <div class="half">
                <label for="email-organizador-reserva"><b>Email del organizador en la reserva: *</b></label>
                <input type="text" id="email-organizador-reserva" placeholder="Acá aparecerá el email del organizador de la reserva.">
              </div>
             <div class="half">
              <label for="capitulo-organizador-reserva"><b>Capítulo al que aplica la reserva: *</b></label>
              <select id="capitulo-organizador-reserva">
                <option value="" disabled selected hidden>Selecciona el capítulo para el que aplica la reserva.</option>
                <option value="uniguajira">UNIGUAJIRA</option>
                <option value="unimagdalena">UNIMAGDALENA</option>
                <option value="uniatlantico">UNIATLÁNTICO</option>
                <option value="uninorte">UNINORTE</option>
                <option value="unisimon">UNISIMÓN</option>
                <option value="cuc">CUC</option>
                <option value="librequilla">LIBREQUILLA</option>
                <option value="utb">UTB</option>
                <option value="upbmonteria">UPBMONTERÍA</option>
                <option value="unicordoba">UNICÓRDOBA</option>
                <option value="areandina">AREANDINA</option>
                <option value="ufps">UFPS</option>
                <option value="unalmed">UNALMED</option>
                <option value="udea">UDEA</option>
                <option value="upbmed">UPBMED</option>
                <option value="utp">UTP</option>
                <option value="unalma">UNALMA</option>
                <option value="udistrital">UDISTRITAL</option>
                <option value="unalbog">UNALBOG</option>
                <option value="univalle">UNIVALLE</option>
                <option value="icesi">ICESI</option>
                <option value="usc">USC</option>
                <option value="librecali">LIBRECALI</option>
                <option value="nacional">ANEIAP NACIONAL</option>
              </select>
              </div>
              </div>
            <label for="telefono-organizador-reserva"><b>Teléfono del organizador en la reserva: *</b></label>
            <input type="tel" id="telefono-organizador-reserva" placeholder="Acá aparecerá el número de teléfono del organizador de la reserva.">
          </div>
          <div class="half">
            <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS DEL PONENTE</p></h2>
            <label for="nombre-ponente-reserva"><b>Nombre del ponente en la reserva: *</b></label>
            <input type="text" id="nombre-ponente-reserva" placeholder="Acá aparecerá el nombre del ponente de la reserva.">
            <label for="email-ponente-reserva"><b>Email del ponente en la reserva:</b></label>
            <input type="text" id="email-ponente-reserva" placeholder="Acá aparecerá el email del ponente de la reserva.">
            <label for="telefono-ponente-reserva"><b>Teléfono del ponente en la reserva:</b></label>
            <input type="tel" id="telefono-ponente-reserva" placeholder="Acá aparecerá el número de teléfono del ponente de la reserva.">
          </div>
        </div>
        <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS PARA EL COMITÉ DE PIEZAS</p></h2>
        <div class="row">
          <div class="third">
            <label for="publicidad-comite-reserva"><b>¿Deseas que el comité de piezas capitular te realice la publicidad del espacio? *</b></label>
            <select id="publicidad-comite-reserva">
              <option value="si">SÍ</option>
              <option value="no">NO</option>
            </select>
          </div>
          <div class="third">
            <label for="observaciones-publicidad-reserva"><b>Observaciones a tener en cuenta para que el comité de piezas tenga en cuenta al hacer tu publicidad:</b></label>
            <textarea id="observaciones-publicidad-reserva" rows="1" placeholder="Ingresa observaciones para la publicidad del evento."></textarea>
          </div>
          <div class="third">
            <label for="foto-ponente-reserva"><b>Enlace de Google Drive de la foto del ponente para que el comité de publicidad la coloque en la pieza:</b></label>
            <input type="text" id="foto-ponente-reserva" placeholder="Ingresa el enlace de Google Drive, debe estar compartido para cualquier correo.">
          </div>
        </div>
        <button class="button-consultar" onclick="editarReserva()">Enviar edición de reserva</button>
        </div>
      </div>
    </div>
  </div>
  <!-- DETALLES Y CAMPOS DEL ACORDEÓN 3 QUE CORRESPONDE A ELIMINAR (CANCELAR) LA RESERVA DE UN EVENTO-->
  <div class="acordeon3" onclick="toggleEliminarReserva()">ELIMINA TU RESERVA ⛔</div>
  <div id="acordeon3-content" style="display: none;">
    <div class="acordeon3-content-inner">
      <div class="eliminar-group">
      <div class="row">
      <div class="half">
      <label for="fecha-evento-eliminar"><b>Fecha del evento a cancelar: *</b></label>
      <input type="date" id="fecha-evento-eliminar" placeholder="Selecciona la fecha del evento que deseas cancelar.">
      </div>
      <div class="half">
      <label for="hora-evento-eliminar"><b>Hora del evento que deseas cancelar: *</b></label>
      <select id="hora-evento-eliminar">
        <option value="" disabled selected hidden>Selecciona la hora de la reserva que deseas cancelar.</option>
        <option value="08:00">08:00</option>
        <option value="08:30">08:30</option>
        <option value="09:00">09:00</option>
        <option value="09:30">09:30</option>
        <option value="10:00">10:00</option>
        <option value="10:30">10:30</option>
        <option value="11:00">11:00</option>
        <option value="11:30">11:30</option>
        <option value="12:00">12:00</option>
        <option value="12:30">12:30</option>
        <option value="13:00">13:00</option>
        <option value="13:30">13:30</option>
        <option value="14:00">14:00</option>
        <option value="14:30">14:30</option>
        <option value="15:00">15:00</option>
        <option value="15:30">15:30</option>
        <option value="16:00">16:00</option>
        <option value="16:30">16:30</option>
        <option value="17:00">17:00</option>
        <option value="17:30">17:30</option>
        <option value="18:00">18:00</option>
        <option value="18:30">18:30</option>
        <option value="19:00">19:00</option>
        <option value="19:30">19:30</option>
        <option value="20:00">20:00</option>
        <option value="20:30">20:30</option>
        <option value="21:00">21:00</option>
      </select>
      </div>
      </div>
      <label for="clave-evento-eliminar"><b>Digita la clave del evento en la reserva: *</b></label>
      <input type="text" id="clave-evento-eliminar" placeholder="Ingresa la clave del evento que fue enviada a tu correo de forma automática al momento de reservar el espacio.">
      <button class="button-eliminar" onclick="eliminarReserva()">Eliminar reserva</button>  
      </div>
    </div>
  </div>
  <!-- DETALLES DEL ACORDEÓN 4 PARA EVALUACIÓN DE SATISFACCIÓN DEL ESPACIO -->
  <div class="acordeon4" onclick="window.location.href = 'https://alessvilla.github.io/SIEA/public/index_evaluar.html'">EVALÚA UN ESPACIO / EVENTO 🌟</div>
  <div id="acordeon4-content" style="display: none;">
    <div class="acordeon4-content-inner">
      <!-- Contenido para evaluar espacio -->
      <button class="alternarConsulta" onclick="alternarEvaluacion()">Click aquí para evaluar el CRM de un evento.</button>

      <div class="evaluar-group" id="evaluar-espacio">
      <!-- Botón para alternar entre evaluar espacio y evaluar evento -->
        <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS GENERALES DEL ESPACIO 🏢</p></h2>
        <div class="row">
          <div class="half">
            <label for="nombre-asistente"><b>Nombre completo del asistente: *</b></label>
            <input type="text" id="nombre-asistente" placeholder="Ingresa tu nombre.">
            <label for="telefono-asistente"><b>Teléfono del asistente: *</b></label>
            <input type="tel" id="telefono-asistente" placeholder="Ingresa tu número de teléfono.">
          </div>
          <div class="half">
            <label for="correo-asistente"><b>Correo del asistente: *</b></label>
            <input type="text" id="correo-asistente" placeholder="Ingresa tu correo electrónico.">
            <label for="capitulo-espacio"><b>Capítulo que organizó y se hizo cargo del espacio: *</b></label>
            <select id="capitulo-espacio">
              <option value="" disabled selected hidden>Selecciona el capítulo que organizó el espacio.</option>
              <option value="uniguajira">UNIGUAJIRA</option>
              <option value="unimagdalena">UNIMAGDALENA</option>
              <option value="uniatlantico">UNIATLÁNTICO</option>
              <option value="uninorte">UNINORTE</option>
              <option value="unisimon">UNISIMÓN</option>
              <option value="cuc">CUC</option>
              <option value="librequilla">LIBREQUILLA</option>
              <option value="utb">UTB</option>
              <option value="upbmonteria">UPBMONTERÍA</option>
              <option value="unicordoba">UNICÓRDOBA</option>
              <option value="areandina">AREANDINA</option>
              <option value="ufps">UFPS</option>
              <option value="unalmed">UNALMED</option>
              <option value="udea">UDEA</option>
              <option value="upbmed">UPBMED</option>
              <option value="utp">UTP</option>
              <option value="unalma">UNALMA</option>
              <option value="udistrital">UDISTRITAL</option>
              <option value="unalbog">UNALBOG</option>
              <option value="univalle">UNIVALLE</option>
              <option value="icesi">ICESI</option>
              <option value="usc">USC</option>
              <option value="librecali">LIBRECALI</option>
              <option value="nacional">ANEIAP NACIONAL</option>
            </select>
          </div>
        </div>
        <label for="nombre-espacio"><b>Nombre del espacio a evaluar: *</b></label>
        <select id="nombre-espacio">
          <option value="" disabled selected hidden>Debes seleccionar primero un capítulo para seleccionar el espacio.</option>
          <!-- Aquí puedes agregar opciones para los espacios disponibles -->
        </select>
        <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">EVALÚA EL ESPACIO 📝</p></h2>
        <p>Evalúa del 1 al 10 los siguientes aspectos siendo 1 la menor nota y 10 la máxima nota:</p>
        <div class="row">
          <div class="half">
            <label for="pregunta1"><b>1️⃣ </b> ¿Qué tan satisfecho te sientes con el espacio brindado? *</label>
            <select id="pregunta1">
              <option value="" disabled selected hidden>Califica del 1 al 10.</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </div>
          <div class="half">
            <label for="pregunta2"><b>2️⃣ </b> ¿Qué tanto aprendiste por haber asistido al espacio? *</label>
            <select id="pregunta2">
              <option value="" disabled selected hidden>Califica del 1 al 10.</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="half">
            <label for="pregunta3"><b>3️⃣ </b> Evalúa la calidad del ponente/organizador del espacio. *</label>
            <select id="pregunta3">
              <option value="" disabled selected hidden>Califica del 1 al 10.</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </div>
          <div class="half">
            <label for="pregunta4"><b>4️⃣ </b> Deja acá tus comentarios, sugerencias y retroalimentaciones.</label>
            <textarea id="pregunta4" rows="1" placeholder="Escribe tus comentarios y sugerencias aquí en caso de que tengas alguno (recomendado)."></textarea>
          </div>
        </div>
        <button class="button-evaluar" onclick="evaluarEspacio()">Enviar evaluación</button>
      </div>

      <!-- Contenido para evaluar evento (inicialmente oculto) -->
      <div class="evaluar-group" id="evaluar-evento" style="display: none;">

        <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DATOS GENERALES DEL EVENTO CAPITULAR/NACIONAL 🏢</p></h2>
          <div class="row">
            <div class="fourth">
                <label for="nombre-asistente"><b>Nombre completo asistente: *</b></label>
                <input type="text" id="nombre-asistente" placeholder="Ingresa tu nombre.">
            </div>
            <div class="fourth">
                <label for="telefono-asistente"><b>Teléfono del asistente: *</b></label>
                <input type="tel" id="telefono-asistente" placeholder="Ingresa tu número de teléfono.">
            </div>
            <div class="fourth">
                <label for="correo-asistente"><b>Correo del asistente: *</b></label>
                <input type="text" id="correo-asistente" placeholder="Ingresa tu correo electrónico.">
            </div>
            <div class="fourth">
                <label for="evento-crm"><b>Evento al que asististe: *</b></label>
                <select id="evento-crm">
                  <option value="" disabled selected hidden>Selecciona el evento.</option>
                  <option value="evento1">Evento 1</option>
                  <option value="evento2">Evento 2</option>
                  <!-- Agrega opciones para otros eventos -->
                </select>
            </div>
          </div>

        <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">EVALÚA EL EVENTO 📝</p></h2>
        <p>Recientemente estuviste en un evento organizado por la ANEIAP. Del 1 al 10, siendo 10 el puntaje máximo.</p>
        <div class="row">
          <div class="half">
            <label for="pregunta1"><b>1️⃣ </b> ¿Qué tan probable es que recomiendes los eventos de la ANEIAP a otras personas? *</label>
            <select id="pregunta1">
              <option value="" disabled selected hidden>Califica del 1 al 10.</option>
              <!-- Opciones de 1 a 10 -->
            </select>
          </div>
          <div class="half">
            <label for="pregunta2"><b>2️⃣ </b> ¿Qué tan adecuadas considera que fueron las instalaciones para el evento? *</label>
            <select id="pregunta2">
              <option value="" disabled selected hidden>Califica del 1 al 10.</option>
              <!-- Opciones de 1 a 10 -->
            </select>
          </div>
        </div>
        <div class="row">
          <div class="half">
              <label for="pregunta3"><b>3️⃣ </b> ¿Cómo calificarías la puntualidad en el desarrollo de las actividades? *</label>
              <select id="pregunta3">
                  <option value="" disabled selected hidden>Califica del 1 al 10.</option>
                  <!-- Opciones de 1 a 10 -->
              </select>
          </div>
          <div class="half">
              <label for="pregunta4"><b>4️⃣ </b> ¿Cómo calificarías tu paso por la mesa de acreditación? *</label>
              <select id="pregunta4">
                  <option value="" disabled selected hidden>Califica del 1 al 10.</option>
                  <!-- Opciones de 1 a 10 -->
              </select>
          </div>
          </div>
          <!-- Repite el mismo patrón para las siguientes preguntas -->
          <!-- Pregunta 5 -->
          <div class="row">
              <!-- Primer half -->
              <div class="half">
                  <label for="pregunta5"><b>5️⃣ </b> ¿Cómo calificarías la apertura del evento? *</label>
                  <select id="pregunta5">
                      <option value="" disabled selected hidden>Califica del 1 al 10.</option>
                      <!-- Opciones de 1 a 10 -->
                  </select>
              </div>
              <!-- Segundo half -->
              <div class="half">
                <label for="pregunta6"><b>6️⃣ </b> ¿Cómo calificarías el trabajo logístico del comité organizador? *</label>
                <select id="pregunta6">
                    <option value="" disabled selected hidden>Califica del 1 al 10.</option>
                    <!-- Opciones de 1 a 10 -->
                </select>
            </div>
          </div>
          <!-- Pregunta 7 -->
          <div class="row">
              <!-- Primer half -->
              <div class="half">
                  <label for="pregunta7"><b>7️⃣ </b> ¿Cómo calificarías la atención por parte del comité organizador? *</label>
                  <select id="pregunta7">
                      <option value="" disabled selected hidden>Califica del 1 al 10.</option>
                      <!-- Opciones de 1 a 10 -->
                  </select>
              </div>
              <!-- Segundo half -->
              <div class="half">
                <label for="pregunta8"><b>8️⃣ </b> ¿Cómo calificarías la agenda del evento? *</label>
                <select id="pregunta8">
                    <option value="" disabled selected hidden>Califica del 1 al 10.</option>
                    <!-- Opciones de 1 a 10 -->
                </select>
              </div>
          </div>
          <!-- Repite el mismo patrón para las siguientes preguntas -->
          <!-- Pregunta 9 -->
          <div class="row">
              <!-- Primer half -->
              <div class="half">
                <label for="pregunta9"><b>9️⃣ </b> ¿Cómo calificarías al(los) conferencista(s)? *</label>
                <select id="pregunta9">
                    <option value="" disabled selected hidden>Califica del 1 al 10.</option>
                    <!-- Opciones de 1 a 10 -->
                </select>
              </div>
              <!-- Segundo half -->
              <div class="half">
                <label for="pregunta10"><b>1️⃣0️⃣ </b> ¿Cómo calificarías las temáticas del evento? *</label>
                <select id="pregunta10">
                    <option value="" disabled selected hidden>Califica del 1 al 10.</option>
                    <!-- Opciones de 1 a 10 -->
                </select>
              </div>
          </div>
          <!-- Repite el mismo patrón para las siguientes preguntas -->
          <!-- Pregunta 11 -->
          <div class="row">
              <!-- Primer half -->
              <div class="half">
                  <label for="pregunta11"><b>1️⃣1️⃣ </b> ¿Qué tan adecuada consideras que fue la publicidad del evento? *</label>
                  <select id="pregunta11">
                      <option value="" disabled selected hidden>Califica del 1 al 10.</option>
                      <!-- Opciones de 1 a 10 -->
                  </select>
              </div>
              <!-- Segundo half -->
              <div class="half">
                  <!-- Espacio para la pregunta 12 -->
              </div>
          </div>
        <button class="button-evaluar" onclick="evaluarEvento()">Enviar evaluación de evento</button>
      </div>

    </div>
  </div>
  <!-- DETALLES DEL ACORDEÓN 5 PARA VISUALIZACIÓN Y ACTUALIZACIÓN DE ESPACIOS -->
  <div class="acordeon5" onclick="toggleVisualizarActualizarEspacios()">VISUALIZA Y ACTUALIZA ESPACIOS 🛠️</div>
  <div id="acordeon5-content" style="display: none;">
    <div class="acordeon5-content-inner">
      <div class="actualizar-group">
        <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DETALLES DEL ESPACIO 🏢</p></h2>
        <div class="row">
          <div class="half">
            <p id="capitulo-usuario"> <!-- Aquí se mostrará dinámicamente el capítulo del usuario --> </p>
          </div>
          <div class="half">
            <div class="row">
              <div class="quarter">
                <label for="fecha-inicial"><b>Fecha inicial: *</b></label>
                <input type="date" id="fecha-inicial">
              </div>
              <div class="quarter">
                <label for="fecha-final"><b>Fecha final: *</b></label>
                <input type="date" id="fecha-final">
              </div>
              <div class="quarter">
                <label for="total-asistentes"><b># de asistentes:</b></label>
                <input type="text" id="total-asistentes">
              </div>
              <div class="quarter">
                <label for="link-evidencia"><b>Evidencia (drive):</b></label>
                <input type="text" id="link-evidencia">
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="half">
            <label for="nombre-espacio-actualizar"><b>Nombre del espacio a actualizar: *</b></label>
            <select id="nombre-espacio-actualizar">
              <option value="" disabled selected hidden>Debes seleccionar primero la fecha inicial y final a consultar.</option>
              <!-- Aquí se cargarán dinámicamente los nombres de los espacios disponibles para el capítulo del usuario -->
            </select>
          </div>
          <div class="half">
            <div class="row">
              <div class="half">
                <label for="tipo-espacio"><b>Tipo de espacio: *</b></label>
                <select id="tipo-espacio">
                  <option value="" disabled selected hidden>Selecciona el tipo de espacio.</option>
                  <option value="valor-agregado">VALOR AGREGADO ➕</option>
                  <option value="entrenamiento-interno">ENTRENAMIENTO INTERNO 🏋🏻</option>
                  <option value="integracion-entorno">INTEGRACIÓN CON EL ENTORNO 🏭</option>
                  <option value="ninguno">No es espacio de FI o IE</option>
                </select>
              </div>
              <div class="half">
                <label for="area-trabajo"><b>Área de trabajo: *</b></label>
                <select id="area-trabajo">
                  <option value="" disabled selected hidden>Selecciona el área de trabajo del espacio.</option>
                  <option value="academico">ACADÉMICO 💚</option>
                  <option value="comunicaciones">COMUNICACIONES 🩵</option>
                  <option value="desarrollo">DESARROLLO 💛</option>
                  <option value="finanzas">FINANZAS 💜</option>
                  <option value="mercadeo">MERCADEO ❤️</option>
                  <option value="habilidades-duras">HABILIDADES DURAS 🧠</option>
                  <option value="habilidades-blandas">HABILIDADES BLANDAS 🫂</option>
                  <option value="conocimiento-aneiap">CONOCIMIENTO ANEIAP 💚💙</option>
                  <option value="integracion-entorno">INTEGRACIÓN CON EL ENTORNO 🏭</option>
                  <option value="ninguno">No es espacio de FI o IE</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <button class="button-actualizar" onclick="actualizarEspacio()">Actualizar espacio</button>
        <div>
          <button class="button-actualizar" onclick="editarInformacionInterna()">Edición interna</button>
        </div>
        <!-- Mini sección de estadísticas -->
        <div class="actualizar-group">
          <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">DASHBOARD ESTADÍSTICO DE ESPACIOS DE FORMACIÓN 📊</p></h2>
          <p id="dashboardEstado" style="text-align: center; display: block;">El dashboard estadístico está oculto.</p>
          <button id="toggleDashboard" onclick="toggleDashboard()" style="margin-left: auto;">Mostrar dashboard</button>
          <div id="estadisticas-container" style="display: none;">
            <div class="row">
                <div class="half">
                        Aquí aparecerá el cumplimiento del plan de formación:
                    <div id="porcentajes-container" style="display: none;">
                    </div>
                    <canvas id="grafico-metas"></canvas>
                </div>
                <div class="half">
                        Acá podrás ver estadísticas sobre el NPS en los espacios:
                    <div id="satisfaccion-container" style="display: none;">
                    </div>
                    <canvas id="grafico-satisfaccion"></canvas>
                </div>
            </div>
          </div>
        </div>
        <!-- Aquí se incluye la tabla resumen -->
        <div class="actualizar-group">
          <div id="tabla-resumen-container">
            <h2 style="font-size: 22px; text-transform: uppercase;"><p style="text-align: center;">TABLA RESUMEN DE SATISFACCIÓN DE ESPACIOS 📋</p></h2>
            <p id="tablaResumenEstado" style="text-align: center; display: block;">La tabla resumen se encuentra oculta.</p>
            <button id="toggleTablaResumen" onclick="toggleTablaResumen()" style="margin-left: auto;">Mostrar tabla resumen</button>
            <table id="tabla-resumen" style="display: none;">
              <!-- Aquí se generará dinámicamente la tabla resumen -->
            </table>
          </div>
        </div>
        <!-- CUARTA MINISECCIÓN: RESPUESTAS DE EVALUACIONES DE SATISFACCIÓN -->
        <div class="actualizar-group">
          <h2 style="font-size: 22px; text-transform: uppercase;">
            <p style="text-align: center;">RESPUESTAS DE EVALUACIONES DE SATISFACCIÓN 📝</p>
          </h2>
          <!-- Desplegable para elegir el evento -->
          <div class="row">
            <div class="half">
              <label for="nombre-espacio-consultar-evaluaciones"><b>Selecciona un evento:</b></label>
              <select id="nombre-espacio-consultar-evaluaciones" onchange="consultarEvaluaciones()">
                <option value="" disabled selected hidden>Debes seleccionar una fecha inicial y una fecha final primero</option>
                <!-- Aquí se cargarán dinámicamente los eventos disponibles para el capítulo del usuario -->
              </select>
            </div>
            <div class="half">
              <div class="row">
                <div class="half">
                  <label for="fecha-inicial-evaluaciones"><b>Fecha inicial:</b></label>
                  <input type="date" id="fecha-inicial-evaluaciones">
                </div>
                <div class="half">
                  <label for="fecha-final-evaluaciones"><b>Fecha final:</b></label>
                  <input type="date" id="fecha-final-evaluaciones">
                </div>
              </div>
            </div>
          </div>
          <!-- Botón para ocultar o mostrar la tabla de evaluaciones -->
          <button id="toggleEvaluaciones" onclick="toggleEvaluaciones()">Mostrar tabla de evaluaciones</button>
          <!-- Mensaje de estado de la tabla -->
          <p id="estadoTablaEvaluaciones" style="text-align: center; display: block;">La tabla de evaluaciones de satisfacción está oculta</p>
          <!-- Tabla con las evaluaciones -->
          <table id="tabla-evaluaciones" class="tabla-evaluaciones" style="display: none;">
            <thead>
              <tr>
                <th style="width: 15%;">Nombre del asistente</th>
                <th style="width: 15%;">Correo asistente</th>
                <th style="width: 10%;">Teléfono asistente</th>
                <th style="width: 10%;">¿Qué tan satisfecho estás del 1 al 10?</th>
                <th style="width: 10%;">¿Cuánto aprendiste del 1 al 10?</th>
                <th style="width: 10%;">Evalúa el ponente del 1 al 10</th>
                <th style="width: auto;">Comentarios</th>
              </tr>
            </thead>
            <tbody>
              <!-- Aquí se generarán dinámicamente las filas de la tabla -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>

    // Variables para la evaluación del espacio dentro del Acordeón 4 y actualización de info del espacio en Acordeón 5:
    var fechaHoy = new Date().toISOString().slice(0, 10);
    var capituloEspacioSelect = document.getElementById("capitulo-espacio");

    // Función para que los nombres de los espacios que están disponibles para evaluar se actualicen a
    // Todos aquellos que tengan una fecha de evento entre HOY y hace 3 SEMANAS, luego de 3 semanas no se podrá evaluar
    capituloEspacioSelect.addEventListener("change", function() {
        var capituloSeleccionado = document.getElementById("capitulo-espacio").value;
        // Calcular la fecha de hace tres semanas
        var tresSemanasAtras = new Date();
        tresSemanasAtras.setDate(tresSemanasAtras.getDate() - 21); // Restar 21 días para tres semanas
        
        // Formatear la fecha de tres semanas atrás en el formato YYYY-MM-DD
        var dia = String(tresSemanasAtras.getDate()).padStart(2, '0');
        var mes = String(tresSemanasAtras.getMonth() + 1).padStart(2, '0');
        var año = tresSemanasAtras.getFullYear();
        var fechaTresSemanasAtras = año + '-' + mes + '-' + dia;
        console.log("la fecha de hace 3 semanas es con función " + fechaTresSemanasAtras);
        // Obtener las reservas para el capítulo y dentro del rango de fechas
        var reservasRef = firebase.firestore().collection("reservas");
        var consulta = reservasRef.where("capitulo", "==", capituloSeleccionado)
                                  .where("fechaEvento", ">=", fechaTresSemanasAtras)
                                  .where("fechaEvento", "<=", fechaHoy)

        consulta.get().then(function(querySnapshot) {
          var nombresEventos = [];
          querySnapshot.forEach(function(doc) {
              nombresEventos.push(doc.data().nombreEvento);
          });
          nombresEventos.sort(); // Orden alfabético
          // Agregar opciones al select
          var nombreEspacioSelect = document.getElementById("nombre-espacio");
          nombreEspacioSelect.innerHTML = ""; // Limpiar opciones anteriores
          if (nombresEventos.length === 0) {
              // Si no hay eventos disponibles, mostrar un mensaje indicando que no hay eventos en el rango de fechas
              var option = document.createElement("option");
              option.text = "No hay ningún evento cuya fecha sea entre HOY y hace 3 SEMANAS para este capítulo o ya pasó el plazo máximo del evento que buscas evaluar.";
              option.value = "";
              option.disabled = true;
              option.selected = true;
              nombreEspacioSelect.add(option);
          } else {
              // Si hay eventos disponibles, agregar cada nombre como una opción
              nombresEventos.forEach(function(nombre) {
                  var option = document.createElement("option");
                  option.text = nombre;
                  option.value = nombre;
                  nombreEspacioSelect.add(option);
              });
          }
        }).catch(function(error) {
            console.log("Error obteniendo reservas:", error);
            // Manejar el error aquí
        });
    });

    // Listener para el caso en que el usuario seleccione Entrenamiento Interno en tipo de espacio
    document.addEventListener("DOMContentLoaded", function() {
      var tipoEspacio = document.getElementById("tipo-espacio");
      var areaTrabajo = document.getElementById("area-trabajo");
      var nombreEspacioActualizar = document.getElementById("nombre-espacio-actualizar");

      // Guardar las opciones originales del campo areaTrabajo
      var opcionesOriginalesAreaTrabajo = `
        <option value="" disabled selected hidden>Selecciona el área de trabajo del espacio.</option>
        <option value="academico">ACADÉMICO 💚</option>
        <option value="comunicaciones">COMUNICACIONES 🩵</option>
        <option value="desarrollo">DESARROLLO 💛</option>
        <option value="finanzas">FINANZAS 💜</option>
        <option value="mercadeo">MERCADEO ❤️</option>
        <option value="habilidades-duras">HABILIDADES DURAS 🧠</option>
        <option value="habilidades-blandas">HABILIDADES BLANDAS 🫂</option>
        <option value="conocimiento-aneiap">CONOCIMIENTO ANEIAP 💚💙</option>
        <option value="ninguno">No es espacio de FI o IE</option>
      `;

      tipoEspacio.addEventListener("change", function() {
        if (tipoEspacio.value === "integracion-entorno") {
          // Vaciar el campo de área de trabajo
          if (!areaTrabajo.value) {
          areaTrabajo.innerHTML = '<option value="" disabled selected hidden>Selecciona el área de trabajo del espacio.</option>';
          }
          // Obtener el nombre del espacio
          var nombreEspacio = nombreEspacioActualizar.value || "No has seleccionado aún un espacio";

          // Mostrar alerta para ingresar el área de trabajo
          Swal.fire({
            title: 'Ingrese el área de trabajo para el espacio de integración con el entorno',
            text: `Espacio seleccionado: 🟩${nombreEspacio.toUpperCase()}🟦`,
            input: 'text',
            inputPlaceholder: 'Escriba el área de trabajo aquí...',
            inputAttributes: {
              maxlength: 80
            },
            showCancelButton: true,
            confirmButtonText: 'Aceptar',
            cancelButtonText: 'Cancelar',
            allowOutsideClick: false,
            allowEscapeKey: false,
            allowEnterKey: true,
            inputValidator: (value) => {
              if (!value) {
                return 'Debe ingresar un área de trabajo!';
              }
              if (value.length > 80) {
                return 'El área de trabajo no debe tener más de 80 caracteres!';
              }
            }
          }).then((result) => {
            if (result.isConfirmed) {
              // Asignar el valor ingresado al campo de área de trabajo
              areaTrabajo.innerHTML = `<option value="${result.value}" selected>${result.value}</option>`;
            } else {
              // Restaurar el valor original del campo de tipo de espacio si se cancela
              tipoEspacio.value = "";
              if (!areaTrabajo.value) {
              areaTrabajo.innerHTML = opcionesOriginalesAreaTrabajo;
              }
            }
          });
        } else {
          // Restaurar las opciones originales del campo areaTrabajo si el valor no es "integracion-entorno"
          if (!areaTrabajo.value) {
          areaTrabajo.innerHTML = opcionesOriginalesAreaTrabajo;
          }
        }
      });
    });

    // Variable global del correo del usuario para mirar si inició sesión un DCA o DNA.
    var correoUsuario = ""; //deben estar vacías, solo que tengo flojera de iniciar sesión.
    var capituloUsuario = "";
    var tablaResumen = [];
    var tablaResumenPDF = [];
    var tablaResumenPDFIE = [];
    var clavesInforme = ""; //TRIPIANTE
    var fechaInicialPDF = '2025-02-01';
    var fechaFinalPDF = '2025-05-31';
    var valoresPorcentajes = 2;
    var PosYParaSG = '';
    // Cargar la imagen que deseas usar como fondo para fi
    var img = new Image();
    img.src = 'https://raw.githubusercontent.com/AlessVilla/SIEA/master/public/fondo_informe_pdf.png';
    var imgPortadaFI = new Image();
    imgPortadaFI.src = 'https://raw.githubusercontent.com/AlessVilla/SIEA/master/public/fondo_portada_informe_fi_pdf.png';
    var imgPortadaIE = new Image();
    imgPortadaIE.src = 'https://raw.githubusercontent.com/AlessVilla/SIEA/master/public/fondo_portada_informe_ie_pdf.png';

    // Obtener los elementos de fecha inicial y final y agregar eventos change a los campos de fecha
    var fechaInicialInput = document.getElementById("fecha-inicial");
    var fechaFinalInput = document.getElementById("fecha-final");
    var nombreEspacioSeleccionado = document.getElementById("nombre-espacio-actualizar").value;
    fechaInicialInput.addEventListener("change", actualizarNombresEspacios);
    fechaFinalInput.addEventListener("change", actualizarNombresEspacios);
    document.getElementById("nombre-espacio-actualizar").addEventListener("change", ActualizarCamposConNombreEspacio);

    // Primera feature: Función para actualizar los nombres de los espacios según las fechas seleccionadas
    function actualizarNombresEspacios() {
        // Obtener las fechas seleccionadas
        var fechaInicial = fechaInicialInput.value;
        var fechaFinal = fechaFinalInput.value;
        console.log(fechaInicial)
        console.log(fechaFinal)
        console.log(capituloUsuario)
        // Verificar que ambas fechas estén seleccionadas
        if (fechaInicial && fechaFinal) {
            // Obtener la referencia a la colección de reservas
            var reservasRef = firebase.firestore().collection("reservas");
            // Crear la consulta para obtener los nombres de los espacios dentro del rango de fechas y del capítulo del usuario
            var consulta = reservasRef.where("capitulosOrganizadores", "array-contains", capituloUsuario)
                                      .where("fechaEvento", ">=", fechaInicial)
                                      .where("fechaEvento", "<=", fechaFinal)

            // Ejecutar la consulta
            consulta.get()
                  .then(function(querySnapshot) {
                        // Array para almacenar los nombres de los espacios
                        console.log("Número de documentos obtenidos:", querySnapshot.size);
                        var nombresEspacios = [];

                        // Iterar sobre los resultados de la consulta
                        querySnapshot.forEach(function(doc) {
                            // Obtener el nombre del espacio y agregarlo al array
                            nombresEspacios.push(doc.data().nombreEvento);
                        });

                        // Llamar a la función para actualizar el desplegable con los nombres de los espacios obtenidos
                        actualizarDesplegableNombresEspacios(nombresEspacios);
                        // Llamar a la función para que la tabla resumen se actualice
                        generarTablaResumen();
                        ActualizarCamposConNombreEspacio();
                        generarGraficos(fechaInicialPDF, fechaFinalPDF);
                  })
                  .catch(function(error) {
                        // Manejar errores
                        console.error("Error al obtener nombres de espacios:", error);
                  });
        }
    }

    // Función para actualizar el desplegable con los nombres de los espacios
    function actualizarDesplegableNombresEspacios(nombresEspacios) {
        // Obtener el desplegable de nombres de espacios
        var nombreEspacioSelect = document.getElementById("nombre-espacio-actualizar");

        // Limpiar opciones anteriores
        nombreEspacioSelect.innerHTML = "";

        // Ordenar los nombres de los espacios alfabéticamente
        nombresEspacios.sort();

        // Si hay nombres de espacios disponibles, agregar cada uno como opción en el desplegable
        if (nombresEspacios.length > 0) {
            nombresEspacios.forEach(function(nombre) {
                var option = document.createElement("option");
                option.text = nombre;
                option.value = nombre;
                nombreEspacioSelect.add(option);
            });
        } else {
            // Si no hay nombres de espacios disponibles, mostrar un mensaje indicando que no se encontraron espacios en el rango de fechas seleccionado
            var option = document.createElement("option");
            option.text = "No hay espacios disponibles en el rango de fechas seleccionado.";
            option.value = "";
            option.disabled = true;
            option.selected = true;
            nombreEspacioSelect.add(option);
        }
    }

    // Función para actualizar el total de asistentes, link de evidencia, tipo de espacio y área de trabajo del espacio
    function ActualizarCamposConNombreEspacio() {
      // Obtener el valor seleccionado del desplegable "nombre-espacio-actualizar"
      var nombreEspacioSeleccionado = document.getElementById("nombre-espacio-actualizar").value;

      // Obtener la referencia del documento correspondiente en Firestore
      var reservasRef = firebase.firestore().collection("reservas");
      var consulta = reservasRef.where("capitulosOrganizadores", "array-contains", capituloUsuario).where("nombreEvento", "==", nombreEspacioSeleccionado);

      consulta.get()
          .then(function(querySnapshot) {
            var areaTrabajo = document.getElementById("area-trabajo");
            // Guardar las opciones originales del campo areaTrabajo
            var opcionesOriginalesAreaTrabajo = `
              <option value="" disabled selected hidden>Selecciona el área de trabajo del espacio.</option>
              <option value="academico">ACADÉMICO 💚</option>
              <option value="comunicaciones">COMUNICACIONES 🩵</option>
              <option value="desarrollo">DESARROLLO 💛</option>
              <option value="finanzas">FINANZAS 💜</option>
              <option value="mercadeo">MERCADEO ❤️</option>
              <option value="habilidades-duras">HABILIDADES DURAS 🧠</option>
              <option value="habilidades-blandas">HABILIDADES BLANDAS 🫂</option>
              <option value="conocimiento-aneiap">CONOCIMIENTO ANEIAP 💚💙</option>
              <option value="integracion-entorno">INTEGRACIÓN CON EL ENTORNO 🏭</option>
              <option value="ninguno">No es espacio de FI o IE</option>
            `;
            areaTrabajo.innerHTML = opcionesOriginalesAreaTrabajo;
              // Verificar si se encontró algún documento con el nombre del espacio seleccionado
              if (!querySnapshot.empty) {
                  // Obtener el primer documento encontrado
                  var doc = querySnapshot.docs[0];
                  var data = doc.data();

                  // Actualizar los valores de los campos con los datos del documento
                  document.getElementById("total-asistentes").value = data.totalAsistentes || "";
                  document.getElementById("link-evidencia").value = data.evidencia || "";
                  document.getElementById("tipo-espacio").value = data.tipoEvento || "";
                  // Validar si el área de trabajo es uno de los valores predefinidos
                  var valoresPredefinidos = ["academico", "comunicaciones", "desarrollo", "finanzas", "mercadeo", "habilidades-duras", "habilidades-blandas", "conocimiento-aneiap", "ninguno", undefined];
                  if (valoresPredefinidos.includes(data.areaTrabajo)) {
                      document.getElementById("area-trabajo").value = data.areaTrabajo || "";
                  } else {
                      // Si no es un valor predefinido, establecerlo como la única opción posible
                      areaTrabajo.innerHTML = `<option value="${data.areaTrabajo}" selected>${data.areaTrabajo}</option>`;
                  }
                  // Llamar a la función para que la tabla resumen se actualice
                  generarTablaResumen();
              } else {
                  // Si no se encontró ningún documento, limpiar los valores de los campos
                  document.getElementById("total-asistentes").value = "";
                  document.getElementById("link-evidencia").value = "";
                  document.getElementById("tipo-espacio").value = "";
                  document.getElementById("area-trabajo").value = "";
              }
          })
          .catch(function(error) {
              console.error("Error al obtener datos del espacio:", error);
              // En caso de error, limpiar los valores de los campos
              document.getElementById("total-asistentes").value = "";
              document.getElementById("link-evidencia").value = "";
              document.getElementById("tipo-espacio").value = "";
              document.getElementById("area-trabajo").value = "";
          });
    }

    // Segunda feature: Generar tabla resumen de satisfacción de espacios
    function generarTablaResumen() {
        // Obtener referencia a la tabla donde se mostrará el resumen
        var tablaResumen = document.getElementById("tabla-resumen");
        // Eliminar todas las filas de la tabla (excepto la primera, que contiene los encabezados)
        while (tablaResumen.rows.length > 1) {
            tablaResumen.deleteRow(1);
        }
        // Limpiar contenido anterior de la tabla
        tablaResumen.innerHTML = "";

        // Crear fila de encabezado de la tabla
        var encabezado = tablaResumen.insertRow();
        var encabezadoColumnas = ["Clave Evento", "Nombre espacio", "Área", "Tipo", "Fecha", "Ponente", "Correo ponente", "Tel. ponente", "Detractores", "Pasivos", "Promotores", "Asistentes", "% NPS", "Evidencia"];
        encabezadoColumnas.forEach(function(columna, index) {
            var th = document.createElement("th");
            th.textContent = columna;
            // Asignar ancho específico a cada columna
            if (index === 0) {
                th.style.width = "10%"; // Ancho para Clave Evento
            } else if (index === 1) {
                th.style.width = "20%"; // Nombre espacio
            } else if (index >= 2 && index <= 6) {
                th.style.width = "10%";
            } else if (index === 7) {
                th.style.width = "5%";
            } else if (index >= 8 && index <= 11) {
                th.style.width = "5%";
            } else if (index === 12) {
                th.style.width = "5%";
            } else if (index === 13) {
                th.style.width = "0%"; // Columna de Evidencia con 0% de ancho
            }
            encabezado.appendChild(th);
        });

        // Obtener las fechas seleccionadas
        var fechaInicial = fechaInicialInput.value;
        var fechaFinal = fechaFinalInput.value;

        // Verificar que ambas fechas estén seleccionadas
        if (fechaInicial && fechaFinal) {
            // Obtener la referencia a la colección de reservas
            var reservasRef = firebase.firestore().collection("reservas");

            // Crear la consulta para obtener los eventos dentro del rango de fechas y del capítulo del usuario
            var consulta = reservasRef.where("capitulosOrganizadores", "array-contains", capituloUsuario)
                                      .where("fechaEvento", ">=", fechaInicial)
                                      .where("fechaEvento", "<=", fechaFinal)
                                      .orderBy("fechaEvento", "asc"); // Ordenar por fecha de forma ascendente

            // Ejecutar la consulta
            consulta.get()
                  .then(function(querySnapshot) {
                        // Iterar sobre los resultados de la consulta
                        querySnapshot.forEach(function(doc) {
                            // Obtener los datos del documento
                            var data = doc.data();

                            // Crear fila para este evento
                            var fila = tablaResumen.insertRow();

                            // Insertar celdas con los datos del evento, incluyendo claveEvento
                            fila.insertCell().textContent = data.claveEvento; // Insertar claveEvento como primer campo
                            fila.insertCell().textContent = data.nombreEvento;
                            fila.insertCell().textContent = data.areaTrabajo;
                            fila.insertCell().textContent = data.tipoEvento;
                            fila.insertCell().textContent = data.fechaEvento;
                            fila.insertCell().textContent = data.nombrePonente;
                            fila.insertCell().textContent = data.emailPonente;
                            fila.insertCell().textContent = data.telefonoPonente;
                            fila.insertCell().textContent = data.detractores;
                            fila.insertCell().textContent = data.pasivos;
                            fila.insertCell().textContent = data.promotores;
                            fila.insertCell().textContent = data.totalAsistentes;
                            var satisfaccion = data.satisfaccion;
                            var satisfaccionFormateada = (satisfaccion * 100).toFixed(2) + '%';
                            fila.insertCell().textContent = satisfaccionFormateada;
                            fila.insertCell().textContent = data.evidencia;
                        });
                    // Verificar si la tabla está vacía
                    if (querySnapshot.size === 0) {
                        // Crear una fila para mostrar el mensaje de que no hay espacios
                        var filaMensaje = tablaResumen.insertRow();
                        var celdaMensaje = filaMensaje.insertCell();
                        celdaMensaje.textContent = "No hay ningún espacio para estas fechas seleccionadas.";
                        celdaMensaje.colSpan = encabezadoColumnas.length; // Colspan para que ocupe todas las columnas
                        celdaMensaje.style.textAlign = "center"; // Centrar el mensaje
                    }
                  })
                  .catch(function(error) {
                        // Manejar errores
                        console.error("Error al obtener eventos:", error);
                  });
        }
    }

    function convertirFechaFormulario(fechaFormulario) {
      if (typeof fechaFormulario !== "string") {
        // Si fechaFormulario no es una cadena, intentamos convertirlo a string
        fechaFormulario = fechaFormulario.toString();
      }
      // La fecha del formulario está en formato "yyyy-mm-dd" (ejemplo: "2023-08-15")
      // Debemos convertirla a formato de Firestore, que es un objeto Date de JavaScript
      var partesFecha = fechaFormulario.split("/"); // Separamos año, mes y día
      var anio = parseInt(partesFecha[0]);
      var mes = parseInt(partesFecha[1]);
      var dia = parseInt(partesFecha[2]);

      // Construimos la fecha en formato de Firestore
      var fechaFirestore = new Date(anio, mes - 1, dia); // Restamos 1 al mes ya que en JavaScript los meses van de 0 a 11
      return fechaFirestore;
    }

    // Función para mostrar el contenido de la pestaña seleccionada
    function showTab(tabNumber) {
      // Oculta todos los contenidos de las pestañas
      var tabContents = document.getElementsByClassName("tab-content");
      for (var i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove("active");
      }
      // Muestra el contenido de la pestaña seleccionada
      var selectedTabContent = document.getElementById("tab-content-" + tabNumber);
      selectedTabContent.classList.add("active");
    }  

    // Esta función se encarga de mostrar u ocultar el contenido cuando se hace clic en la barra "CONSULTAR DISPONIBILIDAD (AC0)".
    function toggleConsultaDisponibilidad() {
      // Obtenemos el elemento HTML con el ID "acordeon0-content".
      var content = document.getElementById("acordeon0-content");
      
      // Comprobamos si el estilo "display" del elemento está configurado como "none" (oculto).
      if (content.style.display === "none") {
        // Si está oculto, lo cambiamos a "block" (visible) para mostrarlo.
        content.style.display = "block";
      } else {
        // Si está visible, lo cambiamos nuevamente a "none" para ocultarlo.
        content.style.display = "none";
      }
      
      // A continuación, ocultamos los contenidos de otras barras (acordeones).

      var content = document.getElementById("acordeon5-content");
      content.style.display = "none";

      // Ocultamos el contenido del elemento con ID "acordeon4-content".
      var content = document.getElementById("acordeon4-content");
      content.style.display = "none";
      
      // Ocultamos el contenido del elemento con ID "acordeon3-content".
      var content = document.getElementById("acordeon3-content");
      content.style.display = "none";
      
      // Ocultamos el contenido del elemento con ID "acordeon2-content".
      var content = document.getElementById("acordeon2-content");
      content.style.display = "none";
      
      // Ocultamos el contenido del elemento con ID "acordeon1-content".
      var content = document.getElementById("acordeon1-content");
      content.style.display = "none";
    }

    // Esta función se encarga de mostrar u ocultar el contenido cuando se hace clic en la barra "REGISTRAR RESERVA (AC1)".
    function toggleRegistrarEvento() {
      // Obtenemos el elemento HTML con el ID "acordeon1-content".
      var content = document.getElementById("acordeon1-content");
      
      // Comprobamos si el estilo "display" del elemento está configurado como "none" (oculto).
      if (content.style.display === "none") {
        // Si está oculto, lo cambiamos a "block" (visible) para mostrarlo.
        content.style.display = "block";
      } else {
        // Si está visible, lo cambiamos nuevamente a "none" para ocultarlo.
        content.style.display = "none";
      }
      
      // A continuación, ocultamos los contenidos de otras barras (acordeones).

      var content = document.getElementById("acordeon5-content");
      content.style.display = "none";

      // Ocultamos el contenido del elemento con ID "acordeon4-content".
      var content = document.getElementById("acordeon4-content");
      content.style.display = "none";
      
      // Ocultamos el contenido del elemento con ID "acordeon3-content".
      var content = document.getElementById("acordeon3-content");
      content.style.display = "none";
      
      // Ocultamos el contenido del elemento con ID "acordeon2-content".
      var content = document.getElementById("acordeon2-content");
      content.style.display = "none";
      
      // Ocultamos el contenido del elemento con ID "acordeon0-content".
      var content = document.getElementById("acordeon0-content");
      content.style.display = "none";
    }

    // Esta función permite cambiar la visibilidad de los campos "ubicación/plataforma" y "lugar presencial"
    // en la sección "REGISTRAR RESERVA (AC1)" según la modalidad seleccionada.
    function toggleUbicacionPlataforma() {
      // Obtenemos los elementos HTML correspondientes a los contenedores de ubicación/plataforma y lugar presencial.
      var ubicacionPlataformaContainer = document.getElementById("ubicacion-plataforma-container");
      var lugarPresencialContainer = document.getElementById("lugar-presencial-container");
      
      // Obtenemos el valor seleccionado en el campo "modalidad-evento".
      var modalidadEvento = document.getElementById("modalidad-evento").value;

      // Comparamos el valor seleccionado con las opciones.
      if (modalidadEvento === "virtual") {
        // Si la modalidad es "virtual", mostramos el campo "ubicación/plataforma" y ocultamos "lugar presencial".
        ubicacionPlataformaContainer.style.display = "block";
        lugarPresencialContainer.style.display = "none";
      } else if (modalidadEvento === "presencial") {
        // Si la modalidad es "presencial", mostramos "lugar presencial" y ocultamos "ubicación/plataforma".
        ubicacionPlataformaContainer.style.display = "none";
        lugarPresencialContainer.style.display = "block";
      } else {
        // En caso contrario, ocultamos ambos campos.
        ubicacionPlataformaContainer.style.display = "none";
        lugarPresencialContainer.style.display = "none";
      }
    }

    // Esta función se encarga de manejar el comportamiento de la barra "EDITAR RESERVA (AC2)"
    // Su principal objetivo es mostrar u ocultar el contenido de esta barra y restablecer los valores de los campos de edición de reserva.
    function toggleEditarReserva() {
      // Obtener la referencia al contenido de la barra "EDITAR RESERVA (AC2)"
      var content = document.getElementById("acordeon2-content");

      // Comprobar si el contenido actualmente está oculto (no visible)
      if (content.style.display === "none") {
        // Si está oculto, se cambia su estilo para mostrarlo (visible)
        content.style.display = "block";
      } else {
        // Si está visible, se cambia su estilo para ocultarlo (no visible)
        content.style.display = "none";
      }

      // Ocultar el contenido de las otras barras de acordeón (si estaban visibles).
      // Esto asegura que solo una barra esté abierta a la vez.
      var content = document.getElementById("acordeon5-content");
      content.style.display = "none";
      var content = document.getElementById("acordeon4-content");
      content.style.display = "none";
      var content = document.getElementById("acordeon3-content");
      content.style.display = "none";
      var content = document.getElementById("acordeon0-content");
      content.style.display = "none";
      var content = document.getElementById("acordeon1-content");
      content.style.display = "none";

      // Restablecer los valores de los campos de edición de reserva a sus valores iniciales.
      // Esto borra cualquier información previamente ingresada en estos campos.
      document.getElementById("clave-evento-reserva").value = "";
      document.getElementById("nombre-evento-reserva").value = "";
      document.getElementById("fecha-evento-reserva").value = "";
      document.getElementById("hora-evento-reserva").value = "";
      document.getElementById("duracion-evento-reserva").value = "";
      document.getElementById("modalidad-evento-reserva").value = "";
      document.getElementById("ubicacion-plataforma-reserva").value = "";
      document.getElementById("lugar-presencial-reserva").value = "";
      document.getElementById("plan-evento-reserva").value = "";
      document.getElementById("observaciones-evento-reserva").value = "";
      document.getElementById("nombre-organizador-reserva").value = "";
      document.getElementById("email-organizador-reserva").value = "";
      document.getElementById("telefono-organizador-reserva").value = "";
      document.getElementById("nombre-ponente-reserva").value = "";
      document.getElementById("email-ponente-reserva").value = "";
      document.getElementById("telefono-ponente-reserva").value = "";
      document.getElementById("publicidad-comite-reserva").value = "";
      document.getElementById("foto-ponente-reserva").value = "";

      // Mostrar el contenido del acordeón "datos-reserva-container".
      // Esta parte del código se encarga de mostrar información adicional
      // relacionada con la reserva una vez que se abre la barra de edición.
      var datosReservaContainer = document.getElementById("datos-reserva-container");
      datosReservaContainer.style.display = "none";
    }

    // Esta función se utiliza en la sección "EDITAR RESERVA (AC2)" para controlar la visualización
    // de campos relacionados con la ubicación o plataforma del evento y el lugar presencial del evento.
    // Dependiendo de la modalidad seleccionada (virtual o presencial), se mostrará uno de estos campos
    // mientras se oculta el otro para evitar confusiones al editar la reserva.
    function toggleUbicacionPlataformaReserva() {
      // Obtener las referencias a los contenedores de ubicación/plataforma y lugar presencial
      var ubicacionPlataformaReservaContainer = document.getElementById("ubicacion-plataforma-reserva-container");
      var lugarPresencialReservaContainer = document.getElementById("lugar-presencial-reserva-container");

      // Obtener el valor de la modalidad del evento seleccionado
      var modalidadEventoReserva = document.getElementById("modalidad-evento-reserva").value;

      // Comprobar la modalidad seleccionada y mostrar/ocultar los campos correspondientes
      if (modalidadEventoReserva === "virtual") {
        // Si la modalidad es "virtual", mostrar el campo de ubicación/plataforma y ocultar el lugar presencial
        ubicacionPlataformaReservaContainer.style.display = "block";
        lugarPresencialReservaContainer.style.display = "none";
      } else if (modalidadEventoReserva === "presencial") {
        // Si la modalidad es "presencial", ocultar el campo de ubicación/plataforma y mostrar el lugar presencial
        ubicacionPlataformaReservaContainer.style.display = "none";
        lugarPresencialReservaContainer.style.display = "block";
      } else {
        // Si no se ha seleccionado ninguna modalidad válida, ocultar ambos campos
        ubicacionPlataformaReservaContainer.style.display = "none";
        lugarPresencialReservaContainer.style.display = "none";
      }
    }

    // Esta función se utiliza cuando se hace clic en la barra "ELIMINAR RESERVA (AC3)" para ocultar
    // las demás barras de información en la interfaz. Su propósito es mejorar la experiencia del usuario
    // al centrarse en la acción de eliminar una reserva sin distracciones innecesarias.
    function toggleEliminarReserva() {
      // Obtener la referencia al contenido de la barra "ELIMINAR RESERVA (AC3)"
      var content = document.getElementById("acordeon3-content");
      
      // Comprobar el estado actual de visualización (oculto o mostrado)
      if (content.style.display === "none") {
        // Si está oculto, cambiarlo a mostrado (display: block)
        content.style.display = "block";
      } else {
        // Si está mostrado, cambiarlo a oculto (display: none)
        content.style.display = "none";
      }

      // A continuación, ocultar las otras barras de información (AC0, AC1, AC2, AC4, AC5) para centrarse en la eliminación

      var content = document.getElementById("acordeon5-content");
      content.style.display = "none";

      var content = document.getElementById("acordeon4-content");
      content.style.display = "none";

      var content0 = document.getElementById("acordeon0-content");
      content0.style.display = "none";

      var content1 = document.getElementById("acordeon1-content");
      content1.style.display = "none";

      var content2 = document.getElementById("acordeon2-content");
      content2.style.display = "none";
    }

    // Esta función se utiliza cuando se hace clic en la barra "EVALUAR ESPACIO (AC4)" para ocultar
    // las demás barras de información en la interfaz. Su propósito es mejorar la experiencia del usuario
    // al centrarse en la acción de eliminar una reserva sin distracciones innecesarias.
    function toggleEvaluarEspacio() {
      // Obtener la referencia al contenido de la barra "ELIMINAR RESERVA (AC3)"
      var content = document.getElementById("acordeon4-content");
      
      // Comprobar el estado actual de visualización (oculto o mostrado)
      if (content.style.display === "none") {
        // Si está oculto, cambiarlo a mostrado (display: block)
        content.style.display = "block";
      } else {
        // Si está mostrado, cambiarlo a oculto (display: none)
        content.style.display = "none";
      }

      // A continuación, ocultar las otras barras de información (AC0, AC1, AC2, AC3 y AC5) para centrarse en la eliminación

      var content = document.getElementById("acordeon5-content");
      content.style.display = "none";

      var content = document.getElementById("acordeon3-content");
      content.style.display = "none";

      var content0 = document.getElementById("acordeon0-content");
      content0.style.display = "none";

      var content1 = document.getElementById("acordeon1-content");
      content1.style.display = "none";

      var content2 = document.getElementById("acordeon2-content");
      content2.style.display = "none";

      document.getElementById("nombre-asistente").value = "";
      document.getElementById("telefono-asistente").value = "";
      document.getElementById("correo-asistente").value = "";
      document.getElementById("capitulo-espacio").value = "";
      document.getElementById("nombre-espacio").value = "";
      document.getElementById("pregunta1").value = "";
      document.getElementById("pregunta2").value = "";
      document.getElementById("pregunta3").value = "";
      document.getElementById("pregunta4").value = "";
    }

    // Esta función se utiliza cuando se hace clic en la barra "VISUALIZAR ACTUALIZAR ESPACIO (AC5)" para ocultar
    // las demás barras de información en la interfaz. Su propósito es mejorar la experiencia del usuario
    function toggleVisualizarActualizarEspacios() {

      // A continuación, ocultar las otras barras de información (AC0, AC1, AC2, AC3, AC4)
      var content = document.getElementById("acordeon4-content");
      content.style.display = "none";

      var content = document.getElementById("acordeon3-content");
      content.style.display = "none";

      var content0 = document.getElementById("acordeon0-content");
      content0.style.display = "none";

      var content1 = document.getElementById("acordeon1-content");
      content1.style.display = "none";

      var content2 = document.getElementById("acordeon2-content");
      content2.style.display = "none";

      var content = document.getElementById("acordeon5-content");
      if (capituloUsuario === "general" || capituloUsuario === "") {
        // Mostrar una alerta indicando que no tiene permisos
        Swal.fire({
          title: '¡NO TIENES PERMISOS PARA ACCEDER A ESTA FUNCIÓN!',
          text: 'Esta función es exclusiva para los DCA y DNA. Inicia sesión con tu correo de Académico si aún no lo has hecho, Si no eres director(a) de académico y crees que deberías tener acceso, por favor, contáctate con el administrador.',
          icon: 'warning',
          confirmButtonText: 'Aceptar',
          imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
          imageWidth: 120, // Ancho de la imagen en píxeles
          imageHeight: 235, // Alto de la imagen en píxeles
          imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
        });
        return; // Terminar la función ya que el usuario no tiene permisos
      }

      // Obtener el elemento del párrafo donde se mostrará el capítulo del usuario
      var capituloUsuarioElement = document.getElementById("capitulo-usuario");
      var textoCapitulo = "<b>La información que aparecerá y consultará corresponderá al capítulo: </b>" + "<b>" + capituloUsuario.toUpperCase() + "</b>";
      capituloUsuarioElement.innerHTML = textoCapitulo;

      // Comprobar el estado actual de visualización (oculto o mostrado)
      if (content.style.display === "none") {
        // Si está oculto, cambiarlo a mostrado (display: block)
        content.style.display = "block";
      } else {
        // Si está mostrado, cambiarlo a oculto (display: none)
        content.style.display = "none";
      }
    }

    // Acá está la función para agregar un evento en la colección "reservas" y documento "basededatos",
    // también tiene en cuenta la posibilidad de adjuntar imagen del ponente y reiniciará los campos cuando se registren.
    function agregarEventoFirestore(nombreEvento, claveEvento, fechaEvento, horaEvento, duracionEvento, modalidadEvento, ubicacionPlataforma, lugarPresencial, planEvento, observacionesEvento, nombreOrganizador, emailOrganizador, capitulo, telefonoOrganizador, nombrePonente, emailPonente, telefonoPonente, publicidadComite, observacionesPublicidad, fotoPonenteURL) {
      // Obtener una referencia a la colección "reservas" en Firestore
      const db = firebase.firestore().collection("reservas").doc(claveEvento);

      db.set({
        nombreEvento: nombreEvento,
        claveEvento: claveEvento,
        fechaEvento: fechaEvento,
        horaEvento: horaEvento,
        duracionEvento: duracionEvento,
        modalidadEvento: modalidadEvento,
        ubicacionPlataforma: ubicacionPlataforma,
        lugarPresencial: lugarPresencial,
        planEvento: planEvento,
        observacionesEvento: observacionesEvento,
        nombreOrganizador: nombreOrganizador,
        emailOrganizador: emailOrganizador,
        capitulo: capitulo,
        telefonoOrganizador: telefonoOrganizador,
        nombrePonente: nombrePonente,
        emailPonente: emailPonente,
        telefonoPonente: telefonoPonente,
        publicidadComite: publicidadComite,
        observacionesPublicidad: observacionesPublicidad,
        fotoPonenteURL: fotoPonenteURL,
        // Agrega aquí los demás campos del evento que deseas guardar
        // ...
        detractores: 0,
        pasivos: 0,
        promotores: 0,
        satisfaccion: 0,
      })
      .then((docRef) => {
        // Éxito: el evento se ha registrado correctamente en el documento existente
        // Aquí puedes agregar cualquier otra lógica que desees después de agregar el evento
        // Limpia los campos del formulario después de registrar el evento
        document.getElementById("nombre-evento").value = "";
        document.getElementById("fecha-evento").value = "";
        document.getElementById("hora-evento").value = "";
        document.getElementById("duracion-evento").value = "";
        document.getElementById("modalidad-evento").value = "";
        document.getElementById("ubicacion-plataforma").value = "";
        document.getElementById("lugar-presencial").value = "";
        document.getElementById("plan-evento").value = "";
        document.getElementById("observaciones-evento").value = "";
        document.getElementById("nombre-organizador").value = "";
        document.getElementById("email-organizador").value = "";
        document.getElementById("telefono-organizador").value = "";
        document.getElementById("nombre-ponente").value = "";
        document.getElementById("email-ponente").value = "";
        document.getElementById("telefono-ponente").value = "";
        document.getElementById("publicidad-comite").value = "";
        document.getElementById("observaciones-publicidad").value = "";
        document.getElementById("foto-ponente").value = "";

        // Muestra el mensaje de reserva completada
        mostrarMensajeReservar();

        // Oculta el contenido del acordeón
        var content = document.getElementById("acordeon1-content");
        content.style.display = "none";
      })
      .catch((error) => {
        // Error: hubo un problema al registrar el evento
        console.error("ERROR AL REGISTRAR EL EVENTO: ", error);
        Swal.fire({
          title: '¡ERROR!',
          text: 'Ha ocurrido un error al registrar el evento. Inténtalo nuevamente más tarde o consulta en el link de dudas, reclamos e inquietudes arriba.',
          icon: 'error',
          imageUrl: 'https://i.ibb.co/PZ7KXF9/AVATAR-ERRORES-removebg-preview.png', // URL de la imagen
          confirmButtonText: 'Aceptar',
          imageWidth: 342, // Ancho de la imagen en píxeles
          imageHeight: 200, // Alto de la imagen en píxeles
          imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
        });
      });
    }    

    function editarEventoFirestore(nombreEventoReserva, claveEventoReserva, fechaEventoReserva, horaEventoReserva, duracionEventoReserva, modalidadEventoReserva, ubicacionPlataformaReserva, lugarPresencialReserva, planEventoReserva, observacionesEventoReserva, nombreOrganizadorReserva, emailOrganizadorReserva, capituloReserva, telefonoOrganizadorReserva, nombrePonenteReserva, emailPonenteReserva, telefonoPonenteReserva, publicidadComiteReserva, observacionesPublicidadReserva, fotoPonenteURLReserva) {
      // Obtener una referencia al documento del evento en Firestore
      const eventoRef = firebase.firestore().collection("reservas").doc(claveEventoReserva);

      eventoRef.get()
        .then((doc) => {
          if (doc.exists) {
            // El documento existe, actualizar los datos del evento
            return eventoRef.update({
              nombreEvento: nombreEventoReserva,
              fechaEvento: fechaEventoReserva,
              horaEvento: horaEventoReserva,
              duracionEvento: duracionEventoReserva,
              modalidadEvento: modalidadEventoReserva,
              ubicacionPlataforma: ubicacionPlataformaReserva,
              lugarPresencial: lugarPresencialReserva,
              planEvento: planEventoReserva,
              observacionesEvento: observacionesEventoReserva,
              nombreOrganizador: nombreOrganizadorReserva,
              emailOrganizador: emailOrganizadorReserva,
              capitulo: capituloReserva,
              telefonoOrganizador: telefonoOrganizadorReserva,
              nombrePonente: nombrePonenteReserva,
              emailPonente: emailPonenteReserva,
              telefonoPonente: telefonoPonenteReserva,
              publicidadComite: publicidadComiteReserva,
              observacionesPublicidad: observacionesPublicidadReserva,
              fotoPonenteURL: fotoPonenteURLReserva,
              // Agrega aquí los demás campos del evento que deseas actualizar
              // ...
            });
          } else {
            // El documento no existe, mostrar un mensaje indicando que el evento no se encontró
            Swal.fire({
              title: 'Evento no encontrado',
              text: 'No se ha encontrado un evento con la clave proporcionada.',
              icon: 'warning',
              confirmButtonText: 'Aceptar'
            });
            return Promise.reject("Evento no encontrado");
          }
        })
        .then(() => {
          // Éxito: el evento se ha actualizado correctamente en el documento existente
          // Aquí puedes agregar cualquier otra lógica que desees después de actualizar el evento
          // Muestra el mensaje de actualización completada
          mostrarMensajeEditar();

          // Oculta el contenido del acordeón
          var content = document.getElementById("acordeon1-content");
          content.style.display = "none";
        })
        .catch((error) => {
          // Error: hubo un problema al actualizar el evento
          console.error("ERROR AL ACTUALIZAR EL EVENTO: ", error);
          if (error !== "Evento no encontrado") {
            Swal.fire({
              title: '¡ERROR!',
              text: 'Ha ocurrido un error al registrar el evento. Inténtalo nuevamente más tarde o consulta en el link de dudas, reclamos e inquietudes arriba.',
              icon: 'error',
              imageUrl: 'https://i.ibb.co/PZ7KXF9/AVATAR-ERRORES-removebg-preview.png', // URL de la imagen
              confirmButtonText: 'Aceptar',
              imageWidth: 342, // Ancho de la imagen en píxeles
              imageHeight: 200, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
          }
        });
    }

    // Esta función genera una clave de evento aleatoria.
    // La clave tiene siempre una cantidad total de 15 caracteres (letras mayúsculas y dígitos) de forma aleatoria.
    function generarClaveEvento() {
      // Definimos una cadena de caracteres que contendrá letras mayúsculas y dígitos.
      var caracteres = "ABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890123456789";
      
      // Especificamos la longitud deseada para la clave generada.
      var longitud = 15;
      
      // Inicializamos una variable para almacenar la clave generada.
      var claveGenerada = "";

      // Iniciamos un bucle para generar cada carácter de la clave.
      for (var i = 0; i < longitud; i++) {
        // Generamos un número aleatorio entre 0 (inclusive) y la longitud de la cadena de caracteres.
        var indiceAleatorio = Math.floor(Math.random() * caracteres.length);
        
        // Agregamos el carácter correspondiente al índice aleatorio a la clave generada.
        claveGenerada += caracteres.charAt(indiceAleatorio);
      }

      // Devolvemos la clave generada como resultado.
      return claveGenerada;
    }

    function registrarEvento() {

      // Validar que todos los campos estén llenos
      var camposValidos = validarCamposRegistrarReserva();

      // Si todos los campos están llenos, proceder con la reserva
      if (camposValidos) {
        // Verificar si la fecha del evento es válida (mayor a la fecha actual)
        var fechaEvento = new Date(document.getElementById("fecha-evento").value);
        var horaEvento = new Date(document.getElementById("hora-evento").value);
        console.log("horaEvento: " + horaEvento);
        console.log("duracionEvento: " + duracionEvento);
        var duracionEvento = new Date(document.getElementById("duracion-evento").value);
        var fechaActual = new Date()//.toISOString().slice(0, 10);
        var fechaActualISOS = new Date().toISOString().slice(0, 10);

        var emailOrganizador = document.getElementById("email-organizador").value;
        // Verificar si el correo es igual a "aneiap_nacional@aneiap.co"
        if (emailOrganizador === "aneiap_nacional@aneiap.co") {
          Swal.fire({
            title: '¡CORREO PROHIBIDO!',
            text: 'El correo aneiap_nacional@aneiap.co no puede ser organizador, recuerda que acá va el correo de quien es el organizador. Por favor, utiliza un correo diferente.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
        }

        // Verificar si el correo comienza con "capitulo" o "directivos"
        if (emailOrganizador.toLowerCase().startsWith("capitulo") || emailOrganizador.toLowerCase().startsWith("directivos")) {
          Swal.fire({
            title: '¡CORREO PROHIBIDO!',
            text: 'Los correos que comienzan con "capitulo" o "directivos" están prohibidos para ser organizador, recuerda que solo el correo del organizador es lo que se escribe acá. Por favor, utiliza un correo diferente.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
        }

        // Verificar si el correo termina con "@aneiap.co"
        if (!emailOrganizador.toLowerCase().endsWith("@aneiap.co")) {
            Swal.fire({
                title: '¡CORREO INCORRECTO!',
                text: 'El correo electrónico debe terminar con "@aneiap.co". Por favor, utiliza un correo válido.',
                icon: 'warning',
                confirmButtonText: 'Aceptar',
                imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
                imageWidth: 120, // Ancho de la imagen en píxeles
                imageHeight: 235, // Alto de la imagen en píxeles
                imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la edición de la reserva
        }

        // Verificar que el correo sea de alguien de la jdn cuando se reserve a nivel nacional ya que estos eventos bloquean el calendario de todos los capítulos.
        var capitulo = document.getElementById("capitulo-organizador").value;
        if (capitulo === "nacional" && capituloUsuario !== "nacional") {
          console.log("el usuario quiere reservar a nivel nacional.")
          Swal.fire({
            title: '¡NO TIENES PERMISOS PARA RESERVAR A NIVEL NACIONAL!',
            text: 'Solo los homólogos nacionales (junta nacional) tienen permiso para reservar a nivel nacional, si deseas hacer una reserva nacional, contáctate con ellos.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
        }

        // Validación de datos para que la fecha con la que se registrará el evento sea mayor a la de hoy.
        if ((fechaEvento < fechaActual) || (fechaEvento < fechaActualISOS)) {
          Swal.fire({
            title: '¡FECHA INCORRECTA!',
            text: 'Debes reservar al menos con 2 días de anticipación, si ya se venció el plazo y deseas hacerlo igualmente, contacta al administrador.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener el registro del evento
        }

        // Verificar el formato del teléfono del organizador (debe empezar por 3 y tener 10 dígitos)
        var telefonoOrganizador = document.getElementById("telefono-organizador").value;
        var telefonoOrganizadorRegex = /^3\d{9}$/;

        // Validación de datos para que el teléfono del organizador efectivamente sea un celular válido.
        if (!telefonoOrganizadorRegex.test(telefonoOrganizador)) {
          Swal.fire({
            title: '¡TELÉFONO DEL ORGANIZADOR INCORRECTO!',
            text: 'Digita un número de teléfono válido.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener el registro del evento
        }

        // Verificar el formato del teléfono del ponente (si fue diligenciado)
        var telefonoPonente = document.getElementById("telefono-ponente").value;

        // En caso de haber diligenciado el teléfono del ponente, valida que sea una celular válido.
        if (telefonoPonente !== "") {
          var telefonoPonenteRegex = /^3\d{9}$/;

          if (!telefonoPonenteRegex.test(telefonoPonente)) {
            Swal.fire({
              title: '¡TELÉFONO DEL PONENTE INCORRECTO!',
              text: 'Digita un número de teléfono válido.',
              icon: 'warning',
              confirmButtonText: 'Aceptar',
              imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener el registro del evento
          }
        }

          // Obtener el enlace del usuario
          var enlaceGoogleDrive = document.getElementById("foto-ponente").value;
          // Expresión regular para verificar el formato del enlace de Google Drive
          var enlaceGoogleDriveRegex = /^https:\/\/drive\.google\.com\/.*$/;
          var publicidadComite = document.getElementById("publicidad-comite").value

          // Validar el enlace utilizando la expresión regular
          if (publicidadComite === "si") {
          if (enlaceGoogleDrive !== "") {
          if (!enlaceGoogleDriveRegex.test(enlaceGoogleDrive)) {
            Swal.fire({
              title: "¡ENLACE INVÁLIDO!",
              text: "Por favor, ingresa un enlace de Google Drive válido para la foto del ponente.",
              icon: "warning",
              confirmButtonText: 'Aceptar',
              imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener el registro del evento
            }
          }

          }
                  

        // Si todas las verificaciones son exitosas, continuar con el registro del evento
                // Guardar los datos del registro.

        //PRIMERO VERIFICA QUE HAYA DISPONIBILIDAD PARA CUANDO INGRESÓ LA FECHA, HORA Y DURACIÓN
        verificarDisponibilidadRegistro().then(function(result) {
          if (!result) {
          // Si no se muestra ningún swal.fire, ejecuta el código a continuación
          } else {
            // Generar clave evento aleatoria de 10 caracteres (mayúsculas y números)
            var claveEvento = generarClaveEvento();
            // ACÁ EMPIEZA EL PROCESO PARA INSERTAR LA DATA EN LA BASE DE DATOS.
            // Obtenemos todos los campos individualmente
            var nombreEvento = document.getElementById("nombre-evento").value;
            var fechaEvento = document.getElementById("fecha-evento").value;
            var horaEvento = document.getElementById("hora-evento").value;
            var duracionEvento = document.getElementById("duracion-evento").value;
            var modalidadEvento = document.getElementById("modalidad-evento").value;
            var ubicacionPlataforma = document.getElementById("ubicacion-plataforma").value;
            var lugarPresencial = document.getElementById("lugar-presencial").value;
            var planEvento = document.getElementById("plan-evento").value;
            var observacionesEvento = document.getElementById("observaciones-evento").value;
            var nombreOrganizador = document.getElementById("nombre-organizador").value;
            var emailOrganizador = document.getElementById("email-organizador").value;
            var capitulo = document.getElementById("capitulo-organizador").value;
            var telefonoOrganizador = document.getElementById("telefono-organizador").value;
            var nombrePonente = document.getElementById("nombre-ponente").value;
            var emailPonente = document.getElementById("email-ponente").value;
            var telefonoPonente = document.getElementById("telefono-ponente").value;
            var publicidadComite = document.getElementById("publicidad-comite").value;
            var observacionesPublicidad = document.getElementById("observaciones-publicidad").value;
            var fotoPonenteURL = document.getElementById("foto-ponente").value;

            enviarCorreoRegistro(claveEvento,emailOrganizador);
            agregarEventoFirestore(nombreEvento, claveEvento, fechaEvento, horaEvento, duracionEvento, modalidadEvento, ubicacionPlataforma, lugarPresencial, planEvento, observacionesEvento, nombreOrganizador, emailOrganizador, capitulo, telefonoOrganizador, nombrePonente, emailPonente, telefonoPonente, publicidadComite, observacionesPublicidad, fotoPonenteURL);
          }
      }).catch(function(error) {
        // Maneja cualquier error que pueda ocurrir durante la verificación
        console.error("Error al verificar la disponibilidad:", error);
      }); 
    }
  }

    // Variable auxiliar para el apoyo de la edición de una reserva
    var fechaEventoGuardar = 'n/a';
    function guardarBackupFechaEventoReserva() {
      if (fechaEventoGuardar === 'n/a') {
        fechaEventoGuardar = document.getElementById("fecha-evento-reserva").value;
      }
      return fechaEventoGuardar;
    }

    function consultarReserva() {

    var claveEventoConsultar = document.getElementById("clave-evento-reserva").value;

    // Verificar si el campo está vacío
    if (claveEventoConsultar.trim() === "") {
      // Mostrar alerta si el campo está vacío
      Swal.fire({
        title: '¡NO HAS DILIGENCIADO NINGUNA CLAVE!',
        text: 'Por favor, ingresa la clave de la reserva de tu evento.',
        icon: 'warning',
        confirmButtonText: 'Aceptar',
        imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
        imageWidth: 120, // Ancho de la imagen en píxeles
        imageHeight: 235, // Alto de la imagen en píxeles
        imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
      });
      return; // Salir de la función si el campo está vacío
    }

    // Obtener la referencia al documento de la reserva en la base de datos
    var reservasRef = firebase.firestore().collection("reservas").doc(claveEventoConsultar);

    reservasRef.get().then((doc) => {
      if (doc.exists) {
        // El documento existe, obtener los datos de la reserva
        var reserva = doc.data();
        // Asignar los valores de la reserva a los campos del formulario
        document.getElementById("nombre-evento-reserva").value = reserva.nombreEvento;
        document.getElementById("fecha-evento-reserva").value = reserva.fechaEvento;
        document.getElementById("hora-evento-reserva").value = reserva.horaEvento;
        document.getElementById("duracion-evento-reserva").value = reserva.duracionEvento;
        document.getElementById("modalidad-evento-reserva").value = reserva.modalidadEvento;
        document.getElementById("ubicacion-plataforma-reserva").value = reserva.ubicacionPlataforma;
        document.getElementById("lugar-presencial-reserva").value = reserva.lugarPresencial;
        document.getElementById("plan-evento-reserva").value = reserva.planEvento;
        document.getElementById("observaciones-evento-reserva").value = reserva.observacionesEvento;
        document.getElementById("nombre-organizador-reserva").value = reserva.nombreOrganizador;
        document.getElementById("capitulo-organizador-reserva").value = reserva.capitulo;
        document.getElementById("email-organizador-reserva").value = reserva.emailOrganizador;
        document.getElementById("telefono-organizador-reserva").value = reserva.telefonoOrganizador;
        document.getElementById("nombre-ponente-reserva").value = reserva.nombrePonente;
        document.getElementById("email-ponente-reserva").value = reserva.emailPonente;
        document.getElementById("telefono-ponente-reserva").value = reserva.telefonoPonente;
        document.getElementById("publicidad-comite-reserva").value = reserva.publicidadComite;       
        document.getElementById("foto-ponente-reserva").value = reserva.fotoPonenteURL;
        // Guardar el valor de la fecha actual para reponerla en caso de que la validación de disponibiildad falle
        guardarBackupFechaEventoReserva();

        // Mostrar el contenido del acordeón datos-reserva-container
        var datosReservaContainer = document.getElementById("datos-reserva-container");
        datosReservaContainer.style.display = "block";
        var content = document.getElementById("acordeon2-content");
        content.style.display = "block";
      } else {
        // El documento no existe, mostrar un mensaje indicando que la reserva no se encontró
        Swal.fire({
          title: '¡NO EXISTE LA RESERVA QUE BUSCAS!',
          text: 'No se ha encontrado una reserva con la clave proporcionada, rectifica que de verdad exista y que estás escribiendo bien la clave,',
          icon: 'warning',
          confirmButtonText: 'Aceptar',
          imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
          imageWidth: 120, // Ancho de la imagen en píxeles
          imageHeight: 235, // Alto de la imagen en píxeles
          imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
        });
      }
    }).catch((error) => {
      // Error al consultar el documento
      console.error("Error al consultar la reserva: ", error);
      Swal.fire({
        title: '¡ERROR!',
        text: 'Ha ocurrido un error al consultar la reserva. Inténtalo nuevamente más tarde o consulta con el administrador/creador del sistema.',
        icon: 'error',
        confirmButtonText: 'Aceptar',
        imageUrl: 'https://i.ibb.co/PZ7KXF9/AVATAR-ERRORES-removebg-preview.png', // URL de la imagen
        imageWidth: 120, // Ancho de la imagen en píxeles
        imageHeight: 235, // Alto de la imagen en píxeles
        imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
      });
    });
    }

    function editarReserva() {

      // Verificar que el correo sea de alguien de la jdn cuando se reserve a nivel nacional ya que estos eventos bloquean el calendario de todos los capítulos.
      var capituloReserva = document.getElementById("capitulo-organizador-reserva").value;
      var emailOrganizadorReserva = document.getElementById("email-organizador-reserva").value;

      // Validar que todos los campos estén llenos y sean válidos
      var camposValidos = validarCamposEdicion();

      // Si todos los campos están llenos y son válidos, proceder con la edición de la reserva
      if (camposValidos) {
        // Verificar si la fecha del evento es válida (mayor a la fecha actual)
        var fechaEventoReserva = document.getElementById("fecha-evento-reserva").value;
        console.log("la fecha nueva es:" + fechaEventoReserva);
        var fechaActual = new Date()//.toISOString().slice(0, 10);
        var fechaActualISOS = new Date().toISOString().slice(0, 10);

        // Verificar si el correo es igual a "aneiap_nacional@aneiap.co"
        if (emailOrganizadorReserva === "aneiap_nacional@aneiap.co") {
          console.log("email del organizador: " + emailOrganizadorReserva)
          Swal.fire({
            title: '¡CORREO PROHIBIDO!',
            text: 'El correo aneiap_nacional@aneiap.co no puede ser organizador, recuerda que acá va el correo de quien es el organizador. Por favor, utiliza un correo diferente.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
        }

        // Verificar si el correo comienza con "capitulo" o "directivos"
        if (emailOrganizadorReserva.toLowerCase().startsWith("capitulo") || emailOrganizadorReserva.toLowerCase().startsWith("directivos")) {
          Swal.fire({
            title: '¡CORREO PROHIBIDO!',
            text: 'Los correos que comienzan con "capitulo" o "directivos" están prohibidos para ser organizador, recuerda que solo el correo del organizador es lo que se escribe acá. Por favor, utiliza un correo diferente.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
        }

        // Verificar si el correo termina con "@aneiap.co"
        if (!emailOrganizadorReserva.toLowerCase().endsWith("@aneiap.co")) {
            Swal.fire({
                title: '¡CORREO INCORRECTO!',
                text: 'El correo electrónico debe terminar con "@aneiap.co". Por favor, utiliza un correo válido.',
                icon: 'warning',
                confirmButtonText: 'Aceptar',
                imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
                imageWidth: 120, // Ancho de la imagen en píxeles
                imageHeight: 235, // Alto de la imagen en píxeles
                imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la edición de la reserva
        }

        // Verificar que el correo sea de alguien de la jdn cuando se reserve a nivel nacional ya que estos eventos bloquean el calendario de todos los capítulos.
        var capituloReserva = document.getElementById("capitulo-organizador-reserva").value;
        if (capituloReserva === "nacional" && capituloUsuario !== "nacional") {
          Swal.fire({
            title: '¡NO TIENES PERMISOS PARA RESERVAR A NIVEL NACIONAL!',
            text: 'Solo los homólogos nacionales (junta nacional) tienen permiso para reservar a nivel nacional, si deseas hacer una reserva nacional, contáctate con ellos.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
        }

        if ((fechaEventoReserva < fechaActual) || (fechaEventoReserva < fechaActualISOS)) {
          Swal.fire({
            title: '¡FECHA INCORRECTA!',
            text: 'Debes reservar al menos con 2 días de anticipación, si ya se venció el plazo y deseas hacerlo igualmente, contacta al administrador.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
        }

        // Verificar el formato del teléfono del organizador (debe empezar por 3 y tener 10 dígitos)
        var telefonoOrganizadorReserva = document.getElementById("telefono-organizador-reserva").value;
        var telefonoOrganizadorReservaRegex = /^3\d{9}$/;

        if (!telefonoOrganizadorReservaRegex.test(telefonoOrganizadorReserva)) {
          Swal.fire({
            title: '¡TELÉFONO DEL ORGANIZADOR INCORRECTO!',
            text: 'Digita un número de teléfono válido.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
        }

        // Verificar el formato del teléfono del ponente (debe empezar por 3 y tener 10 dígitos) si está diligenciado
        var telefonoPonenteReserva = document.getElementById("telefono-ponente-reserva").value;
        if (telefonoPonenteReserva !== "" && !telefonoOrganizadorReservaRegex.test(telefonoPonenteReserva)) {
          Swal.fire({
            title: '¡TELÉFONO DEL PONENTE INCORRECTO!',
            text: 'Digita un número de teléfono válido.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
        }

        // Obtener el enlace del usuario
        var enlaceGoogleDriveReserva = document.getElementById("foto-ponente-reserva").value;
        // Expresión regular para verificar el formato del enlace de Google Drive
        var enlaceGoogleDriveRegex = /^https:\/\/drive\.google\.com\/.*$/;
        var publicidadComiteReserva = document.getElementById("publicidad-comite-reserva").value

        // Validar el enlace utilizando la expresión regular
        if (publicidadComiteReserva === "si") {
        if (enlaceGoogleDriveReserva !== "") {
        if (!enlaceGoogleDriveRegex.test(enlaceGoogleDriveReserva)) {
          Swal.fire({
            title: "¡ENLACE INVÁLIDO!",
            text: "Por favor, ingresa un enlace de Google Drive válido para la foto del ponente.",
            icon: "warning",
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener el registro del evento
          }
        }

        }

        // Aquí realizarías la lógica para verificar la disponibilidad de horarios
        var claveEventoReserva = document.getElementById("clave-evento-reserva").value;
        var fechaEventoReserva = document.getElementById("fecha-evento-reserva").value;
        var horaEventoReserva = document.getElementById("hora-evento-reserva").value;
        var duracionEventoReserva = document.getElementById("duracion-evento-reserva").value;

        // Lógica para verificar disponibilidad (puedes basarte en tu función ConsultarDisponibilidadReservas)
        // Obtener la fecha del evento con claveEventoReserva de la base de datos
        var eventoRef = firebase.firestore().collection("reservas").doc(claveEventoReserva);

        eventoRef.get().then((doc) => {
          if (doc.exists) {
            // El documento existe, realizar operaciones relacionadas con el evento
            // El documento existe, obtener los datos de la reserva
            var reserva = doc.data();
            //var fechaEventoDB = doc.data().fechaEvento.toDate();
            var fechaEventoDB = reserva.fechaEvento;
            console.log("la fecha en la database es:" + fechaEventoDB);

            // Verificar si hay disponibilidad para esa fecha y hora de edición
            verificarDisponibilidadEdicion().then(function(result) {
              if (!result) {
                // Si no se muestra ningún swal.fire, ejecuta el código a continuación
              } else {
                // Obtenemos todos los campos individualmente
                var nombreEventoReserva = document.getElementById("nombre-evento-reserva").value;
                var claveEventoReserva = document.getElementById("clave-evento-reserva").value;
                var fechaEventoReserva = document.getElementById("fecha-evento-reserva").value;
                var horaEventoReserva = document.getElementById("hora-evento-reserva").value;
                var duracionEventoReserva = document.getElementById("duracion-evento-reserva").value;
                var modalidadEventoReserva = document.getElementById("modalidad-evento-reserva").value;
                var ubicacionPlataformaReserva = document.getElementById("ubicacion-plataforma-reserva").value;
                var lugarPresencialReserva = document.getElementById("lugar-presencial-reserva").value;
                var planEventoReserva = document.getElementById("plan-evento-reserva").value;
                var observacionesEventoReserva = document.getElementById("observaciones-evento-reserva").value;
                var nombreOrganizadorReserva = document.getElementById("nombre-organizador-reserva").value;
                var emailOrganizadorReserva = document.getElementById("email-organizador-reserva").value;
                var capituloReserva = document.getElementById("capitulo-organizador-reserva").value;
                var telefonoOrganizadorReserva = document.getElementById("telefono-organizador-reserva").value;
                var nombrePonenteReserva = document.getElementById("nombre-ponente-reserva").value;
                var emailPonenteReserva = document.getElementById("email-ponente-reserva").value;
                var telefonoPonenteReserva = document.getElementById("telefono-ponente-reserva").value;
                var publicidadComiteReserva = document.getElementById("publicidad-comite-reserva").value;
                var observacionesPublicidadReserva = document.getElementById("observaciones-publicidad-reserva").value;
                var fotoPonenteURLReserva = document.getElementById("foto-ponente-reserva").value;

                if (publicidadComiteReserva === "si") {
                  // Mostrar swal.fire para que el usuario seleccione la opción de publicidad
                  swal.fire({
                      title: '¿Desea enviar la solicitud de publicidad a nivel nacional o capitular?',
                      showDenyButton: true,
                      showCloseButton: false, // Oculta el botón de cerrar
                      allowOutsideClick: false, // Impide cerrar haciendo clic afuera
                      confirmButtonText: `Nacional`,
                      denyButtonText: `Capitular`,
                  }).then((result) => {
                      if (result.isConfirmed) {
                          // Si el usuario elige enviar a nivel nacional
                          enviarSolicitudPublicidadEdicionEmailJS("si");
                          enviarCorreoEdicionEmailJS();
                          editarEventoFirestore(nombreEventoReserva, claveEventoReserva, fechaEventoReserva, horaEventoReserva, duracionEventoReserva, modalidadEventoReserva, ubicacionPlataformaReserva, lugarPresencialReserva, planEventoReserva, observacionesEventoReserva, nombreOrganizadorReserva, emailOrganizadorReserva, capituloReserva, telefonoOrganizadorReserva, nombrePonenteReserva, emailPonenteReserva, telefonoPonenteReserva, publicidadComiteReserva, observacionesPublicidadReserva, fotoPonenteURLReserva);
                          // Restablecer los campos a su valor por defecto (vacío)
                          // Ocultar el contenido del acordeón datos-reserva-container
                          var datosReservaContainer = document.getElementById("datos-reserva-container");
                          datosReservaContainer.style.display = "none";
                          var content = document.getElementById("acordeon2-content");
                          content.style.display = "none";
                      } else if (result.isDenied) {
                        // Si el usuario elige enviar a nivel capitular
                        enviarSolicitudPublicidadEdicionEmailJS("no");
                        enviarCorreoEdicionEmailJS();
                        editarEventoFirestore(nombreEventoReserva, claveEventoReserva, fechaEventoReserva, horaEventoReserva, duracionEventoReserva, modalidadEventoReserva, ubicacionPlataformaReserva, lugarPresencialReserva, planEventoReserva, observacionesEventoReserva, nombreOrganizadorReserva, emailOrganizadorReserva, capituloReserva, telefonoOrganizadorReserva, nombrePonenteReserva, emailPonenteReserva, telefonoPonenteReserva, publicidadComiteReserva, observacionesPublicidadReserva, fotoPonenteURLReserva);
                        // Restablecer los campos a su valor por defecto (vacío)
                        // Ocultar el contenido del acordeón datos-reserva-container
                        var datosReservaContainer = document.getElementById("datos-reserva-container");
                        datosReservaContainer.style.display = "none";
                        var content = document.getElementById("acordeon2-content");
                        content.style.display = "none";
                      }
                  });
                } else {
                  enviarCorreoEdicionEmailJS();
                  editarEventoFirestore(nombreEventoReserva, claveEventoReserva, fechaEventoReserva, horaEventoReserva, duracionEventoReserva, modalidadEventoReserva, ubicacionPlataformaReserva, lugarPresencialReserva, planEventoReserva, observacionesEventoReserva, nombreOrganizadorReserva, emailOrganizadorReserva, capituloReserva, telefonoOrganizadorReserva, nombrePonenteReserva, emailPonenteReserva, telefonoPonenteReserva, publicidadComiteReserva, observacionesPublicidadReserva, fotoPonenteURLReserva);
                  // Restablecer los campos a su valor por defecto (vacío)
                  // Ocultar el contenido del acordeón datos-reserva-container
                  var datosReservaContainer = document.getElementById("datos-reserva-container");
                  datosReservaContainer.style.display = "none";
                  var content = document.getElementById("acordeon2-content");
                  content.style.display = "none";
                }
                
              }
            }).catch(function(error) {
              // Maneja cualquier error que pueda ocurrir durante la verificación
              console.error("Error al verificar la disponibilidad:", error);
            });

              // Mostrar mensaje de éxito
              // El mensaje de editar lo arroja la función editarDisponibilidad
          } else {
            // El documento no existe, mostrar mensaje de error
            Swal.fire({
              title: '¡NO EXISTE EL EVENTO QUE BUSCAS!',
              text: 'Verifica que estés escribiendo una clave de evento que de verdad exista.',
              icon: 'error',
              confirmButtonText: 'Aceptar',
              imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return;
          }
        }).catch(function(error) {
          // Manejar errores de consulta aquí
          // Mostrar una alerta tipo SweetAlert en caso de error
          console.log("Error al consultar Firebase: " + error);
          Swal.fire({
            title: 'Error',
            text: 'Hubo en error con el código, consulta al administrador/creador del sistema.',
            icon: 'error',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/PZ7KXF9/AVATAR-ERRORES-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return;
        });
      }
    }

    // Esta función elimina cada reserva que el usuario desee eliminar, también 
    function eliminarReserva() {
        // Obtener los valores de los campos a verificar
        var fechaEventoEliminarsub = document.getElementById("fecha-evento-eliminar").value;
        var horaEventoEliminar = document.getElementById("hora-evento-eliminar").value;
        var claveEventoEliminar = document.getElementById("clave-evento-eliminar").value;

        // Crear una lista para almacenar los nombres de los campos faltantes
        var camposFaltantes = [];

        // Verificar si cada campo está vacío y agregar su nombre a la lista si es el caso
        if (fechaEventoEliminarsub.trim() === "") {
            camposFaltantes.push("Fecha del evento. ");
        }
        if (horaEventoEliminar.trim() === "") {
            camposFaltantes.push("Hora del evento. ");
        }
        if (claveEventoEliminar.trim() === "") {
            camposFaltantes.push("Clave del evento.");
        }
        var fechaEventoEliminarSub = new Date(document.getElementById("fecha-evento-eliminar").value);
        // Si hay campos faltantes, mostrar mensaje de error personalizado
        if (camposFaltantes.length > 0) {
            var mensajeError = "Faltan campos por diligenciar:\n\n" + camposFaltantes.join("\n");
            Swal.fire({
            title: '¡NO HAS DILIGENCIADO TODOS LOS CAMPOS!',
            text: mensajeError,
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
        } else {
            // Si no hay campos faltantes, proceder con la eliminación de la reserva
            Swal.fire({
            title: '¿CONFIRMAS QUE DESEAS ELIMINAR LA RESERVA?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'CONFIRMO',
            cancelButtonText: 'NO',
            imageUrl: 'https://i.ibb.co/VSh1RT4/AVATAR-SEGUROELIMINAR-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            }).then((result) => {
            // Si el usuario hizo clic en el botón "CONFIRMO", proceder a eliminar la reserva
            if (result.isConfirmed) {
                // Realizar la eliminación de la reserva en la base de datos
                var claveEventoEliminar = document.getElementById("clave-evento-eliminar").value;
                console.log(claveEventoEliminar);
                // Obtener una referencia al documento que se desea eliminar
                var reservaRef = firebase.firestore().collection("reservas").doc(claveEventoEliminar);

                // Verificar si el documento existe antes de intentar eliminarlo
                reservaRef.get().then((doc) => {
                  if (doc.exists) {
                    // El documento existe, proceder con la eliminación
                    var fechaReservaSub = new Date(doc.data().fechaEvento);
                    var fechaReserva = fechaReservaSub.toISOString().slice(0, 10);
                    var fechaEventoEliminar = fechaEventoEliminarSub.toISOString().slice(0, 10);
                    var horaReserva = doc.data().horaEvento;
                    var duracionReserva = doc.data().duracionEvento;
                    var nombreEventoReserva= doc.data().nombreEvento;
                    var nombreOrganizadorReserva = doc.data().nombreOrganizador;
                    var correoReserva = doc.data().emailOrganizador;
                    var planEvento = doc.data().planEvento;
                    var capituloEliminar = doc.data().capitulo;
                    var observacionesReserva = doc.data().observacionesEvento;
                    var modalidadReserva = doc.data().modalidadEvento;
                    var ubicacionOPlataforma = doc.data().ubicacionPlataforma;
                    var nombrePonente = doc.data().nombrePonente;
                    // Dividir la hora y los minutos en variables
                    var partesHora = horaEventoEliminar.split(":");
                    var hora = parseInt(partesHora[0], 10); // Convertir la hora en número entero
                    var minutos = parseInt(partesHora[1], 10); // Convertir los minutos en número entero
                    // Calcular el número total de minutos después de la medianoche
                    var minutosDespuesDeMedianoche = hora * 60 + minutos;
                    // Verificar si la fecha es la apropiada
                    if (fechaReserva !== fechaEventoEliminar) {
                      Swal.fire({
                        title: '¡FECHA INCORRECTA!',
                        text: 'La fecha del evento debe ser exactamente igual a la que tiene la reserva.',
                        icon: 'warning',
                        confirmButtonText: 'Aceptar',
                        imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
                        imageWidth: 120, // Ancho de la imagen en píxeles
                        imageHeight: 235, // Alto de la imagen en píxeles
                        imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
                      });
                      return; // Detener la edición de la reserva
                    }
                    if (horaReserva !== '' + minutosDespuesDeMedianoche) {
                      Swal.fire({
                        title: '¡HORA INCORRECTA!',
                        text: 'La hora del evento debe ser exactamente igual a la que tiene la reserva.',
                        icon: 'warning',
                        confirmButtonText: 'Aceptar',
                        imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
                        imageWidth: 120, // Ancho de la imagen en píxeles
                        imageHeight: 235, // Alto de la imagen en píxeles
                        imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
                      });
                      return; // Detener la edición de la reserva
                    }
                    reservaRef.delete().then(() => {
                      // Eliminación exitosa
                      console.log("Reserva eliminada con éxito.");
                      // Resetear los campos del acordeón 3 a sus valores por defect luego de enviar correo.
                      enviarCorreoEliminarEmailJS(claveEventoEliminar,nombreOrganizadorReserva,correoReserva,nombreEventoReserva,fechaReserva,horaReserva,duracionReserva,capituloEliminar,planEvento, observacionesReserva, modalidadReserva, ubicacionOPlataforma, nombrePonente);
                      document.getElementById("fecha-evento-eliminar").value = "";
                      document.getElementById("hora-evento-eliminar").value = "";
                      document.getElementById("clave-evento-eliminar").value = "";
                      // Ocultar el acordeón 3
                      var content = document.getElementById("acordeon3-content");
                      content.style.display = "none";
                      // Mostrar mensaje de éxito
                      mostrarMensajeEliminar();
                      // Ocultar el acordeón 3
                      var content = document.getElementById("acordeon3-content");
                      content.style.display = "none";
                      // Mostrar mensaje de éxito
                      //mostrarMensajeEliminar();
                    }).catch((error) => {
                      // Error al intentar eliminar el documento
                      console.error("NO SE PUDO ELIMINAR LA RESERVA", error);
                      Swal.fire({
                        title: '¡ERROR!',
                        text: 'Ha ocurrido un error al eliminar la reserva. Inténtalo nuevamente más tarde o ponte en contacto con el administrador de la plataforma.',
                        icon: 'error',
                        confirmButtonText: 'Aceptar',
                        imageUrl: 'https://i.ibb.co/PZ7KXF9/AVATAR-ERRORES-removebg-preview.png', // URL de la imagen
                        imageWidth: 120, // Ancho de la imagen en píxeles
                        imageHeight: 235, // Alto de la imagen en píxeles
                        imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
                      });
                    });
                  } else {
                    // El documento no existe, mostrar un mensaje indicando que la reserva no se encontró
                    Swal.fire({
                      title: 'NO EXISTE ESTA RESERVA',
                      text: 'No se ha encontrado una reserva con la clave proporcionada, rectifica que estás diligenciando la clave correcta.',
                      icon: 'warning',
                      confirmButtonText: 'Aceptar',
                      imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
                      imageWidth: 120, // Ancho de la imagen en píxeles
                      imageHeight: 235, // Alto de la imagen en píxeles
                      imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
                    });
                  }
                }).catch((error) => {
                  // Error al consultar el documento
                  console.error("ERROR AL CONSULTAR LA RESERVA", error);
                  Swal.fire({
                    title: '¡ERROR!',
                    text: 'Ha ocurrido un error al consultar la reserva. Inténtalo nuevamente más tarde o ponte en contacto con el administrador de la plataforma',
                    icon: 'error',
                    confirmButtonText: 'Aceptar',
                    imageUrl: 'https://i.ibb.co/PZ7KXF9/AVATAR-ERRORES-removebg-preview.png', // URL de la imagen
                    imageWidth: 120, // Ancho de la imagen en píxeles
                    imageHeight: 235, // Alto de la imagen en píxeles
                    imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
                  });
                });
            }
            });
        }
        }

    // Esta función permite la acción de mostrar un mensaje de éxito al momento de registrar una reserva.        
    function mostrarMensajeReservar() {
      Swal.fire({
      title: '¡RESERVA COMPLETADA!',
      text: 'Su reserva ha sido registrada y APROBADA con ÉXITO, revisa tu correo para confirmar la reserva y obtener tu CLAVE de evento.',
      icon: 'success',
      showConfirmButton: true, // Muestra el botón de confirmación
      allowOutsideClick: false, // Bloquea la interacción fuera del mensaje emergente
      allowEscapeKey: false, // Bloquea la interacción con la tecla Esc
      imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png', // URL de la imagen
      imageWidth: 120, // Ancho de la imagen en píxeles
      imageHeight: 235, // Alto de la imagen en píxeles
      imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
      }).then((result) => {
      // Esta función se ejecutará después de que el usuario haga clic en el botón de confirmación
      });
    }

    // Esta función permite la acción de mostrar un mensaje de éxito al momento de actualizar un espacio.        
    function mostrarMensajeActualizarEspacio() {
      Swal.fire({
      title: '¡ACTUALIZACIÓN COMPLETADA!',
      text: 'Su espacio ha sido actualizado con ÉXITO, revisa en la tabla resumen o en consultar disponibilidad para confirmarlo.',
      icon: 'success',
      showConfirmButton: true, // Muestra el botón de confirmación
      allowOutsideClick: false, // Bloquea la interacción fuera del mensaje emergente
      allowEscapeKey: false, // Bloquea la interacción con la tecla Esc
      imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png', // URL de la imagen
      imageWidth: 120, // Ancho de la imagen en píxeles
      imageHeight: 235, // Alto de la imagen en píxeles
      imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
      }).then((result) => {
      // Esta función se ejecutará después de que el usuario haga clic en el botón de confirmación
      });
    }

    // Esta función permite la acción de mostrar un mensaje de error al momento de tener una falla.        
    function mostrarMensajeFallaTecnica() {
      Swal.fire({
      title: 'Error de Consulta',
      text: 'Ocurrió un error al obtener las reservas. Por favor, inténtalo de nuevo más tarde o comunícate con el creador de la plataforma.',
      icon: 'error',
      confirmButtonText: 'Aceptar',
      allowOutsideClick: true,
      backdrop: true,  
      allowEscapeKey: true
      });
    }

    // Esta función permite la acción de mostrar un mensaje de éxito al momento de actualizar una reserva.    
    function mostrarMensajeEditar() {
      Swal.fire({
      title: '¡ACTUALIZACIÓN DE RESERVA COMPLETADA!',
      text: 'Su reserva ha sido ACTUALIZADA con ÉXITO, revisa tu correo para confirmar la actualización, recuerda que no cambias de CLAVE de evento.',
      icon: 'success',
      showConfirmButton: true, // Muestra el botón de confirmación
      allowOutsideClick: false, // Bloquea la interacción fuera del mensaje emergente
      allowEscapeKey: false, // Bloquea la interacción con la tecla Esc
      imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png', // URL de la imagen
      imageWidth: 120, // Ancho de la imagen en píxeles
      imageHeight: 235, // Alto de la imagen en píxeles
      imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
      }).then((result) => {
      // Esta función se ejecutará después de que el usuario haga clic en el botón de confirmación
      });
    }

    // Esta función permite la acción de mostrar un mensaje de éxito al momento de eliminar una reserva.
    function mostrarMensajeEliminar() {
      Swal.fire({
      title: '¡ELIMININACIÓN DE RESERVA COMPLETADA!',
      text: 'Su reserva ha sido ELIMINADA con ÉXITO, revisa tu correo para confirmar que ha sido eliminada',
      icon: 'success',
      showConfirmButton: true, // Muestra el botón de confirmación
      allowOutsideClick: false, // Bloquea la interacción fuera del mensaje emergente
      allowEscapeKey: false, // Bloquea la interacción con la tecla Esc
      imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png', // URL de la imagen
      imageWidth: 120, // Ancho de la imagen en píxeles
      imageHeight: 235, // Alto de la imagen en píxeles
      imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
      }).then((result) => {
      // Esta función se ejecutará después de que el usuario haga clic en el botón de confirmación
      });
    }

    // Esta función verifica si hacen falta campos obligatorios en la sección "REGISTRAR RESERVA" y en caso de hacer 
    // falta arrojará una alerta diciendo que hacen falta campos y te dirá también cuáles campos son los que faltan.
    function validarCamposRegistrarReserva() {
      // Obtener los valores de los campos
      var nombreEvento = document.getElementById("nombre-evento").value;
      var fechaEvento = document.getElementById("fecha-evento").value;
      var horaEvento = document.getElementById("hora-evento").value;
      var duracionEvento = document.getElementById("duracion-evento").value;
      var modalidadEvento = document.getElementById("modalidad-evento").value;
      var ubicacionPlataforma = document.getElementById("ubicacion-plataforma").value;
      var lugarPresencial = document.getElementById("lugar-presencial").value;
      var planEvento = document.getElementById("plan-evento").value;
      var observacionesEvento = document.getElementById("observaciones-evento").value;
      var nombreOrganizador = document.getElementById("nombre-organizador").value;
      var emailOrganizador = document.getElementById("email-organizador").value;
      var capitulo = document.getElementById("capitulo-organizador").value;
      var telefonoOrganizador = document.getElementById("telefono-organizador").value;
      var nombrePonente = document.getElementById("nombre-ponente").value;
      var emailPonente = document.getElementById("email-ponente").value;
      var telefonoPonente = document.getElementById("telefono-ponente").value;
      var publicidadComite = document.getElementById("publicidad-comite").value.toLowerCase();
      var fotoPonente = document.getElementById("foto-ponente").value;

      // Lista para almacenar los campos faltantes
      var camposFaltantes = [];

      // Verificar qué campos están vacíos y agregar sus nombres a la lista
      if (nombreEvento.trim() === "") {
        camposFaltantes.push("Nombre del evento");
      }
      if (fechaEvento.trim() === "") {
        camposFaltantes.push("Fecha del evento");
      }
      if (horaEvento.trim() === "") {
        camposFaltantes.push("Hora del evento");
      }
      if (duracionEvento.trim() === "") {
        camposFaltantes.push("Duración del evento");
      }
      if (modalidadEvento.trim() === "") {
        camposFaltantes.push("Modalidad del evento");
      }
      if (ubicacionPlataforma.trim() === "" && lugarPresencial.trim() === "") {
            camposFaltantes.push("Ubicación en plataforma o Lugar presencial");
        }
      if (planEvento.trim() === "") {
        camposFaltantes.push("Plan del evento");
      }
      if (nombreOrganizador.trim() === "") {
        camposFaltantes.push("Nombre del organizador");
      }
      if (emailOrganizador.trim() === "") {
        camposFaltantes.push("Email del organizador");
      }
      if (capitulo.trim() === "") {
        camposFaltantes.push("Capítulo");
      }
      if (telefonoOrganizador.trim() === "") {
        camposFaltantes.push("Teléfono del organizador");
      }
      if (nombrePonente.trim() === "") {
        camposFaltantes.push("Nombre del ponente");
      }
      if (publicidadComite === "") {
          camposFaltantes.push("Publicidad SÍ/NO");
      }   
      if (publicidadComite === "si" && fotoPonente.trim() === "") {
        camposFaltantes.push("Foto del ponente");
      }

      // Mostrar la alerta si hay campos faltantes con la concatenación de los campos faltantes.
      if (camposFaltantes.length > 0) {
        var mensaje = "Faltan campos por diligenciar:\n";
        for (var i = 0; i < camposFaltantes.length; i++) {
          mensaje += "- " + camposFaltantes[i] + "\n";
        }

        Swal.fire({
          title: '¡FALTAN CAMPOS POR DILIGENCIAR EN TU RESERVA!',
          text: mensaje,
          icon: 'warning',
          confirmButtonText: 'Aceptar',
          allowOutsideClick: true,
          backdrop: true,  
          allowEscapeKey: true,
          imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
          imageWidth: 120, // Ancho de la imagen en píxeles
          imageHeight: 235, // Alto de la imagen en píxeles
          imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
        });
        return false;
      }

      return true; // Todos los campos están llenos
    }

    // Esta función verifica si hacen falta campos obligatorios en la sección "EDITAR RESERVA" y en caso de hacer 
    // falta arrojará una alerta diciendo que hacen falta campos y te dirá también cuáles campos son los que faltan.
    function validarCamposEdicion() {
        var camposFaltantes = [];

        // Obtener los valores de los campos a verificar
        var nombreEventoReserva = document.getElementById("nombre-evento-reserva").value;
        var fechaEventoReserva = document.getElementById("fecha-evento-reserva").value;
        var horaEventoReserva = document.getElementById("hora-evento-reserva").value;
        var duracionEventoReserva = document.getElementById("duracion-evento-reserva").value;
        var modalidadEventoReserva = document.getElementById("modalidad-evento-reserva").value;
        var ubicacionPlataformaReserva = document.getElementById("ubicacion-plataforma-reserva").value;
        var lugarPresencialReserva = document.getElementById("lugar-presencial-reserva").value;
        var planEventoReserva = document.getElementById("plan-evento-reserva").value;
        var observacionesEventoReserva = document.getElementById("observaciones-evento-reserva").value;
        var nombreOrganizadorReserva = document.getElementById("nombre-organizador-reserva").value;
        var emailOrganizadorReserva = document.getElementById("email-organizador-reserva").value;
        var capituloReserva = document.getElementById("capitulo-organizador-reserva").value;
        var telefonoOrganizadorReserva = document.getElementById("telefono-organizador-reserva").value;
        var nombrePonenteReserva = document.getElementById("nombre-ponente-reserva").value;
        var emailPonenteReserva = document.getElementById("email-ponente-reserva").value;
        var telefonoPonenteReserva = document.getElementById("telefono-ponente-reserva").value;
        var publicidadComiteReserva = document.getElementById("publicidad-comite-reserva").value;
        var fotoPonenteReserva = document.getElementById("foto-ponente-reserva").value;
        
        // Verificar si cada campo está vacío y agregar su nombre a la lista si es el caso
        if (nombreEventoReserva.trim() === "") {
            camposFaltantes.push("Nombre del evento");
        }
        if (fechaEventoReserva.trim() === "") {
            camposFaltantes.push("Fecha del evento");
        }
        if (horaEventoReserva.trim() === "") {
            camposFaltantes.push("Hora del evento");
        }
        if (duracionEventoReserva.trim() === "") {
            camposFaltantes.push("Duración del evento");
        }
        if (modalidadEventoReserva.trim() === "") {
            camposFaltantes.push("Modalidad del evento");
        }
        if (ubicacionPlataformaReserva.trim() === "" && lugarPresencialReserva.trim() === "") {
            camposFaltantes.push("Ubicación en plataforma o Lugar presencial");
        }
        if (planEventoReserva.trim() === "") {
            camposFaltantes.push("Plan del evento");
        }
        if (nombreOrganizadorReserva.trim() === "") {
            camposFaltantes.push("Nombre del organizador");
        }
        if (emailOrganizadorReserva.trim() === "") {
            camposFaltantes.push("Email del organizador");
        }
        if (capituloReserva.trim() === "") {
            camposFaltantes.push("Capítulo");
        }
        if (telefonoOrganizadorReserva.trim() === "") {
            camposFaltantes.push("Teléfono del organizador");
        }
        if (nombrePonenteReserva.trim() === "") {
            camposFaltantes.push("Nombre del ponente");
        }
        if (publicidadComiteReserva === "") {
          camposFaltantes.push("Publicidad SÍ/NO");
        }        
        if (publicidadComiteReserva === "si" && fotoPonenteReserva.trim() === "") {
          camposFaltantes.push("Foto del ponente");
        }

        // Mostrar la alerta si hay campos faltantes con la concatenación de cada uno de ellos (los faltantes).
        if (camposFaltantes.length > 0) {
            var mensaje = "Faltan campos por diligenciar:\n";
            for (var i = 0; i < camposFaltantes.length; i++) {
            mensaje += "- " + camposFaltantes[i] + "\n";
            }

            Swal.fire({
            title: '¡NO HAS DILIGENCIADO TODOS LOS CAMPOS!',
            text: mensaje,
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,  
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });

            return false;
        }

        return true; // Todos los campos están llenos y son válidos
        }

    function activarConsultaDisponibilidad() {
      // Obtener referencias a los elementos de fecha y capítulo
      var fechaInput = document.getElementById("fecha-consulta");
      var capituloSelect = document.getElementById("capitulo-consulta");

      // Agregar event listener para cambio de fecha
      fechaInput.addEventListener("change", function() {
        ConsultarDisponibilidadReservas();
      });

      // Agregar event listener para cambio de capítulo
      capituloSelect.addEventListener("change", function() {
        ConsultarDisponibilidadReservas();
      });
    }
    // Listener combo para que se active la consulta de disponibilidad cada vez que den click a una fecha o capítulo.
    document.addEventListener("DOMContentLoaded", function() {activarConsultaDisponibilidad();});

    function ConsultarDisponibilidadReservas() {
        var fechaConsulta = document.getElementById("fecha-consulta").value;
        var capituloConsulta = document.getElementById("capitulo-consulta").value;
        var fechaHoy = new Date().toISOString().slice(0, 10);

        // Acá se verifica que se haya insertado una fecha, si no insertaste nada, para el proceso y le notifica al usuario.
        if (fechaConsulta.trim() === "") {
          // Mostrar mensaje de error si no se ha seleccionado una fecha válida
          Swal.fire({
            title: '¡FECHA NO SELECCIONADA!',
            text: 'Por favor, selecciona una fecha para consultar la disponibilidad.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,  
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return;
        }
        if (capituloConsulta.trim() === "") {
          // Mostrar mensaje de error si no se ha seleccionado una fecha válida
          Swal.fire({
            title: '¡CAPÍTULO NO SELECCIONADO!',
            text: 'Por favor, selecciona el capítulo del cual deseas consultar la disponibilidad.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,  
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom-end')
          });
          return;
        }
        /* Comentario opcional por si se desea considerar o no la limitación de fecha de hoy al consultar
        if (fechaConsulta < fechaHoy) {
          // Mostrar mensaje de error si la fecha seleccionada es menor o igual a la fecha actual
          Swal.fire({
            title: '¡FECHA INCORRECTA!',
            text: 'Por favor, selecciona una fecha mayor a la fecha de HOY para consultar la disponibilidad.',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,  
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return;
        }*/

        // Aquí realizarías la lógica para consultar la disponibilidad de reservas con la fecha seleccionada
        var reservasRef = firebase.firestore().collection("reservas");
        
        var consultaCapitulo = reservasRef.where("fechaEvento", "==", fechaConsulta).where("capitulosOrganizadores", "array-contains", capituloConsulta);
        var consultaNacional = reservasRef.where("fechaEvento", "==", fechaConsulta).where("capitulosOrganizadores", "array-contains", "nacional");

        Promise.all([consultaCapitulo.get(), consultaNacional.get()])
          .then(function(results) {
            var querySnapshotCapitulo = results[0];
            var querySnapshotNacional = results[1];

            // Combinar los resultados de ambas consultas
            var querySnapshotCombined = querySnapshotCapitulo.docs.concat(querySnapshotNacional.docs);

            // Eliminar duplicados si es necesario
            var uniqueDocs = [];
            var docIds = new Set();
            querySnapshotCombined.forEach(function(doc) {
              if (!docIds.has(doc.id)) {
                docIds.add(doc.id);
                uniqueDocs.push(doc);
              }
            });

            // Arreglo que representará el estado de disponibilidad de cada intervalo
            var disponibilidad = Array(28).fill(true); // Inicialmente, todos los intervalos están disponibles (verde)

            // Ciclo para revisar cada evento reservado para la fecha seleccionada
            uniqueDocs.forEach(function(doc) {
              var horaEvento = doc.data().horaEvento; // Hora en minutos (ej. 480 para 08:00)
              var duracionEvento = doc.data().duracionEvento; // Duración en minutos (ej. 120 para 2 horas)

              // Calcular los índices de inicio y fin del intervalo que ocupará el evento
              var inicioIntervalo = Math.floor((horaEvento - 480) / 30);
              var finIntervalo = inicioIntervalo + (duracionEvento / 30);

              // Marcar los intervalos como ocupados (rojo) en el arreglo de disponibilidad
              for (var i = inicioIntervalo; i < finIntervalo; i++) {
                disponibilidad[i] = false;
              }
            });

            // Actualizar la visualización de disponibilidad en el HTML
            var disponibilidadContainer = document.querySelector(".disponibilidad-container");
            var disponibilidadItems = disponibilidadContainer.getElementsByClassName("disponibilidad-item");
            for (var i = 0; i < disponibilidad.length; i++) {
              if (disponibilidad[i]) {
                disponibilidadItems[i].style.backgroundColor = "#00B30F"; // Establecer fondo verde para intervalo disponible
              } else {
                disponibilidadItems[i].style.backgroundColor = "red"; // Establecer fondo rojo para intervalo ocupado
              }
            }
            /* oculto el swal.fire para que no moleste.
            // Mostrar mensaje de éxito
            Swal.fire({
              title: '¡CONSULTA DE DISPONIBILIDAD REALIZADA!',
              text: 'La consulta se realizó con éxito para la fecha seleccionada. Los horarios en rojo representan que ya están reservados, los que están en color verde son los disponibles.',
              icon: 'success',
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,  
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom-end')
            });
            */
            // Construir la sección de eventos programados
            var eventosProgramadosDiv = document.getElementById("eventos-programados");
            eventosProgramadosDiv.innerHTML = ""; // Limpiar el contenido anterior

            var eventos = [];
            var indice = 1;
            uniqueDocs.forEach(function(doc) {
              var nombreEvento = doc.data().nombreEvento;
              var nombreOrganizador = doc.data().nombreOrganizador;
              var horaEvento = doc.data().horaEvento;
              var correoOrganizador = doc.data().emailOrganizador;
              var capitulo = doc.data().capitulosOrganizadores;

              var hora = Math.floor(horaEvento / 60); // Obtener la hora del evento
              var minutos = horaEvento % 60; // Obtener los minutos del evento
              var horaFormateada = (hora < 10 ? "0" + hora : hora) + ":" + (minutos < 10 ? "0" + minutos : minutos); // Formatear la hora

              eventos.push({ indice: numeroAEmoji(indice), nombre: nombreEvento, organizador: nombreOrganizador, capitulo: capitulo, hora: horaFormateada, correo: correoOrganizador });
              indice++;
            });

            // Mostrar los eventos en la sección
            if (eventos.length > 0) {
              eventos.forEach(function(evento) {
                eventosProgramadosDiv.innerHTML += "<b>Evento </b>" + evento.indice + ": <b>Nombre espacio: </b>" + evento.nombre + " - <b>Organizador: </b>" + evento.organizador + " - <b>Capítulo: </b>" + evento.capitulo + " - <b>Hora: </b>" + evento.hora + " - <b>Correo: </b>" + evento.correo + "<br>";
              });
            } else {
              eventosProgramadosDiv.innerHTML = "No hay eventos programados para esta fecha y capítulo.";
            }
          }).catch(function(error) {
            console.log("Error obteniendo reservas:", error);
            // Mostrar mensaje de error en caso de fallo en la consulta a Firebase
          });
      }

    var consultaDiaria = true; // Variable para almacenar el estado de la consulta (diaria por defecto)

    function alternarConsulta() {
        consultaDiaria = !consultaDiaria; // Alternar entre consulta diaria y semanal
        var botonAlternar = document.getElementById("alternarConsulta");
        var consultaDiariaDiv = document.getElementById("consultaDiaria");
        var consultaSemanalDiv = document.getElementById("consultaSemanal");
        if (consultaDiaria) {
            botonAlternar.textContent = "Cambiar a calendario semanal";
            consultaDiariaDiv.style.display = "block"; // Mostrar la consulta diaria
            consultaSemanalDiv.style.display = "none"; // Ocultar la consulta semanal
        } else {
            botonAlternar.textContent = "Cambiar a calendario diario";
            consultaDiariaDiv.style.display = "none"; // Ocultar la consulta diaria
            consultaSemanalDiv.style.display = "block"; // Mostrar la consulta semanal
        }
    }

    function activarConsultaSemanal() {
      // Obtener referencias a los elementos de fecha y capítulo
      var fechaInput = document.getElementById("fecha-consulta-semanal");
      var capituloSelect = document.getElementById("capitulo-consulta-semanal");

      // Agregar event listener para cambio de fecha
      fechaInput.addEventListener("change", function() {
        ConsultarDisponibilidadSemanal();
      });

      // Agregar event listener para cambio de capítulo
      capituloSelect.addEventListener("change", function() {
        ConsultarDisponibilidadSemanal();
      });
    }
    // Listener combo para que se active la consulta de disponibilidad cada vez que den click a una fecha o capítulo.
    document.addEventListener("DOMContentLoaded", function() {activarConsultaSemanal();});

    function ConsultarDisponibilidadSemanal() {
      var fechaConsultaDirecta = document.getElementById("fecha-consulta-semanal").value;
      var fechaConsulta = new Date(document.getElementById("fecha-consulta-semanal").value);
      var capituloConsulta = document.getElementById("capitulo-consulta-semanal").value;

      // Verificar que se haya seleccionado una fecha y capítulo
      if (fechaConsultaDirecta.trim() === "" || capituloConsulta.trim() === "") {
        // Mostrar mensaje de error si no se ha seleccionado una fecha o capítulo válidos
        Swal.fire({
          title: '¡FECHA O CAPÍTULO NO SELECCIONADOS!',
          text: 'Por favor, selecciona una fecha y un capítulo para consultar la disponibilidad semanal.',
          icon: 'warning',
          confirmButtonText: 'Aceptar',
          allowOutsideClick: true,
          backdrop: true,
          allowEscapeKey: true,
          imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png',
          imageWidth: 120,
          imageHeight: 235,
          imagePosition: 'top-start'
        });
        return;
      }

      // Limpiar el contenido anterior del calendario semanal
      var calendarioSemanal = document.getElementById("calendario-semanal");
      calendarioSemanal.innerHTML = "";

      // Crear la tabla del calendario semanal
      var tablaCalendario = document.createElement("table");
      tablaCalendario.classList.add("calendario-semanal-table");
      calendarioSemanal.appendChild(tablaCalendario);

      // Crear el encabezado de la tabla
      var encabezado = tablaCalendario.createTHead().insertRow(0);
      var thDiaSemana = document.createElement("th");
      thDiaSemana.textContent = "Día de la semana";
      encabezado.appendChild(thDiaSemana);
      var thEventosReservados = document.createElement("th");
      thEventosReservados.textContent = "Eventos reservados";
      encabezado.appendChild(thEventosReservados);

      // Crear el cuerpo de la tabla
      var cuerpoTabla = tablaCalendario.createTBody();

      // Obtener la fecha del lunes de la semana
      var lunesSemana = mostrarSemana();

      // Calcular las fechas para cada día de la semana
      var fechaLunes = new Date(lunesSemana);
      var fechaMartes = new Date(fechaLunes);
      fechaMartes.setDate(fechaLunes.getDate() + 1);
      var fechaMiercoles = new Date(fechaLunes);
      fechaMiercoles.setDate(fechaLunes.getDate() + 2);
      var fechaJueves = new Date(fechaLunes);
      fechaJueves.setDate(fechaLunes.getDate() + 3);
      var fechaViernes = new Date(fechaLunes);
      fechaViernes.setDate(fechaLunes.getDate() + 4);
      var fechaSabado = new Date(fechaLunes);
      fechaSabado.setDate(fechaLunes.getDate() + 5);
      var fechaDomingo = new Date(fechaLunes);
      fechaDomingo.setDate(fechaLunes.getDate() + 6);

      // Formatear las fechas en el formato "YYYY-MM-DD"
      var fechaLunesString = convertirFechaTipoFirebaseYDate(fechaLunes);
      var fechaMartesString = convertirFechaTipoFirebaseYDate(fechaMartes);
      var fechaMiercolesString = convertirFechaTipoFirebaseYDate(fechaMiercoles);
      var fechaJuevesString = convertirFechaTipoFirebaseYDate(fechaJueves);
      var fechaViernesString = convertirFechaTipoFirebaseYDate(fechaViernes);
      var fechaSabadoString = convertirFechaTipoFirebaseYDate(fechaSabado);
      var fechaDomingoString = convertirFechaTipoFirebaseYDate(fechaDomingo);

      // Crear las consultas para cada día de la semana
      consultarEventos(fechaLunesString, cuerpoTabla, capituloConsulta);
      consultarEventos(fechaMartesString, cuerpoTabla, capituloConsulta);
      consultarEventos(fechaMiercolesString, cuerpoTabla, capituloConsulta);
      consultarEventos(fechaJuevesString, cuerpoTabla, capituloConsulta);
      consultarEventos(fechaViernesString, cuerpoTabla, capituloConsulta);
      consultarEventos(fechaSabadoString, cuerpoTabla, capituloConsulta);
      consultarEventos(fechaDomingoString, cuerpoTabla, capituloConsulta);
    }

    // Función para consultar eventos reservados para un día y agregarlos a la tabla
    function consultarEventos(fechaDiaTipoFirebase, cuerpoTabla, capituloConsulta) {
      var fila = cuerpoTabla.insertRow();
      var fechaDiaTipoDate = convertirFechaTipoFirebaseYDate(fechaDiaTipoFirebase);
      var diaSemana = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
      var textoDia = fechaDiaTipoDate;
      fila.insertCell().textContent = textoDia; // Agregar el día de la semana a la primera columna de la fila

      // Consultar los eventos reservados para el día de la semana actual
      var reservasRef = firebase.firestore().collection("reservas");
      
      var consultaCapitulo = reservasRef.where("fechaEvento", "==", fechaDiaTipoFirebase).where("capitulosOrganizadores", "array-contains", capituloConsulta);
      var consultaNacional = reservasRef.where("fechaEvento", "==", fechaDiaTipoFirebase).where("capitulosOrganizadores", "array-contains", "nacional");

      Promise.all([consultaCapitulo.get(), consultaNacional.get()])
        .then(function(results) {
          var querySnapshotCapitulo = results[0];
          var querySnapshotNacional = results[1];

          // Combinar los resultados de ambas consultas
          var querySnapshotCombined = querySnapshotCapitulo.docs.concat(querySnapshotNacional.docs);

          // Eliminar duplicados si es necesario
          var uniqueDocs = [];
          var docIds = new Set();
          querySnapshotCombined.forEach(function(doc) {
            if (!docIds.has(doc.id)) {
              docIds.add(doc.id);
              uniqueDocs.push(doc);
            }
          });

          var numEventos = uniqueDocs.length;
          console.log("Número de eventos obtenidos para el día ", fechaDiaTipoFirebase, ":", numEventos);
          var eventos = [];
          uniqueDocs.forEach(function(doc) {
            var nombreEvento = doc.data().nombreEvento;
            var nombreOrganizador = doc.data().nombreOrganizador;
            var horaEvento = doc.data().horaEvento;
            var correoOrganizador = doc.data().emailOrganizador;
            var capitulo = doc.data().capitulosOrganizadores;

            var hora = Math.floor(horaEvento / 60); // Obtener la hora del evento
            var minutos = horaEvento % 60; // Obtener los minutos del evento
            var horaFormateada = (hora < 10 ? "0" + hora : hora) + ":" + (minutos < 10 ? "0" + minutos : minutos); // Formatear la hora

            eventos.push({ nombre: nombreEvento, organizador: nombreOrganizador, capitulo: capitulo, hora: horaFormateada, correo: correoOrganizador });
          });

          // Agregar los eventos reservados para el día de la semana actual a la segunda columna de la fila
          if (eventos.length > 0) {
            var eventosReservados = "";
            eventos.forEach(function(evento, indice) {
              eventosReservados += `${numeroAEmoji(indice + 1)} ${evento.nombre} - Organizador: ${evento.organizador} - Capítulo: ${evento.capitulo} - Hora: ${evento.hora} - Correo: ${evento.correo}<br>`;
            });
            fila.insertCell().innerHTML = eventosReservados;
          } else {
            fila.insertCell().innerHTML = "✅ DISPONIBLE POR COMPLETO.";
          }
        }).catch(function(error) {
          console.log("Error obteniendo reservas:", error);
          // Mostrar mensaje de error en caso de fallo en la consulta a Firebase
        });
    }

    function convertirFechaTipoFirebaseYDate(fecha) {
      // Verificar si la fecha es un objeto Date válido
      if (fecha instanceof Date && !isNaN(fecha)) {
        // Extraer el día, mes y año
        var dia = fecha.getDate().toString().padStart(2, '0');
        var mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
        var anio = fecha.getFullYear();

        // Construir la fecha en formato "YYYY-MM-DD"
        return anio + '-' + mes + '-' + dia;
      }
      // Verificar si la fecha es en formato "YYYY-MM-DD"
      else if (/^\d{4}-\d{2}-\d{2}$/.test(fecha)) {
        // Extraer el año, mes y día
        var anio = fecha.substring(0, 4);
        var mes = fecha.substring(5, 7);
        var dia = fecha.substring(8, 10);

        // Construir la fecha en formato "DD/MM/YYYY"
        return dia + '/' + mes + '/' + anio;
      }
      // Verificar si la fecha es en formato "DD/MM/YYYY"
      else if (/^\d{2}\/\d{2}\/\d{4}$/.test(fecha)) {
        // Extraer el día, mes y año
        var dia = fecha.substring(0, 2);
        var mes = fecha.substring(3, 5);
        var anio = fecha.substring(6, 10);

        // Construir la fecha en formato "YYYY-MM-DD"
        return anio + '-' + mes + '-' + dia;
      }
      // Si el formato no es reconocido, retornar null
      else {
        return null;
      }
    }

    var fechaConsultaSemanalInput = document.getElementById("fecha-consulta-semanal");
    fechaConsultaSemanalInput.addEventListener("change", mostrarSemana);
    function mostrarSemana() {
      // Obtener la fecha seleccionada
      let fechaSeleccionada = new Date(document.getElementById("fecha-consulta-semanal").value);
      // Obtener el día de la semana (1 = lunes, ..., 6 = sábado, 7 = domingo)
      let diaSemana = fechaSeleccionada.getDay();
      console.log("diaSemana: " + diaSemana)

      // Calcular la fecha del lunes de la semana
      let lunesSemana = new Date(fechaSeleccionada);
      if (diaSemana === 0) {
        // Si es lunes, la semana comienza ese mismo día y termina sumándole 6 días
        lunesSemana.setDate(fechaSeleccionada.getDate() + 1);
      } else if (diaSemana === 1) {
        // Si es martes, la semana comienza restando 6 días y termina ese mismo día
        lunesSemana.setDate(fechaSeleccionada.getDate());
      } else if (diaSemana === 2) {
        // Si es martes, la semana comienza restando 1 día y termina sumándole 5 días
        lunesSemana.setDate(fechaSeleccionada.getDate() - 1);
      } else if (diaSemana === 3) {
        // Si es miércoles, la semana comienza restando 2 días y termina sumándole 4 días
        lunesSemana.setDate(fechaSeleccionada.getDate() - 2);
      } else if (diaSemana === 4) {
        // Si es jueves, la semana comienza restando 3 días y termina sumándole 3 días
        lunesSemana.setDate(fechaSeleccionada.getDate() - 3);
      } else if (diaSemana === 5) {
        // Si es viernes, la semana comienza restando 4 días y termina sumándole 2 días
        lunesSemana.setDate(fechaSeleccionada.getDate() - 4);
      } else if (diaSemana === 6) {
        // Si es sábado, la semana comienza restando 5 días y termina sumándole 1 día
        lunesSemana.setDate(fechaSeleccionada.getDate() - 5);
      }

      // Calcular la fecha del domingo de la semana
      let domingoSemana = new Date(lunesSemana + 6);
      domingoSemana.setDate(lunesSemana.getDate()+6);

      // Formatear las fechas para mostrarlas
      let formatoFecha = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      let textoLunes = lunesSemana.toLocaleDateString('es-ES', formatoFecha).replace(/\b\w+\b/g, match => `<b>${match}</b>`);
      let textoDomingo = domingoSemana.toLocaleDateString('es-ES', formatoFecha).replace(/\b\w+\b/g, match => `<b>${match}</b>`);
      
      // Convertir los números de día a emojis
      textoLunes = textoLunes.replace(/\d{1,2}/g, match => `${numeroAEmoji(parseInt(match))}`);
      textoDomingo = textoDomingo.replace(/\d{1,2}/g, match => `${numeroAEmoji(parseInt(match))}`);
      
      // Actualizar el texto con la semana seleccionada
      document.getElementById("semana-seleccionada").innerHTML = `Semana del ${textoLunes} al ${textoDomingo}`;

      // Retornar la fecha del lunes
      return new Date(lunesSemana);
    }

    function obtenerCorreoEdicion(correoElectronico, capitulo) {
      // Banco de correos asociados a cada capítulo
      const bancoCorreos = {
          uniguajira: "academico_uniguajira@aneiap.co, interventoria_uniguajira@aneiap.co",
          unimagdalena: "academico_unimagdalena@aneiap.co",
          uniatlantico: "academico_uniatlantico@aneiap.co",
          uninorte: "academico_uninorte@aneiap.co, interventoria_uninorte@aneiap.co",
          unisimon: "academico_unisimon@aneiap.co, interventoria_unisimon@aneiap.co",
          cuc: "academico_cuc@aneiap.co, interventoria_cuc@aneiap.co",
          librequilla: "academico_librequilla@aneiap.co",
          utb: "academico_utb@aneiap.co",
          upbmonteria: "academico_upbmonteria@aneiap.co, interventoria_upbmonteria@aneiap.co",
          unicordoba: "academico_unicordoba@aneiap.co, interventoria_unicordoba@aneiap.co",
          areandina: "academico_areandina@aneiap.co, interventoria_areandina@aneiap.co",
          ufps: "academico_ufps@aneiap.co, interventoria_ufps@aneiap.co",
          unalmed: "academico_unalmed@aneiap.co",
          udea: "academico_udea@aneiap.co",
          upbmed: "academico_upbmed@aneiap.co",
          utp: "academico_utp@aneiap.co, interventoria_utp@aneiap.co",
          unalma: "academico_unalma@aneiap.co, interventoria_unalma@aneiap.co",
          udistrital: "academico_udistrital@aneiap.co",
          unalbog: "academico_unalbog@aneiap.co",
          univalle: "academico_univalle@aneiap.co",
          icesi: "academico_icesi@aneiap.co",
          usc: "academico_usc@aneiap.co, interventoria_usc@aneiap.co",
          librecali: "academico_librecali@aneiap.co, interventoria_librecali@aneiap.co",
          nacional: "academico@aneiap.co, interventoria@aneiap.co"
      };

      // Correo de usuario y correos asociados al capítulo
      const correosUsuario = correoElectronico ? correoElectronico + ", " : "";
      const correosCapitulo = bancoCorreos[capitulo.toLowerCase()] || "";

      // Devolver todos los correos concatenados
      return correosUsuario + correosCapitulo;
    }

    // Función para enviar el correo de edición de reserva
    function enviarCorreoEdicion() {
      // Obtener el correo del organizador para enviarle el correo
      const correoDestino = document.getElementById("email-organizador-reserva").value;
      const claveReserva = document.getElementById("clave-evento-reserva").value;

      const emailHost = "smtp.elasticemail.com"; // Reemplaza con el servidor SMTP correcto
      const emailUsername = "siea@aneiap.co"; // Reemplaza con tu nombre de usuario SMTP
      const emailPassword = "D20D124D2A2129252882BEE9DAC2B79F4E70"; // Reemplaza con tu contraseña SMTP
      const asunto = `Confirmación de edición de reserva - Clave: ${claveReserva}`;

      // Datos adicionales de la reserva
      const nombreOrganizadorReserva= document.getElementById("nombre-organizador-reserva").value;
      const nombreEventoReserva= document.getElementById("nombre-evento-reserva").value;
      const fechaReserva = document.getElementById("fecha-evento-reserva").value;
      const horaReserva = document.getElementById("hora-evento-reserva").value;
      const duracionReserva = document.getElementById("duracion-evento-reserva").value;
      const planEvento = document.getElementById("plan-evento-reserva").value;
      const modalidadReserva = document.getElementById("modalidad-evento-reserva").value;
      const capituloReserva = document.getElementById("capitulo-organizador-reserva").value;
      const nombrePonente = document.getElementById("nombre-ponente-reserva").value;
      const publicidadComiteReserva = document.getElementById("publicidad-comite-reserva").value;
      const observacionesPublicidadReserva = document.getElementById("observaciones-publicidad-reserva").value;
      const fotoPonenteURLReserva = document.getElementById("foto-ponente-reserva").value;
      const ubicacionPlataformaReserva = document.getElementById("ubicacion-plataforma-reserva").value;
      const lugarPresencialReserva = document.getElementById("lugar-presencial-reserva").value;

      const destinatario = obtenerCorreoEdicion(correoDestino, capituloReserva); // Reemplaza con la dirección de correo del destinatario junto al bancoCorreos

      // Convertir duración a formato horas + minutos
      const duracionHoras = Math.floor(duracionReserva / 60);
      const duracionMinutos = duracionReserva % 60;

      // Convertir minutos a formato militar (HH:MM)
      const horasMilitar = Math.floor(horaReserva / 60);
      const minutosMilitar = horaReserva % 60;
      const horaMilitar = `${horasMilitar.toString().padStart(2, "0")}:${minutosMilitar.toString().padStart(2, "0")}`;

      // Datos adicionales para la publicidad
      let publicidad = "";
      if (publicidadComiteReserva === "si") {
        publicidad = `
          <p>El organizador ha solicitado la realización de la publicidad para el evento. A continuación, se adjuntan las observaciones:</p>
          <p>${observacionesPublicidadReserva}</p>
          <p>Puede encontrar la foto del ponente en el siguiente enlace: <a href="${fotoPonenteURLReserva}" target="_blank">FOTO PONENTE</a></p>
        `;
      }

      // Mensaje de correo con los datos adicionales
      const mensaje = `
        <html>
          <body>
            <h1 style="color: #007BFF;">Su edición de reserva ha sido confirmada ☑️</h1>
            <p>Estimado(a) <strong>${nombreOrganizadorReserva}</strong>,</p>
            <p>Le confirmamos que su edición de reserva para el evento <strong>${nombreEventoReserva}</strong> ha sido procesada correctamente.</p>
            <p>A continuación, encontrará los detalles de su reserva:</p>
            <ul>
              <li><strong>Clave de la reserva:</strong> ${claveReserva}</li>
              <li><strong>Fecha de la reserva:</strong> ${fechaReserva}</li>
              <li><strong>Hora de la reserva:</strong> ${horaMilitar}</li>
              <li><strong>Capitulo:</strong> ${capituloReserva}</li>
              <li><strong>Duración de la reserva:</strong> ${duracionHoras} hora(s) ${duracionMinutos} minuto(s)</li>
              <li><strong>Plan del evento:</strong> ${planEvento}</li>
              <li><strong>Modalidad de la reserva:</strong> ${modalidadReserva}</li>
              ${modalidadReserva === "virtual" ? `<li><strong>Plataforma:</strong> ${ubicacionPlataformaReserva}</li>` : `<li><strong>Ubicación/Salón:</strong> ${lugarPresencialReserva}</li>`}
              <li><strong>Nombre del ponente:</strong> ${nombrePonente}</li>
            </ul>
            ${publicidad}
            <p>Si tiene alguna pregunta, inquietud o necesita asistencia adicional, no dude en <a href="http://wa.me/3002252099" target="_blank">hacer clic aquí</a> para comunicarse con nosotros a través de WhatsApp.</p>
            <p>Recuerde que todas las claves son personales e intransferibles, no las comparta con nadie. 💙💚</p>
            <p>Agradecemos su confianza en nosotros, recuerde que este correo es automático y NO debe ser respondido. Esperamos seguir construyendo A.L.M.A. 💙💚</p>
            <p style="font-style: italic;">Cordialmente,</p>
            <p style="font-style: italic;">Alessandro Villanueva Cantillo</p>
            <p style="font-style: italic;">Administrador y creador SIEA</p>
          </body>
        </html>
      `;

      Email.send({
        Host: emailHost,
        Username: emailUsername,
        Password: emailPassword,
        To: `${destinatario}, siea@aneiap.co`, // Usuario que está registrando la reserva
        From: emailUsername, // Debería ser la misma dirección de correo de Username
        Subject: asunto,
        Body: mensaje,
        ContentType: "text/html", // Indicar que el mensaje es de tipo HTML
      })
        .then((message) => {
          console.log("Mensaje de SMTPJS:", message);

          if (message === "OK") {
            console.log("Correo enviado con éxito");
            // Puedes eliminar la alerta ya que no es necesaria
          } else {
            console.error("Error al enviar el correo:", message);
            // Puedes manejar el error de otra manera si lo deseas
          }
        })
        .catch((error) => {
          console.error("Error en la función de envío de correo:", error);
          // Puedes manejar el error de otra manera si lo deseas
        });
    }

    //ALESSANDRO
    // Función para enviar el correo de confirmación de edición de reserva usando EmailJS
    function enviarCorreoEdicionEmailJS() {
        emailjs.init("2vq1EFo6RmswvD4Ey");

        const claveReserva = document.getElementById("clave-evento-reserva").value;
        const correoDestino = document.getElementById("email-organizador-reserva").value;

        const capitulo = document.getElementById("capitulo-organizador-reserva").value;
        const destinatario = obtenerCorreoEdicion(correoDestino, capitulo)  + ", siea@aneiap.co"; // Reemplaza con la dirección de correo del destinatario junto al bancoCorreos

        const asunto = `Confirmación de edición de reserva - Clave: ${claveReserva}`;

        const fechaReserva = document.getElementById("fecha-evento-reserva").value;
        const horaReserva = document.getElementById("hora-evento-reserva").value;
        const duracionReserva = document.getElementById("duracion-evento-reserva").value;
        const planEvento = document.getElementById("plan-evento-reserva").value;
        const modalidadReserva = document.getElementById("modalidad-evento-reserva").value;
        const nombrePonente = document.getElementById("nombre-ponente-reserva").value;
        const observacionesReserva = document.getElementById("observaciones-evento-reserva").value || "No se especificaron observaciones.";
        const ubicacionOPlataforma = modalidadReserva === "virtual" ? 
            document.getElementById("ubicacion-plataforma-reserva").value || "" : 
            document.getElementById("lugar-presencial-reserva").value || "";

        const observacionesPublicidad = document.getElementById("observaciones-publicidad-reserva").value || "No se especificaron observaciones.";
        const fotoPonenteURL = document.getElementById("foto-ponente-reserva").value || "";

        const duracionHoras = Math.floor(duracionReserva / 60);
        const duracionMinutos = duracionReserva % 60;
        const horaMilitar = `${Math.floor(horaReserva / 60).toString().padStart(2, "00")}:${(horaReserva % 60).toString().padStart(2, "00")}`;

        const params = {
            tituloCorreo: "Su edición de reserva ha sido confirmada ☑️",
            saludoInicial: `Estimado(a) ${document.getElementById("nombre-organizador-reserva").value}`,
            mensajeIntroduccion: `Le confirmamos que su edición de reserva para el evento "${document.getElementById("nombre-evento-reserva").value}" ha sido procesada correctamente.`,
            claveEventoReserva: claveReserva || "",
            fechaReserva: fechaReserva || "",
            horaReserva: horaMilitar || "",
            capitulo: capitulo || "",
            duracionEvento: `${duracionHoras} hora(s) ${duracionMinutos} minuto(s)`,
            planEvento: planEvento || "",
            observacionesReserva: observacionesReserva,
            modalidadReserva: modalidadReserva || "",
            ubicacionOPlataforma: ubicacionOPlataforma,
            nombrePonente: nombrePonente || "",
            mensajePublicidad: fotoPonenteURL ? "El organizador ha solicitado la realización de la publicidad para el evento. " : "",
            observacionesPublicidad: fotoPonenteURL ? `Observaciones de la publicidad: ${observacionesPublicidad}` : "",
            fotoPonenteTexto: fotoPonenteURL ? "Link de la foto del ponente: " : "",
            fotoPonenteURL: fotoPonenteURL,
            mensajeFinal: "Recuerde que todas las claves son personales e intransferibles, no las comparta con nadie. 💙💚",
            despedida: "Cordialmente, Alessandro Villanueva Cantillo - Administrador y creador SIEA",
            to_email: destinatario,
            //to_email: "avillanuevacantillo@gmail.com",
            subject: asunto
        };

        emailjs.send("siea_6zoabdr", "registro_reservas", params)
            .then((response) => {
                console.log("Correo de confirmación de edición de reserva enviado exitosamente", response.status, response.text);
                alert("Confirmación de edición de reserva enviada exitosamente.");
            })
            .catch((error) => {
                console.error("Error al enviar el correo de confirmación de edición de reserva:", error);
                alert(`Error al enviar la confirmación de edición de reserva: ${error.text || "Error desconocido"}. Por favor, consulta con el administrador.`);
            });
    }

    // Función para enviar el correo de solicitud de publicidad
    function enviarSolicitudPublicidadEdicion(escogioPublicidadNacional) {
      // Obtener el correo del comité de piezas publicitarias
      // Banco de correos asociados a cada capítulo
      const bancoCorreos = {
        uniguajira: "comunicaciones_uniguajira@aneiap.co",
        unimagdalena: "comunicaciones_unimagdalena@aneiap.co",
        uniatlantico: "comunicaciones_uniatlantico@aneiap.co",
        uninorte: "comunicaciones_uninorte@aneiap.co, geraldine.mendoza@aneiap.co",
        unisimon: "comunicaciones_unisimon@aneiap.co",
        cuc: "comunicaciones_cuc@aneiap.co",
        librequilla: "comunicaciones_librequilla@aneiap.co",
        utb: "comunicaciones_utb@aneiap.co",
        upbmonteria: "comunicaciones_upbmonteria@aneiap.co",
        unicordoba: "comunicaciones_unicordoba@aneiap.co",
        areandina: "comunicaciones_areandina@aneiap.co",
        ufps: "comunicaciones_ufps@aneiap.co",
        unalmed: "comunicaciones_unalmed@aneiap.co",
        udea: "comunicaciones_udea@aneiap.co",
        upbmed: "comunicaciones_upbmed@aneiap.co",
        utp: "comunicaciones_utp@aneiap.co",
        unalma: "comunicaciones_unalma@aneiap.co",
        udistrital: "comunicaciones_udistrital@aneiap.co",
        unalbog: "comunicaciones_unalbog@aneiap.co",
        univalle: "comunicaciones_univalle@aneiap.co",
        icesi: "comunicaciones_icesi@aneiap.co",
        usc: "comunicaciones_usc@aneiap.co",
        librecali: "comunicaciones_librecali@aneiap.co",
        nacional: "proy_diseno_nacional@aneiap.co"
      };

      // Obtener el correo del comité de piezas publicitarias según el capítulo
      const capituloReserva = document.getElementById("capitulo-organizador-reserva").value;
      // Obtener el correo de destino dependiendo de la elección del usuario
      let correoDestino = "";
      if (escogioPublicidadNacional === "no") {
          // Obtener el correo del comité de piezas publicitarias del capítulo
          correoDestino = bancoCorreos[capitulo];
      } else if (escogioPublicidadNacional === "si") {
          // Enviar la solicitud al comité de piezas publicitarias nacional
          correoDestino = "proy_diseno_nacional@aneiap.co";
      }

      // Datos adicionales de la solicitud de publicidad
      const emailOrganizadorReserva= document.getElementById("email-organizador-reserva").value;
      const nombreOrganizadorReserva= document.getElementById("nombre-organizador-reserva").value;
      const nombreEventoReserva= document.getElementById("nombre-evento-reserva").value;
      const fechaReserva = document.getElementById("fecha-evento-reserva").value;
      const horaReserva = document.getElementById("hora-evento-reserva").value;
      const planEvento = document.getElementById("plan-evento-reserva").value;
      
      const nombrePonente = document.getElementById("nombre-ponente-reserva").value;
      const publicidadComiteReserva = document.getElementById("publicidad-comite-reserva").value;
      const observacionesPublicidadReserva = document.getElementById("observaciones-publicidad-reserva").value;
      const fotoPonenteURLReserva = document.getElementById("foto-ponente-reserva").value;
      const modalidadEventoReserva = document.getElementById("modalidad-evento-reserva").value;
      const ubicacionPlataformaReserva = document.getElementById("ubicacion-plataforma-reserva").value;
      const lugarPresencialReserva = document.getElementById("lugar-presencial-reserva").value;
      const emailHost = "smtp.elasticemail.com"; // Reemplaza con el servidor SMTP correcto
      const emailUsername = "siea@aneiap.co"; // Reemplaza con tu nombre de usuario SMTP
      const emailPassword = "D20D124D2A2129252882BEE9DAC2B79F4E70"; // Reemplaza con tu contraseña SMTP
      const destinatario = correoDestino; // Reemplaza con la dirección de correo del destinatario
      const cc = `${emailOrganizadorReserva}, siea@aneiap.co`; // Copia de carbono (CC)
      const claveReserva = document.getElementById("clave-evento-reserva").value;
      const asunto = `Solicitud de Publicidad para el Evento - "${nombreEventoReserva}" con clave de reserva terminada en ***********${claveReserva.slice(-4)}`;

      // Convertir minutos a formato militar (HH:MM)
      const horasMilitar = Math.floor(horaReserva / 60);
      const minutosMilitar = horaReserva % 60;
      const horaMilitar = `${horasMilitar.toString().padStart(2, "0")}:${minutosMilitar.toString().padStart(2, "0")}`;

      // Datos adicionales para la publicidad
      let publicidad = "";
      publicidad = `
        <p>El organizador ha solicitado la realización de la publicidad para el evento. A continuación, se adjuntan las observaciones:</p>
        <p>${observacionesPublicidadReserva}</p>
        <p>Puede encontrar la foto del ponente en el siguiente enlace: <a href="${fotoPonenteURLReserva}" target="_blank">FOTO PONENTE</a></p>
      `;

      // Mensaje de correo con los datos para la publicidad
      const mensaje = `
        <html>
          <body>
            <h1 style="color: #007BFF;">Solicitud de Publicidad para el Evento</h1>
            <p>Estimado Comité de Piezas Publicitarias,</p>
            <p>Solicitamos la realización de publicidad para el siguiente evento:</p>
            <ul>
              <li><strong>Nombre del Evento:</strong> ${nombreEventoReserva}</li>
              <li><strong>Fecha del Evento:</strong> ${fechaReserva}</li>
              <li><strong>Hora del Evento:</strong> ${horaMilitar}</li>
              <li><strong>Capítulo:</strong> ${capituloReserva}</li>
              <li><strong>Plan del Evento:</strong> ${planEvento}</li>
              <li><strong>Nombre del Ponente:</strong> ${nombrePonente}</li>
              <li><strong>Modalidad:</strong> ${modalidadEventoReserva}</li>
              ${
                modalidadEventoReserva === "presencial"
                  ? `<li><strong>Ubicación:</strong> ${lugarPresencialReserva}</li>`
                  : `<li><strong>Plataforma:</strong> ${ubicacionPlataformaReserva}</li>`
              }
            </ul>
            ${publicidad}
            <p>Por favor, revise esta solicitud y proporcione detalles sobre la publicidad requerida.</p>
            <p>Si tiene alguna pregunta o necesita información adicional, no dude en ponerse en contacto con nosotros.</p>
            <p>Recuerde que esta es una solicitud de publicidad proviente de una EDICIÓN DE RESERVA y no contiene datos privados de la reserva.</p>
            <p>Se recomienda verificar la solicitud inicial de reserva en caso de haberse requerido publicidad para esta y así no solaparse ambas solicitudes.</p>
            <p>La pieza publicitaria debe ser enviada como respuesta a TODOS los destinatarios de este correo.</p>
            <p>Atentamente,</p>
            <p>${nombreOrganizadorReserva}</p>
            <p style="font-style: italic;">Organizador de la reserva</p>
          </body>
        </html>
      `;

      Email.send({
        Host: emailHost,
        Username: emailUsername,
        Password: emailPassword,
        To: destinatario,
        Cc: cc,
        From: emailUsername,
        Subject: asunto,
        Body: mensaje,
        ContentType: "text/html",
      })
        .then((message) => {
          console.log("Mensaje de SMTPJS:", message);

          if (message === "OK") {
            console.log("Correo enviado con éxito");
          } else {
            console.error("Error al enviar el correo:", message);
          }
        })
        .catch((error) => {
          console.error("Error en la función de envío de correo:", error);
        });
    }

    // Función para enviar el correo de edición de reserva
    function enviarCorreoRegistro(claveReservaCreada) {
      // Obtener el correo del organizador para enviarle el correo
      const correoDestino = document.getElementById("email-organizador").value;
      const claveReserva = claveReservaCreada;

      const emailHost = "smtp.elasticemail.com"; // Reemplaza con el servidor SMTP correcto
      const emailUsername = "siea@aneiap.co"; // Reemplaza con tu nombre de usuario SMTP
      const emailPassword = "D20D124D2A2129252882BEE9DAC2B79F4E70"; // Reemplaza con tu contraseña SMTP
      const destinatario = correoDestino; // Reemplaza con la dirección de correo del destinatario
      const asunto = `Confirmación de registro de reserva - Clave: ${claveReserva}`;

      // Datos adicionales de la reserva
      const nombreOrganizadorReserva= document.getElementById("nombre-organizador").value;
      const nombreEventoReserva= document.getElementById("nombre-evento").value;
      const fechaReserva = document.getElementById("fecha-evento").value;
      const horaReserva = document.getElementById("hora-evento").value;
      const duracionReserva = document.getElementById("duracion-evento").value;
      const planEvento = document.getElementById("plan-evento").value;
      const capitulo = document.getElementById("capitulo-organizador").value;
      const modalidadReserva = document.getElementById("modalidad-evento").value;
      const nombrePonente = document.getElementById("nombre-ponente").value;
      const publicidadComiteReserva = document.getElementById("publicidad-comite").value;
      const observacionesPublicidadReserva = document.getElementById("observaciones-publicidad").value;
      const fotoPonenteURLReserva = document.getElementById("foto-ponente").value;
      const ubicacionPlataformaReserva = document.getElementById("ubicacion-plataforma").value;
      const lugarPresencialReserva = document.getElementById("lugar-presencial").value;

      // Convertir duración a formato horas + minutos
      const duracionHoras = Math.floor(duracionReserva / 60);
      const duracionMinutos = duracionReserva % 60;

      // Convertir minutos a formato militar (HH:MM)
      const horasMilitar = Math.floor(horaReserva / 60);
      const minutosMilitar = horaReserva % 60;
      const horaMilitar = `${horasMilitar.toString().padStart(2, "0")}:${minutosMilitar.toString().padStart(2, "0")}`;

      // Datos adicionales para la publicidad
      let publicidad = "";
      if (publicidadComiteReserva === "si") {
        publicidad = `
          <p>El organizador ha solicitado la realización de la publicidad para el evento. A continuación, se adjuntan las observaciones:</p>
          <p>${observacionesPublicidadReserva}</p>
          <p>Puede encontrar la foto del ponente en el siguiente enlace: <a href="${fotoPonenteURLReserva}" target="_blank">FOTO PONENTE</a></p>
        `;
      }

      if (publicidadComiteReserva === "si") {
        enviarSolicitudPublicidadRegistro(claveReservaCreada);
      }

      // Mensaje de correo con los datos adicionales
      const mensaje = `
        <html>
          <body>
            <h1 style="color: #007BFF;">Su registro de reserva ha sido confirmado ☑️</h1>
            <p>Estimado(a) <strong>${nombreOrganizadorReserva}</strong>,</p>
            <p>Le confirmamos que su registro de reserva para el evento <strong>${nombreEventoReserva}</strong> ha sido procesado correctamente.</p>
            <p>A continuación, encontrará los detalles de su reserva:</p>
            <ul>
              <li><strong>Clave de la reserva:</strong> ${claveReserva}</li>
              <li><strong>Fecha de la reserva:</strong> ${fechaReserva}</li>
              <li><strong>Hora de la reserva:</strong> ${horaMilitar}</li>
              <li><strong>Capítulo:</strong> ${capitulo}</li>
              <li><strong>Duración de la reserva:</strong> ${duracionHoras} hora(s) ${duracionMinutos} minuto(s)</li>
              <li><strong>Plan del evento:</strong> ${planEvento}</li>
              <li><strong>Modalidad de la reserva:</strong> ${modalidadReserva}</li>
              ${modalidadReserva === "virtual" ? `<li><strong>Plataforma:</strong> ${ubicacionPlataformaReserva}</li>` : `<li><strong>Ubicación/Salón:</strong> ${lugarPresencialReserva}</li>`}
              <li><strong>Nombre del ponente:</strong> ${nombrePonente}</li>
            </ul>
            ${publicidad}
            <p>Si tiene alguna pregunta, inquietud o necesita asistencia adicional, no dude en <a href="http://wa.me/3002252099" target="_blank">hacer clic aquí</a> para comunicarse con nosotros a través de WhatsApp.</p>
            <p>Recuerde que todas las claves son personales e intransferibles, no las comparta con nadie. 💙💚</p>
            <p>Agradecemos su confianza en nosotros, recuerde que este correo es automático y NO debe ser respondido. Esperamos seguir construyendo A.L.M.A. 💙💚</p>
            <p style="font-style: italic;">Cordialmente,</p>
            <p style="font-style: italic;">Alessandro Villanueva Cantillo</p>
            <p style="font-style: italic;">Administrador y creador SIEA</p>
          </body>
        </html>
      `;

      Email.send({
        Host: emailHost,
        Username: emailUsername,
        Password: emailPassword,
        To: `${destinatario}, siea@aneiap.co`, // Usuario que está registrando la reserva
     //   Cc: "siea@aneiap.co", // Copia a siea para siempre tener registro de correos
        From: emailUsername, // Debería ser la misma dirección de correo de Username
        Subject: asunto,
        Body: mensaje,
        ContentType: "text/html", // Indicar que el mensaje es de tipo HTML
      })
        .then((message) => {
          console.log("Mensaje de SMTPJS:", message);

          if (message === "OK") {
            console.log("Correo enviado con éxito");
            // Puedes eliminar la alerta ya que no es necesaria
          } else {
            console.error("Error al enviar el correo:", message);
            // Puedes manejar el error de otra manera si lo deseas
          }
        })
        .catch((error) => {
          console.error("Error en la función de envío de correo:", error);
          // Puedes manejar el error de otra manera si lo deseas
        });
    }

    // Función para enviar el correo de solicitud de publicidad
    function enviarSolicitudPublicidadRegistro(claveReservaCreada) {
    // Función para enviar el correo de solicitud de publicidad
      // Obtener el correo del comité de piezas publicitarias
      const capitulo = document.getElementById("capitulo-organizador").value;
      // Banco de correos asociados a cada capítulo
      const bancoCorreos = {
        uniguajira: "comunicaciones_uniguajira@aneiap.co",
        unimagdalena: "comunicaciones_unimagdalena@aneiap.co",
        uniatlantico: "comunicaciones_uniatlantico@aneiap.co",
        uninorte: "comunicaciones_uninorte@aneiap.co",
        unisimon: "comunicaciones_unisimon@aneiap.co",
        cuc: "comunicaciones_cuc@aneiap.co",
        librequilla: "comunicaciones_librequilla@aneiap.co",
        utb: "comunicaciones_utb@aneiap.co",
        upbmonteria: "comunicaciones_upbmonteria@aneiap.co",
        unicordoba: "comunicaciones_unicordoba@aneiap.co",
        areandina: "comunicaciones_areandina@aneiap.co",
        ufps: "comunicaciones_ufps@aneiap.co",
        unalmed: "comunicaciones_unalmed@aneiap.co",
        udea: "comunicaciones_udea@aneiap.co",
        upbmed: "comunicaciones_upbmed@aneiap.co",
        utp: "comunicaciones_utp@aneiap.co",
        unalma: "comunicaciones_unalma@aneiap.co",
        udistrital: "comunicaciones_udistrital@aneiap.co",
        unalbog: "comunicaciones_unalbog@aneiap.co",
        univalle: "comunicaciones_univalle@aneiap.co",
        icesi: "comunicaciones_icesi@aneiap.co",
        usc: "comunicaciones_usc@aneiap.co",
        librecali: "comunicaciones_librecali@aneiap.co",
        nacional: "proy_diseno_nacional@aneiap.co"
      };

      const correoDestino = bancoCorreos[capitulo];
      // Datos adicionales de la solicitud de publicidad
      const emailOrganizadorReserva = document.getElementById("email-organizador").value;
      const nombreOrganizadorReserva = document.getElementById("nombre-organizador").value;
      const nombreEventoReserva= document.getElementById("nombre-evento").value;
      const fechaReserva = document.getElementById("fecha-evento").value;
      const horaReserva = document.getElementById("hora-evento").value;
      const planEvento = document.getElementById("plan-evento").value;
      const nombrePonente = document.getElementById("nombre-ponente").value;
      const publicidadComiteReserva = document.getElementById("publicidad-comite").value;
      const observacionesPublicidadReserva = document.getElementById("observaciones-publicidad").value;
      const fotoPonenteURLReserva = document.getElementById("foto-ponente").value;
      const modalidadEventoReserva = document.getElementById("modalidad-evento").value;
      const ubicacionPlataformaReserva = document.getElementById("ubicacion-plataforma").value;
      const lugarPresencialReserva = document.getElementById("lugar-presencial").value;

      const emailHost = "smtp.elasticemail.com"; // Reemplaza con el servidor SMTP correcto
      const emailUsername = "siea@aneiap.co"; // Reemplaza con tu nombre de usuario SMTP
      const emailPassword = "D20D124D2A2129252882BEE9DAC2B79F4E70"; // Reemplaza con tu contraseña SMTP
      const destinatario = correoDestino; // Reemplaza con la dirección de correo del destinatario
      const cc = `${emailOrganizadorReserva}, siea@aneiap.co`; // Copia de carbono (CC)
      const claveReserva = claveReservaCreada;
      const asunto = `Solicitud de Publicidad para el Espacio - "${nombreEventoReserva}" con clave de reserva terminada en ***********${claveReserva.slice(-4)}`;

      // Convertir minutos a formato militar (HH:MM)
      const horasMilitar = Math.floor(horaReserva / 60);
      const minutosMilitar = horaReserva % 60;
      const horaMilitar = `${horasMilitar.toString().padStart(2, "0")}:${minutosMilitar.toString().padStart(2, "0")}`;

      // Datos adicionales para la publicidad
      let publicidad = "";
      publicidad = `
        <p>El organizador ha solicitado la realización de la publicidad para el evento. A continuación, se adjuntan las observaciones:</p>
        <p>${observacionesPublicidadReserva}</p>
        <p>Puede encontrar la foto del ponente en el siguiente enlace: <a href="${fotoPonenteURLReserva}" target="_blank">FOTO PONENTE</a></p>
      `;

      // Mensaje de correo con los datos para la publicidad
      const mensaje = `
        <html>
          <body>
            <h1 style="color: #007BFF;">Solicitud de Publicidad para el Evento</h1>
            <p>Estimado Comité de Piezas Publicitarias,</p>
            <p>Solicitamos la realización de publicidad para el siguiente evento:</p>
            <ul>
              <li><strong>Nombre del Evento:</strong> ${nombreEventoReserva}</li>
              <li><strong>Fecha del Evento:</strong> ${fechaReserva}</li>
              <li><strong>Hora del Evento:</strong> ${horaMilitar}</li>
              <li><strong>Capitulo:</strong> ${capitulo}</li>
              <li><strong>Plan del Evento:</strong> ${planEvento}</li>
              <li><strong>Nombre del Ponente:</strong> ${nombrePonente}</li>
              <li><strong>Modalidad:</strong> ${modalidadEventoReserva}</li>
              ${
                modalidadEventoReserva === "presencial"
                  ? `<li><strong>Ubicación:</strong> ${lugarPresencialReserva}</li>`
                  : `<li><strong>Plataforma:</strong> ${ubicacionPlataformaReserva}</li>`
              }
            </ul>
            ${publicidad}
            <p>Por favor, revise esta solicitud y proporcione detalles sobre la publicidad requerida.</p>
            <p>Si tiene alguna pregunta o necesita información adicional, no dude en ponerse en contacto con nosotros.</p>
            <p>Recuerde que esta es una solicitud de publicidad proveniente de una RESERVA NUEVA y no contiene datos privados de la reserva.</p>
            <p>La pieza publicitaria debe ser enviada como respuesta a TODOS los destinatarios de este correo.</p>
            <p>Atentamente,</p>
            <p>${nombreOrganizadorReserva}</p>
            <p style="font-style: italic;">Organizador de la reserva</p>
          </body>
        </html>
      `;

      Email.send({
        Host: emailHost,
        Username: emailUsername,
        Password: emailPassword,
        To: destinatario,
        Cc: cc,
        From: emailUsername,
        Subject: asunto,
        Body: mensaje,
        ContentType: "text/html",
      })
        .then((message) => {
          console.log("Mensaje de SMTPJS:", message);

          if (message === "OK") {
            console.log("Correo enviado con éxito");
          } else {
            console.error("Error al enviar el correo:", message);
          }
        })
        .catch((error) => {
          console.error("Error en la función de envío de correo:", error);
        });
    }

    //ALESSANDRO
    // Función para enviar el correo de solicitud de publicidad para la edición de reserva usando EmailJS
    function enviarSolicitudPublicidadEdicionEmailJS(escogioPublicidadNacional) {
        emailjs.init("2vq1EFo6RmswvD4Ey");

        // Banco de correos de comunicaciones asociado a cada capítulo
        const bancoCorreos = {
            uniguajira: "comunicaciones_uniguajira@aneiap.co",
            unimagdalena: "comunicaciones_unimagdalena@aneiap.co",
            uniatlantico: "comunicaciones_uniatlantico@aneiap.co",
            uninorte: "comunicaciones_uninorte@aneiap.co, geraldine.mendoza@aneiap.co",
            unisimon: "comunicaciones_unisimon@aneiap.co",
            cuc: "comunicaciones_cuc@aneiap.co",
            librequilla: "comunicaciones_librequilla@aneiap.co",
            utb: "comunicaciones_utb@aneiap.co",
            upbmonteria: "comunicaciones_upbmonteria@aneiap.co",
            unicordoba: "comunicaciones_unicordoba@aneiap.co",
            areandina: "comunicaciones_areandina@aneiap.co",
            ufps: "comunicaciones_ufps@aneiap.co",
            unalmed: "comunicaciones_unalmed@aneiap.co",
            udea: "comunicaciones_udea@aneiap.co",
            upbmed: "comunicaciones_upbmed@aneiap.co",
            utp: "comunicaciones_utp@aneiap.co",
            unalma: "comunicaciones_unalma@aneiap.co",
            udistrital: "comunicaciones_udistrital@aneiap.co",
            unalbog: "comunicaciones_unalbog@aneiap.co",
            univalle: "comunicaciones_univalle@aneiap.co",
            icesi: "comunicaciones_icesi@aneiap.co",
            usc: "comunicaciones_usc@aneiap.co",
            librecali: "comunicaciones_librecali@aneiap.co",
            nacional: "proy_diseno_nacional@aneiap.co"
        };

        // Determinar el correo de destino según la elección del usuario
        const claveReserva = document.getElementById("clave-evento-reserva").value;
        const capitulo = document.getElementById("capitulo-organizador-reserva").value;
        const correoDestino = escogioPublicidadNacional === "si" ? 
            "proy_diseno_nacional@aneiap.co" : 
            (bancoCorreos[capitulo.toLowerCase()] || "");

        const asunto = `Solicitud de Publicidad para el Evento - "${document.getElementById("nombre-evento-reserva").value}" con clave de reserva terminada en ***********${claveReserva.slice(-4)}`;

        // Datos adicionales de la solicitud de publicidad
        const fechaReserva = document.getElementById("fecha-evento-reserva").value;
        const horaReserva = document.getElementById("hora-evento-reserva").value;
        const planEvento = document.getElementById("plan-evento-reserva").value;
        const modalidadReserva = document.getElementById("modalidad-evento-reserva").value;
        const nombrePonente = document.getElementById("nombre-ponente-reserva").value;
        const observacionesReserva = document.getElementById("observaciones-evento-reserva").value || "No se especificaron observaciones.";

        const observacionesPublicidad = document.getElementById("observaciones-publicidad-reserva").value || "No se especificaron observaciones.";
        const fotoPonenteURL = document.getElementById("foto-ponente-reserva").value || "";

        const ubicacionOPlataforma = modalidadReserva === "virtual" ? 
            document.getElementById("ubicacion-plataforma-reserva").value || "" : 
            document.getElementById("lugar-presencial-reserva").value || "";
        const horaMilitar = `${Math.floor(horaReserva / 60).toString().padStart(2, "00")}:${(horaReserva % 60).toString().padStart(2, "00")}`;

        const params = {
            tituloCorreo: "Solicitud de Publicidad para el Evento",
            saludoInicial: "Estimado Comité de Piezas Publicitarias",
            mensajeIntroduccion: "Solicitamos la realización de publicidad para el siguiente evento:",
            claveEventoReserva: "***********" + claveReserva.slice(-4),
            fechaReserva: fechaReserva || "",
            horaReserva: horaMilitar || "",
            capitulo: capitulo || "",
            duracionEvento: `${Math.floor(document.getElementById("duracion-evento-reserva").value / 60)} hora(s) ${document.getElementById("duracion-evento-reserva").value % 60} minuto(s)`,
            planEvento: planEvento || "",
            observacionesReserva: observacionesReserva,
            modalidadReserva: modalidadReserva || "",
            ubicacionOPlataforma: ubicacionOPlataforma,
            nombrePonente: nombrePonente || "",
            mensajePublicidad: "El organizador ha solicitado la realización de la publicidad para el evento.",
            observacionesPublicidad: `Observaciones de la publicidad: ${observacionesPublicidad}`,
            fotoPonenteTexto: fotoPonenteURL ? "Link de la foto del ponente: " : "",
            fotoPonenteURL: fotoPonenteURL,
            mensajeFinal: "Por favor, revise esta solicitud y proporcione detalles sobre la publicidad requerida.",
            despedida: "Atentamente, organizadores del espacio.",
            to_email: correoDestino,
            //to_email: "avillanuevacantillo@gmail.com",
            subject: asunto
        };

        emailjs.send("siea_6zoabdr", "registro_reservas", params)
            .then((response) => {
                console.log("Correo de solicitud de publicidad enviado exitosamente", response.status, response.text);
                alert("Solicitud de publicidad enviada exitosamente.");
            })
            .catch((error) => {
                console.error("Error al enviar la solicitud de publicidad:", error);
                alert(`Error al enviar la solicitud de publicidad: ${error.text || "Error desconocido"}. Por favor, consulta al administrador.`);
            });
    }

    function obtenerCorreoRegistrar(correoElectronico, capitulo) {
        // Banco de correos asociados a cada capítulo
        const bancoCorreos = {
            uniguajira: "academico_uniguajira@aneiap.co, interventoria_uniguajira@aneiap.co",
            unimagdalena: "academico_unimagdalena@aneiap.co",
            uniatlantico: "academico_uniatlantico@aneiap.co",
            uninorte: "academico_uninorte@aneiap.co, interventoria_uninorte@aneiap.co",
            unisimon: "academico_unisimon@aneiap.co, interventoria_unisimon@aneiap.co",
            cuc: "academico_cuc@aneiap.co, interventoria_cuc@aneiap.co",
            librequilla: "academico_librequilla@aneiap.co",
            utb: "academico_utb@aneiap.co",
            upbmonteria: "academico_upbmonteria@aneiap.co, interventoria_upbmonteria@aneiap.co",
            unicordoba: "academico_unicordoba@aneiap.co, interventoria_unicordoba@aneiap.co",
            areandina: "academico_areandina@aneiap.co, interventoria_areandina@aneiap.co",
            ufps: "academico_ufps@aneiap.co, interventoria_ufps@aneiap.co",
            unalmed: "academico_unalmed@aneiap.co",
            udea: "academico_udea@aneiap.co",
            upbmed: "academico_upbmed@aneiap.co",
            utp: "academico_utp@aneiap.co, interventoria_utp@aneiap.co",
            unalma: "academico_unalma@aneiap.co, interventoria_unalma@aneiap.co",
            udistrital: "academico_udistrital@aneiap.co",
            unalbog: "academico_unalbog@aneiap.co",
            univalle: "academico_univalle@aneiap.co",
            icesi: "academico_icesi@aneiap.co",
            usc: "academico_usc@aneiap.co, interventoria_usc@aneiap.co",
            librecali: "academico_librecali@aneiap.co, interventoria_librecali@aneiap.co",
            nacional: "academico@aneiap.co, interventoria@aneiap.co"
        };

        // Correo de usuario y correos asociados al capítulo
        const correosUsuario = correoElectronico ? correoElectronico + ", " : "";
        const correosCapitulo = bancoCorreos[capitulo.toLowerCase()] || "";

        // Devolver todos los correos concatenados
        return correosUsuario + correosCapitulo;
    }

    //ALESSANDRO
    // Función para enviar el correo de confirmación de eliminación de reserva usando EmailJS
    function enviarCorreoEliminarEmailJS(claveReservaCreada, nombreOrganizadorReserva, correoReserva, nombreEventoReserva, fechaReserva, horaReserva, duracionReserva, capitulo, planEvento, observacionesReserva, modalidadReserva, ubicacionOPlataforma, nombrePonente) {
        // Inicializar EmailJS
        emailjs.init("2vq1EFo6RmswvD4Ey");

        // Obtener los correos de registro asociados al capítulo y al correo del organizador
        const destinatario = obtenerCorreoRegistrar(correoReserva, capitulo) + ", siea@aneiap.co";
        // Asunto del correo
        const asunto = `Confirmación de eliminación de reserva - Clave: ${claveReservaCreada}`;

        // Convertir duración a formato horas + minutos
        const duracionHoras = Math.floor(duracionReserva / 60);
        const duracionMinutos = duracionReserva % 60;

        // Convertir minutos a formato militar (HH:MM)
        const horasMilitar = Math.floor(horaReserva / 60);
        const minutosMilitar = horaReserva % 60;
        const horaMilitar = `${horasMilitar.toString().padStart(2, "00")}:${minutosMilitar.toString().padStart(2, "00")}`;

        // Parámetros para la plantilla de confirmación de eliminación en EmailJS
        const params = {
            tituloCorreo: "Su eliminación de reserva ha sido confirmada ☑️",
            saludoInicial: `Estimado(a) ${nombreOrganizadorReserva}`,
            mensajeIntroduccion: `Le confirmamos que su registro de reserva para el evento "${nombreEventoReserva}" ha sido eliminado correctamente.`,
            claveEventoReserva: claveReservaCreada || "",
            fechaReserva: fechaReserva || "",
            horaReserva: horaMilitar || "",
            capitulo: capitulo || "",
            duracionEvento: `${duracionHoras} hora(s) ${duracionMinutos} minuto(s)`,
            planEvento: planEvento || "",
            observacionesReserva: observacionesReserva || "No se especificaron observaciones.",
            modalidadReserva: modalidadReserva || "",
            ubicacionOPlataforma: ubicacionOPlataforma || "",
            nombrePonente: nombrePonente || "",
            mensajePublicidad: "", // Campo vacío
            observacionesPublicidad: "", // Campo vacío
            fotoPonenteTexto: "", // Campo vacío
            fotoPonenteURL: "", // Campo vacío
            mensajeFinal: "Recuerde que todas las claves son personales e intransferibles, no las comparta con nadie. 💙💚",
            despedida: "Cordialmente, Alessandro Villanueva Cantillo - Administrador y creador SIEA",
            to_email: destinatario, // Destinatario con los correos concatenados
            //to_email: "avillanuevacantillo@gmail.com", // Destinatario de prueba para no enviar los correos de prueba a otras personas.
            subject: asunto
        };

        // Enviar correo usando EmailJS con la plantilla "eliminacion_reserva"
        emailjs.send("siea_6zoabdr", "registro_reservas", params)
            .then((response) => {
                console.log("Correo de confirmación de eliminación de reserva enviado exitosamente", response.status, response.text);
                alert("Confirmación de eliminación de reserva enviada exitosamente.");
            })
            .catch((error) => {
                console.error("Error al enviar el correo de confirmación de eliminación de reserva:", error);
                alert(`Error al enviar la confirmación de eliminación de reserva: ${error.text || "Error desconocido"}. Por favor, consulta con el administrador.`);
            });
    }

    function calcularIntervalosNuevaFecha(nuevaFecha, nuevaHora, nuevaDuracion) {
      var nuevosIntervalos = [];

      // Calcula los índices de inicio y fin del intervalo que ocupará el evento en la nueva fecha
      var inicioIntervalo = Math.floor((nuevaHora - 480) / 30);
      var finIntervalo = inicioIntervalo + nuevaDuracion/30;

      // Agrega los nuevos intervalos al arreglo nuevosIntervalos
      for (var i = inicioIntervalo; i < finIntervalo; i++) {
        nuevosIntervalos.push(i);
      }

      return nuevosIntervalos;
    }

    function calcularDisponibilidadPorFecha(nuevaFecha) {
      var disponibilidadHorarios = Array(28).fill(true); // Inicialmente, todos los intervalos están disponibles

      // Realiza una consulta a la base de datos para obtener las reservas en la nueva fecha
      var reservasRef = firebase.firestore().collection("reservas");
      var consulta = reservasRef.where("fechaEvento", "==", nuevaFecha);

      consulta.get().then(function(querySnapshot) {
        // Ciclo para revisar cada evento reservado para la nueva fecha
        querySnapshot.forEach(function(doc) {
          var horaEvento = doc.data().horaEvento; // Hora en minutos (ej. 540 para 09:00)
          var duracionEvento = doc.data().duracionEvento; // Duración en minutos (ej. 120 para 2 horas)

          // Calcular los índices de inicio y fin del intervalo que ocupará el evento
          var inicioIntervalo = Math.floor((horaEvento - 480) / 30);
          var finIntervalo = inicioIntervalo + duracionEvento / 30;

          // Marcar los intervalos como ocupados en el arreglo de disponibilidad
          for (var i = inicioIntervalo; i < finIntervalo; i++) {
            disponibilidadHorarios[i] = false;
          }
        });

        // Ahora disponibilidadHorarios tiene la disponibilidad de los intervalos en la nueva fecha
        // Realiza el resto de la lógica aquí
      }).catch(function(error) {
        Swal.fire({
          title: 'Error de Consulta',
          text: 'Ocurrió un error al obtener las reservas. Por favor, inténtalo de nuevo más tarde o comunícate con el creador de la plataforma.',
          icon: 'error',
          confirmButtonText: 'Aceptar',
          allowOutsideClick: true,
          backdrop: true,  
          allowEscapeKey: true
        });
      });
    }

    function verificarDisponibilidadEdicion() {
      return new Promise((resolve, reject) => {

      // Obtener una referencia al documento del evento en Firestore
      var claveEventoReserva = document.getElementById("clave-evento-reserva").value;
      const eventoRef = firebase.firestore().collection("reservas").doc(claveEventoReserva);

      console.log("actualizaremos la fecha a 31-dic");
      // Actualizar el evento como si la nueva fecha fuera el 31 de diciembre de 2023, esto es con fines prácticas para
      // lograr que este evento no sea tomado nunca dentro de la colección reservas debido a que cuando la
      // nueva fecha sea igual a la actual (no cambió de fecha) no queremos que el evento se autobloquee la disponibilidad
      return eventoRef.update({fechaEvento: "2023-12-31"})
      .then(() => {
        console.log("actualización exitosa, ahora obtendremos la consulta de todos los eventos en esa nueva fecha");
        // Resto del código

        var disponibilidadHorarios = Array(28).fill(true); // Inicialmente, todos los intervalos están disponibles

        var claveEvento = document.getElementById("clave-evento-reserva").value;
        var nuevaFecha = document.getElementById("fecha-evento-reserva").value;
        var nuevaHora = document.getElementById("hora-evento-reserva").value;
        var nuevaDuracion = document.getElementById("duracion-evento-reserva").value;
        var nuevoCapitulo = document.getElementById("capitulo-organizador-reserva").value;

        if (parseInt(nuevaDuracion) + parseInt(nuevaHora) > 1321) {
          Swal.fire({
            title: '¡ESTÁS INTENTANDO MOVER EL ESPACIO PARA DESPUÉS DE LAS 22:00 (10PM)!',
            text: 'El evento debe estar programado para finalizar a más tardar hasta las 22:00, ve a la duración del mismo y edítala de tal forma que no se excedan las 22:00 (10pm)',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener el registro del evento
        }

        // Realiza una consulta a la base de datos para obtener las reservas en la nueva fecha
        var reservasRef = firebase.firestore().collection("reservas");

          console.log("ahora obtendremos la consulta de todos los eventos en esa nueva fecha");

        // Primera consulta: Filtrar por "fechaEvento" igual a "nuevaFecha"
        if (nuevoCapitulo === "nacional") {
          // Si se seleccionó "ANEIAP NACIONAL", consultar solo las reservas para toda la Asociación
          consulta = reservasRef.where("fechaEvento", "==", nuevaFecha).where("capitulo", "==", "nacional");
        } else {
          // Consultar las reservas para el capítulo seleccionado y para toda la Asociación (ANEIAP NACIONAL)
          consulta = reservasRef.where("fechaEvento", "==", nuevaFecha).where("capitulo", "in", [nuevoCapitulo, "nacional"]);
        }

        console.log("queremos empezar a hacer la consulta");

        // Realizar el filtrado para obtener intervalos disponibles y no disponibles
        consulta.get().then(function(querySnapshot) {
          console.log("entramos a hacer consulta");
          // Ciclo para revisar cada evento reservado para la nueva fecha
          querySnapshot.forEach(function(doc) {
            console.log("este es el doc: " + doc);
            var horaEvento = doc.data().horaEvento; // Hora en minutos (ej. 540 para 09:00)
            var duracionEvento = doc.data().duracionEvento; // Duración en minutos (ej. 120 para 2 horas)
            console.log("hora del evento con clave: " + doc.data().claveEvento + ": " + horaEvento);
            console.log("duracion del evento con clave: " + doc.data().claveEvento + ": " + duracionEvento);
            // Calcular los índices de inicio y fin del intervalo que ocupará el evento
            var inicioIntervalo = Math.floor((horaEvento - 480) / 30);
            var finIntervalo = inicioIntervalo + duracionEvento / 30;
            console.log("inicio intervalo: " + inicioIntervalo);
            console.log("fin intervalo: " + finIntervalo);

            // Marcar los intervalos como ocupados en el arreglo de disponibilidad
            for (var i = inicioIntervalo; i < finIntervalo; i++) {
              disponibilidadHorarios[i] = false;
            }
            console.log("estas son las disponibilidades de los intervalos:");
            console.log(disponibilidadHorarios);
          });
          
          var disponibilidadMatutino = true;
          var disponibilidadVesperino = true;
          var disponibilidadNocturno = true;

          // Colocar los intervalos de un mismo paquete horario (matutino, vespertino o nocturno) ocupados
          // Verificar el paquete horario matutino (intervalos 1 al 10, es decir, 8:00 a 13:00)
          for (var i = 0; i <= 9; i++) {
            if (!disponibilidadHorarios[i]) {
              for (var j = 0; j <= 9; j++) {
                disponibilidadHorarios[j] = false;
              }
              disponibilidadMatutino = false;
              break; // Al menos un intervalo está ocupado, salir del ciclo
            }
          }

          // Verificar el paquete horario vespertino (intervalos 11 al 20, es decir, 13:00 a 18:00)
          for (var i = 10; i <= 19; i++) {
            if (!disponibilidadHorarios[i]) {
              for (var j = 10; j <= 19; j++) {
                disponibilidadHorarios[j] = false;
              }
              disponibilidadVesperino = false;
              break; // Al menos un intervalo está ocupado, salir del ciclo
            }
          }

          // Verificar el paquete horario nocturno (intervalos 21 al 28, es decir, 18:00 a 22:00)
          for (var i = 20; i <= 27; i++) {
            if (!disponibilidadHorarios[i]) {
              for (var j = 20; j <= 27; j++) {
                disponibilidadHorarios[j] = false;
              }
              disponibilidadNocturno = false;
              break; // Al menos un intervalo está ocupado, salir del ciclo
            }
          }

          // Calcula los índices de inicio y fin de los intervalos para la nueva hora y duración
          var inicioNuevoIntervalo = Math.floor((nuevaHora - 480) / 30);
          var finNuevoIntervalo = inicioNuevoIntervalo + nuevaDuracion / 30;

          // Verifica si alguno de los nuevos intervalos está ocupado
          var algunIntervaloOcupado = false;
          for (var i = inicioNuevoIntervalo; i < finNuevoIntervalo; i++) {
            console.log("esta es la disponibilidad del intervalo " + i + ": " + disponibilidadHorarios[i]);
            if (!disponibilidadHorarios[i]) {
              console.log("está ocupado el intervalo " + i);
              algunIntervaloOcupado = true;
              break; // Si uno está ocupado, no es necesario verificar los demás
            }
          }

          if (algunIntervaloOcupado) {
            // Al menos uno de los intervalos no está disponible
            // Actualizar la fecha del evento de vuelta a la fecha que tenía porque ahora mismo está en 31 de diciembre.
            var fechaEventoReservaBackup = guardarBackupFechaEventoReserva();
            console.log('fecha evento reserva backup' + fechaEventoReservaBackup);
            eventoRef.update({fechaEvento: fechaEventoReservaBackup});
            // Mostrar alerta al usuario con SweetAlert2 en caso de estar TODO EL DÍA ocupado
            if (!disponibilidadMatutino && !disponibilidadVesperino && !disponibilidadNocturno) {
              Swal.fire({
              title: '¡SIN DISPONIBILIDAD EN TODO EL DÍA! 📅',
              text: 'Ya no es posible reservar en ningún espacio del día debido a que los 3 horarios para este día están ocupados. Prueba a consultar la disponibilidad en la sección azul y escoger otro día.',
              icon: 'error',
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,  
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/LPTDqcy/AVATAR-NODISPOTODODIA-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la ejecución de la función
            }
            // Mostrar alerta al usuario con SweetAlert2 en caso de estar ocupado el horario matutino.
            if (!disponibilidadMatutino && inicioNuevoIntervalo <= 9) {
              Swal.fire({
              title: '¡SIN DISPONIBILIDAD EN EL HORARIO MATUTINO! 🌤️',
              text: 'El horario matutino ya está ocupado (8:00 a 13:00). Prueba cambiar el día, hora o duración.',
              icon: 'error',
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,  
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/4p0C8SC/AVATAR-HORARIOSNODISPO-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la ejecución de la función
            }
            // Mostrar alerta al usuario con SweetAlert2 en caso de estar ocupado el horario vespertino.
            if (!disponibilidadVesperino && inicioNuevoIntervalo <= 19) {
              Swal.fire({
              title: '¡SIN DISPONIBILIDAD EN EL HORARIO VESPERTINO! ☀️',
              text: 'El horario vespertino ya está ocupado (13:00 a 18:00). Prueba cambiar el día, hora o duración.',
              icon: 'error',
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,  
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/4p0C8SC/AVATAR-HORARIOSNODISPO-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la ejecución de la función
            }
            // Mostrar alerta al usuario con SweetAlert2 en caso de estar ocupado el horario nocturno.
            if (!disponibilidadNocturno) {
              Swal.fire({
              title: '¡SIN DISPONIBILIDAD EN EL HORARIO NOCTURNO! 🌕',
              text: 'El horario nocturno ya está ocupado (18:00 a 22:00). Prueba cambiar el día, hora o duración.',
              icon: 'error',
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,  
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/4p0C8SC/AVATAR-HORARIOSNODISPO-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la ejecución de la función
            }
          } else {
            // Todos los intervalos están disponibles
            // Realiza la edición de la reserva
            // ...
            resolve(true); // Resolver la promesa con 'true' si todos los intervalos están disponibles
          }
        }).catch(function(error) {
          Swal.fire({
            title: '¡ERROR DE CONSULTA!',
            text: 'Ocurrió un error al obtener las reservas. Por favor, inténtalo de nuevo más tarde o comunícate con el creador de la plataforma.',
            icon: 'error',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,  
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/PZ7KXF9/AVATAR-ERRORES-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          console.log(error);
          resolve(false); // Resolver la promesa con 'false' en caso de error
          return;
        });
        
      })
      .catch(error => console.error("Error al actualizar el evento:", error));

    }
  )}

    function verificarDisponibilidadRegistro() {
        return new Promise((resolve, reject) => {
        var disponibilidadHorarios = Array(28).fill(true); // Inicialmente, todos los intervalos están disponibles

        // var claveEvento = document.getElementById("clave-evento").value; // ya no es necesario esto
        var nuevaFecha = document.getElementById("fecha-evento").value;
        var nuevaHora = document.getElementById("hora-evento").value;
        var nuevaDuracion = document.getElementById("duracion-evento").value;
        var nuevoCapitulo = document.getElementById("capitulo-organizador").value;

        // Validación de datos para que la fecha con la que se registrará el evento sea mayor a la de hoy.
        if (parseInt(nuevaDuracion) + parseInt(nuevaHora) > 1321) {
          Swal.fire({
            title: '¡ESTÁS INTENTANDO RESERVAR DESPUÉS DE LAS 22:00 (10PM)!',
            text: 'El evento debe estar programado para finalizar a más tardar hasta las 22:00, ve a la duración del mismo y edítala de tal forma que no se excedan las 22:00 (10pm)',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener el registro del evento
        }

        // Realiza una consulta a la base de datos para obtener las reservas en la nueva fecha
        var reservasRef = firebase.firestore().collection("reservas");

        // Primera consulta: Filtrar por "fechaEvento" igual a "nuevaFecha"
        if (nuevoCapitulo === "nacional") {
          // Si se seleccionó "ANEIAP NACIONAL", consultar solo las reservas para toda la Asociación
          consulta = reservasRef.where("fechaEvento", "==", nuevaFecha).where("capitulo", "==", "nacional");
        } else {
          // Consultar las reservas para el capítulo seleccionado y para toda la Asociación (ANEIAP NACIONAL)
          consulta = reservasRef.where("fechaEvento", "==", nuevaFecha).where("capitulo", "in", [nuevoCapitulo, "nacional"]);
        }

        // Realizar el filtrado para obtener intervalos disponibles y no disponibles
        consulta.get().then(function(querySnapshot) {
          console.log("entramos a hacer consulta");
          // Ciclo para revisar cada evento reservado para la nueva fecha
          querySnapshot.forEach(function(doc) {
            console.log("este es el doc: " + doc);
            var horaEvento = doc.data().horaEvento; // Hora en minutos (ej. 540 para 09:00)
            var duracionEvento = doc.data().duracionEvento; // Duración en minutos (ej. 120 para 2 horas)
            console.log("hora del evento con clave: " + doc.data().claveEvento + ": " + horaEvento);
            console.log("duracion del evento con clave: " + doc.data().claveEvento + ": " + duracionEvento);
            // Calcular los índices de inicio y fin del intervalo que ocupará el evento
            var inicioIntervalo = Math.floor((horaEvento - 480) / 30);
            var finIntervalo = inicioIntervalo + duracionEvento / 30;
            console.log("inicio intervalo: " + inicioIntervalo);
            console.log("fin intervalo: " + finIntervalo);

            // Marcar los intervalos como ocupados en el arreglo de disponibilidad
            for (var i = inicioIntervalo; i < finIntervalo; i++) {
              disponibilidadHorarios[i] = false;
            }
            console.log("estas son las disponibilidades de los intervalos:");
            console.log(disponibilidadHorarios);
          });

          // Calcula los índices de inicio y fin de los intervalos para la nueva hora y duración
          var inicioNuevoIntervalo = Math.floor((nuevaHora - 480) / 30);
          var finNuevoIntervalo = inicioNuevoIntervalo + nuevaDuracion / 30;

          var disponibilidadMatutino = true;
          var disponibilidadVesperino = true;
          var disponibilidadNocturno = true;

          // Colocar los intervalos de un mismo paquete horario (matutino, vesperino o nocturno) ocupados
          // Verificar el paquete horario matutino (intervalos 1 al 10, es decir, 8:00 a 13:00)
          for (var i = 0; i <= 9; i++) {
            if (!disponibilidadHorarios[i]) {
              for (var j = 0; j <= 9; j++) {
                disponibilidadHorarios[j] = false;
              }
              disponibilidadMatutino = false;
              break; // Al menos un intervalo está ocupado, salir del ciclo
            }
          }

          // Verificar el paquete horario vespertino (intervalos 11 al 20, es decir, 13:00 a 18:00)
          for (var i = 10; i <= 19; i++) {
            if (!disponibilidadHorarios[i]) {
              for (var j = 10; j <= 19; j++) {
                disponibilidadHorarios[j] = false;
              }
              disponibilidadVesperino = false;
              break; // Al menos un intervalo está ocupado, salir del ciclo
            }
          }

          // Verificar el paquete horario nocturno (intervalos 21 al 28, es decir, 18:00 a 22:00)
          for (var i = 20; i <= 27; i++) {
            if (!disponibilidadHorarios[i]) {
              for (var j = 20; j <= 27; j++) {
                disponibilidadHorarios[j] = false;
              }
              disponibilidadNocturno = false;
              break; // Al menos un intervalo está ocupado, salir del ciclo
            }
          }

          // Calcula los índices de inicio y fin de los intervalos para la nueva hora y duración
          var inicioNuevoIntervalo = Math.floor((nuevaHora - 480) / 30);
          var finNuevoIntervalo = inicioNuevoIntervalo + nuevaDuracion / 30;

          // Verifica si alguno de los nuevos intervalos está ocupado
          var algunIntervaloOcupado = false;
          for (var i = inicioNuevoIntervalo; i < finNuevoIntervalo; i++) {
            console.log("esta es la disponibilidad del intervalo " + i + ": " + disponibilidadHorarios[i]);
            if (!disponibilidadHorarios[i]) {
              console.log("está ocupado el intervalo " + i);
              algunIntervaloOcupado = true;
              break; // Si uno está ocupado, no es necesario verificar los demás
            }
          }

          if (algunIntervaloOcupado) {
            // Al menos uno de los intervalos no está disponible
            // Mostrar alerta al usuario con SweetAlert2 en caso de estar TODO EL DÍA ocupado
            if (!disponibilidadMatutino && !disponibilidadVesperino && !disponibilidadNocturno) {
              Swal.fire({
              title: '¡SIN DISPONIBILIDAD EN TODO EL DÍA! 📅',
              text: 'Ya no es posible reservar en ningún espacio del día debido a que los 3 horarios para este día están ocupados. Prueba a consultar la disponibilidad en la sección azul y escoger otro día.',
              icon: 'error',
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,  
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/LPTDqcy/AVATAR-NODISPOTODODIA-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la ejecución de la función
            }
            // Mostrar alerta al usuario con SweetAlert2 en caso de estar ocupado el horario matutino.
            if (!disponibilidadMatutino && inicioNuevoIntervalo <= 9) {
              Swal.fire({
              title: '¡SIN DISPONIBILIDAD EN EL HORARIO MATUTINO! 🌤️',
              text: 'El horario matutino ya está ocupado (8:00 a 13:00). Prueba cambiar el día, hora o duración.',
              icon: 'error',
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,  
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/4p0C8SC/AVATAR-HORARIOSNODISPO-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la ejecución de la función
            }
            // Mostrar alerta al usuario con SweetAlert2 en caso de estar ocupado el horario vespertino.
            if (!disponibilidadVesperino && inicioNuevoIntervalo <= 19) {
              Swal.fire({
              title: '¡SIN DISPONIBILIDAD EN EL HORARIO VESPERTINO! ☀️',
              text: 'El horario vespertino ya está ocupado (13:00 a 18:00). Prueba cambiar el día, hora o duración.',
              icon: 'error',
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,  
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/4p0C8SC/AVATAR-HORARIOSNODISPO-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la ejecución de la función
            }
            // Mostrar alerta al usuario con SweetAlert2 en caso de estar ocupado el horario nocturno.
            if (!disponibilidadNocturno) {
              Swal.fire({
              title: '¡SIN DISPONIBILIDAD EN EL HORARIO NOCTURNO! 🌕',
              text: 'El horario nocturno ya está ocupado (18:00 a 22:00). Prueba cambiar el día, hora o duración.',
              icon: 'error',
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,  
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/4p0C8SC/AVATAR-HORARIOSNODISPO-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
            return; // Detener la ejecución de la función
            }
          } else {
            // Todos los intervalos están disponibles
            // Realiza la edición de la reserva
            // ...
            resolve(true); // Resolver la promesa con 'true' si todos los intervalos están disponibles
          }
        }).catch(function(error) {
          Swal.fire({
            title: '¡ERROR DE CONSULTA!',
            text: 'Ocurrió un error al obtener las reservas. Por favor, inténtalo de nuevo más tarde o comunícate con el creador de la plataforma.',
            icon: 'error',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,  
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/PZ7KXF9/AVATAR-ERRORES-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          console.log(error);
          resolve(false); // Resolver la promesa con 'false' en caso de error
          return;
        });
      }
    )}

    function limpiarTicket() {
      // Lógica para limpiar los campos del ticket, por ejemplo, establecer los valores de los campos en blanco.
      // Ejemplo:
      document.getElementById("nombre").value = "";
      document.getElementById("correo-ticket").value = "";
      document.getElementById("tipo-ticket").value = "";
      document.getElementById("explicacion").value = "";
      document.getElementById("celular").value = "";
      document.getElementById("link-drive").value = "";
    }

    function enviarTicket() {
      // Obtener los valores de los campos
      
      var nombre = document.getElementById("nombre").value;
      var correo = document.getElementById("correo-ticket").value;
      var tipoTicket = document.getElementById("tipo-ticket").value;
      var explicacion = document.getElementById("explicacion").value;
      var celular = document.getElementById("celular").value;
      var linkDrive = document.getElementById("link-drive").value;

      // Crear una lista para almacenar los nombres de los campos faltantes
      var camposFaltantes = [];

      // Verificar si cada campo está vacío y agregar su nombre a la lista si es el caso
      if (nombre.trim() === "") {
        camposFaltantes.push(" - Nombre completo");
      }
      if (correo.trim() === "") {
        camposFaltantes.push(" - Correo ANEIAP");
      }
      if (tipoTicket === "") {
        camposFaltantes.push(" - Tipo de ticket");
      }
      if (explicacion.trim() === "") {
        camposFaltantes.push(" - Explicación del caso");
      }
      if (celular.trim() === "") {
        camposFaltantes.push(" - Número de celular");
      }

      // Verificar si hay campos faltantes
      if (camposFaltantes.length > 0) {
        // Mostrar una alerta con los campos faltantes
        Swal.fire({
          icon: 'error',
          title: '¡NO HAS DILIGENCIADO TODOS LOS CAMPOS!',
          text: 'Los siguientes campos son obligatorios y están vacíos:\n' + camposFaltantes.join('\n'),
          confirmButtonText: 'Aceptar',
          allowOutsideClick: true,
          backdrop: true,  
          allowEscapeKey: true,
          imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
          imageWidth: 120, // Ancho de la imagen en píxeles
          imageHeight: 235, // Alto de la imagen en píxeles
          imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
        });
      } else {
        // Verificar el número de celular
        if (!/^3\d{9}$/.test(celular)) {
          // El número de celular no cumple con el patrón
          Swal.fire({
            icon: 'error',
            title: '¡NÚMERO DE CELULAR INVÁLIDO!',
            text: 'Estás escribiendo un número de celular no válido, vuelve a rectificar por favor.',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,  
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
        } else if (!/^[\w.%+-]+@aneiap\.co$/.test(correo)) {
          // El correo ANEIAP no cumple con el patrón
          Swal.fire({
            icon: 'error',
            title: '¡CORREO ANEIAP INVÁLIDO!',
            text: 'Escribe bien tu correo ANEIAP. Vuelve y verifica.',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,  
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
        } else if (linkDrive && !/^https:\/\/drive\.google\.com\/.*$/.test(linkDrive)) {
          // El link de Drive no cumple con el patrón
          Swal.fire({
            icon: 'error',
            title: '¡LINK DE DRIVE DE EVIDENCIAS INVÁLIDO!',
            text: 'El link de Google Drive no es válido. Vuelve y verifica que lo estés diligenciando correctamente.".',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,  
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
        } else {
          // Todos los campos son válidos, aquí puedes agregar la lógica para enviar el ticket al servidor o realizar otras acciones.
          // Por ejemplo, puedes enviar una solicitud HTTP para procesar el ticket en el servidor.
          // Aquí puedes agregar tu lógica de envío del ticket.
          console.log("Correo ticket: " + correo)
          enviarCorreoTicketEmailJS(nombre,correo,tipoTicket,explicacion,celular,linkDrive);
        }
      }
    }

    function EnviarCorreoTicket(nombre,correo,tipoTicket,explicacion,celular,linkDrive,emailPassword) {

      // Configuración del servicio de correo (en este caso, Elastic Email)
      var emailHost = "smtp.elasticemail.com"; // Reemplaza con el servidor SMTP correcto
      var emailUsername = "siea@aneiap.co"; // Reemplaza con tu nombre de usuario SMTP
      var emailPassword = "D20D124D2A2129252882BEE9DAC2B79F4E70"; // Reemplaza con tu contraseña SMTP 

      // Mensaje de correo con los datos adicionales
      const asunto = `GENERACIÓN TICKET - TIPO ${tipoTicket}`;
      const mensaje = `
        <html>
          <body>
            <h1 style="color: #007BFF;">GENERACIÓN DE TICKET - TIPO "${tipoTicket}"</h1>
            <p>Estimado(a) <strong>Administrador</strong>,</p>
            <p>Se ha generado un nuevo ticket de soporte con la siguiente información:</p>
            <ul>
              <li><strong>Nombre Solicitante:</strong> ${nombre}</li>
              <li><strong>Correo ANEIAP:</strong> ${correo}</li>
              <li><strong>Tipo de Ticket:</strong> ${tipoTicket}</li>
              <li><strong>Explicación detallada del Caso:</strong> ${explicacion}</li>
              <li><strong>Número de Celular:</strong> ${celular}</li>
              <li><strong>Link de Google Drive con evidencias:</strong> ${linkDrive || 'No proporcionado'}</li>
            </ul>
            <p>Por favor, revise y atienda este ticket lo antes posible.</p>
            <p>Si tiene alguna pregunta o necesita asistencia adicional, no dude en responder a este correo o escribir a <a href="http://wa.me/${celular}" target="_blank">WhatsApp</a>.</p>
            <p>Gracias por su atención y servicio.</p>
            <p style="font-style: italic;">Cordialmente,</p>
            <p style="font-style: italic;">${nombre}</p>
            <p style="font-style: italic;">Solicitante de Ticket</p>
          </body>
        </html>
      `;

      Email.send({
        Host: emailHost,
        Username: emailUsername,
        Password: emailPassword,
        To: `siea@aneiap.co, ${correo}`, // Usuario que está registrando la reserva
     //   Cc: "siea@aneiap.co", // Copia a siea para siempre tener registro de correos
        From: emailUsername, // Debería ser la misma dirección de correo de Username
        Subject: asunto,
        Body: mensaje,
        ContentType: "text/html", // Indicar que el mensaje es de tipo HTML
      })
        .then((message) => {
          console.log("Mensaje de SMTPJS:", message);

          if (message === "OK") {
            console.log("Correo enviado con éxito");
            // Puedes eliminar la alerta ya que no es necesaria
            swal.fire({
              title: "¡TICKET ENVIADO!",
              text: `El ticket ha sido enviado correctamente a siea@aneiap.co, en máximo DOS (2) días hábiles se te dará respuesta al mismo.`,
              icon: "success",
              confirmButtonText: "OK",
              allowOutsideClick: true,
              backdrop: true,
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
            });
          } else {
            console.error("Error al enviar el correo:", message);
            // Puedes manejar el error de otra manera si lo deseas
          }
        })
        .catch((error) => {
          console.error("Error en la función de envío de correo:", error);
          // Puedes manejar el error de otra manera si lo deseas
        });

    }
    /*
    const modoSwitch = document.getElementById('modo-switch');
    const body = document.body;
    const logos = document.querySelectorAll('.logo');

    modoSwitch.addEventListener('click', () => {
      body.classList.toggle('dark-mode');

      // Verifica si el body tiene la clase dark-mode
      if (body.classList.contains('dark-mode')) {
        // Si está en modo oscuro, muestra el logo dark y oculta el logo light
        logos.forEach((logo) => {
          if (logo.classList.contains('dark-mode')) {
            logo.style.display = 'block';
          } else {
            logo.style.display = 'none';
          }
        });
      } else {
        // Si está en modo claro, muestra el logo light y oculta el logo dark
        logos.forEach((logo) => {
          if (logo.classList.contains('light-mode')) {
            logo.style.display = 'block';
          } else {
            logo.style.display = 'none';
          }
        });
      }
    });*/

    function enviarCorreoTicketEmailJS(nombre, correo, tipoTicket, explicacion, celular, linkDrive) {
        // Inicializar EmailJS
        emailjs.init("2vq1EFo6RmswvD4Ey");

        // Asunto del correo
        const asunto = `GENERACIÓN TICKET - TIPO ${tipoTicket}`;

        // Crear la constante para los correos destinatarios
        const correosDestinatarios = `${correo}, siea@aneiap.co, academico@aneiap.co`;
        console.log("correosDestinatarios: " + correosDestinatarios)

        // Parámetros para la plantilla de EmailJS
        const params = {
            tituloCorreo: `GENERACIÓN DE TICKET - TIPO "${tipoTicket}"`,
            saludoInicial: "Estimado(a) Administrador,",
            mensajeIntroduccion: "Se ha generado un nuevo ticket de soporte con la siguiente información:",
            
            // Información del ticket
            TextoNombreCompleto: "    🔹 Nombre Solicitante: ",
            nombreCompleto: nombre,
            TextoCorreoElectronico: "   🔹 Correo ANEIAP: ",
            correoElectronico: correo,
            TextoTipoTicket: "    🔹 Tipo de Ticket: ",
            tipoTicket: tipoTicket,
            TextoExplicacionCaso: "   🔹 Explicación detallada del Caso: ",
            explicacionCaso: explicacion,
            TextoNumeroCelular: "   🔹 Número de Celular: ",
            numeroCelular: celular,
            TextoLinkDrive: "   🔹 Link de Google Drive con evidencias: ",
            linkDrive: linkDrive || "No proporcionado.",
            
            // Mensaje adicional
            mensajeFinal: "Por favor, revise y atienda este ticket lo antes posible. ",
            despedida: "Cordialmente, el equipo de soporte",
            
            // Asunto y destinatario
            subject: asunto,
            to_email: correosDestinatarios // Usar la constante para los correos destinatarios
        };

        // Enviar el correo usando EmailJS
        emailjs.send("siea_6zoabdr", "otros_correos", params)
            .then((response) => {
                console.log("Correo de ticket enviado exitosamente", response.status, response.text);
                alert("Ticket enviado exitosamente."); // Agregar alerta
                swal.fire({
                    title: "¡TICKET ENVIADO!",
                    text: `El ticket ha sido enviado correctamente a siea@aneiap.co, en máximo DOS (2) días hábiles se te dará respuesta al mismo.`,
                    icon: "success",
                    confirmButtonText: "OK",
                    allowOutsideClick: true,
                    backdrop: true,
                    allowEscapeKey: true,
                    imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png',
                    imageWidth: 120,
                    imageHeight: 235,
                    imagePosition: 'top-start'
                });
                limpiarTicket()
            })
            .catch((error) => {
                console.error("Error al enviar el correo de ticket:", error);
                alert(`Error al enviar el ticket: ${error.text || "Error desconocido"}. Por favor, consulta al administrador.`); // Agregar alerta de error
                swal.fire({
                    title: "Error",
                    text: "Hubo un error al enviar el ticket. Por favor, inténtelo de nuevo más tarde o contacte con el administrador.",
                    icon: "error",
                    confirmButtonText: "OK"
                });
            });
    }


    function EjecutarAdmin(event) {
    console.log("Función EjecutarAdmin iniciada.");

    // Verifica si el usuario es administrador mediante correoUsuario
    if (correoUsuario !== "siea@aneiap.co") {
        console.log("Usuario no autorizado. Mostrando mensaje de advertencia.");
        Swal.fire({
            title: "¿LA CURIOSIDAD MATÓ AL GATO?",
            text: "Solo el administrador puede acceder a esta función SECRETA de SIEA. ¿Quieres saber qué es? Sacia tu curiosidad escribiéndole al admin. 👀",
            icon: "warning",
            confirmButtonText: "Aceptar",
            allowOutsideClick: true,
            backdrop: true,
            allowEscapeKey: true,
            imageWidth: 120,
            imageHeight: 235,
        });
        console.log("Fin de la función por falta de permisos.");
        return;
    }

    console.log("Usuario autorizado. Continuando con la obtención de documentos.");

    // Obtener todos los documentos de la colección "reservas"
    const reservasRef = firebase.firestore().collection("reservas");
    reservasRef.get().then(reservasSnapshot => {
        const reservasList = reservasSnapshot.docs.map(doc => ({ id: doc.id, data: doc.data() }));
        console.log("Lista de documentos procesada:", reservasList);

        // Lista de campos de un documento en Firebase
        const camposFirebase = [
            "areaTrabajo", "asistentes", "capitulo", "capitulosOrganizadores", "claveEvento", "comentarios",
            "correosAsistentes", "crm", "detractores", "duracionEvento", "emailOrganizador", "emailPonente", "evidencia",
            "fechaEvento", "fotoPonenteURL", "horaEvento", "lugarPresencial", "modalidadEvento", "nombreEvento",
            "nombreOrganizador", "nombrePonente", "observacionesEvento", "observacionesPublicidad", "pasivos",
            "planEvento", "promotores", "publicidadComite", "respuestas1", "respuestas2", "respuestas3", "satisfaccion",
            "telefonoOrganizador", "telefonoPonente", "telefonosAsistentes", "tipoEvento", "totalAsistentes",
            "ubicacionPlataforma"
        ];

        // Mostrar el Swal con los tres campos y las acciones
        Swal.fire({
            title: "Actualizar Documento",
            html: `
                <label for="busquedaClave">Clave de la reserva</label>
                <input type="text" id="busquedaClave" class="swal2-input" placeholder="Escribe para buscar...">
                <select id="documentoSelect" class="swal2-input" style="width: 100%; height: 90px;" size="15">
                    ${reservasList.map(reserva => `<option value="${reserva.id}">${reserva.id}</option>`).join('')}
                </select>
                <br>
                <label for="campoSelect">Campo a editar</label>
                <select id="campoSelect" class="swal2-input" style="width: 100%;" placeholder="Selecciona un campo">
                    ${camposFirebase.map(campo => `<option value="${campo}">${campo}</option>`).join('')}
                </select>
                <br>
                <label for="nuevoValor">Valor a colocar</label>
                <input id="nuevoValor" class="swal2-input" placeholder="Escribe el nuevo valor">
                <p id="mensajeError" style="color: red; display: none;">Todos los campos deben ser diligenciados</p>
            `,
            showCancelButton: true,
            confirmButtonText: "Actualizar",
            cancelButtonText: "Cancelar",
            didOpen: () => {
                // Agregar eventos para actualización dinámica de "Valor a colocar" y búsqueda en "Clave de la reserva"
                document.getElementById("documentoSelect").addEventListener("change", actualizarValorActual);
                document.getElementById("campoSelect").addEventListener("change", actualizarValorActual);
                document.getElementById("busquedaClave").addEventListener("input", filtrarDocumentos);

                // Función para actualizar el valor en el tercer slot
                function actualizarValorActual() {
                    const documentoId = document.getElementById("documentoSelect").value;
                    const campoSeleccionado = document.getElementById("campoSelect").value;

                    if (documentoId && campoSeleccionado) {
                        const docRef = reservasRef.doc(documentoId);
                        docRef.get().then(docSnapshot => {
                            if (docSnapshot.exists) {
                                const valorActual = docSnapshot.data()[campoSeleccionado] || "";
                                document.getElementById("nuevoValor").value = valorActual;
                                console.log(`Valor actual del campo ${campoSeleccionado} en el documento ${documentoId}:`, valorActual);
                            } else {
                                console.log("Documento no encontrado en Firebase.");
                            }
                        }).catch(error => {
                            console.error("Error al obtener el documento:", error);
                            mostrarMensajeFallaTecnica();
                        });
                    }
                }

                // Función de búsqueda dinámica en el campo "Clave de la reserva"
                function filtrarDocumentos() {
                    const searchText = document.getElementById("busquedaClave").value.toLowerCase();
                    const documentoSelect = document.getElementById("documentoSelect");
                    documentoSelect.innerHTML = reservasList
                        .filter(reserva => reserva.id.toLowerCase().startsWith(searchText)) // Filtra solo si comienza con el texto
                        .map(reserva => `<option value="${reserva.id}">${reserva.id}</option>`)
                        .join('');
                }
            },
            preConfirm: () => {
                console.log("Validando campos seleccionados.");

                // Validación de los campos
                const documentoId = document.getElementById("documentoSelect").value;
                const campoSeleccionado = document.getElementById("campoSelect").value;
                const nuevoValor = document.getElementById("nuevoValor").value;

                console.log("Valores capturados:", { documentoId, campoSeleccionado, nuevoValor });

                if (!documentoId || !campoSeleccionado || !nuevoValor) {
                    document.getElementById("mensajeError").style.display = "block";
                    return false;
                } else {
                    document.getElementById("mensajeError").style.display = "none";
                }

                console.log("Campos completos. Iniciando actualización en Firebase.");

                // Referencia al documento seleccionado en Firebase
                const docRef = reservasRef.doc(documentoId);

                // Actualizar el campo en Firebase
                const actualizacion = {};
                actualizacion[campoSeleccionado] = nuevoValor;
                console.log("Datos a actualizar:", actualizacion);

                return docRef.update(actualizacion)
                    .then(() => {
                        console.log("Actualización exitosa en Firebase.");
                        mostrarMensajeActualizarEspacio();
                    })
                    .catch((error) => {
                        console.error("Error al actualizar en Firebase:", error);
                        mostrarMensajeFallaTecnica();
                    });
            }
        });
    }).catch(error => {
        console.error("Error al obtener documentos de Firebase:", error);
        mostrarMensajeFallaTecnica();
    });
}

    function validar_login() {
      // Obtener los valores de correo y contraseña desde los campos del formulario
      var correo = document.getElementById("correo").value;
      var contrasena = document.getElementById("contrasena").value;
      var content = document.getElementById("acordeon5-content");
      content.style.display = "none";

      // Verificar si ambos campos están diligenciados
      if (!correo || !contrasena) {
        // Campos no diligenciados, mostrar alerta de advertencia
        Swal.fire({
          title: "¡NO HAS DILIGENCIADO TODOS LOS CAMPOS!",
          text: "Debes diligenciar tanto correo como contraseña para iniciar sesión.",
          icon: "warning",
          confirmButtonText: "Aceptar",
          allowOutsideClick: true,
          backdrop: true,
          allowEscapeKey: true,
          imageUrl: "https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png", // URL de la imagen
          imageWidth: 120, // Ancho de la imagen en píxeles
          imageHeight: 235, // Alto de la imagen en píxeles
        });
        // Actualizar el contenido del elemento saludoUsuario con el saludo genérico
        document.getElementById("saludoUsuario").innerText = "¡Hola, ANEIAPo!";
        return; // Detener la ejecución de la función
      }

      // Referencia al documento en la colección "cuentas" correspondiente al correo
      var cuentaRef = firebase.firestore().collection("cuentas").doc(correo);

      // Obtener la información del documento
      cuentaRef.get().then((doc) => {
        if (doc.exists) {
          // El documento existe, comprobar si la contraseña coincide
          var storedPassword = doc.data().pass;
          if (contrasena === storedPassword) {
            // Contraseña correcta, asignar el valor del correo electrónico a la variable global
            correoUsuario = correo;
            // Contraseña correcta, asignar el valor del capítulo dependiendo del correo.
            // Verificar el valor del correo para determinar el capítulo del usuario
            if (correo === "academico@aneiap.co" || correo === "formacion_integral@aneiap.co") {
              // Mostrar un desplegable con la lista de todos los capítulos
              Swal.fire({
                title: 'Selecciona el capítulo sobre el cual deseas consultar información en caso de que vayas a hacerlo:',
                input: 'select',
                inputOptions: {
                  'uniguajira': 'UNIGUAJIRA',
                  'unimagdalena': 'UNIMAGDALENA',
                  'uniatlantico': 'UNIATLÁNTICO',
                  'uninorte': 'UNINORTE',
                  'unisimon': 'UNISIMÓN',
                  'cuc': 'CUC',
                  'librequilla': 'LIBREQUILLA',
                  'utb': 'UTB',
                  'upbmonteria': 'UPBMONTERÍA',
                  'unicordoba': 'UNICÓRDOBA',
                  'areandina': 'AREANDINA',
                  'ufps': 'UFPS',
                  'unalmed': 'UNALMED',
                  'udea': 'UDEA',
                  'upbmed': 'UPBMED',
                  'utp': 'UTP',
                  'unalma': 'UNALMA',
                  'udistrital': 'UDISTRITAL',
                  'unalbog': 'UNALBOG',
                  'univalle': 'UNIVALLE',
                  'icesi': 'ICESI',
                  'usc': 'USC',
                  'librecali': 'LIBRECALI',
                  'nacional': 'NACIONAL',
                },
                inputPlaceholder: 'Selecciona un capítulo',
                showCancelButton: false, // No mostrar el botón de cancelar
                confirmButtonText: 'Aceptar',
                allowOutsideClick: false, // No permitir clic fuera de la alerta
                allowEscapeKey: false // No permitir usar la tecla de escape
              }).then((result) => {
                // Verificar si se seleccionó un capítulo
                if (result.isConfirmed && result.value !== "") {
                  // Asignar el valor seleccionado a capituloUsuario
                  capituloUsuario = result.value;
                  // Mostrar mensaje de inicio de sesión exitoso
                  mostrarMensajeInicioSesion();
                  console.log("El capítulo del usuario es: " + capituloUsuario);
                }
              });
            } else if (correo.startsWith("academico_") || correo === "informes@aneiap.co") {
              if (correo.startsWith("academico_")) {
                // Si el correo empieza por "academico_", extraer el nombre del capítulo y asignarlo a capituloUsuario
                var inicio = "academico_";
                var fin = "@aneiap.co";
                var capitulo = correo.substring(inicio.length, correo.indexOf(fin));
                capituloUsuario = capitulo;
                // Mostrar botones para generar informes
                document.getElementById("btnInformeFI").style.display = "inline-block";
                document.getElementById("btnInformeIE").style.display = "inline-block";
              } else {
                // Si el correo no empieza por "academico_", asignar "nacional"
                capituloUsuario = "nacional";
                document.getElementById("btnInformeFI").style.display = "inline-block";
                document.getElementById("btnInformeIE").style.display = "inline-block";
              }
              var storedTelefonoCuenta = doc.data().telefonoDCA;
              telefonoCuenta = storedTelefonoCuenta;
              // Mostrar mensaje de inicio de sesión exitoso
              mostrarMensajeInicioSesion();
              // Vaciar los campos de correo y contraseña
              document.getElementById("correo").value = "";
              document.getElementById("contrasena").value = "";
            } else if (correo.startsWith("mercadeo_") || correo === "crm@aneiap.co") {
              if (correo.startsWith("mercadeo_")) {
                // Si el correo empieza por "academico_", extraer el nombre del capítulo y asignarlo a capituloUsuario
                var inicio = "mercadeo_";
                var fin = "@aneiap.co";
                var capitulo = correo.substring(inicio.length, correo.indexOf(fin));
                capituloUsuario = capitulo;
              } else {
                // Si el correo no empieza por "academico_", asignar "nacional"
                capituloUsuario = "nacional";
              }
              // Mostrar mensaje de inicio de sesión exitoso
              mostrarMensajeInicioSesion();
              // Vaciar los campos de correo y contraseña
              document.getElementById("correo").value = "";
              document.getElementById("contrasena").value = "";
              desplegarInterfazCRM();
              return;
            } else {
              // Si no se cumple ninguna de las condiciones anteriores, asignar valor "general" a capituloUsuario
              capituloUsuario = "nacional";
              // Mostrar mensaje de inicio de sesión exitoso
              mostrarMensajeInicioSesion();
              // Vaciar los campos de correo y contraseña
              document.getElementById("correo").value = "";
              document.getElementById("contrasena").value = "";
            }


          } else {
            // Contraseña incorrecta, mostrar alerta de advertencia
            Swal.fire({
              title: "Contraseña incorrecta",
              text: "No diligenciaste correctamente la contraseña, revísala o consulta al administrador si la olvidaste.",
              icon: "warning",
              confirmButtonText: "Aceptar",
              imageUrl: "https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png",
              imageWidth: 120,
              imageHeight: 235,
            });
            // Actualizar el contenido del elemento saludoUsuario con el saludo genérico
            document.getElementById("saludoUsuario").innerText = "¡Hola, ANEIAPo!";
            // Vaciar los campos de correo y contraseña
            document.getElementById("correo").value = "";
            document.getElementById("contrasena").value = "";
          }
        } else {
          // El documento no existe, el correo no está registrado, mostrar alerta de error
          Swal.fire({
            title: "Correo no válido.",
            text: "Recuerda que para utilizar esta función de SIEA debes ser DCA o DNA. 🦉💚",
            icon: "error",
            confirmButtonText: "Aceptar",
            imageUrl: "https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png",
            imageWidth: 120,
            imageHeight: 235,
          });
          // Actualizar el contenido del elemento saludoUsuario con el saludo genérico
          document.getElementById("saludoUsuario").innerText = "¡Hola, ANEIAPo!";
        }
      }).catch((error) => {
        // Manejar errores, mostrar alerta de error
        Swal.fire({
          title: "Algo inesperado ha ocurrido con tu inicio de sesión, consulta al administrador o creador de SIEA para más información.",
          text: error.message,
          icon: "error",
        });
        // Actualizar el contenido del elemento saludoUsuario con el saludo genérico
        document.getElementById("saludoUsuario").innerText = "¡Hola, ANEIAPo!";
      });
    }

    function cambiar_contrasena() {
      Swal.fire({
          title: 'Cambio de Contraseña',
          html: `
              <label for="email">Correo electrónico</label>
              <input type="email" id="email" class="swal2-input input-email" placeholder="Correo">
              
              <label for="oldPassword">Contraseña actual</label>
              <input type="password" id="oldPassword" class="swal2-input input-password" placeholder="Contraseña Actual">
              <span class="toggle-password" onclick="togglePasswordVisibility('oldPassword')">&#128065;</span>
              
              <label for="newPassword">Nueva contraseña</label>
              <input type="password" id="newPassword" class="swal2-input input-password" placeholder="Nueva Contraseña">
              <span class="toggle-password" onclick="togglePasswordVisibility('newPassword')">&#128065;</span>
              
              <label for="confirmNewPassword">Confirmación contraseña</label>
              <input type="password" id="confirmNewPassword" class="swal2-input input-password" placeholder="Confirmar Nueva Contraseña">
              <span class="toggle-password" onclick="togglePasswordVisibility('confirmNewPassword')">&#128065;</span>
          `,
          confirmButtonText: 'Cambiar Contraseña',
          focusConfirm: false,
          preConfirm: () => {
              const email = Swal.getPopup().querySelector('#email').value;
              const oldPassword = Swal.getPopup().querySelector('#oldPassword').value;
              const newPassword = Swal.getPopup().querySelector('#newPassword').value;
              const confirmNewPassword = Swal.getPopup().querySelector('#confirmNewPassword').value;
              
              if (!email || !oldPassword || !newPassword || !confirmNewPassword) {
                  Swal.showValidationMessage(`Todos los campos son obligatorios.`);
                  return false;
              }

              if (oldPassword === newPassword) {
                  Swal.showValidationMessage(`Tu nueva contraseña debe ser diferente a la actual.`);
                  return false;
              }

              if (newPassword !== confirmNewPassword) {
                  Swal.showValidationMessage(`Las contraseñas nuevas no coinciden.`);
                  return false;
              }

              // Referencia al documento en la colección "cuentas"
              var cuentaRef = firebase.firestore().collection("cuentas").doc(email);

              return cuentaRef.get().then((doc) => {
                  if (!doc.exists) {
                      Swal.showValidationMessage('No se encontró una cuenta asociada a ese correo.');
                      return false;
                  }

                  const storedPassword = doc.data().pass;
                  if (oldPassword !== storedPassword) {
                      Swal.showValidationMessage('La contraseña actual no es correcta.');
                      return false;
                  }

                  return { email: email, oldPassword: oldPassword, newPassword: newPassword };
              });
          },
          showCancelButton: true,
          cancelButtonText: 'Cancelar'
      }).then((result) => {
          if (result.value) {
              const { email, newPassword } = result.value;

              // Actualizar la contraseña en Firestore
              var cuentaRef = firebase.firestore().collection("cuentas").doc(email);
              cuentaRef.update({
                  pass: newPassword
              }).then(() => {
                  Swal.fire('Actualizado', 'Tu contraseña ha sido actualizada correctamente.', 'success');
                  return enviarCorreoCambioContraseñaEmailJS(email, newPassword);
              }).catch((error) => {
                  Swal.fire('Error', 'No se pudo actualizar la contraseña.', 'error');
              });
          }
      }).catch((error) => {
          Swal.fire('Error', error.message, 'error');
      });
    }

    function obtenerResponsable(correoUsuario) {
      // Referencia al documento en la colección "cuentas" correspondiente al correo
      var cuentaRef = firebase.firestore().collection("cuentas").doc(correoUsuario);

      // Obtener la información del documento
      return cuentaRef.get().then((doc) => {
        if (doc.exists) {
          // El documento existe, devolver el valor del campo "responsable"
          return doc.data().responsable;
        } else {
          // El documento no existe, devolver null
          return 'ANEIAPo';
        }
      }).catch((error) => {
        // Manejar errores
        console.error("Error al obtener el responsable:", error);
        return 'ANEIAPo';
      });
    }

    function togglePasswordVisibility(inputId) {
        var input = document.getElementById(inputId);
        if (input.type === "password") {
            input.type = "email";
        } else {
            input.type = "password";
        }
    }

    function enviarCorreoCambioContraseña(email, newPassword) {
        // Configuración del servicio de correo (en este caso, Elastic Email)
        var emailHost = "smtp.elasticemail.com";
        var emailUsername = "siea@aneiap.co";
        var emailPassword = "D20D124D2A2129252882BEE9DAC2B79F4E70";

        // Mensaje de correo con confirmación del cambio de contraseña y la nueva contraseña adjunta
        const asunto = "Confirmación de Cambio de Contraseña";
        const mensaje = `
            <html>
            <body>
                <h1>CAMBIO DE CONTRASEÑA CONFIRMADO </h1>
                <p>Estimado usuario,</p>
                <p>Este mensaje confirma que tu contraseña ha sido cambiada exitosamente. Tu nueva contraseña es: <strong>${newPassword}</strong></p>
                <p>Si no has solicitado este cambio, por favor contacta inmediatamente a siea@aneiap.co o genera un ticket en SIEA.</p>
                <p>¡Gracias por utilizar SIEA!.</p>
                <p style="font-style: italic;">Este es un correo automático y no debe ser respondido.</p>
                <p style="font-style: italic;">Cordialmente, Administrador SIEA</p>
            </body>
            </html>
        `;

        return Email.send({
            Host: emailHost,
            Username: emailUsername,
            Password: emailPassword,
            To: email,
            Cc: "siea@aneiap.co",
            From: emailUsername,
            Subject: asunto,
            Body: mensaje,
            ContentType: "text/html"
        })
        .then((message) => {
            console.log("Mensaje de SMTPJS:", message);
            if (message === "OK") {
                console.log("Correo de confirmación de cambio de contraseña enviado con éxito.");
            } else {
                console.error("Error al enviar el correo de confirmación de cambio de contraseña:", message);
            }
        })
        .catch((error) => {
            console.error("Error en la función de envío de correo de confirmación de cambio de contraseña:", error);
        });
    }

    function enviarCorreoCambioContraseñaEmailJS(email, newPassword) {
        // Inicializar EmailJS
        emailjs.init("2vq1EFo6RmswvD4Ey");

        // Asunto del correo
        const asunto = "Confirmación de Cambio de Contraseña";

        // Parámetros para la plantilla de EmailJS
        const params = {
            tituloCorreo: "CAMBIO DE CONTRASEÑA CONFIRMADO",
            saludoInicial: "Estimado usuario,",
            TextoNuevaContrasena: `Este mensaje confirma que tu contraseña ha sido cambiada exitosamente. Tu nueva contraseña es: `,
            nuevaContrasena: newPassword,
            mensajeFinal: "Si no has solicitado este cambio, por favor contacta inmediatamente a siea@aneiap.co o genera un ticket en SIEA.",
            despedida: "Cordialmente, Administrador SIEA",
            
            // Asunto y destinatario
            subject: asunto,
            to_email: `${email}, siea@aneiap.co` // Enviar copia al usuario y a siea@aneiap.co
        };

        // Enviar el correo usando EmailJS
        emailjs.send("siea_6zoabdr", "otros_correos", params)
            .then((response) => {
                console.log("Correo de confirmación de cambio de contraseña enviado exitosamente", response.status, response.text);
                alert("Correo de confirmación de cambio de contraseña enviado exitosamente."); // Agregar alerta de éxito
            })
            .catch((error) => {
                console.error("Error al enviar el correo de cambio de contraseña:", error);
                alert(`Error al enviar el correo de cambio de contraseña: ${error.text || "Error desconocido"}. Por favor, consulta al administrador.`); // Agregar alerta de error
            });
    }


    // Función para convertir números en emojis
    function numeroAEmoji(numero) {
      if (numero < 10) {
        switch (numero) {
          case 0:
            return "0️⃣";
          case 1:
            return "1️⃣";
          case 2:
            return "2️⃣";
          case 3:
            return "3️⃣";
          case 4:
            return "4️⃣";
          case 5:
            return "5️⃣";
          case 6:
            return "6️⃣";
          case 7:
            return "7️⃣";
          case 8:
            return "8️⃣";
          case 9:
            return "9️⃣";
          default:
            return numero; // Si el número no está entre 0 y 9, devolver el mismo número
        }
      } else {
        // Obtener el primer dígito
        let primerDigito = Math.floor(numero / 10);
        // Obtener el segundo dígito
        let segundoDigito = numero % 10;
        // Convertir ambos dígitos a emojis
        let emojiPrimerDigito = numeroAEmoji(primerDigito);
        let emojiSegundoDigito = numeroAEmoji(segundoDigito);
        // Devolver ambos emojis concatenados
        return `${emojiPrimerDigito}${emojiSegundoDigito}`;
      }
    }

    function evaluarEspacio() {
      // Obtener los valores de los campos
      var nombreAsistente = document.getElementById("nombre-asistente").value;
      var telefonoAsistente = document.getElementById("telefono-asistente").value;
      var correoAsistente = document.getElementById("correo-asistente").value;
      var capituloEspacio = document.getElementById("capitulo-espacio").value;
      var nombreEspacio = document.getElementById("nombre-espacio").value;
      var pregunta1 = document.getElementById("pregunta1").value;
      var pregunta2 = document.getElementById("pregunta2").value;
      var pregunta3 = document.getElementById("pregunta3").value;
      var comentarios = document.getElementById("pregunta4").value;

      // Crear una lista para almacenar los nombres de los campos faltantes
      var camposFaltantes = [];

      // Verificar si cada campo está vacío y agregar su nombre a la lista si es el caso
      if (nombreAsistente.trim() === "") {
          camposFaltantes.push(" - Nombre del asistente");
      }
      if (telefonoAsistente.trim() === "") {
          camposFaltantes.push(" - Teléfono del asistente");
      }
      if (correoAsistente.trim() === "") {
          camposFaltantes.push(" - Correo del asistente");
      }
      if (capituloEspacio === "") {
          camposFaltantes.push(" - Capítulo que organizó el espacio");
      }
      if (nombreEspacio === "") {
          camposFaltantes.push(" - Nombre del espacio a evaluar");
      }
      if (pregunta1 === "") {
          camposFaltantes.push(" - Pregunta 1");
      }
      if (pregunta2 === "") {
          camposFaltantes.push(" - Pregunta 2");
      }
      if (pregunta3 === "") {
          camposFaltantes.push(" - Pregunta 3");
      }

      // Verificar si hay campos faltantes
      if (camposFaltantes.length > 0) {
          // Mostrar una alerta con los campos faltantes
          Swal.fire({
              icon: 'error',
              title: '¡NO HAS DILIGENCIADO TODOS LOS CAMPOS!',
              text: 'Los siguientes campos son obligatorios y están vacíos:\n' + camposFaltantes.join('\n'),
              confirmButtonText: 'Aceptar',
              allowOutsideClick: true,
              backdrop: true,
              allowEscapeKey: true,
              imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
              imageWidth: 120, // Ancho de la imagen en píxeles
              imageHeight: 235, // Alto de la imagen en píxeles
              imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener el proceso de evaluación
      }

      // Si todos los campos están diligenciados, continuar con el proceso de evaluación
      // Actualizar la información del evento en la base de datos
      var reservasRef = firebase.firestore().collection("reservas");
      // Crear la consulta para obtener el evento donde el nombre del evento es igual y capituloEspacio está en capitulosOrganizadores (array)
      var eventoRef = reservasRef.where("capitulosOrganizadores", "array-contains", capituloEspacio)
                                .where("nombreEvento", "==", nombreEspacio);

      eventoRef.get().then(function(querySnapshot) {
        querySnapshot.forEach(function(doc) {
            var data = doc.data();

            // Incrementar los contadores según las respuestas a las preguntas
            if (pregunta1 === "1" || pregunta1 === "2" || pregunta1 === "3" || pregunta1 === "4" || pregunta1 === "5" || pregunta1 === "6") {
                // Detractor
                data.detractores = (data.detractores || 0) + 1;
            } else if (pregunta1 === "7" || pregunta1 === "8") {
                // Pasivo
                data.pasivos = (data.pasivos || 0) + 1;
            } else {
                // Promotor
                data.promotores = (data.promotores || 0) + 1;
            }

            if (pregunta2 === "1" || pregunta2 === "2" || pregunta2 === "3" || pregunta2 === "4" || pregunta2 === "5" || pregunta2 === "6") {
                data.detractores = (data.detractores || 0) + 1;
            } else if (pregunta2 === "7" || pregunta2 === "8") {
                data.pasivos = (data.pasivos || 0) + 1;
            } else {
                data.promotores = (data.promotores || 0) + 1;
            }

            if (pregunta3 === "1" || pregunta3 === "2" || pregunta3 === "3" || pregunta3 === "4" || pregunta3 === "5" || pregunta3 === "6") {
                data.detractores = (data.detractores || 0) + 1;
            } else if (pregunta3 === "7" || pregunta3 === "8") {
                data.pasivos = (data.pasivos || 0) + 1;
            } else {
                data.promotores = (data.promotores || 0) + 1;
            }

            // Almacenar respuestas en los campos correspondientes
            data.respuestas1 = (data.respuestas1 || "") + pregunta1 + "|" ;
            data.respuestas2 = (data.respuestas2 || "") + pregunta2 + "|" ;
            data.respuestas3 = (data.respuestas3 || "") + pregunta3 + "|" ;

            // Actualizar comentarios y datos personales del asistente
            if (comentarios.trim() !== "") {
                data.comentarios = (data.comentarios || "") + comentarios + "|" ;
            } else {data.comentarios = (data.comentarios || "") + "Ninguno.|"}

            data.asistentes = (data.asistentes || "") + nombreAsistente + "|";
            data.correosAsistentes = (data.correosAsistentes || "") + correoAsistente + "|" ;
            data.telefonosAsistentes = (data.telefonosAsistentes || "") +  telefonoAsistente + "|" ;

            // Recalcular satisfacción
            console.log("Promotores:", data.promotores);
            console.log("Pasivos:", data.pasivos);
            console.log("Detractores:", data.detractores);
            var satisfaccion = (data.promotores - data.detractores) / (data.promotores + data.pasivos + data.detractores);
            console.log("La satisfacción es: " + satisfaccion)
            data.satisfaccion = satisfaccion;

            // Actualizar el evento en la base de datos
            reservasRef.doc(doc.id).set(data, { merge: true }).then(function() {
                // Mostrar mensaje de éxito
                Swal.fire({
                  icon: 'success',
                  title: '¡EVALUACIÓN ENVIADA CON ÉXITO!',
                  text: 'Gracias por tu evaluación.',
                  confirmButtonText: 'Aceptar',
                  allowOutsideClick: true,
                  backdrop: true,
                  allowEscapeKey: true,
                  imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png', // URL de la imagen
                  imageWidth: 120, // Ancho de la imagen en píxeles
                  imageHeight: 235, // Alto de la imagen en píxeles
                  imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
                });
                // Reiniciar los campos del formulario que no son los 3 datos personales del asistente en caso de que quiera volver a llenar para otro espacio diferente.
                document.getElementById("capitulo-espacio").value = "";
                document.getElementById("nombre-espacio").value = "";
                document.getElementById("pregunta1").value = "";
                document.getElementById("pregunta2").value = "";
                document.getElementById("pregunta3").value = "";
                document.getElementById("pregunta4").value = "";
                var content = document.getElementById("acordeon4-content");
                content.style.display = "none";
                }).catch(function(error) {
                    console.error("Error actualizando el evento:", error);
                    // Mostrar mensaje de error
                    Swal.fire({
                        icon: 'error',
                        title: '¡ERROR AL ENVIAR LA EVALUACIÓN!',
                        text: 'Ocurrió un error al actualizar la información del evento. Por favor, intenta nuevamente.',
                        confirmButtonText: 'Aceptar'
                    });
                });
            });
        }).catch(function(error) {
            console.error("Error obteniendo el evento:", error);
            // Mostrar mensaje de error
            Swal.fire({
                icon: 'error',
                title: '¡ERROR AL OBTENER EL EVENTO!',
                text: 'Ocurrió un error al obtener la información del evento. Por favor, contáctate con el administrador.',
                confirmButtonText: 'Aceptar'
            });
        });

    }

    // Función para mostrar mensaje de inicio de sesión exitoso con temporizador
    function mostrarMensajeInicioSesion() {
      Swal.fire({
        title: "Iniciando sesión...",
        text: "Espera unos segundos",
        icon: "info",
        timer: 3000, // Tiempo en milisegundos (3 segundos)
        timerProgressBar: true,
        allowOutsideClick: false, // Evitar clics fuera del modal
        showConfirmButton: false, // Ocultar botón de confirmación
        didOpen: () => {
          Swal.showLoading();
        }
      }).then(() => {
        // Después de que pase el temporizador, mostrar el mensaje de inicio de sesión exitoso
        obtenerResponsable(correoUsuario).then((responsable) => {
          Swal.fire({
            title: "Has iniciado sesión exitosamente. 🦉💚",
            text: "Disfruta de SIEA " + responsable, // Utiliza el valor del responsable obtenido
            icon: "success",
            confirmButtonText: "Aceptar",
            imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png', // URL de la imagen
            imageWidth: 120,
            imageHeight: 235,
          });
          // Actualizar el contenido del elemento saludoUsuario con el correo del usuario
          document.getElementById("saludoUsuario").innerText = "¡Hola, " + responsable + "!";
        }).catch((error) => {
          console.error("Error al obtener el responsable:", error);
        });
      });
    }

    function actualizarEspacio() {
    // Obtener los valores de los campos
    var totalAsistentes = document.getElementById("total-asistentes").value;
    var linkEvidencia = document.getElementById("link-evidencia").value;
    var nombreEspacio = document.getElementById("nombre-espacio-actualizar").value;
    var tipoEspacio = document.getElementById("tipo-espacio").value;
    var areaTrabajo = document.getElementById("area-trabajo").value;

    // Verificar si se han llenado todos los campos importantes
    if (!totalAsistentes || !linkEvidencia || !nombreEspacio || tipoEspacio === "" || areaTrabajo === "") {
        // Crear una lista para almacenar los nombres de los campos faltantes
        var camposFaltantes = [];

        // Verificar si cada campo está vacío y agregar su nombre a la lista si es el caso
        if (!totalAsistentes) {
            camposFaltantes.push(" - Total de asistentes");
        }
        if (!linkEvidencia) {
            camposFaltantes.push(" - Link de evidencia");
        }
        if (!nombreEspacio) {
            camposFaltantes.push(" - Nombre del espacio");
        }
        if (tipoEspacio === "") {
            camposFaltantes.push(" - Tipo de espacio");
        }
        if (areaTrabajo === "") {
            camposFaltantes.push(" - Área de trabajo");
        }

        // Mostrar una alerta con los campos faltantes
        Swal.fire({
            title: "¡NO HAS DILIGENCIADO TODOS LOS CAMPOS!",
            text: "Te falta por diligenciar los siguientes campos:\n" + camposFaltantes.join('\n'),
            icon: "error",
            confirmButtonText: "Aceptar",
            imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
        });
        return;
    }

    // Validación de datos
    if (isNaN(parseInt(totalAsistentes))) {
        Swal.fire({
            title: "¡Diligiencia bien el total de asistentes!",
            text: "El total de asistentes debe ser un número entero sin decimales.",
            icon: "error",
            confirmButtonText: "Aceptar",
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
        return;
    }

    // Validación de enlace de evidencia
    var enlaceGoogleDrive = linkEvidencia;
    var enlaceGoogleDriveRegex = /^https:\/\/drive\.google\.com\/.*$/;
    if (!enlaceGoogleDriveRegex.test(enlaceGoogleDrive)) {
        Swal.fire({
            title: "¡Error!",
            text: "El enlace de evidencia debe ser un enlace válido de Google Drive.",
            icon: "error",
            confirmButtonText: "Aceptar",
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
        return;
    }

    // Actualizar la información del evento en la base de datos
    var reservasRef = firebase.firestore().collection("reservas");
    var consulta = reservasRef.where("capitulosOrganizadores", "array-contains", capituloUsuario).where("nombreEvento", "==", nombreEspacio);

    consulta.get()
        .then(function(querySnapshot) {
            querySnapshot.forEach(function(doc) {
                doc.ref.update({
                    totalAsistentes: parseInt(totalAsistentes),
                    evidencia: linkEvidencia,
                    tipoEvento: tipoEspacio,
                    areaTrabajo: areaTrabajo
                }).then(function() {
                    Swal.fire({
                      title: "¡Se ha actualizado la información con éxito!",
                      text: "La información del espacio '" + nombreEspacio + "' se ha actualizado correctamente.",
                      icon: "success",
                      confirmButtonText: 'Aceptar',
                      allowOutsideClick: true,
                      backdrop: true,  
                      allowEscapeKey: true,
                      imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png', // URL de la imagen
                      imageWidth: 120, // Ancho de la imagen en píxeles
                      imageHeight: 235, // Alto de la imagen en píxeles
                      imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
                    });
                }).catch(function(error) {
                    console.error("Error al actualizar el espacio:", error);
                    Swal.fire({
                        title: "¡Error!",
                        text: "Ha ocurrido un error al actualizar la información del espacio. Por favor, inténtalo de nuevo o comunícate con el administrador.",
                        icon: "error",
                        confirmButtonText: "Aceptar"
                    });
                });
            });
        })
        .catch(function(error) {
            console.error("Error al obtener el espacio:", error);
            Swal.fire({
                title: "¡Error!",
                text: "Ha ocurrido un error al obtener la información del espacio. Por favor, inténtalo de nuevo o comunícate con el administrador.",
                icon: "error",
                confirmButtonText: "Aceptar"
            });
        });
    }

    function editarInformacionInterna() {
        // Obtener el valor seleccionado del espacio
        console.log("El espacio seleccionado es: " + document.getElementById("nombre-espacio-actualizar").value)
        const espacioSeleccionado = document.getElementById("nombre-espacio-actualizar").value;
        if (!espacioSeleccionado) {
            Swal.fire({
                title: '¡Espacio no seleccionado!',
                text: 'Por favor selecciona un espacio antes de continuar.',
                icon: 'warning',
                confirmButtonText: 'Aceptar'
            });
            return;
        }

        // Obtener información de Firebase
        const reservasRef = firebase.firestore().collection("reservas");
        const fechaInicial = fechaInicialInput.value;
        const fechaFinal = fechaFinalInput.value;

        console.log("La fecha inicial es: " + fechaInicial);
        console.log("La fecha final es: " + fechaFinal);
        console.log("El capítulo del usuario es: " + capituloUsuario);

        const consulta = reservasRef
            .where("capitulosOrganizadores", "array-contains", capituloUsuario)
            .where("fechaEvento", ">=", fechaInicial)
            .where("fechaEvento", "<=", fechaFinal)
            .where("nombreEvento", "==", espacioSeleccionado);

        // Ejecutar consulta
        consulta.get().then((querySnapshot) => {
            if (!querySnapshot.empty) {
                const eventoDoc = querySnapshot.docs[0]; // Selecciona el primer documento
                const eventoData = eventoDoc.data();
                const capitulosExistentes = eventoData.capitulosOrganizadores || [];
                const capitulosRestantes = 4 - capitulosExistentes.length;

                Swal.fire({
                    title: 'Edición de Información',
                    text: '¿Deseas editar información del ponente o añadir un capítulo organizador?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Añadir capítulo',
                    cancelButtonText: 'Cancelar',
                    showDenyButton: true,
                    denyButtonText: 'Editar información del ponente'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Comprobar si ya se ha alcanzado el máximo de capítulos
                        if (capitulosRestantes <= 0) {
                            Swal.fire({
                                title: 'Máximo de capítulos alcanzado',
                                text: 'Este espacio ya tiene 4 capítulos organizadores, que es el límite, por lo que no podrás añadirle alguno adicional.',
                                icon: 'info',
                                confirmButtonText: 'Aceptar'
                            });
                            return;
                        }

                        // Opciones de capítulos
                        const opcionesCapitulos = [
                            "uniguajira", "unimagdalena", "uniatlantico", "uninorte", "unisimon", 
                            "cuc", "librequilla", "utb", "upbmonteria", "unicordoba", 
                            "areandina", "ufps", "unalmed", "udea", "upbmed", 
                            "utp", "unalma", "udistrital", "unalbog", "univalle", 
                            "icesi", "usc", "librecali"
                        ];
                        
                        // Crear la estructura HTML para los desplegables y textos adicionales
                        let seleccionCapitulosHTML = '';
                        for (let i = 0; i < capitulosRestantes; i++) {
                            const numeroCapitulo = capitulosExistentes.length + i + 1;  // Calcula el número correcto del capítulo
                            const etiquetaCapitulo = numeroCapitulo === 2 ? "Segundo capítulo" :
                                                numeroCapitulo === 3 ? "Tercer capítulo" :
                                                "Cuarto capítulo";
                            seleccionCapitulosHTML += `
                                <label for="capituloOpcion${i + 1}"><b>${etiquetaCapitulo}</b></label>
                                <select id="capituloOpcion${i + 1}">
                                    <option value="" disabled selected>Selecciona un capítulo</option>
                                    ${opcionesCapitulos.map(c => `<option value="${c}">${c}</option>`).join('')}
                                </select><br>
                            `;
                        }

                        // Añadir el texto con los capítulos actuales en mayúsculas
                        const capitulosActualesTexto = capitulosExistentes.map(c => c.toUpperCase()).join(", ");
                        seleccionCapitulosHTML += `<p>Estos son los capítulos que actualmente aparecen como organizadores del espacio: ${capitulosActualesTexto}</p>`;

                        // Mostrar el Swal con la estructura personalizada
                        Swal.fire({
                            title: 'Selecciona capítulos adicionales',
                            html: seleccionCapitulosHTML,
                            showCancelButton: true,
                            confirmButtonText: 'Añadir capítulo',
                            cancelButtonText: 'Cancelar',
                            preConfirm: () => {
                                // Obtener las selecciones de capítulos
                                const nuevosCapitulos = [];
                                for (let i = 0; i < capitulosRestantes; i++) {
                                    const capitulo = document.getElementById(`capituloOpcion${i + 1}`).value;
                                    if (capitulo && !capitulosExistentes.includes(capitulo)) {
                                        nuevosCapitulos.push(capitulo);
                                    } else if (capitulo && capitulosExistentes.includes(capitulo)) {
                                        Swal.showValidationMessage(`El capítulo ${capitulo} ya es un organizador.`);
                                        return false;
                                    }
                                }
                                return nuevosCapitulos;
                            }
                        }).then((result) => {
                            if (result.isConfirmed && result.value.length > 0) {
                                // Actualizar el campo "capitulosOrganizadores" en Firebase
                                const nuevosCapitulos = result.value;
                                const actualizacion = {
                                    capitulosOrganizadores: firebase.firestore.FieldValue.arrayUnion(...nuevosCapitulos)
                                };

                                eventoDoc.ref.update(actualizacion).then(() => {
                                    mostrarMensajeActualizarEspacio();
                                }).catch(() => {
                                    mostrarMensajeFallaTecnica();
                                });
                            } else if (result.isConfirmed) {
                                Swal.fire({
                                    title: 'No se seleccionó ningún capítulo',
                                    text: 'No se realizó ninguna actualización porque no seleccionaste ningún capítulo nuevo.',
                                    icon: 'info',
                                    confirmButtonText: 'Aceptar'
                                });
                            }
                        });
                    } else if (result.isDenied) {
                        // Información actual del ponente
                        const nombreActual = eventoData.nombrePonente || '';
                        const emailActual = eventoData.emailPonente || '';
                        const telefonoActual = eventoData.telefonoPonente || '';

                        // Crear el formulario con los campos del ponente en Swal
                        Swal.fire({
                            title: 'Actualizar información del ponente',
                            html: `
                                <label for="nombrePonente">Nombre del ponente:</label>
                                <input type="text" id="nombrePonente" class="swal2-input" placeholder="Nombre del ponente" value="${nombreActual}">

                                <label for="emailPonente">Email del ponente:</label>
                                <input type="text" id="emailPonente" class="swal2-input" placeholder="Email del ponente" value="${emailActual}">

                                <label for="telefonoPonente">Teléfono del ponente:</label>
                                <input type="text" id="telefonoPonente" class="swal2-input" placeholder="Teléfono del ponente" value="${telefonoActual}">
                            `,
                            showCancelButton: true,
                            confirmButtonText: 'Actualizar',
                            cancelButtonText: 'Cancelar',
                            preConfirm: () => {
                                // Obtener los valores de los campos
                                const nombrePonente = document.getElementById("nombrePonente").value.trim();
                                const emailPonente = document.getElementById("emailPonente").value.trim();
                                const telefonoPonente = document.getElementById("telefonoPonente").value.trim();

                                // Validaciones
                                if (!nombrePonente) {
                                    Swal.showValidationMessage("El nombre del ponente es obligatorio.");
                                    return false;
                                }
                                if (!emailPonente && !telefonoPonente) {
                                    Swal.showValidationMessage("Debes diligenciar al menos el email o el teléfono del ponente.");
                                    return false;
                                }
                                if (telefonoPonente && (!/^[3]\d{9}$/.test(telefonoPonente))) {
                                    Swal.showValidationMessage("Debes diligenciar un número de teléfono válido.");
                                    return false;
                                }

                                // Si pasa las validaciones, devolver los datos actualizados
                                return {
                                    nombrePonente,
                                    emailPonente,
                                    telefonoPonente
                                };
                            }
                        }).then((result) => {
                            if (result.isConfirmed) {
                                const { nombrePonente, emailPonente, telefonoPonente } = result.value;

                                // Actualizar los campos en Firebase
                                eventoDoc.ref.update({
                                    nombrePonente,
                                    emailPonente,
                                    telefonoPonente
                                }).then(() => {
                                    mostrarMensajeActualizarEspacio();
                                }).catch(() => {
                                    mostrarMensajeFallaTecnica();
                                });
                            }
                        });
                    }
                });
            } else {
                Swal.fire({
                    title: 'Espacio no encontrado',
                    text: 'No se encontró información para el espacio seleccionado en el rango de fechas especificado.',
                    icon: 'warning',
                    confirmButtonText: 'Aceptar'
                });
            }
        }).catch((error) => {
            console.error("Error al buscar el evento:", error);
            mostrarMensajeFallaTecnica();
        });
    }

    // Función para alternar la visibilidad de la tabla resumen y cambiar el texto del botón
    function toggleTablaResumen() {
      var tabla = document.getElementById("tabla-resumen");
      var boton = document.getElementById("toggleTablaResumen");
      var estado = document.getElementById("tablaResumenEstado");
      if (tabla.style.display === "none") {
        tabla.style.display = "block";
        boton.textContent = "Ocultar tabla resumen";
        estado.style.display = "none";
      } else {
        tabla.style.display = "none";
        boton.textContent = "Mostrar tabla resumen";
        estado.style.display = "block";
      }
    }

    // Función para alternar la visibilidad del dashboard estadístico y cambiar el texto del botón
    function toggleDashboard() {
        var dashboard = document.getElementById("estadisticas-container");
        var boton = document.getElementById("toggleDashboard");
        var estado = document.getElementById("dashboardEstado");
        var porcentajesContainer = document.getElementById("porcentajes-container");
        var satisfaccionContainer = document.getElementById("satisfaccion-container");
        var fechaInicial = document.getElementById("fecha-inicial").value;
        var fechaFinal = document.getElementById("fecha-final").value;

        if (dashboard.style.display === "none") {
            dashboard.style.display = "block";
            boton.textContent = "Ocultar dashboard";
            estado.style.display = "none";
            porcentajesContainer.style.display = "block"; // Mostrar contenedor de porcentajes
            satisfaccionContainer.style.display = "block"; // Mostrar contenedor de satisfacciones
        } else {
            dashboard.style.display = "none";
            boton.textContent = "Mostrar dashboard";
            estado.style.display = "block";
            porcentajesContainer.style.display = "none"; // Ocultar contenedor de porcentajes
            satisfaccionContainer.style.display = "none"; // Ocultar contenedor de satisfacciones
        }
    }

    // Función para generar los gráficos y actualizarlos dentro del acordeón 5
    async function generarGraficos(fechaInicialPDF, fechaFinalPDF) {
        console.log("Empezamos el proceso de graficación de metas y satisfacción");

        try {
            // Obtener datos necesarios para los gráficos desde Firebase
            // Consulta para obtener los eventos del capítulo dentro del rango de fechas
            var fechaInicial = document.getElementById("fecha-inicial").value;
            var fechaFinal = document.getElementById("fecha-final").value;
            var fechaHoy = new Date().toISOString().slice(0, 10);
            var reservasRef = firebase.firestore().collection("reservas");
            var consultaEventos = reservasRef.where("capitulosOrganizadores", "array-contains", capituloUsuario)
                .where("fechaEvento", ">=", fechaInicial)
                .where("fechaEvento", "<=", fechaFinal);

            // Consulta para obtener las metas del capítulo
            var cuentasRef = firebase.firestore().collection("cuentas");
            var consultaMetas = cuentasRef.where("capitulo", "==", capituloUsuario);

            // Variables para almacenar los resultados
            var metaVA = 0; // Meta de Valor Agregado
            var metaEI = 0; // Meta de Entrenamiento Interno
            var totalVA = 0; // Total de Valor Agregado
            var totalEI = 0; // Total de Entrenamiento Interno

            /*
            // Realizar consultas
            var metasSnapshot = await consultaMetas.get();
            metasSnapshot.forEach(doc => {
                metaVA = 3;
                metaEI = 2;
            });
            */

            if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2024-05-31") {
                metaVA = 3;
                metaEI = 2; // 2024 Semestre 1
            } else if (fechaInicialPDF === "2024-08-01" && fechaFinalPDF === "2024-11-30") {
                metaVA = 3;
                metaEI = 2; // 2024 Semestre 2
            } else if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2024-11-30") {
                metaVA = 6;
                metaEI = 4; // 2024 Año Completo (Suma de 2024-1 y 2024-2)
            } else if (fechaInicialPDF === "2025-02-01" && fechaFinalPDF === "2025-05-31") {
                metaVA = 4;
                metaEI = 2; // 2025 Semestre 1
            } else if (fechaInicialPDF === "2025-08-01" && fechaFinalPDF === "2025-11-30") {
                metaVA = 4;
                metaEI = 2; // 2025 Semestre 2
            } else if (fechaInicialPDF === "2025-02-01" && fechaFinalPDF === "2025-11-30") {
                metaVA = 8;
                metaEI = 4; // 2025 Año Completo (Suma de 2025-1 y 2025-2)
            } else if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2025-11-30") {
                metaVA = 14;
                metaEI = 8; // Todos los periodos (Suma de 2024 y 2025)
            } else {
                metaVA = 3;
                metaEI = 2; // Meta por defecto
            }

            console.log(`Metas establecidas -> metaVA: ${metaVA}, metaEI: ${metaEI}`);

            // Calcular meta general
            var metaGeneral = metaVA + metaEI;

            var eventosSnapshot = await consultaEventos.get();

            eventosSnapshot.forEach(doc => {
                var tipoEvento = doc.data().tipoEvento;
                if (tipoEvento === "valor-agregado") {
                    totalVA++;
                } else if (tipoEvento === "entrenamiento-interno") {
                    totalEI++;
                }
            });

            // Calcular total general
            var totalGeneral = totalVA + totalEI;

            // Calcular porcentajes de cumplimiento de metas
            var porcentajeVACumplido = (totalVA / metaVA) * 100;
            var porcentajeEICumplido = (totalEI / metaEI) * 100;
            var porcentajeGeneralCumplido = (totalGeneral / metaGeneral) * 100;

            // Formatear porcentajes
            var porcentajeVAFormateado = porcentajeVACumplido.toFixed(2) + "%";
            var porcentajeEIFormateado = porcentajeEICumplido.toFixed(2) + "%";
            var porcentajeGeneralFormateado = porcentajeGeneralCumplido.toFixed(2) + "%";

            // Obtener el contenedor de los porcentajes
            var porcentajesContainer = document.getElementById("porcentajes-container");

            // Actualizar el contenido con los porcentajes formateados
            porcentajesContainer.innerHTML = "Alcanzado VA: " + porcentajeVAFormateado + " | Alcanzado EI: " + porcentajeEIFormateado + " | Avance formación: " + porcentajeGeneralFormateado;
            var valoresPorcentajes = "Alcanzado VA: " + porcentajeVAFormateado + ", Alcanzado EI: " + porcentajeEIFormateado + ", Avance formación: " + porcentajeGeneralFormateado;
            console.log("El valor de porcentajes es: " + valoresPorcentajes)
            // Llamar función para que el gráfico de metas se actualice
            actualizarGraficoMetas(metaVA, metaEI, totalVA, totalEI, metaGeneral, totalGeneral);

            // Calcular promedios de satisfacción por área de trabajo
            var satisfaccionesPromedio = await calcularPromediosSatisfaccion(consultaEventos);
            console.log("satisfaccionesPromedio: ")
            console.log(satisfaccionesPromedio)

            // Llamar función para que el gráfico de satisfacción se actualice
            actualizarGraficoSatisfaccion(...satisfaccionesPromedio);

            var satisfaccionContainer = document.getElementById("satisfaccion-container");
            satisfaccionContainer.textContent = "Total espacios: " +
            " 💚" + (await consultaEventos.where("areaTrabajo", "==", "academico").get()).size +
            "|🩵" + (await consultaEventos.where("areaTrabajo", "==", "comunicaciones").get()).size +
            "|💛" + (await consultaEventos.where("areaTrabajo", "==", "desarrollo").get()).size +
            "|💜" + (await consultaEventos.where("areaTrabajo", "==", "finanzas").get()).size +
            "|❤️" + (await consultaEventos.where("areaTrabajo", "==", "mercadeo").get()).size +
            "|🧠" + (await consultaEventos.where("areaTrabajo", "==", "habilidades-duras").get()).size +
            "|🫂" + (await consultaEventos.where("areaTrabajo", "==", "habilidades-blandas").get()).size +
            "|💚💙" + (await consultaEventos.where("areaTrabajo", "==", "conocimiento-aneiap").get()).size +
            "|➕" + (await consultaEventos.where("tipoEvento", "==", "valor-agregado").get()).size +
            "|🏋🏻" + (await consultaEventos.where("tipoEvento", "==", "entrenamiento-interno").get()).size +
            "|n/a " + (await consultaEventos.where("tipoEvento", "==", "ninguno").get()).size;
            var valoresSatisfaccion = satisfaccionContainer.textContent

            // Devuelves los valores en un objeto
            return {
                porcentajes: valoresPorcentajes,
                totalSAC: (await consultaEventos.where("areaTrabajo", "==", "academico").get()).size,
                totalSCO: (await consultaEventos.where("areaTrabajo", "==", "comunicaciones").get()).size,
                totalSDE: (await consultaEventos.where("areaTrabajo", "==", "desarrollo").get()).size,
                totalSFI: (await consultaEventos.where("areaTrabajo", "==", "finanzas").get()).size,
                totalSME: (await consultaEventos.where("areaTrabajo", "==", "mercadeo").get()).size,
                totalSHD: (await consultaEventos.where("areaTrabajo", "==", "habilidades-duras").get()).size,
                totalSHB: (await consultaEventos.where("areaTrabajo", "==", "habilidades-blandas").get()).size,
                totalSCA: (await consultaEventos.where("areaTrabajo", "==", "conocimiento-aneiap").get()).size,
                totalSVA: (await consultaEventos.where("tipoEvento", "==", "valor-agregado").get()).size,
                totalSEI: (await consultaEventos.where("tipoEvento", "==", "entrenamiento-interno").get()).size,
                totalSNI: (await consultaEventos.where("tipoEvento", "==", "ninguno").get()).size,
                satisfaccionesPromedio: satisfaccionesPromedio
            };

        } catch (error) {
            console.error("Error al generar gráficos:", error);
        }

    }

    // Función para calcular promedios de satisfacción por área de trabajo
    async function calcularPromediosSatisfaccion(consultaEventos) {
        var consultasSatisfaccion = [
            consultaEventos.where("areaTrabajo", "==", "academico"),
            consultaEventos.where("areaTrabajo", "==", "comunicaciones"),
            consultaEventos.where("areaTrabajo", "==", "desarrollo"),
            consultaEventos.where("areaTrabajo", "==", "finanzas"),
            consultaEventos.where("areaTrabajo", "==", "mercadeo"),
            consultaEventos.where("areaTrabajo", "==", "habilidades-duras"),
            consultaEventos.where("areaTrabajo", "==", "habilidades-blandas"),
            consultaEventos.where("areaTrabajo", "==", "conocimiento-aneiap"),
            consultaEventos.where("tipoEvento", "==", "valor-agregado"),
            consultaEventos.where("tipoEvento", "==", "entrenamiento-interno"),
            consultaEventos.where("tipoEvento", "==", "ninguno")
        ];

        var promesasSatisfaccion = consultasSatisfaccion.map(async consulta => {
            var querySnapshot = await consulta.get();
            var totalSatisfaccion = 0;
            var totalEventos = querySnapshot.size;

            if (totalEventos > 0) {
                querySnapshot.forEach(doc => {
                    totalSatisfaccion += doc.data().satisfaccion;
                });
                console.log(totalSatisfaccion / totalEventos)
                return totalSatisfaccion / totalEventos;
            } else {
                console.log("no hay")
                return 0; // Asignar cero si no hay eventos
            }
        });

        return Promise.all(promesasSatisfaccion);
    }

    // Función para actualizar el gráfico de satisfacción
    function actualizarGraficoSatisfaccion(satisfaccionPromedioAcademico, satisfaccionPromedioComunicaciones, 
        satisfaccionPromedioDesarrollo, satisfaccionPromedioFinanzas, satisfaccionPromedioMercadeo, 
        satisfaccionPromedioHabilidadesDuras, satisfaccionPromedioHabilidadesBlandas, satisfaccionPromedioConocimientoAneiap,
        satisfaccionPromedioValorAgregado, satisfaccionPromedioEntrenamientoInterno, satisfaccionPromedioNinguno) 
    {
      // Datos para el gráfico de satisfacción
      var datosSatisfaccion = {
          labels: ['AC💚', 'CO🩵', 'DE💛', 'FI💜', 'ME❤️', 'HD🧠', 'HB🫂', 'CA💚💙', 'VA➕', 'EI🏋🏻', 'n/a'],
          datasets: [
              {
                  label: 'Satisfacción promedio por área',
                  backgroundColor: '#76c04e', // Verde para áreas
                  borderColor: 'rgba(50, 150, 50, 1)', // Bordes un poco más oscuros
                  pointBackgroundColor: 'rgba(30, 100, 30, 1)', // Puntos más oscuros
                  borderWidth: 2,
                  pointRadius: 5, // Tamaño de los puntos aumentado
                  data: [
                    satisfaccionPromedioAcademico, satisfaccionPromedioComunicaciones, satisfaccionPromedioDesarrollo,
                    satisfaccionPromedioFinanzas, satisfaccionPromedioMercadeo, satisfaccionPromedioHabilidadesDuras,
                    satisfaccionPromedioHabilidadesBlandas, satisfaccionPromedioConocimientoAneiap,
                    satisfaccionPromedioValorAgregado, satisfaccionPromedioEntrenamientoInterno, satisfaccionPromedioNinguno
                  ]
              },
              {
                  label: 'Satisfacción general',
                  borderColor: '#0d62ad', // Azul para promedio general
                  borderWidth: 2,
                  type: 'line',
                  fill: false,
                  data: []
              }
          ]
      };

      // Calcular el promedio general solo con las satisfacciones diferentes de cero
      var satisfacciones = [
        satisfaccionPromedioAcademico, satisfaccionPromedioComunicaciones, satisfaccionPromedioDesarrollo,
        satisfaccionPromedioFinanzas, satisfaccionPromedioMercadeo, satisfaccionPromedioHabilidadesDuras,
        satisfaccionPromedioHabilidadesBlandas, satisfaccionPromedioConocimientoAneiap,
        satisfaccionPromedioValorAgregado, satisfaccionPromedioEntrenamientoInterno, satisfaccionPromedioNinguno
      ];
      satisfacciones = satisfacciones.filter(satisfaccion => satisfaccion !== 0);
      var promedioGeneral = satisfacciones.reduce((total, satisfaccion) => total + satisfaccion, 0) / satisfacciones.length;

      // Llenar los datos de la línea de meta general
      datosSatisfaccion.datasets[1].data = Array(datosSatisfaccion.labels.length).fill(promedioGeneral);

      // Opciones del gráfico de satisfacción
      var opcionesSatisfaccion = {
          scales: {
              yAxes: [{
                  ticks: {
                      beginAtZero: true,
                      fontColor: 'rgba(0, 0, 0, 0.8)', // Color del texto en negrita
                      fontWeight: 'bold' // Texto en negrita
                  }
              }],
              xAxes: [{
                  ticks: {
                      fontColor: 'rgba(0, 0, 0, 0.8)', // Color del texto en negrita
                      fontWeight: 'bold' // Texto en negrita
                  }
              }]
          }
      };

      var ctxSatisfaccion = document.getElementById('grafico-satisfaccion').getContext('2d');
      var graficoSatisfaccion = new Chart(ctxSatisfaccion, {
          type: 'line',
          data: datosSatisfaccion,
          options: opcionesSatisfaccion
      });

        // Actualizar el gráfico
        graficoSatisfaccion.update();
    }

    // Función para actualizar el gráfico de cumplimiento de metas
    function actualizarGraficoMetas(metaVA, metaEI, totalVA, totalEI, metaGeneral, totalGeneral) {
      // Datos para el gráfico de metas
      var datosMetas = {
          labels: ['VALOR AGREGADO', 'ENTRENAMIENTO INTERNO', 'GENERAL'],
          datasets: [
              {
                  label: 'Metas planeadas',
                  backgroundColor: ['#76c04e', '#76c04e', '#76c04e'],
                  borderColor: 'rgba(50, 150, 50, 1)', // Bordes un poco más oscuros
                  borderWidth: 2, // Grosor del borde aumentado
                  data: [metaVA, metaEI, metaGeneral]
              },
              {
                  label: 'Total ejecutado',
                  backgroundColor: ['#0d62ad', '#0d62ad', '#0d62ad'],
                  borderColor: 'rgba(0, 50, 100, 1)', // Bordes un poco más oscuros
                  borderWidth: 2, // Grosor del borde aumentado
                  data: [totalVA, totalEI, totalGeneral]
              }
          ]
      };

      // Opciones del gráfico de metas
      var opcionesMetas = {
          scales: {
              yAxes: [{
                  ticks: {
                      beginAtZero: true
                  }
              }]
          }
      };

      // Renderizar gráfico de metas
      var ctxMetas = document.getElementById('grafico-metas').getContext('2d');
      var graficoMetas = new Chart(ctxMetas, {
          type: 'bar',
          data: datosMetas,
          options: opcionesMetas
      });

      // Actualizar datos del gráfico
      graficoMetas.update();
    }

    // Función para alternar la visibilidad de la tabla de evaluaciones y cambiar el texto del botón
    function toggleEvaluaciones() {
      var tabla = document.getElementById("tabla-evaluaciones");
      var boton = document.getElementById("toggleEvaluaciones");
      var estadoTabla = document.getElementById("estadoTablaEvaluaciones");
      if (tabla.style.display === "none") {
        tabla.style.display = "block";
        boton.textContent = "Ocultar tabla de evaluaciones";
        estadoTabla.style.display = "none"; // Oculta el mensaje de estado
        consultarEvaluaciones();
      } else {
        tabla.style.display = "none";
        boton.textContent = "Mostrar tabla de evaluaciones";
        estadoTabla.style.display = "block"; // Muestra el mensaje de estado
      }
    }

    // Obtener los elementos de fecha inicial y final y agregar eventos change a los campos de fecha
    var fechaInicialEvaluacionesInput = document.getElementById("fecha-inicial-evaluaciones");
    var fechaFinalEvaluacionesInput = document.getElementById("fecha-final-evaluaciones");
    var nombreEspacioSelect = document.getElementById("nombre-espacio-consultar-evaluaciones");
    fechaInicialEvaluacionesInput.addEventListener("change", actualizarNombresEspaciosEvaluaciones);
    fechaFinalEvaluacionesInput.addEventListener("change", actualizarNombresEspaciosEvaluaciones);
    nombreEspacioSelect.addEventListener("change", consultarEvaluaciones);

    // Función para actualizar los nombres de los espacios según las fechas seleccionadas
    function actualizarNombresEspaciosEvaluaciones() {
        // Obtener las fechas seleccionadas
        var fechaInicial = fechaInicialEvaluacionesInput.value;
        var fechaFinal = fechaFinalEvaluacionesInput.value;
        console.log(fechaInicial)
        console.log(fechaFinal)

        // Verificar que ambas fechas estén seleccionadas
        if (fechaInicial && fechaFinal) {
            // Obtener la referencia a la colección de reservas
            var reservasRef = firebase.firestore().collection("reservas");
            // Crear la consulta para obtener los nombres de los espacios dentro del rango de fechas
            var consulta = reservasRef.where("fechaEvento", ">=", fechaInicial)
                                      .where("fechaEvento", "<=", fechaFinal)
                                      .where("capitulosOrganizadores", "array-contains", capituloUsuario);

            // Ejecutar la consulta
            consulta.get()
                .then(function(querySnapshot) {
                    // Array para almacenar los nombres de los espacios
                    var nombresEspacios = [];

                    // Iterar sobre los resultados de la consulta
                    querySnapshot.forEach(function(doc) {
                        // Obtener el nombre del espacio y agregarlo al array
                        nombresEspacios.push(doc.data().nombreEvento);
                    });

                    // Llamar a la función para actualizar el desplegable con los nombres de los espacios obtenidos
                    actualizarDesplegableNombresEspaciosEvaluaciones(nombresEspacios);
                })
                .catch(function(error) {
                    // Manejar errores
                    console.error("Error al obtener nombres de espacios:", error);
                });
        }
    }

    // Función para actualizar el desplegable con los nombres de los espacios
    function actualizarDesplegableNombresEspaciosEvaluaciones(nombresEspacios) {
        // Obtener el desplegable de nombres de espacios
        var nombreEspacioSelect = document.getElementById("nombre-espacio-consultar-evaluaciones");

        // Limpiar opciones anteriores
        nombreEspacioSelect.innerHTML = "";

        // Ordenar los nombres de los espacios alfabéticamente
        nombresEspacios.sort();

        // Si hay nombres de espacios disponibles, agregar cada uno como opción en el desplegable
        if (nombresEspacios.length > 0) {
            nombresEspacios.forEach(function(nombre) {
                var option = document.createElement("option");
                option.text = nombre;
                option.value = nombre;
                nombreEspacioSelect.add(option);
            });
        } else {
            // Si no hay nombres de espacios disponibles, mostrar un mensaje indicando que no se encontraron espacios en el rango de fechas seleccionado
            var option = document.createElement("option");
            option.text = "No hay espacios disponibles en el rango de fechas seleccionado.";
            option.value = "";
            option.disabled = true;
            option.selected = true;
            nombreEspacioSelect.add(option);
        }
    }

    // Función para consultar las evaluaciones del evento seleccionado
    function consultarEvaluaciones() {
    // Obtener el nombre del evento seleccionado
    var nombreEvento = document.getElementById("nombre-espacio-consultar-evaluaciones").value;
    // Obtener las fechas seleccionadas
    var fechaInicial = document.getElementById("fecha-inicial-evaluaciones").value;
    var fechaFinal = document.getElementById("fecha-final-evaluaciones").value;

    // Realizar la consulta a Firebase para obtener las evaluaciones del evento seleccionado
    var reservasRef = firebase.firestore().collection("reservas");
    var consultaEvaluaciones = reservasRef.where("nombreEvento", "==", nombreEvento)
        .where("fechaEvento", ">=", fechaInicial)
        .where("fechaEvento", "<=", fechaFinal)
        .where("capitulosOrganizadores", "array-contains", capituloUsuario);

    consultaEvaluaciones.get().then(function(querySnapshot) {
        var tablaBody = document.getElementById("tabla-evaluaciones").getElementsByTagName("tbody")[0];
        tablaBody.innerHTML = ""; // Limpiar el contenido actual de la tabla

        if (querySnapshot.empty) {
            // Si no hay datos, mostrar mensaje en lugar de la tabla
            var mensaje = document.createElement("tr");
            var mensajeCell = document.createElement("td");
            mensajeCell.setAttribute("colspan", "7"); // Colspan para ocupar todas las columnas
            mensajeCell.textContent = "No hay respuestas en la evaluación de satisfacción en este momento para el evento.";
            mensaje.appendChild(mensajeCell);
            tablaBody.appendChild(mensaje);
            var estadoTabla = document.getElementById("estadoTablaEvaluaciones");
            estadoTabla.style.display = "none"; // Oculta el mensaje de estado
        } else {
            // Si hay datos, construir la tabla
            querySnapshot.forEach(function(doc) {
                var data = doc.data();
                // Dividir las respuestas que están separadas por "|"
                var asistentes = data.asistentes.split("|");
                var correosAsistentes = data.correosAsistentes.split("|");
                var telefonosAsistentes = data.telefonosAsistentes.split("|");
                var respuestas1 = data.respuestas1.split("|");
                var respuestas2 = data.respuestas2.split("|");
                var respuestas3 = data.respuestas3.split("|");
                var comentarios = data.comentarios.split("|");

                // Insertar cada respuesta en una fila de la tabla
                for (var i = 0; i < asistentes.length - 1; i++) {
                    var fila = tablaBody.insertRow();
                    fila.insertCell(0).textContent = asistentes[i];
                    fila.insertCell(1).textContent = correosAsistentes[i];
                    fila.insertCell(2).textContent = telefonosAsistentes[i];
                    fila.insertCell(3).textContent = respuestas1[i];
                    fila.insertCell(4).textContent = respuestas2[i];
                    fila.insertCell(5).textContent = respuestas3[i];
                    fila.insertCell(6).textContent = comentarios[i];
                }
            });
        }
    }).catch(function(error) {
        console.error("Error al consultar las evaluaciones:", error);
    });
}

    // la función que cambia entre la evaluación de espacio y la evaluación de evento
    function alternarEvaluacion() {
      // Decirle al usuario que está en construcción la parte del CRM del evento
      Swal.fire({
            title: '¡𝐂𝐎𝐌𝐈𝐍𝐆 𝐒𝐎𝐎𝐍... 🛠️⚙️🧰!',
            text: 'Esta funcionalidad de SIEA (Evaluar eventos magnos, SCC, nacionales, etc.) por medio del CRM (Antes era un formulario de google) estará disponible 𝐌𝐔𝐘 𝐏𝐑𝐎𝐍𝐓𝐎, por ahora disfruta de la evaluación de espacios capitulares (capacitaciones, integraciones, etc.)',
            icon: 'warning',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/kJ6gs4J/AVATAR-VALIDACIONDATOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
          });
          return; // Detener la edición de la reserva
      // Obtener el contenedor de la evaluación de espacio
      const evaluarEspacio = document.getElementById("evaluar-espacio");
      // Obtener el contenedor de la evaluación de evento
      const evaluarEvento = document.getElementById("evaluar-evento");
      // Obtener el botón de alternar consulta
      const alternarBoton = document.querySelector(".alternarConsulta");

      // Obtener el estilo computado de evaluarEspacio
      const estiloEspacio = window.getComputedStyle(evaluarEspacio);
      // Obtener el estilo computado de evaluarEvento
      const estiloEvento = window.getComputedStyle(evaluarEvento);

      // Verificar el estado actual de los contenedores
      if (estiloEspacio.display === "block") {
          // Si el modo actual es espacio, cambiar a evento
          evaluarEspacio.style.display = "none";
          evaluarEvento.style.display = "block";
          // Cambiar el texto del botón
          alternarBoton.textContent = "Volver a la evaluación de espacios";
          consultarEventosCRM()
      } else {
          // Si el modo actual es evento, cambiar a espacio
          evaluarEspacio.style.display = "block";
          evaluarEvento.style.display = "none";
          // Cambiar el texto del botón
          alternarBoton.textContent = "Click aquí para evaluar el CRM de un evento.";
          consultarEventosCRM()
        }
    }

    // Función para consultar eventos en Firebase y actualizar el desplegable del CRM
    function consultarEventosCRM() {
      // Realizar la consulta a Firebase para obtener los eventos
      var reservasRef = firebase.firestore().collection("reservas");
      var consultaEventos = reservasRef.where("crm", "==", "si");

      // Limpiar las opciones actuales del desplegable
      var selectEvento = document.getElementById("evento-crm");
      selectEvento.innerHTML = '<option value="" disabled selected hidden>Selecciona un evento capitular/nacional</option>';

      // Obtener los nombres de los eventos y agregarlos como opciones al desplegable
      consultaEventos.get().then((querySnapshot) => {
          if (querySnapshot.empty) {
              // Si no se encontraron eventos, agregar una opción indicando que no hay eventos con CRM pendiente
              selectEvento.innerHTML = '<option value="">No hay ningún evento con CRM pendiente</option>';
          } else if (querySnapshot.size === 1) {
              // Si solo hay un evento, asignar automáticamente su valor al campo
              querySnapshot.forEach((doc) => {
                  var nombreEvento = doc.data().nombreEvento;
                  selectEvento.innerHTML = `<option value="${nombreEvento}" selected>${nombreEvento}</option>`;
              });
          } else {
              // Si se encontraron varios eventos, agregar cada evento como una opción en el desplegable
              querySnapshot.forEach((doc) => {
                  var capitulo = doc.data().capitulo.toUpperCase(); // Capítulo en mayúsculas
                  var nombreEvento = doc.data().nombreEvento; // Ajusta este campo según la estructura de tu base de datos
                  var option = document.createElement("option");
                  option.text = capitulo + " || " + nombreEvento;
                  option.value = nombreEvento; // Asignar el valor del nombre del evento como valor de la opción
                  selectEvento.add(option);
              });
          }
      }).catch((error) => {
          console.log("Error obteniendo eventos:", error);
      });
    }
 
    async function desplegarInterfazCRM() {
        // Conectar con la colección de Firebase
        const eventosRef = firebase.firestore().collection("crmeventos");
        const consulta = eventosRef.where("capitulosOrganizadores", "array-contains", capituloUsuario);

        
        // Función para mostrar el swal inicial
        const mostrarInterfazInicial = () => {
            Swal.fire({
            title: "Bienvenido al CRM de Eventos",
            html: `
                <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                <button id="opcionConsultarEditar" style="background-color: #ffcccc; color: black; width: 100%; padding: 10px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer;">Consultar/Editar Información de Eventos</button>
                <button id="opcionRegistrar" style="background-color: #ffd700; color: black; width: 100%; padding: 10px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer;">Registrar Nuevo Evento</button>
                <button id="opcionConsultarRespuestas" style="background-color: #d4edda; color: black; width: 100%; padding: 10px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer;">Consultar Respuestas</button>
                <button id="opcionGenerarInforme" style="background-color: red; color: white; width: 100%; padding: 10px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer;">Generar Informe de Satisfacción de Evento</button>
                </div>
            `,
            showConfirmButton: false,
            didRender: () => {
                document.getElementById("opcionConsultarEditar").addEventListener("click", () => consultarEditarEvento());
                document.getElementById("opcionRegistrar").addEventListener("click", () => registrarNuevoEvento());
                document.getElementById("opcionConsultarRespuestas").addEventListener("click", () => consultarRespuestasEvento());
                document.getElementById("opcionGenerarInforme").addEventListener("click", () => generarInformeCRM());
            },
            });
        };
        
        // Función para consultar y editar un evento
        const consultarEditarEvento = async () => {
            const eventosSnapshot = await consulta.get();
            const eventos = eventosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            if (eventos.length === 0) {
            Swal.fire("Sin eventos", `No se encontraron eventos para el capítulo ${capituloUsuario.toUpperCase()}.`, "info");
            return;
            }

            const opcionesEventos = eventos.map(evento => `
            <option value="${evento.id}">
                ${evento.nombrecrmEvento} | ${evento.clavecrmEvento.slice(-3)}
            </option>`
            ).join("");

            Swal.fire({
            title: `Eventos del capítulo ${capituloUsuario.toUpperCase()}`,
            html: `
                <label for="selectEvento" style="font-size: 14px; font-weight: bold;">Selecciona un evento:</label>
                <select id="selectEvento" style="width: 100%; padding: 8px; border-radius: 4px;">
                ${opcionesEventos}
                </select>
            `,
            showCancelButton: true,
            confirmButtonText: "Editar",
            cancelButtonText: "Cancelar",
            preConfirm: () => {
                const eventoSeleccionadoId = document.getElementById("selectEvento").value;
                return eventos.find(evento => evento.id === eventoSeleccionadoId);
            }
            }).then(resultado => {
            if (resultado.isConfirmed && resultado.value) {
                editarEvento(resultado.value);
            } else {
                mostrarInterfazInicial();
            }
            });
        };

        // Función para editar un evento
        const editarEvento = (evento) => {
            const capitulos = evento.capitulosOrganizadores || [];
            let capitulosHTML = "";

            if (capitulos.length === 1) {
            capitulosHTML = `
                <div style="display: flex; flex-direction: column;">
                <label>Capítulo Organizador:</label>
                <input type="text" value="${capitulos[0]}" disabled style="width: 100%; padding: 8px; border-radius: 4px; background: #f5f5f5;">
                </div>`;
            } else {
            const flexBasis = capitulos.length === 2 ? "48%" : capitulos.length === 3 ? "31%" : "23%";
            capitulosHTML = `
                <div style="display: flex; flex-direction: column;">
                <label>Capítulos Organizadores:</label>
                <div style="display: flex; gap: 10px;">
                    ${capitulos.map(capitulo => `
                    <div style="flex-basis: ${flexBasis};">
                        <input type="text" value="${capitulo}" disabled style="width: 100%; padding: 8px; border-radius: 4px; background: #f5f5f5;">
                    </div>`).join("")}
                </div>
                </div>`;
            }

            Swal.fire({
            title: `Editando evento: ${evento.nombrecrmEvento}`,
            html: `
                <div style="border-bottom: 3px solid green; margin-bottom: 15px;"></div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="coordGeneral1">Coordinador General 1:</label>
                    <input type="text" id="coordGeneral1" value="${evento.coordGeneral1 || ""}" placeholder="Coordinador General 1" style="width: 100%; padding: 8px; border-radius: 4px;">
                    <span id="errorCoordGeneral1" style="color: red; font-size: 12px; display: none;">Este campo es obligatorio.</span>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="coordGeneral2">Coordinador General 2:</label>
                    <input type="text" id="coordGeneral2" value="${evento.coordGeneral2 || ""}" placeholder="Coordinador General 2" style="width: 100%; padding: 8px; border-radius: 4px;">
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="coordMercadeo">Coordinador Mercadeo:</label>
                    <input type="text" id="coordMercadeo" value="${evento.coordMercadeo || ""}" placeholder="Coordinador Mercadeo" style="width: 100%; padding: 8px; border-radius: 4px;">
                    <span id="errorCoordMercadeo" style="color: red; font-size: 12px; display: none;">Este campo es obligatorio.</span>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="telefonoCoordMercadeo">Teléfono del Coordinador:</label>
                    <input type="text" id="telefonoCoordMercadeo" value="${evento.telefonoCoordMercadeo || ""}" placeholder="Teléfono Coordinador" style="width: 100%; padding: 8px; border-radius: 4px;">
                    <span id="errorTelefonoCoordMercadeo" style="color: red; font-size: 12px; display: none;">Debe ser un número válido de 10 dígitos.</span>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="fechaEvento">Fecha del Evento:</label>
                    <input type="date" id="fechaEvento" value="${evento.fechaEvento || ""}" style="width: 100%; padding: 8px; border-radius: 4px;">
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="duracionDias">Duración (días):</label>
                    <input type="number" id="duracionDias" value="${evento.duracionDias || 1}" placeholder="Duración (días)" style="width: 100%; padding: 8px; border-radius: 4px;">
                    <span id="errorDuracionDias" style="color: red; font-size: 12px; display: none;">Este campo es obligatorio y debe ser mayor a 0.</span>
                    </div>
                </div>
                ${capitulosHTML}
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="totalAsistentes">Total de Asistentes:</label>
                    <input type="number" id="totalAsistentes" value="${evento.totalAsistentes || 0}" placeholder="Total Asistentes" style="width: 100%; padding: 8px; border-radius: 4px;">
                    <span id="errorTotalAsistentes" style="color: red; font-size: 12px; display: none;">Debe ser mayor que 0.</span>
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="respuestasObtenidas">Respuestas (#):</label>
                    <input type="number" id="respuestasObtenidas" value="${(evento.datoscrm1?.[4] || 0)}" disabled style="width: 100%; padding: 8px; border-radius: 4px; background: #f5f5f5;">
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="muestraMinima">Muestra Mínima:</label>
                    <input type="text" id="muestraMinima" value="${calcularMuestraMinima(evento.totalAsistentes || 0)}" disabled style="width: 100%; padding: 8px; border-radius: 4px; background: #f5f5f5;">
                    </div>
                    <div style="flex: 1; display: flex; flex-direction: column;">
                    <label for="cumplimientoMuestra">Cumplimiento (%):</label>
                    <input type="text" id="cumplimientoMuestra" value="${calcularCumplimientoMuestra(evento.datoscrm1?.[4] || 0, calcularMuestraMinima(evento.totalAsistentes || 0))}" disabled style="width: 100%; padding: 8px; border-radius: 4px; background: #f5f5f5;">
                    </div>
                </div>
                <div style="display: flex; flex-direction: column;">
                    <label for="nombrecrmEvento">Nombre del Evento:</label>
                    <input type="text" id="nombrecrmEvento" value="${evento.nombrecrmEvento || ""}" placeholder="Nombre del Evento" style="width: 100%; padding: 8px; border-radius: 4px;">
                    <span id="errorNombreEvento" style="color: red; font-size: 12px; display: none;">Este campo es obligatorio.</span>
                </div>
                <div style="display: flex; flex-direction: column;">
                    <label style="margin-top:10px">Comentarios Finales / Conclusión:</label>
                    <textarea id="conclusionComentarios" class="swal2-textarea" placeholder="En esta sección, escribe una conclusion basada en los comentarios dejados en el formulario por los asistentes del evento">${evento.conclusion_comentarios || ''}</textarea>
                    <label style="margin-top:10px">Top 3 Conclusiones:</label>
                    <textarea id="conclusionTop3" class="swal2-textarea" placeholder="En esta sección, destaca y detalla cómo mantendrás las 3 áreas identificadas de mayor fortaleza y mejorarás las 3 areas de mayor debilidad del evento...">${evento.conclusion_top_3 || ''}</textarea>
                </div>
                </div>
                <div style="border-bottom: 3px solid blue; margin-top: 15px; margin-bottom: 15px;"></div>
            `,
            showCancelButton: true,
            confirmButtonText: "Actualizar",
            cancelButtonText: "Cancelar",
            didOpen: () => {
                // Listener para actualizar muestra mínima y cumplimiento dinámicamente
                document.getElementById("totalAsistentes").addEventListener("input", () => {
                // Obtener el nuevo valor de total asistentes
                const nuevosAsistentes = parseInt(document.getElementById("totalAsistentes").value.trim(), 10) || 0;

                // Calcular la nueva muestra mínima
                const nuevaMuestraMinima = calcularMuestraMinima(nuevosAsistentes);

                // Obtener respuestas obtenidas actuales
                const respuestasObtenidas = parseInt(document.getElementById("respuestasObtenidas").value.trim(), 10) || 0;

                // Calcular el nuevo cumplimiento
                const nuevoCumplimiento = calcularCumplimientoMuestra(respuestasObtenidas, nuevaMuestraMinima);

                // Actualizar los valores en la interfaz
                document.getElementById("muestraMinima").value = nuevaMuestraMinima;
                document.getElementById("cumplimientoMuestra").value = `${nuevoCumplimiento}`;
                });
            },
            preConfirm: () => {
                let isValid = true;

                // Validar coordinador general 1
                const coordGeneral1 = document.getElementById("coordGeneral1").value.trim();
                if (!coordGeneral1) {
                document.getElementById("errorCoordGeneral1").style.display = "block";
                isValid = false;
                } else {
                document.getElementById("errorCoordGeneral1").style.display = "none";
                }
                console.log("coordGeneral1: " + coordGeneral1);

                // Validar coordinador general 2
                const coordGeneral2 = document.getElementById("coordGeneral2").value.trim();
                console.log("coordGeneral2: " + coordGeneral2);

                // Validar coordinador de mercadeo
                const coordMercadeo = document.getElementById("coordMercadeo").value.trim();
                if (!coordMercadeo) {
                document.getElementById("errorCoordMercadeo").style.display = "block";
                isValid = false;
                } else {
                document.getElementById("errorCoordMercadeo").style.display = "none";
                }
                console.log("coordMercadeo: " + coordMercadeo);

                // Validar teléfono coordinador de mercadeo
                const telefonoCoordMercadeo = document.getElementById("telefonoCoordMercadeo").value.trim();
                if (!telefonoCoordMercadeo) {
                document.getElementById("errorTelefonoCoordMercadeo").style.display = "block";
                isValid = false;
                } else {
                document.getElementById("errorTelefonoCoordMercadeo").style.display = "none";
                }
                console.log("telefonoCoordMercadeo: " + telefonoCoordMercadeo);

                // Validar duración días
                const duracionDias = parseInt(document.getElementById("duracionDias").value.trim(), 10);
                if (isNaN(duracionDias) || duracionDias <= 0) {
                document.getElementById("errorDuracionDias").style.display = "block";
                isValid = false;
                } else {
                document.getElementById("errorDuracionDias").style.display = "none";
                }
                console.log("duracionDias: " + duracionDias);

                // Validar total asistentes
                const totalAsistentes = parseInt(document.getElementById("totalAsistentes").value.trim(), 10);
                if (isNaN(totalAsistentes) || totalAsistentes <= 0) {
                document.getElementById("errorTotalAsistentes").style.display = "block";
                isValid = false;
                } else {
                document.getElementById("errorTotalAsistentes").style.display = "none";
                }
                console.log("totalAsistentes: " + totalAsistentes);

                // Validar nombre del evento
                const nombreEvento = document.getElementById("nombrecrmEvento").value.trim();
                if (!nombreEvento) {
                document.getElementById("errorNombreEvento").style.display = "block";
                isValid = false;
                } else {
                document.getElementById("errorNombreEvento").style.display = "none";
                }
                console.log("nombreEvento: " + nombreEvento);

                if (!isValid) {
                return false;
                }

                return {
                coordGeneral1,
                coordGeneral2: document.getElementById("coordGeneral2").value.trim(),
                coordMercadeo: document.getElementById("coordMercadeo").value.trim(),
                telefonoCoordMercadeo: document.getElementById("telefonoCoordMercadeo").value.trim(),
                duracionDias,
                totalAsistentes,
                muestraMinima: parseInt(document.getElementById("muestraMinima").value.trim(), 10), // Se asegura que sea un número
                cumplimientoMuestra: parseFloat(document.getElementById("cumplimientoMuestra").value.trim().replace("%", "")), // Convierte a decimal eliminando el símbolo de porcentaje
                nombrecrmEvento: nombreEvento,
                conclusion_comentarios : document.getElementById("conclusionComentarios").value,
                conclusion_top_3: document.getElementById("conclusionTop3").value
                };
            }
            }).then(resultado => {
            if (resultado.isConfirmed) {
                const datos = resultado.value;
                eventosRef.doc(evento.id).update(datos).then(() => {
                Swal.fire("Actualizado", "Los datos del evento se han actualizado correctamente.", "success");
                }).catch(error => {
                Swal.fire("Error", "No se pudo actualizar, consulta con el administrador: " + error.message, "error");
                });
            } else {
                consultarEditarEvento();
            }
            });
        };

        // Función para calcular la muestra mínima
        const calcularMuestraMinima = (totalAsistentes) => {
            if (totalAsistentes <= 0) return 0;
            const z = 1.96; // Nivel de confianza 95%
            const p = 0.5; // Proporción esperada
            const e = 0.05; // Margen de error
            return Math.ceil((Math.pow(z, 2) * p * (1  - p)) / Math.pow(e, 2) / (1 + ((Math.pow(z, 2) * p * (1 - p)) / (Math.pow(e, 2) * totalAsistentes))));
        };

        // Función para calcular el porcentaje de cumplimiento de la muestra
        const calcularCumplimientoMuestra = (respuestasObtenidas, muestraMinima) => {
            if (muestraMinima <= 0) return "0.0%";
            return ((respuestasObtenidas / muestraMinima) * 100).toFixed(1) + "%";
        };

        // Mostrar la interfaz inicial
        mostrarInterfazInicial();

        // Función para consultar respuestas de un evento
        const consultarRespuestasEvento = async () => {
            const eventosSnapshot = await consulta.get();
            const eventos = eventosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            if (eventos.length === 0) {
                Swal.fire("Sin eventos", `No se encontraron eventos para el capítulo ${capituloUsuario.toUpperCase()}.`, "info");
                return;
            }

            const opcionesEventos = eventos.map(evento => `
                <option value="${evento.id}">
                    ${evento.nombrecrmEvento} | ${evento.clavecrmEvento.slice(-3)}
                </option>`
            ).join("");

            Swal.fire({
                title: `Consultar Respuestas - Eventos del capítulo ${capituloUsuario.toUpperCase()}`,
                html: `
                    <label for="selectEvento" style="font-size: 14px; font-weight: bold;">Selecciona un evento:</label>
                    <select id="selectEvento" style="width: 100%; padding: 8px; border-radius: 4px;">
                        ${opcionesEventos}
                    </select>
                `,
                showCancelButton: true,
                confirmButtonText: "Consultar",
                cancelButtonText: "Cancelar",
                preConfirm: () => {
                    const eventoSeleccionadoId = document.getElementById("selectEvento").value;
                    return eventos.find(evento => evento.id === eventoSeleccionadoId);
                }
            }).then(async (resultado) => {
                if (resultado.isConfirmed && resultado.value) {
                    const evento = resultado.value;
                    const respuestas = obtenerRespuestasDeEvento(evento);

                    if (respuestas.length === 0) {
                        Swal.fire({
                            title: "Sin respuestas",
                            text: "Este evento no tiene respuestas aún.",
                            icon: "info",
                            showConfirmButton: true,
                            confirmButtonText: "Volver",
                            confirmButtonColor: "#3085d6",
                            allowOutsideClick: false, // Evita cerrar haciendo clic fuera del modal
                            allowEscapeKey: false, // Evita cerrar con la tecla Escape
                            allowEnterKey: false, // Evita cerrar con Enter
                        }).then((result) => {
                            if (result.isConfirmed) {
                              consultarRespuestasEvento(); // Se ejecuta al hacer clic en "Volver"
                            }
                        });

                        
                    }
                    mostrarTablaRespuestas(respuestas);
                } else if (resultado.isDismissed) { 
                    mostrarInterfazInicial();
                }
            });
        };

        // Función para extraer respuestas del evento
        const obtenerRespuestasDeEvento = (evento) => {
            const nombres = evento.nombrescrmAsistentes?.split("|").filter(nombre => nombre) || [];
            const correos = evento.correoscrmAsistentes?.split("|").filter(correo => correo) || [];
            const telefonos = evento.telefonoscrmAsistentes?.split("|").filter(telefono => telefono) || [];
            const respuestas = Array.from({ length: nombres.length }, (_, i) => ({
                nombre: nombres[i] || "",
                correo: correos[i] || "",
                telefono: telefonos[i] || "",
                r1: evento.respuestascrm1?.split("|")[i] || "",
                r2: evento.respuestascrm2?.split("|")[i] || "",
                r3: evento.respuestascrm3?.split("|")[i] || "",
                r4: evento.respuestascrm4?.split("|")[i] || "",
                r5: evento.respuestascrm5?.split("|")[i] || "",
                r6: evento.respuestascrm6?.split("|")[i] || "",
                r7: evento.respuestascrm7?.split("|")[i] || "",
                r8: evento.respuestascrm8?.split("|")[i] || "",
                r9: evento.respuestascrm9?.split("|")[i] || "",
                r10: evento.respuestascrm10?.split("|")[i] || "",
                r11: evento.respuestascrm11?.split("|")[i] || "",
                r12: evento.respuestascrm12?.split("|")[i] || "",
                r13: evento.respuestascrm13?.split("|")[i] || "",
                r14: evento.respuestascrm14?.split("|")[i] || "",
                comentario: evento.comentarioscrm?.split("|")[i] || ""
            }));
            return respuestas;
        };

        // Función para mostrar la tabla de respuestas
        const mostrarTablaRespuestas = (respuestas) => {
            const tablaHTML = `
                <div style="overflow-x: auto; max-height: 400px;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead style="position: sticky; top: 0; background-color: #f2f2f2; z-index: 1;">
                            <tr>
                                <th style="position: sticky; left: 0; background-color: #f2f2f2; border: 1px solid #ddd; padding: 8px;">NOMBRE</th>
                                <th style="border: 1px solid #ddd; padding: 8px;">CORREO</th>
                                <th style="border: 1px solid #ddd; padding: 8px;">TELÉFONO</th>
                                ${Array.from({ length: 14 }, (_, i) => `<th style="border: 1px solid #ddd; padding: 4px;">R${i + 1}</th>`).join("")}
                                <th style="border: 1px solid #ddd; padding: 8px;">COMENTARIO</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${respuestas.map(respuesta => `
                                <tr>
                                    <td style="position: sticky; left: 0; background-color: #fff; border: 1px solid #ddd; padding: 8px;">${respuesta.nombre}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${respuesta.correo}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${respuesta.telefono}</td>
                                    ${Array.from({ length: 14 }, (_, i) => `<td style="border: 1px solid #ddd; padding: 4px;">${respuesta[`r${i + 1}`]}</td>`).join("")}
                                    <td style="border: 1px solid #ddd; padding: 8px;">${respuesta.comentario}</td>
                                </tr>
                            `).join("")}
                        </tbody>
                    </table>
                </div>
            `;

            Swal.fire({
                title: "Respuestas del Evento",
                html: tablaHTML,
                width: "100%",
                showConfirmButton: true,
                confirmButtonText: "Volver",
            }).then((result) => {
                if (result.isConfirmed) {
                  consultarRespuestasEvento(); // Llamamos a la interfaz anterior al dar clic en "Volver"
                }
            });
        };

        async function registrarNuevoEvento() {

            Swal.fire({
                title: "Crear Nuevo Evento",
                html: `
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div>
                    <label for="nombrecrmEvento">Nombre del Evento:</label>
                    <input type="text" id="nombrecrmEvento" placeholder="Nombre del Evento" style="width: 100%; padding: 8px; border-radius: 4px;">
                    <span id="errorNombreEvento" style="color: red; font-size: 12px; display: none;">Este campo es obligatorio.</span>
                    </div>
                    <div>
                    <label>Capítulos Organizadores:</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        ${[1, 2, 3, 4].map(i => `
                            <div style="flex: 1 1 calc(50% - 10px);">
                                <select id="capitulo${i}" style="width: 100%; padding: 8px; border-radius: 4px;">
                                    <option value="" selected>N/A</option>
                                    ${CAPITULOS.map(capitulo => `<option value="${capitulo.value}">${capitulo.label}</option>`).join("")}
                                </select>
                            </div>
                        `).join("")}
                    </div>
                    <span id="errorCapitulos" style="color: red; font-size: 12px; display: none;">Debe seleccionar al menos un capítulo organizador.</span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label for="coordGeneral1">Coordinador General 1:</label>
                        <input type="text" id="coordGeneral1" placeholder="Coordinador General 1" style="width: 100%; padding: 8px; border-radius: 4px;">
                        <span id="errorCoordGeneral1" style="color: red; font-size: 12px; display: none;">Este campo es obligatorio.</span>
                    </div>
                    <div style="flex: 1;">
                        <label for="coordGeneral2">Coordinador General 2:</label>
                        <input type="text" id="coordGeneral2" placeholder="Coordinador General 2" style="width: 100%; padding: 8px; border-radius: 4px;">
                    </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label for="coordMercadeo">Coordinador Mercadeo:</label>
                        <input type="text" id="coordMercadeo" placeholder="Coordinador de Mercadeo" style="width: 100%; padding: 8px; border-radius: 4px;">
                        <span id="errorCoordMercadeo" style="color: red; font-size: 12px; display: none;">Este campo es obligatorio.</span>
                    </div>
                    <div style="flex: 1;">
                        <label for="telefonoCoordMercadeo">Teléfono del Coordinador:</label>
                        <input type="text" id="telefonoCoordMercadeo" placeholder="Teléfono del Coordinador" style="width: 100%; padding: 8px; border-radius: 4px;">
                        <span id="errorTelefonoCoordMercadeo" style="color: red; font-size: 12px; display: none;">Debe ser un número válido de 10 dígitos y empezar en 3.</span>
                    </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label for="fechaEvento">Fecha del Evento:</label>
                        <input type="date" id="fechaEvento" style="width: 100%; padding: 8px; border-radius: 4px;">
                        <span id="errorFechaEvento" style="color: red; font-size: 12px; display: none;">Este campo es obligatorio.</span>
                    </div>
                    <div style="flex: 1;">
                        <label for="duracionDias">Duración (días):</label>
                        <input type="number" id="duracionDias" placeholder="Duración (días)" style="width: 100%; padding: 8px; border-radius: 4px;">
                        <span id="errorDuracionDias" style="color: red; font-size: 12px; display: none;">Este campo es obligatorio.</span>
                    </div>
                    </div>
                    <div>
                    <label for="crmExtra1">Pregunta Extra CRM #1:</label>
                    <input type="text" id="crmExtra1" placeholder="Pregunta Extra #1 (Opcional)" style="width: 100%; padding: 8px; border-radius: 4px;">
                    </div>
                    <div>
                    <label for="crmExtra2">Pregunta Extra CRM #2:</label>
                    <input type="text" id="crmExtra2" placeholder="Pregunta Extra #2 (Opcional)" style="width: 100%; padding: 8px; border-radius: 4px;">
                    </div>
                    <div>
                    <label for="crmExtra3">Pregunta Extra CRM #3:</label>
                    <input type="text" id="crmExtra3" placeholder="Pregunta Extra #3 (Opcional)" style="width: 100%; padding: 8px; border-radius: 4px;">
                    </div>
                </div>
                `,
                showCancelButton: true,
                confirmButtonText: "Crear Evento",
                cancelButtonText: "Cancelar",
                preConfirm: () => {
                let isValid = true;

                // Validar cada campo obligatorio
                const nombreEvento = document.getElementById("nombrecrmEvento").value.trim();
                if (!nombreEvento) {
                    document.getElementById("errorNombreEvento").style.display = "block";
                    isValid = false;
                } else {
                    document.getElementById("errorNombreEvento").style.display = "none";
                }

                const capitulosOrganizadores = [
                    document.getElementById("capitulo1").value,
                    document.getElementById("capitulo2").value,
                    document.getElementById("capitulo3").value,
                    document.getElementById("capitulo4").value
                ].filter(capitulo => capitulo);

                if (capitulosOrganizadores.length === 0) {
                    document.getElementById("errorCapitulos").style.display = "block";
                    isValid = false;
                } else {
                    document.getElementById("errorCapitulos").style.display = "none";
                }

                const coordGeneral1 = document.getElementById("coordGeneral1").value.trim();
                if (!coordGeneral1) {
                    document.getElementById("errorCoordGeneral1").style.display = "block";
                    isValid = false;
                } else {
                    document.getElementById("errorCoordGeneral1").style.display = "none";
                }

                const coordGeneral2 = document.getElementById("coordGeneral2").value.trim();

                const coordMercadeo = document.getElementById("coordMercadeo").value.trim();
                if (!coordMercadeo) {
                    document.getElementById("errorCoordMercadeo").style.display = "block";
                    isValid = false;
                } else {
                    document.getElementById("errorCoordMercadeo").style.display = "none";
                }

                const telefonoCoordMercadeo = document.getElementById("telefonoCoordMercadeo").value.trim();
                const telefonoRegex = /^3\d{9}$/;
                if (!telefonoRegex.test(telefonoCoordMercadeo)) {
                    document.getElementById("errorTelefonoCoordMercadeo").style.display = "block";
                    isValid = false;
                } else {
                    document.getElementById("errorTelefonoCoordMercadeo").style.display = "none";
                }

                const fechaEvento = document.getElementById("fechaEvento").value.trim();
                if (!fechaEvento) {
                    document.getElementById("errorFechaEvento").style.display = "block";
                    isValid = false;
                } else {
                    document.getElementById("errorFechaEvento").style.display = "none";
                }

                const duracionDias = parseInt(document.getElementById("duracionDias").value.trim(), 10);
                if (isNaN(duracionDias) || duracionDias <= 0) {
                    document.getElementById("errorDuracionDias").style.display = "block";
                    isValid = false;
                } else {
                    document.getElementById("errorDuracionDias").style.display = "none";
                }

                // Obtener y reasignar las preguntas extra en orden
                const preguntasExtra = [
                    document.getElementById("crmExtra1").value.trim(),
                    document.getElementById("crmExtra2").value.trim(),
                    document.getElementById("crmExtra3").value.trim()
                ].filter(pregunta => pregunta); // Filtrar las preguntas no vacías

                if (!isValid) {
                    return false;
                }

                return {
                    nombrecrmEvento: nombreEvento,
                    capitulosOrganizadores,
                    coordGeneral1,
                    coordGeneral2,
                    coordMercadeo,
                    telefonoCoordMercadeo,
                    fechaEvento,
                    duracionDias,
                    crmExtra1: preguntasExtra[0] || "", // Si no existe, será un string vacío
                    crmExtra2: preguntasExtra[1] || "", // Si no existe, será un string vacío
                    crmExtra3: preguntasExtra[2] || ""  // Si no existe, será un string vacío
                };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                const datosEvento = result.value;
                const claveEvento = generarClaveEvento();

                const nuevoEvento = {
                    ...datosEvento,
                    clavecrmEvento: claveEvento,
                    comentarioscrm: "",
                    crm: "si",
                    datoscrm1: [0, 0, 0, 0, 0],
                    datoscrm2: [0, 0, 0, 0, 0],
                    datoscrm3: [0, 0, 0, 0, 0],
                    datoscrm4: [0, 0, 0, 0, 0],
                    datoscrm5: [0, 0, 0, 0, 0],
                    datoscrm6: [0, 0, 0, 0, 0],
                    datoscrm7: [0, 0, 0, 0, 0],
                    datoscrm8: [0, 0, 0, 0, 0],
                    datoscrm9: [0, 0, 0, 0, 0],
                    datoscrm10: [0, 0, 0, 0, 0],
                    datoscrm11: [0, 0, 0, 0, 0],
                    nombrescrmAsistentes: "",
                    correoscrmAsistentes: "",
                    respuestascrm1: "", respuestascrm2: "", respuestascrm3: "", respuestascrm4: "",
                    respuestascrm5: "", respuestascrm6: "", respuestascrm7: "", respuestascrm8: "",
                    respuestascrm9: "", respuestascrm10: "", respuestascrm11: "",
                    telefonoscrmAsistentes: "",
                    ...(datosEvento.crmExtra1 && { datoscrm12: [0, 0, 0, 0, 0], respuestascrm12: "" }),
                    ...(datosEvento.crmExtra2 && { datoscrm13: [0, 0, 0, 0, 0], respuestascrm13: "" }),
                    ...(datosEvento.crmExtra3 && { datoscrm14: [0, 0, 0, 0, 0], respuestascrm14: "" })
                };

                // Conexión a Firestore
                const eventosRef = firebase.firestore().collection("crmeventos");

                eventosRef
                    .doc(claveEvento)
                    .set(nuevoEvento)
                    .then(() => {
                    Swal.fire("Éxito", "El evento se ha creado correctamente.", "success");
                    })
                    .catch((error) => {
                    Swal.fire("Error", "No se pudo crear el evento: " + error.message, "error");
                    });

                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    mostrarInterfazInicial(); // Volver a la interfaz inicial cuando se cancela
                }
            });

            }

        async function generarInformeCRM() { 
          const eventosSnapshot = await consulta.get();
          const eventos = eventosSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      
          if (eventos.length === 0) {
              Swal.fire("Sin eventos", `No se encontraron eventos para el capítulo ${capituloUsuario.toUpperCase()}.`, "info");
              return;
          }
      
          const opcionesEventos = eventos.map(evento => `
              <option value="${evento.id}">${evento.nombrecrmEvento} | ${evento.clavecrmEvento.slice(-3)}</option>`
          ).join("");
      
          Swal.fire({
              title: `Seleccione el evento al cual desea el Informe de Satisfaccion al Evento`,
              html: `
                  <label for="selectEvento" style="font-size: 14px; font-weight: bold;">Selecciona un evento:</label>
                  <select id="selectEvento" style="width: 100%; padding: 8px; border-radius: 4px;">
                      ${opcionesEventos}
                  </select>
              `,
              showCancelButton: true,
              confirmButtonText: "Seleccionar",
              cancelButtonText: "Cancelar",
              preConfirm: () => {
                  const eventoSeleccionadoId = document.getElementById("selectEvento").value;
                  return eventos.find(evento => evento.id === eventoSeleccionadoId);
              }
          }).then(async (resultado) => {
              if (resultado.isConfirmed && resultado.value) {
                  const eventoSeleccionado = resultado.value;
                  const nombreEvento = eventoSeleccionado.nombrecrmEvento;
                  const totalAsistentes = eventoSeleccionado.totalAsistentes 
                  ? eventoSeleccionado.totalAsistentes 
                  : "¡¡ EDITA TOTAL ASISTENTES !!";

      
                  const doc = await eventosRef.doc(eventoSeleccionado.id).get();
      
                  if (doc.exists) {
                      const datosEvento = doc.data();
   
                      // Mostrar alerta de carga al iniciar la generación del informe
                      Swal.fire({
                        title: 'Generando informe...',
                        text: 'Por favor espera, se está generando el informe.',
                        allowOutsideClick: false,  // No permitir clics fuera de la alerta
                        allowEscapeKey: false,     // No permitir la tecla Escape para cerrar
                        allowEnterKey: false,      // No permitir la tecla Enter para aceptar
                        didOpen: () => {
                          // Mostrar indicador de carga
                          Swal.showLoading();
                        }
                      });

                      // 🔹 Filtrar solo las claves de respuestas
                      const respuestas = Object.keys(datosEvento)
                          .filter(key => key.startsWith("respuestascrm"))
                          .reduce((obj, key) => {
                              obj[key] = datosEvento[key];
                              return obj;
                          }, {});
      
                      // 🔹 Filtrar respuestas para excluir los valores que sean 0
                      const cantidadPreguntas = Object.values(respuestas).filter(value => value !== 0).length;
      
                      // 🔹 Analizar respuestas
                      const resultadoAnalisis = analizarRespuestasTotales(respuestas, cantidadPreguntas);
      
                      // 🔹 Crear el PDF
                      var pdf = new jsPDF();
                      var margenizq = 15;
                      var margender = 180;
                      var y = 35;
      
                      // 🔹 Portada del informe
                      var fondo_portada_informe_crm = new Image();
                      fondo_portada_informe_crm.src = 'https://raw.githubusercontent.com/AlessVilla/SIEA/master/public/fondo_portada_informe_crm.png';
                      pdf.addImage(fondo_portada_informe_crm, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
      
                      // Insertar datos generales del evento en la portada
                      // 🔹 Ajuste del ancho máximo permitido para el texto en la portada
                      const maxWidthPortada = pdf.internal.pageSize.getWidth() - 70; // Margen de 20px a cada lado

                      // 🔹 Obtener y formatear los capítulos organizadores en mayúsculas
                      let capitulos = datosEvento.capitulosOrganizadores
                          .map(capitulo => capitulo.toUpperCase()) // Convertir cada capítulo a mayúsculas
                          .join(" | "); // Unirlos con " | "

                      // 🔹 Obtener y formatear el nombre del evento
                      let nombreEvento = datosEvento.nombrecrmEvento || "NOMBRE DEL EVENTO NO DISPONIBLE";
                      let nombreEventoDividido = pdf.splitTextToSize(`Evento: ${nombreEvento}`, maxWidthPortada);

                      // 🔹 Obtener la fecha de inicio y calcular el intervalo si dura más de un día
                      // 🔹 Obtener la fecha de inicio y calcular el intervalo si dura más de un día
                      let fechaInicio = datosEvento.fechaEvento ? new Date(datosEvento.fechaEvento) : null;
                      let duracionDias = datosEvento.duracionDias || 1; // Si no está definido, asumimos 1 día

                      let fechaInicioFormateada = "NO DISPONIBLE";
                      let fechaFinFormateada = "";

                      if (fechaInicio) {
                          // Formatear la fecha de inicio
                          // 🔹 Corregir la fecha sumando 1 día
                          fechaInicio.setDate(fechaInicio.getDate() + 1);

                          fechaInicioFormateada = fechaInicio.toLocaleDateString("es-ES", {
                              day: "2-digit",
                              month: "long",
                              year: "numeric"
                          }).replace(/\b\w/g, l => l.toUpperCase()); // Convertir la primera letra del mes a mayúscula

                          // Si el evento dura más de 1 día, calcular la fecha final
                          if (duracionDias > 1) {
                              let fechaFin = new Date(fechaInicio);
                              fechaFin.setDate(fechaFin.getDate() + (duracionDias - 1)); // Sumar días restantes

                              fechaFinFormateada = fechaFin.toLocaleDateString("es-ES", {
                                  day: "2-digit",
                                  month: "long",
                                  year: "numeric"
                              }).replace(/\b\w/g, l => l.toUpperCase());
                          }
                      }

                      // 🔹 Ajustar coordenadas para alineación adecuada
                      let xCentro = pdf.internal.pageSize.getWidth() / 2; // Centrar en la página
                      let yInicio = 180; // Posición base para evitar solapamientos con la imagen de fondo

                      // 🔹 Insertar Capítulos Organizadores
                      pdf.setFontSize(20);
                      pdf.setFont(undefined, "bold");
                      pdf.text("Capítulos organizadores:", xCentro, yInicio, { align: "center" });
                      yInicio += 10;
                      pdf.setFontSize(20);
                      pdf.text(capitulos, xCentro, yInicio, { align: "center" });
                      yInicio += 25; // Espaciado antes del nombre del evento

                      // 🔹 Insertar Nombre del Evento con manejo de textos largos
                      pdf.setFontSize(20);
                      pdf.setFont(undefined, "bold");
                      nombreEventoDividido.forEach((linea, index) => {
                          pdf.text(linea, xCentro, yInicio + (index * 10), { align: "center" });
                      });
                      yInicio += nombreEventoDividido.length > 1 ? 40 : 30; // Ajustar espacio si el título tiene más de una línea
                      // 🔹 Concatenar "Fecha: [Fecha Inicio]"
                      let textoFechaCompleto = `Fecha: ${fechaInicioFormateada}`;
                      let anchoTextoFecha = pdf.getTextWidth(textoFechaCompleto);
                      let xCentroFecha = (pdf.internal.pageSize.getWidth() - anchoTextoFecha) / 2;

                      // 🔹 Insertar "Fecha: [Fecha Inicio]" centrado
                      pdf.setFontSize(20);
                      pdf.setFont(undefined, "bold");
                      pdf.text(textoFechaCompleto, xCentroFecha, yInicio);

                      // 🔹 Si hay fecha final, agregar "a [Fecha Fin]" en la siguiente línea
                      if (fechaFinFormateada) {
                          let textoFechaFin = `a ${fechaFinFormateada}`;
                          let anchoTextoFechaFin = pdf.getTextWidth(textoFechaFin);
                          let xCentroFechaFin = (pdf.internal.pageSize.getWidth() - anchoTextoFechaFin) / 2;

                          yInicio += 10;
                          pdf.setFont(undefined, "bold");
                          pdf.text(textoFechaFin, xCentroFechaFin, yInicio);
                      }

                      pdf.setFontSize(12);


                      // Información del evento

                      pdf.addPage();
                      var img_fondo_crm = new Image();
                      img_fondo_crm.src = 'https://raw.githubusercontent.com/AlessVilla/SIEA/master/public/fondo_informe_crm.png';
                      pdf.addImage(img_fondo_crm, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
      
                      // 🔹 Datos sobre la encuesta
                      const respuestasObtenidas = eventoSeleccionado.respuestascrm1 
                      ? (eventoSeleccionado.respuestascrm1.match(/\|/g) || []).length 
                      : 0;

                      var muestraMinima = calcularMuestraMinima(totalAsistentes);
                      var cumplimiento_logrado = parseFloat(calcularCumplimientoMuestra(respuestasObtenidas, muestraMinima));
      
                      var confiabilidad = cumplimiento_logrado >= 100
                          ? "este informe se puede considerar que es de confianza ya que se cumple con la muestra mínima necesaria."
                          : "este informe puede tener limitaciones en su confiabilidad, ya que la muestra utilizada parece no haber alcanzado la muestra mínima necesaria para garantizar resultados plenamente representativos.";
      
                      // 🔹 Título
                      // Ajuste del ancho máximo permitido para el título
                      const maxWidthTitulo = pdf.internal.pageSize.getWidth() - 80; // Margen de 20px a cada lado

                      // Construcción del título del informe
                      let tituloInforme = `INFORME DE SATISFACCIÓN ${nombreEvento}`;

                      // Dividir el título en caso de ser muy largo
                      let tituloDividido = pdf.splitTextToSize(tituloInforme, maxWidthTitulo);

                      // Insertar el título, centrado
                      pdf.setFontSize(18);
                      tituloDividido.forEach((linea, index) => {
                          pdf.text(linea, pdf.internal.pageSize.getWidth() / 2, 20 + (index * 10), { align: "center" });
                      });

                      // Ajustar `y` dependiendo de cuántas líneas ocupó el título
                      y = 20 + (tituloDividido.length * 10) + 10;
      
                      // 🔹 Introducción
                      pdf.setFontSize(12);
                      const textoIntroduccion = `Las encuestas de satisfacción nos dan a conocer qué tan buen servicio se está prestando al ente externo, resaltando fortalezas y debilidades en la organización de eventos. Este informe busca mejorar los aspectos débiles y mantener los puntos fuertes. La encuesta fue resuelta por ${respuestasObtenidas} personas de ${totalAsistentes} asistentes. Por lo cual, ${confiabilidad} Adicionalmente, la encuesta consistió en ${cantidadPreguntas} preguntas de valoración numérica. NPS = %Promotores - %Detractores`;
                      let telefonoCRM = datosEvento.telefonoCoordMercadeo || "Teléfono no detectado";


                      const textoDividido = pdf.splitTextToSize(textoIntroduccion, margender);
                        textoDividido.forEach(linea => {
                            pdf.text(linea, margenizq, y);
                            y += 7;
                        });
                        y += 10;
                      
                      const preguntas_estandar_CRM = [ 
                        "Recientemente estuvo en un evento organizado por ANEIAP. Del 1 al 10, ¿Qué tan probable es que recomiende los eventos ANEIAP a otras personas?",
                        "Del 1 al 10, ¿Qué tan adecuados considera que fueron las instalaciones del evento?",
                        "Del 1 al 10, ¿Cómo calificaría la puntualidad en el desarrollo de las actividades?",
                        "Del 1 al 10, ¿Cómo calificaría su paso por la mesa de acreditación?",
                        "Del 1 al 10, ¿Cómo calificaría la apertura del evento?",
                        "Del 1 al 10, ¿Cómo calificaría el trabajo logístico del comité organizador?",
                        "Del 1 al 10, ¿Cómo calificaría la atención por parte del comité organizador?",
                        "Del 1 al 10, ¿Cómo calificaría la agenda del evento?",
                        "Del 1 al 10, ¿Cómo calificarías al/los conferencista(s)?",
                        "Del 1 al 10, ¿Cómo calificaría la o las temáticas del evento?",
                        "Del 1 al 10, ¿Qué tan adecuada considera que fue la publicidad del evento?"
                      ];

                      const item_pregunta_CRM = [
                          "LA PROBABILIDAD DE QUE LAS PERSONAS RECOMIENDEN ASISTIR A EVENTOS DE ANEIAP ",
                          "LAS INSTALACIONES UTILIZADAS EN EL TRANSCURSO DEL EVENTO ",
                          "LA PUNTUALIDAD EN EL DESARROLLO DE LAS ACTIVIDADES ",
                          "EL PASO POR LA MESA DE ACREDITACIÓN ",
                          "LA APERTURA DEL EVENTO ",
                          "EL TRABAJO LOGÍSTICO DEL COMITÉ ORGANIZADOR ",
                          "LA ATENCIÓN POR PARTE DEL COMITÉ ORGANIZADOR ",
                          "LA AGENDA DEL EVENTO ",
                          "LA ELECCIÓN DE CONFERENCISTAS ",
                          "LA TEMÁTICA DEL EVENTO ",
                          "LA PUBLICIDAD DEL EVENTO " 
                      ];

                      let npsResultados = [];
                      const pageWidth = pdf.internal.pageSize.getWidth();
                      const imgHeight = 60;
                      pageHeight = pdf.internal.pageSize.getHeight()
                      let tablaRespuestas = [];
                      for (let i = 1; i <= cantidadPreguntas; i++) {
                        const key = `respuestascrm${i}`;
                        if (!respuestas[key] || respuestas[key].trim() === "") {
                          continue; // saltar si no hay ese campo o está vacío
                        }
                        var valores = respuestas[key].split("|").map(Number).filter(n => !isNaN(n));
                        if (valores.length > 0) {
                          // Se guarda en la posición normal “i-1”
                          tablaRespuestas.push(valores);
                        }
                      }

                      //Primera grafica/pregunta
                        i = 1;
                        // Calcular datos NPS
                        var fila_i = tablaRespuestas[i - 1].slice().filter(num => num !== 0);
                        
                        //Analizar que Ocurre en estas siguientes 8 lineas
                        var total = fila_i.length;
                         // Salta la pregunta sin respuestas válidas
                        var detractores = fila_i.filter(r => r >= 1 && r <= 6).length;
                        var pasivos = fila_i.filter(r => r >= 7 && r <= 8).length;
                        var promotores = fila_i.filter(r => r >= 9 && r <= 10).length;
                        var porcentaje_Promotores = Number(((promotores / total) * 100).toFixed(2));
                        var porcentaje_Pasivos    = Number(((pasivos / total) * 100).toFixed(2));
                        var porcentaje_Detractores= Number(((detractores / total) * 100).toFixed(2));
                        //var total = fila_i.length;
                        var nps = ((promotores - detractores) / total * 100).toFixed(2);

                        // Agregar título de la pregunta centrado
                        let questionTitle = "";
                        // Si i está entre 1 y 11 (equivalente a preguntas 1-11), usar la lista preguntas_estandar_CRM
                        if (i <= 11) {
                            questionTitle = `${i}. ${preguntas_estandar_CRM[i-1]}`;
                        } 
                        // Si i es 12 (Pregunta 12), tomar crmExtra1
                        else if (i === 12) {
                            questionTitle = `12. ${datosEvento.crmExtra1 || "Pregunta adicional 1"}`;
                        } 
                        // Si i es 13 (Pregunta 13), tomar crmExtra2
                        else if (i === 13) {
                            questionTitle = `13. ${datosEvento.crmExtra2 || "Pregunta adicional 2"}`;
                        } 
                        // Si i es 14 (Pregunta 14), tomar crmExtra3
                        else if (i === 14) {
                            questionTitle = `14. ${datosEvento.crmExtra3 || "Pregunta adicional 3"}`;
                        }

                        pdf.setFontSize(12);
                        const maxWidth = margender - margenizq;
                        const lines = pdf.splitTextToSize(questionTitle, maxWidth);
                        lines.forEach(line => {
                          pdf.text(line, margenizq, y);
                          y += 7;
                        });
                        
                        // **Crear un gráfico de pastel dinámico**
                        const canvas = document.createElement("canvas");
                        canvas.width = 300;
                        canvas.height = 300;
                        document.body.appendChild(canvas);

                        const ctx = canvas.getContext("2d");
                        new Chart(ctx, {
                            type: "pie",
                            data: {
                                labels: ["Promotores", "Pasivos", "Detractores"],
                                datasets: [{
                                    data: [
                                      porcentaje_Promotores,
                                      porcentaje_Pasivos,
                                      porcentaje_Detractores,
                                    ],
                                    backgroundColor: ["#4CAF50", "#FFC107", "#F44336"]
                                }]
                            },
                            options: {
                              responsive: false,
                              animation: {
                                // Desactivar animaciones reduce redondeos intermedios
                                animateRotate: false,
                                animateScale: false
                              },
                                plugins: {
                                    legend: { position: "bottom" }
                                }
                            }
                        });

                        // **Convertir la gráfica en imagen y agregarla al PDF**
                        await new Promise(resolve => {
                            setTimeout(() => {
                                html2canvas(canvas).then(canvasImage => {
                                    const imageData = canvasImage.toDataURL("image/png");
                                    const imgWidth = 60; // Ancho de la imagen en el PDF
                                    const minSpaceNeeded = imgHeight + 50;

                                    if (y + minSpaceNeeded > pageHeight  - 30) { 
                                      pdf.addPage();
                                      pdf.addImage(img_fondo_crm, "PNG", 0, 0, pageWidth, pageHeight);
                                      y = 40; // Reiniciar posición en la nueva página
                                    } 

                                    const xPosImg = (pageWidth - imgWidth) / 2; // Cálculo para centrar
                                    pdf.addImage(imageData, "PNG", xPosImg, y, imgWidth, imgWidth);

                                    document.body.removeChild(canvas); // Eliminar la imagen del DOM
                                    y += 70; // Agregar espacio después de la imagen
                                    resolve();
                                });
                            }, 500); // Esperar para permitir la renderización de Chart.js
                        });

                        // Agregar texto de análisis centrado
                        pdf.setFontSize(12);
                        pdf.text(`Promotores: ${promotores} de ${total} (${porcentaje_Promotores}%)`, pageWidth / 2, y, { align: "center" });
                        pdf.text(`Pasivos: ${pasivos} de ${total} (${porcentaje_Pasivos}%)`, pageWidth / 2, y + 7, { align: "center" });
                        pdf.text(`Detractores: ${detractores} de ${total} (${porcentaje_Detractores}%)`, pageWidth / 2, y + 14, { align: "center" });
                        //pdf.text(`NPS = %Promotores - %Detractores`, pageWidth / 2, y + 21, { align: "center" });
                        pdf.text(`NPS = ${((promotores / total) * 100).toFixed(2)}% - ${((detractores / total) * 100).toFixed(2)}% = ${nps}%`, pageWidth / 2, y + 28, { align: "center" });

                        // Conclusión basada en el NPS
                        let conclusion = "";
                        let itemTexto = item_pregunta_CRM[i - 1] ? item_pregunta_CRM[i - 1] : " "; // Evita undefined

                        if (nps >= 80) {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "FUE EXCELENTE.";
                        } else if (nps >= 50) {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "FUE BUENO, PERO AÚN SE PUEDE MEJORAR.";
                        } else if (nps >= 0) {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "FUE DE NIVEL MODERADO, POR LO QUE SE RECOMIENDA REVISAR POSIBLES MEJORAS.";
                        } else if (nps >= -50) {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "FUE DE NIVEL BAJO, POR LO CUAL, ES UN ASPECTO QUE SE REQUIERE MEJORAR URGENTEMENTE.";
                        } else {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "ESTÁ EN UN NIVEL CRÍTICO, LO CUAL INDICA QUE ES UN ÁREA DE GRAN PREOCUPACIÓN Y NECESITA UNA REVISIÓN INMEDIATA.";
                        }

                        y += 40;
                        const conclusionText = pdf.splitTextToSize(`AL ESTAR EN ${nps}% ${conclusion}`, 180);

                        
                        pdf.setFontSize(10);
                        pdf.setFont(undefined, 'bold');
                        pdf.text(conclusionText, pdf.internal.pageSize.getWidth() / 2, y, { align: "center" });
                        pdf.setFont(undefined, 'normal');
        
                        y += 20;
                        let itemEvaluado = (i <= 11) 
                          ? item_pregunta_CRM[i - 1].toUpperCase() // Ítems estándar en mayúsculas
                          : (i === 12) ? (datosEvento.crmExtra1 ? datosEvento.crmExtra1.toUpperCase() : "PREGUNTA ADICIONAL 1") 
                          : (i === 13) ? (datosEvento.crmExtra2 ? datosEvento.crmExtra2.toUpperCase() : "PREGUNTA ADICIONAL 2")
                          : (i === 14) ? (datosEvento.crmExtra3 ? datosEvento.crmExtra3.toUpperCase() : "PREGUNTA ADICIONAL 3")
                          : "PREGUNTA DESCONOCIDA"; // En caso de que haya más preguntas extras en el futuro

                        // Guardar los resultados en la lista para posterior análisis
                        
                        npsResultados.push({ indice: i, item: itemEvaluado, nps: parseFloat(nps) });


        // |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
        // |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
        // |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
                  
                      //Segunda grafica en adelante
                      for (let i = 2; i <= cantidadPreguntas /*- 1*/; i++) {

                        // **Añadir nueva página al inicio**
                        if ((i - 2) % 2 === 0) {  // Se añade una nueva página cada 2 preguntas
                            pdf.addPage();

                            console.log("i donde se añade página: " + i)
                            pdf.addImage(img_fondo_crm, "PNG", 0, 0, pageWidth, pageHeight);
                            y = 20;  // Reiniciar la posición Y en la nueva página
            
                        }

    // 📌 Asegurar que se inserta el teléfono CRM en todas las páginas excepto la primera
    pdf.setFont(undefined, "normal");
    let currentPage = pdf.internal.getNumberOfPages(); // Obtener la página actual
    pdf.setPage(currentPage);
    
    // 📌 Asegurar que el color del texto es visible
    pdf.setTextColor("#E4E4E4"); // Blanco agrisado para mejor visibilidad
    pdf.setFontSize(11);

    // 📌 Insertar el teléfono en una posición más abajo para evitar solapamiento
    let xTelefono = 98.5;
    let yTelefono = 291.5; // Intentar 290 en vez de 301.5 para ver si estaba solapado
    console.log(`Insertando teléfono CRM en página ${currentPage}: ${telefonoCRM}`);
    pdf.text(telefonoCRM, xTelefono, yTelefono); 

    // 📌 Restaurar color del texto a negro después de escribir el teléfono
    pdf.setTextColor(0, 0, 0);
    pdf.setFontSize(12);

                        // Calcular datos NPS
                        if (!tablaRespuestas[i - 1]) {
                          continue; // o break, según prefieras
                        }
                        var fila_i = tablaRespuestas[i-1].filter(num => num !== 0);
                        console.log(fila_i + " esta es la fila "+ i);
                        if (!fila_i.length) {
                          continue;
                        }
                        var detractores = fila_i.filter(r => r >= 1 && r <= 6).length;
                        var pasivos = fila_i.filter(r => r >= 7 && r <= 8).length;
                        var promotores = fila_i.filter(r => r >= 9 && r <= 10).length;
                        var porcentaje_Promotores = Number(((promotores / total) * 100).toFixed(2));
                        var porcentaje_Pasivos    = Number(((pasivos / total) * 100).toFixed(2));
                        var porcentaje_Detractores= Number(((detractores / total) * 100).toFixed(2));
                        var total = fila_i.length;
                        if (total === 0) continue;
                        var nps = ((promotores - detractores) / total * 100).toFixed(2);

                        // Agregar título de la pregunta centrado
                        let questionTitle = "";
                        // Si i está entre 1 y 11 (equivalente a preguntas 1-11), usar la lista preguntas_estandar_CRM
                        if (i <= 11) {
                            questionTitle = `${i}. ${preguntas_estandar_CRM[i-1]}`;
                        } 
                        // Si i es 12 (Pregunta 12), tomar crmExtra1
                        else if (i === 12) {
                            questionTitle = `12. ${datosEvento.crmExtra1 || "Pregunta adicional 1"}`;
                        } 
                        // Si i es 13 (Pregunta 13), tomar crmExtra2
                        else if (i === 13) {
                            questionTitle = `13. ${datosEvento.crmExtra2 || "Pregunta adicional 2"}`;
                        } 
                        // Si i es 14 (Pregunta 14), tomar crmExtra3
                        else if (i === 14) {
                            questionTitle = `14. ${datosEvento.crmExtra3 || "Pregunta adicional 3"}`;
                        }

                        pdf.setFontSize(12);
                        const maxWidth = margender - margenizq;
                        const lines = pdf.splitTextToSize(questionTitle, maxWidth);
                        lines.forEach(line => {
                          pdf.text(line, margenizq, y);
                          y += 7;
                        });
                        
                        // **Crear un gráfico de pastel dinámico**
                        const canvas = document.createElement("canvas");
                        canvas.width = 250;
                        canvas.height = 250;
                        document.body.appendChild(canvas);

                        const ctx = canvas.getContext("2d");
                        new Chart(ctx, {
                            type: "pie",
                            data: {
                                labels: ["Promotores", "Pasivos", "Detractores"],
                                datasets: [{
                                    data: [
                                      porcentaje_Promotores,
                                      porcentaje_Pasivos,
                                      porcentaje_Detractores,
                                    ],
                                    backgroundColor: ["#4CAF50", "#FFC107", "#F44336"]
                                }]
                            },
                            options: {
                              responsive: false,
                              animation: {
                                // Desactivar animaciones reduce redondeos intermedios
                                animateRotate: false,
                                animateScale: false
                              },
                                plugins: {
                                    legend: { position: "bottom" }
                                }
                            }
                        });

                        // **Convertir la gráfica en imagen y agregarla al PDF**
                        await new Promise(resolve => {
                            setTimeout(() => {
                                html2canvas(canvas).then(canvasImage => {
                                    const imageData = canvasImage.toDataURL("image/png");
                                    const imgWidth = 50; // Ancho de la imagen en el PDF
                                    const minSpaceNeeded = imgHeight + 50;

                                    if (y + minSpaceNeeded > pageHeight  - 30) { 
                                      pdf.addPage();
                                      pdf.addImage(img_fondo_crm, "PNG", 0, 0, pageWidth, pageHeight);
                                      y = 40; // Reiniciar posición en la nueva página
                                    } 

                                    const xPosImg = (pageWidth - imgWidth) / 2; // Cálculo para centrar
                                    pdf.addImage(imageData, "PNG", xPosImg, y, imgWidth, imgWidth);

                                    document.body.removeChild(canvas); // Eliminar la imagen del DOM
                                    y += 70; // Agregar espacio después de la imagen
                                    resolve();
                                });
                            }, 500); // Esperar para permitir la renderización de Chart.js
                        });


                        pdf.text(`Promotores: ${promotores} de ${total} (${porcentaje_Promotores}%)`, pageWidth / 2, y, { align: "center" });
                        pdf.text(`Pasivos: ${pasivos} de ${total} (${porcentaje_Pasivos}%)`, pageWidth / 2, y + 7, { align: "center" });
                        pdf.text(`Detractores: ${detractores} de ${total} (${porcentaje_Detractores}%)`, pageWidth / 2, y + 14, { align: "center" });
                        //pdf.text(`NPS = %Promotores - %Detractores`, pageWidth / 2, y + 21, { align: "center" });
                        pdf.text(`NPS = ${((promotores / total) * 100).toFixed(2)}% - ${((detractores / total) * 100).toFixed(2)}% = ${nps}%`, pageWidth / 2, y + 21, { align: "center" });
        
                        // Conclusión basada en el NPS
                        let conclusion = "";
                        let itemTexto = item_pregunta_CRM[i - 1] ? item_pregunta_CRM[i - 1] : " "; // Evita undefined

                        if (nps >= 80) {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "FUE EXCELENTE.";
                        } else if (nps >= 50) {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "FUE BUENO, PERO AÚN SE PUEDE MEJORAR.";
                        } else if (nps >= 0) {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "FUE DE NIVEL MODERADO, POR LO QUE SE RECOMIENDA REVISAR POSIBLES MEJORAS.";
                        } else if (nps >= -50) {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "FUE DE NIVEL BAJO, POR LO CUAL, ES UN ASPECTO QUE SE REQUIERE MEJORAR URGENTEMENTE.";
                        } else {
                            conclusion = "SE CONSIDERA QUE " + itemTexto + "ESTÁ EN UN NIVEL CRÍTICO, LO CUAL INDICA QUE ES UN ÁREA DE GRAN PREOCUPACIÓN Y NECESITA UNA REVISIÓN INMEDIATA.";
                        }
        
                        y += 35;
                        const conclusionText = pdf.splitTextToSize(`AL ESTAR EN ${nps}% ${conclusion}`, 180);
                        pdf.setFontSize(10);
                        pdf.setFont(undefined, 'bold');
                        pdf.text(conclusionText, pdf.internal.pageSize.getWidth() / 2, y, { align: "center" });
                        pdf.setFont(undefined, 'normal');

                        y += 15;
                        let itemEvaluado = (i <= 11) 
                          ? item_pregunta_CRM[i - 1].toUpperCase() // Ítems estándar en mayúsculas
                          : (i === 12) ? (datosEvento.crmExtra1 ? datosEvento.crmExtra1.toUpperCase() : "PREGUNTA ADICIONAL 1") 
                          : (i === 13) ? (datosEvento.crmExtra2 ? datosEvento.crmExtra2.toUpperCase() : "PREGUNTA ADICIONAL 2")
                          : (i === 14) ? (datosEvento.crmExtra3 ? datosEvento.crmExtra3.toUpperCase() : "PREGUNTA ADICIONAL 3")
                          : "PREGUNTA DESCONOCIDA"; // En caso de que haya más preguntas extras en el futuro

                        // Guardar los resultados en la lista para posterior análisis
                        npsResultados.push({ indice: i, item: itemEvaluado, nps: parseFloat(nps) });
                    }
                      npsResultados.sort((a, b) => b.nps - a.nps);

                      const top3 = npsResultados.slice(0, 3); // 3 mejores NPS
                      const bottom3 = npsResultados.slice(-3); // 3 peores NPS
                      const conclusion_comentarios = datosEvento.conclusion_comentarios || "";
                      const conclusion_top_3 = datosEvento.conclusion_top_3 || "";
                      let conclusionFinal = "";

                      if (conclusion_comentarios?.trim() && conclusion_top_3?.trim()) {
                        conclusionFinal = `Conclusión general y de comentarios del informe:\n\n${conclusion_comentarios}\n\n` +
                      `Adicionalmente, se han identificado los siguientes tres aspectos con mejor evaluación:\n\n` +
                      `1. ${top3[0].item} - NPS: ${top3[0].nps}%\n` +
                      `2. ${top3[1].item} - NPS: ${top3[1].nps}%\n` +
                      `3. ${top3[2].item} - NPS: ${top3[2].nps}%\n\n` +
                      `Por otro lado, se han identificado los tres aspectos con menor evaluación:\n\n` +
                      `1. ${bottom3[2].item} - NPS: ${bottom3[2].nps}%\n` +
                      `2. ${bottom3[1].item} - NPS: ${bottom3[1].nps}%\n` +
                      `3. ${bottom3[0].item} - NPS: ${bottom3[0].nps}%` +
                      `Conclusión TOP 3 y LAST 3:\n\n` +
                      `${conclusion_top_3}\n\n`; // Se agrega aquí la conclusión específica del TOP 3
                      } else {
                         // **Generar el texto de conclusión**
                       conclusionFinal = `Se han identificado los siguientes tres aspectos con mejor evaluación, los cuales son áreas de fortaleza del evento y se buscará mantener las buenas prácticas que permitieron alcanzar estos puntajes:
                      
                      1. ${top3[0].item} - NPS: ${top3[0].nps}%
                      2. ${top3[1].item} - NPS: ${top3[1].nps}%
                      3. ${top3[2].item} - NPS: ${top3[2].nps}%
                                            
                      Por otro lado, se han identificado los tres aspectos con menor evaluación. Se analizarán en detalle los factores que influyeron en estos puntajes para mejorar en futuras ediciones:
                                            
                      1. ${bottom3[2].item} - NPS: ${bottom3[2].nps}%
                      2. ${bottom3[1].item} - NPS: ${bottom3[1].nps}%
                      3. ${bottom3[0].item} - NPS: ${bottom3[0].nps}%
                                            
                      Con base en esta información, se tomarán medidas estratégicas para reforzar las áreas destacadas y mejorar aquellos aspectos que han recibido retroalimentación menos positiva.
                      Este texto es ejemplar de como usted debe escribir la parte analizando los 3 mejores aspectos y los 3 mejores aspectos del evento segun la perspectiva del asistente,su analisis debe ser personal y no el presentado aca.                      `;
                      
                      }
                      pdf.setTextColor(0, 0, 0); // Asegurar que el texto sea negro

                      const conclusionDividida = pdf.splitTextToSize(conclusionFinal, margender);
                      const altoNecesario = conclusionDividida.length * 7;

                      if (y + altoNecesario > pageHeight - 30) {
                      // **Agregar salto de página antes de la conclusión si es necesario**
                      pdf.addPage();
                      pdf.addImage(img_fondo_crm, "PNG", 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
                      y = 40; // Posición vertical de arranque para la nueva página
                      }

                      pdf.setFontSize(14);
                      pdf.setFont(undefined, "bold");
                      pdf.text("Conclusión Final", margenizq, y);

                      y += 10;
                      pdf.setFontSize(12);
                      pdf.setFont(undefined, "normal");

                      if (conclusion_comentarios?.trim() && conclusion_top_3?.trim()) {
                        pdf.setTextColor(0, 0, 0);
                      } else {
                        pdf.setTextColor("#FF0000");
                      
                      }
                      const conclusionTextoDividido = pdf.splitTextToSize(conclusionFinal, margender);
                      conclusionTextoDividido.forEach(linea => {
                          pdf.text(linea, margenizq, y);
                          y += 7;
                      }
                    );

    // 📌 Asegurar que se inserta el teléfono CRM en todas las páginas excepto la primera
    pdf.setFont(undefined, "normal");
    let currentPage = pdf.internal.getNumberOfPages(); // Obtener la página actual
    pdf.setPage(currentPage);
    
    // 📌 Asegurar que el color del texto es visible
    pdf.setTextColor("#E4E4E4"); // Blanco agrisado para mejor visibilidad
    pdf.setFontSize(11);

    // 📌 Insertar el teléfono en una posición más abajo para evitar solapamiento
    let xTelefono = 98.5;
    let yTelefono = 291.5; // Intentar 290 en vez de 301.5 para ver si estaba solapado
    console.log(`Insertando teléfono CRM en página ${currentPage}: ${telefonoCRM}`);
    pdf.text(telefonoCRM, xTelefono, yTelefono); 
    pdf.setPage(2);
    pdf.text(telefonoCRM, xTelefono, yTelefono); 

    // 📌 Restaurar color del texto a negro después de escribir el teléfono
    pdf.setTextColor(0, 0, 0);
    pdf.setFontSize(12);


    
                      // Reemplazar espacios por "_"
                      let nombreLimpio = nombreEvento.replace(/\s+/g, "_");

                      // Guardar el PDF con el nombre modificado
                      pdf.save(`Informe_Satisfacción_Evento_${nombreLimpio}.pdf`);
                      //toggleVisualizarActualizarEspacios();
                      
                      Swal.close();

                      Swal.fire({
                          title: 'Informe Generado',
                          text: 'Su informe ha sido generado exitosamente, se debió abrir en una pestaña nueva y también guardar en tu carpeta de descargas, gracias por utilizar SIEA, un abrazo enorme.',
                          icon: 'success',
                          showConfirmButton: true,
                          confirmButtonColor: '#3085d6',
                          confirmButtonText: 'Aceptar',
                          allowOutsideClick: false, // Evita cerrar al hacer clic fuera
                          allowEscapeKey: false, // Evita cerrar con la tecla Escape
                          allowEnterKey: false, // Evita cerrar con Enter
                          imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png',
                          imageWidth: 120,
                          imageHeight: 235,
                          imageAlt: 'Éxito'
                      }).then((result) => {
                          if (result.isConfirmed) {
                              mostrarInterfazInicial(); // Ejecutar la función al cerrar el modal
                          }
                      });


                      var pdfURL = pdf.output('bloburl');
                      window.open(pdfURL, '_blank');
                  }
              } else if (resultado.isDismissed) {  
                  // 🚀 Si el usuario cancela, ejecutar mostrarInterfazInicial()
                  mostrarInterfazInicial();
              }
          });

          }
          
          // 🔹 Función de análisis de respuestas
        const analizarRespuestasTotales = (respuestas, cantidadPreguntas) => {
              let resumenTotal = { detractores: 0, pasivos: 0, promotores: 0, totalRespuestas: 0 };
              let resumenPorPregunta = {}; 
          
              for (let i = 1; i <= cantidadPreguntas; i++) { 
                  const key = `respuestascrm${i}`;
                  if (!respuestas[key] || respuestas[key].trim() === "") continue;
          
                  const valores = respuestas[key].split("|").map(Number).filter(n => !isNaN(n));
          
                  const detractores = valores.filter(r => r >= 1 && r <= 6).length;
                  const pasivos = valores.filter(r => r >= 7 && r <= 8).length;
                  const promotores = valores.filter(r => r >= 9 && r <= 10).length;
          
                  const total = valores.length;
                  const indiceSatisfaccion = ((promotores - detractores) / total).toFixed(2);
          
                  // Guardamos los datos por pregunta
                  resumenPorPregunta[key] = { detractores, pasivos, promotores, total, indiceSatisfaccion };
          
                  // Sumamos al total general
                  resumenTotal.detractores += detractores;
                  resumenTotal.pasivos += pasivos;
                  resumenTotal.promotores += promotores;
                  resumenTotal.totalRespuestas += total;
              }
          
              // Calcular el índice de satisfacción general
              resumenTotal.indiceSatisfaccion = ((resumenTotal.promotores - resumenTotal.detractores) / resumenTotal.totalRespuestas).toFixed(2);
          
              return { resumenTotal, resumenPorPregunta, cantidadPreguntas };
          };

        }

    const CAPITULOS = [
        { value: "uniguajira", label: "UNIGUAJIRA" },
        { value: "unimagdalena", label: "UNIMAGDALENA" },
        { value: "uniatlantico", label: "UNIATLÁNTICO" },
        { value: "uninorte", label: "UNINORTE" },
        { value: "unisimon", label: "UNISIMÓN" },
        { value: "cuc", label: "CUC" },
        { value: "librequilla", label: "LIBREQUILLA" },
        { value: "utb", label: "UTB" },
        { value: "upbmonteria", label: "UPBMONTERÍA" },
        { value: "unicordoba", label: "UNICÓRDOBA" },
        { value: "areandina", label: "AREANDINA" },
        { value: "ufps", label: "UFPS" },
        { value: "unalmed", label: "UNALMED" },
        { value: "udea", label: "UDEA" },
        { value: "upbmed", label: "UPBMED" },
        { value: "utp", label: "UTP" },
        { value: "unalma", label: "UNALMA" },
        { value: "udistrital", label: "UDISTRITAL" },
        { value: "unalbog", label: "UNALBOG" },
        { value: "univalle", label: "UNIVALLE" },
        { value: "icesi", label: "ICESI" },
        { value: "usc", label: "USC" },
        { value: "librecali", label: "LIBRECALI" },
        { value: "nacional", label: "ANEIAP NACIONAL" }
        ];

    async function generarInformePDF(event) {
      
      if (capituloUsuario === "" || correoUsuario === "") {
        Swal.fire({
            icon: 'error',
            title: '¡DEBE INICIAR SESIÓN PARA GENERAR EL INFORME!',
            text: 'Debe iniciar sesión como DCA para poder generar el informe.',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
        });
        return; // Detener el proceso de evaluación
      }

      // Opciones de periodos disponibles
      const periodosDisponibles = {
          "2024 Sem1": { inicio: "2024-02-01", fin: "2024-05-31" },
          "2024 Sem2": { inicio: "2024-08-01", fin: "2024-11-30" },
          "2024 Año": { inicio: "2024-02-01", fin: "2024-11-30" },
          "2025 Sem1": { inicio: "2025-02-01", fin: "2025-05-31" },
          "2025 Sem2": { inicio: "2025-08-01", fin: "2025-11-30" },
          "2025 Año": { inicio: "2025-02-01", fin: "2025-11-30" },
          "Todos los periodos": { inicio: "2024-02-01", fin: "2025-11-30" }
      };

      // Convertir las claves en opciones válidas para el menú desplegable
      const opcionesPeriodo = Object.keys(periodosDisponibles);

      // Mostrar el menú de selección de periodo con SweetAlert
      const { value: periodoSeleccionado } = await Swal.fire({
          title: 'Selecciona el periodo',
          input: 'select',
          inputOptions: opcionesPeriodo.reduce((obj, periodo) => {
              obj[periodo] = periodo; // Mostrar solo el nombre del periodo
              return obj;
          }, {}),
          inputPlaceholder: 'Selecciona un periodo',
          showCancelButton: true,
          confirmButtonText: 'Aceptar',
          cancelButtonText: 'Cancelar',
          allowOutsideClick: false,
          allowEscapeKey: false
      });

      // Si el usuario canceló la selección, detener la ejecución
      if (!periodoSeleccionado) {
          return;
      }

      // Asignar las fechas según el periodo seleccionado
      var fechaInicialPDF = periodosDisponibles[periodoSeleccionado].inicio;
      var fechaFinalPDF = periodosDisponibles[periodoSeleccionado].fin;

      console.log(`Periodo seleccionado: ${periodoSeleccionado}`);
      console.log(`Fecha Inicial: ${fechaInicialPDF}`);
      console.log(`Fecha Final: ${fechaFinalPDF}`);

      actualizarClavesInforme(capituloUsuario, correoUsuario, fechaInicialPDF, fechaFinalPDF)

      // Mostrar SweetAlert de espera personalizado
      Swal.fire({
          title: 'Generando informe',
          html: '<p>¡Estamos preparando tu informe!<br>Esto podría llevar hasta 30 segundos, si demora más de esto, entonces hay un error en la información de tus espacios, actualízala.</p><p>Mientras tanto, ¿por qué no tomas un pequeño descanso o preparas una taza de café?</p><p>El informe estará disponible en la carpeta de descargas cuando esté listo.</p>',
          timer: tiempoCarga*2, // Duración en milisegundos (60 segundos)
          showConfirmButton: false,
          allowOutsideClick: false,
          allowEscapeKey: false,
          allowEnterKey: false,
          didOpen: () => {
              Swal.showLoading();
          }
      });

      // Crear un nuevo objeto jsPDF
      var pdf = new jsPDF();
      var tiempoCarga = 30000;
      var margenizq = 15; //Margen izquierdo
      var margender = 180;//Margen derecho
      var coordenadaY = 35;
      // Añadir imagen de fondo a la primera página
      pdf.addImage(imgPortadaFI, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());

      pdf.addPage(); // Agrega una nueva página al documento actual
      // Añadir imagen de fondo a la segunda página
      pdf.addImage(img, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());

      // Preparación inicial de las funciones y la sección de actualización
        // Obtener datos necesarios para los gráficos desde Firebase
        document.getElementById("fecha-inicial").value = fechaInicialPDF;
        document.getElementById("fecha-final").value = fechaFinalPDF;
        await toggleVisualizarActualizarEspacios();
        await toggleDashboard();

        var objetoGraficos = await generarGraficos(fechaInicialPDF, fechaFinalPDF)
        var valoresPorcentajes = objetoGraficos.porcentajes;

      // Define el valor para las satisfacciones dependiendo de si hay espacios de ese tipo/área o no.
      var valorSAC = objetoGraficos.totalSAC !== 0 ? (objetoGraficos.satisfaccionesPromedio[0] * 100).toFixed(2) + "%" : "N/A";
      var valorSCO = objetoGraficos.totalSCO !== 0 ? (objetoGraficos.satisfaccionesPromedio[1] * 100).toFixed(2) + "%" : "N/A";
      var valorSDE = objetoGraficos.totalSDE !== 0 ? (objetoGraficos.satisfaccionesPromedio[2] * 100).toFixed(2) + "%" : "N/A";
      var valorSFI = objetoGraficos.totalSFI !== 0 ? (objetoGraficos.satisfaccionesPromedio[3] * 100).toFixed(2) + "%" : "N/A";
      var valorSME = objetoGraficos.totalSME !== 0 ? (objetoGraficos.satisfaccionesPromedio[4] * 100).toFixed(2) + "%" : "N/A";
      var valorSHD = objetoGraficos.totalSHD !== 0 ? (objetoGraficos.satisfaccionesPromedio[5] * 100).toFixed(2) + "%" : "N/A";
      var valorSHB = objetoGraficos.totalSHB !== 0 ? (objetoGraficos.satisfaccionesPromedio[6] * 100).toFixed(2) + "%" : "N/A";
      var valorSCA = objetoGraficos.totalSCA !== 0 ? (objetoGraficos.satisfaccionesPromedio[7] * 100).toFixed(2) + "%" : "N/A";
      var valorSVA = objetoGraficos.totalSVA !== 0 ? (objetoGraficos.satisfaccionesPromedio[8] * 100).toFixed(2) + "%" : "N/A";
      var valorSEI = objetoGraficos.totalSEI !== 0 ? (objetoGraficos.satisfaccionesPromedio[9] * 100).toFixed(2) + "%" : "N/A";
      var valorSNI = objetoGraficos.totalSNI !== 0 ? (objetoGraficos.satisfaccionesPromedio[10] * 100).toFixed(2) + "%" : "N/A";

      // Texto de los valores de la tabla
      var valoresText = "Académico: " + valorSAC + "\n" +
                  "Comunicaciones: " + valorSCO + "\n" +
                  "Desarrollo: " + valorSDE + "\n" +
                  "Finanzas: " + valorSFI + "\n" +
                  "Mercadeo: " + valorSME + "\n" +
                  "Habilidades duras: " + valorSHD + "\n" +
                  "Habilidades blandas: " + valorSHB + "\n" +
                  "Conocimiento ANEIAP: " + valorSCA + "\n" +
                  "Valor agregado: " + valorSVA + "\n" +
                  "Entrenamiento interno: " + valorSEI + "\n" +
                  "Ninguno: " + valorSNI;

      // Función para obtener la abreviatura de un mes en español
      function obtenerAbreviaturaMes(mes) {
          const meses = {
              "01": "FEB", "02": "FEB", "03": "MAR", "04": "ABR", "05": "MAY", "06": "JUN",
              "07": "JUL", "08": "AGO", "09": "SEP", "10": "OCT", "11": "NOV", "12": "DIC"
          };
          return meses[mes] || "";
      }

      // Extraer año y mes de las fechas
      let añoInicial = fechaInicialPDF.substring(0, 4);
      let mesInicial = obtenerAbreviaturaMes(fechaInicialPDF.substring(5, 7));
      let añoFinal = fechaFinalPDF.substring(0, 4);
      let mesFinal = obtenerAbreviaturaMes(fechaFinalPDF.substring(5, 7));

      // Determinar el nombre del periodo
      let nombrePeriodo = `${mesInicial}-${mesFinal}_${añoFinal}`;
      if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2024-11-30") {
          nombrePeriodo = "ANUAL_2024";
      } else if (fechaInicialPDF === "2025-02-01" && fechaFinalPDF === "2025-11-30") {
          nombrePeriodo = "ANUAL_2025";
      } else if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2025-11-30") {
          nombrePeriodo = "TODOS_LOS_PERIODOS";
      }

      // Título del informe
      pdf.setFontSize(18);
      pdf.text("INFORME DE SEGUIMIENTO A LA FORMACIÓN " + capituloUsuario.toUpperCase() + " " + nombrePeriodo,
      margenizq, 20, { align: "justify", maxWidth: margender });
      // Texto de introducción
      pdf.setFontSize(12);
      pdf.text("Este informe contiene un seguimiento detallado de la formación correspondiente al capítulo " + capituloUsuario.toUpperCase() + " del periodo académico " + nombrePeriodo + ".",
      margenizq, 35, { align: "justify", maxWidth: margender });

      // Sección: Dashboard y Metas
      pdf.setFontSize(12); pdf.setTextColor(0, 0, 0); // Color azul para resaltar la sección
      pdf.text("En esta sección, encontrarás un análisis detallado del progreso y los logros alcanzados en materia de formación y desarrollo de competencias.\n\nEl Dashboard inicial proporciona una visión general de los objetivos establecidos y el avance realizado hasta la fecha. Aquí, podrás evaluar el cumplimiento de las metas acordadas, tanto en términos de Valor Agregado como de Entrenamiento Interno. Además, se incluye un indicador del NPS (Net Promoter Score), que refleja la satisfacción de los participantes en los espacios de formación.",
      margenizq, 50, { align: "justify", maxWidth: margender });
      // Aviso de otra sección relacionada 
    /*  doc.setFontSize(12); doc.setTextColor(0, 0, 0); // Restaurar color de texto predeterminado
      doc.text("Por último, encontrarás una sección dedicada a analizar la información de los espacios y las respuestas de satisfacción de los participantes de forma individual, esto orientado a la toma de decisiones.",
      margenizq, 80, { align: "justify", maxWidth: margender });*/

      pdf.setFontSize(15);
      pdf.text("1. GRÁFICO DE CUMPLIMIENTO DE METAS DE FORMACIÓN Y SATISFACCIÓN DEL CAPÍTULO",
      margenizq, 83, { align: "justify", maxWidth: margender });

      // Generar el dashboard de metas y satisfacciones
      //generarDashboardMetasSatisfacciones(doc); // Llamada a la función que genera el dashboard y lo inserta en el PDF

      // Obtener las imágenes de los gráficos después de un retraso
      setTimeout(function() {
        var canvasMetas = document.getElementById("grafico-metas");
        var canvasSatisfaccion = document.getElementById("grafico-satisfaccion");

        // Obtener el contexto 2D de los canvas
        var ctxMetas = canvasMetas.getContext('2d');
        var ctxSatisfaccion = canvasSatisfaccion.getContext('2d');

        // Crear una imagen a partir del canvas
        var imgMetas = new Image();
        var imgSatisfaccion = new Image();

        // Establecer el origen de la imagen a los datos del canvas
        imgMetas.src = canvasMetas.toDataURL("image/png", 1.0);
        imgSatisfaccion.src = canvasSatisfaccion.toDataURL("image/png", 1.0);

        // Insertar la imagen en el PDF
        pdf.setFontSize(12); pdf.setTextColor(0, 0, 0); // Restaurar color de texto predeterminado
        pdf.addImage(imgMetas, 'PNG', margenizq, 90, margender, 80, '', 'FAST'); // Inserta la imagen del gráfico de metas
        pdf.setFontSize(10); pdf.setTextColor(0, 0, 0); // Restaurar color de texto predeterminado
        pdf.text("Porcentajes: " + valoresPorcentajes, margenizq, 175, { align: "justify", maxWidth: margender });
        pdf.setFontSize(12); pdf.setTextColor(0, 0, 0); // Restaurar color de texto predeterminado
        pdf.addImage(imgSatisfaccion, 'PNG', margenizq, 178, margender, 80, '', 'FAST'); // Inserta la imagen del gráfico de satisfacción
        //doc.text("Satisfacciones: " + valoresSatisfaccion, margenizq, 250, { align: "justify", maxWidth: margender });
        // Añadir la cabecera de la tabla al PDF
        pdf.text("AREA/TIPO DE ESPACIO Y SU SATISFACCIÓN PROMEDIO", margenizq, 262, { align: "justify", maxWidth: margender });
        // Añadir los valores de la tabla al PDF
        pdf.text(valoresText, margenizq, 271, { align: "justify", maxWidth: margender });

        // Llamar a la función para agregar la tabla resumen siendo esta la 3ra página y a veces hasta 4ta página
        agregarTablaResumen(pdf, tablaResumenPDF, margenizq, margender, fechaInicialPDF, fechaFinalPDF)
        // Llamar a la función para agregar la tabla resumen siendo esta la 4ta o 5ta página y a veces hasta 5ta o 6ta página
        agregarSatisfaccionesYComentarios(pdf, img, margenizq, margender, correoUsuario, fechaInicialPDF, fechaFinalPDF)
        // Avisar que ya se generó el informe y que revise en descargas

        Swal.fire({
            title: 'Informe Generado',
            text: 'Su informe ha sido generado exitosamente, se debió abrir en una pestaña nueva y también guardar en tu carpeta de descargas, gracias por utilizar SIEA, un abrazo enorme.',
            icon: 'success',
            showConfirmButton: true,
            confirmButtonColor: '#3085d6',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png',
            imageWidth: 120,
            imageHeight: 235,
            imageAlt: 'Éxito',
        });
      }, tiempoCarga); // Espera 60 segundos antes de obtener los canvas y convertirlos en imágenes

    }

    function agregarTablaResumen(pdf, tablaResumenPDF, margenizq, margender, fechaInicialPDF, fechaFinalPDF) {
      const anchoPorcentaje = {
        nombreEvento: 22,
        areaTrabajo: 14,
        tipoEvento: 6,
        fechaEvento: 10,
        nombrePonente: 17,
        contactoPonente: 22,
        totalAsistentes: 5,
        satisfaccion: 8,
        evidencia: 7
      };

      const encabezados = ["Nombre del espacio", "Área de trabajo", "Tipo", "Fecha", "Ponente(s)", "Contacto", "#A", "% NPS", "Evid."];
      const anchoTotal = margender - margenizq;
      let maxRowsPerPage = 15; // Máximo de filas por página
      let currentPage = 0; // Página actual

      while (currentPage * maxRowsPerPage < tablaResumenPDF.length) {
        if (currentPage >= 0) {
          pdf.addPage(); // Agrega una nueva página al documento actual
          pdf.addImage(img, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
        }

        pdf.setFontSize(15);
        pdf.text(`2. TABLA RESUMEN DE EVENTOS DEL ${fechaInicialPDF} AL ${fechaFinalPDF}`, margenizq, 22, { align: "justify", maxWidth: margender });

        var posY = 35; // Posición vertical inicial
        pdf.setFontSize(7);
        pdf.setDrawColor(0); // Establecer color de líneas en negro
        pdf.setLineWidth(0.1); // Establecer ancho de línea
        var posXEncabezados = margenizq + 12; // Posición horizontal inicial para los encabezados

        // Dibujar fila de encabezados
        pdf.line(margenizq, posY - 3, margender + 18, posY - 3);
        for (var i = 0; i <= maxRowsPerPage + currentPage; i++) {
          if (currentPage * maxRowsPerPage + i >= tablaResumenPDF.length + 1) break;
          pdf.line(margenizq, posY + 2, margender + 18, posY + 2);
          posY += 15; // Incrementar la posición vertical
        }
        var maxPosY = posY - 13; // Posición final de las líneas verticales
        posY = 35;

        // Iterar sobre cada encabezado y agregar texto al PDF
        pdf.line(posXEncabezados - 12, posY - 3, posXEncabezados - 12, maxPosY);
        encabezados.forEach(function(encabezado, index) {
          var anchoCampoEncabezado = (anchoTotal * anchoPorcentaje[Object.keys(anchoPorcentaje)[index]]) / 100;
          pdf.text(encabezado, posXEncabezados - 10, posY, { align: "justify", valign: "middle", maxWidth: anchoCampoEncabezado - 4 });
          if (index < encabezados.length) {
            pdf.line(posXEncabezados + anchoCampoEncabezado - 12, posY - 3, posXEncabezados + anchoCampoEncabezado - 12, maxPosY);
          }
          posXEncabezados += anchoCampoEncabezado; // Mover la posición horizontal al final del campo actual para los encabezados
        });

        posY = 41; // Reiniciar la posición vertical para el contenido de la tabla

        for (var i = 0; i < maxRowsPerPage; i++) {
          var rowIndex = currentPage * maxRowsPerPage + i;
          if (rowIndex >= tablaResumenPDF.length) break;
          var campos = tablaResumenPDF[rowIndex].split("|");
          var posX = margenizq;

          Object.keys(anchoPorcentaje).forEach(function(campo, index) {
            var anchoCampo = (anchoTotal * anchoPorcentaje[campo]) / 100;
            var restarValor;
            if (campo === 'nombreEvento') { restarValor = 6; }
            else if (campo === 'nombrePonente') { restarValor = 7; }
            else if (campo === 'contactoPonente') { restarValor = 6; }
            else { restarValor = 4; }

            if (campo === 'evidencia') {
              pdf.setTextColor(0, 0, 255);
              pdf.textWithLink('click', posX + 2, posY, { url: campos[index], target: '_blank' });
              pdf.setDrawColor(0, 0, 255);
              pdf.line(posX + 2, posY + 1, posX + 2 + pdf.getTextWidth('click'), posY + 1);
              pdf.setTextColor(0, 0, 0);
            } else {
              var textoCampo = campos[index];
              if (campo === 'tipoEvento') {
                if (campos[index] === 'valor-agregado') {
                  textoCampo = 'VA';
                } else if (campos[index] === 'entrenamiento-interno') {
                  textoCampo = 'EI';
                }
              }
              pdf.text(textoCampo, posX + 2, posY, { align: "justify", valign: "middle", maxWidth: anchoCampo - restarValor });
            }
            posX += anchoCampo;
          });

          posY += 15; // Mover la posición vertical para el siguiente evento
        }

        currentPage++;
        PosYParaSG = posY + 3;
      }
    }

    // Función para agregar la tabla de satisfacciones y comentarios por espacio
    async function agregarSatisfaccionesYComentarios(pdf, img, margenizq, margender, correoUsuario, fechaInicialPDF, fechaFinalPDF) {
        
        var componenteComentarios = 0;
        var posY = 35; // Posición vertical inicial
        var maxPosY = 270; // Límite de posición vertical

        // Punto 3: Respuestas de satisfacción por cada uno de los espacios
        pdf.addPage(); // Agregar una nueva página al PDF
        // Añadir imagen de fondo a la tercera página
        pdf.addImage(img, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());

        console.log("Página de satisfacciones y comentarios añadida.");

        pdf.setFontSize(15);
        pdf.text(`3. RESPUESTAS DE SATISFACCIÓN DEL ${fechaInicialPDF} AL ${fechaFinalPDF}`, margenizq, 22, { align: "justify", maxWidth: margender });

        console.log("Título de la sección añadido.");

        // Definir tamaño de celdas de la tabla
        var anchoEvento = pdf.internal.pageSize.getWidth() * 0.15;
        var anchoRespuestas = pdf.internal.pageSize.getWidth() * 0.05;
        var anchoPorcentaje = pdf.internal.pageSize.getWidth() * 0.15;
        var anchoComentarios = pdf.internal.pageSize.getWidth() * 0.35;
        var anchoRestante = pdf.internal.pageSize.getWidth() * 0.25;

        var posYTabla = 20; // Posición vertical para la tabla en el PDF

        // Encabezados de la tabla de respuestas
        pdf.setFontSize(7);
        pdf.line(margenizq, posYTabla + 5, margender + 18, posYTabla + 5); // Línea horizontal
        pdf.text("ESPACIO", margenizq + 7, posYTabla + 10);
        pdf.text("DET.", margenizq + anchoEvento, posYTabla + 10, { align: "center", maxWidth: anchoEvento - 5 });
        pdf.text("PAS.", margenizq + anchoEvento + anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
        pdf.text("PRO.", margenizq + anchoEvento + 2 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
        pdf.text("#RES.", margenizq + anchoEvento + 3 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
        pdf.text("% RES.", margenizq + anchoEvento + 4 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
        pdf.text("COMENTARIOS", margenizq + anchoEvento + 6 * anchoRespuestas - 4, posYTabla + 10, { align: "center", maxWidth: anchoRestante });

        console.log("Encabezados de la tabla añadidos.");

        // Obtener las claves de los eventos del campo "clavesInforme" del documento correspondiente en la colección "cuentas"
        var cuentasRef = firebase.firestore().collection("cuentas").doc(correoUsuario);

        cuentasRef.get().then(async (docCuentas) => {
            if (docCuentas.exists) {
                var clavesInforme = docCuentas.data().clavesInforme.split("|");
                console.log("Claves del informe obtenidas: ", clavesInforme);

                let totalSatisfaccion = 0;
                let eventosConSatisfaccion = 0;
                for (const claveEvento of clavesInforme) {
                    if (claveEvento) {
                        var reservaRef = firebase.firestore().collection("reservas").doc(claveEvento);
                        var docReserva = await reservaRef.get();

                        if (docReserva.exists) {
                            var data = docReserva.data();
                            console.log("Datos del evento obtenidos: ", data);

                            var nombreEvento = data.nombreEvento || "";
                            var detractores = data.detractores || 0;
                            var pasivos = data.pasivos || 0;
                            var promotores = data.promotores || 0;
                            var respuestas = ((detractores + pasivos + promotores) / 3) || 0;
                            var porcentajeRespuestas = ((respuestas / data.totalAsistentes) * 100).toFixed(2) + "%";
                            var comentarios = data.comentarios ? data.comentarios.split(/\|/g).filter(comentario => comentario !== "Ninguno.").map(comentario => "«" + comentario.trim() + "»").join("_") : "";

                            if (data.tipoEvento === "valor-agregado") {
                                totalSatisfaccion += parseFloat(data.satisfaccion || 0);
                                eventosConSatisfaccion++;
                            }

                            var anchoComentarios = margender - (margenizq + anchoEvento + 3 * anchoRespuestas);
                            console.log("anchoComentarios: " + anchoComentarios);
                            var longitudComentarios = 1.1 * pdf.getStringUnitWidth(comentarios) * pdf.getFontSize();
                            var longitudNombreEvento = 1.8 * pdf.getStringUnitWidth(nombreEvento) * pdf.getFontSize();
                            var lineasNecesariasComentarios = Math.ceil(longitudComentarios / (anchoComentarios));
                            var lineasNecesariasNombreEvento = Math.ceil(longitudNombreEvento / (anchoEvento - 7));
                            var sumarAposYTabla = Math.max(7, lineasNecesariasComentarios, lineasNecesariasNombreEvento);

                            console.log("Longitud de comentarios: ", longitudComentarios);
                            console.log("Longitud de nombre del evento: ", longitudNombreEvento);
                            console.log("Líneas necesarias para comentarios: ", lineasNecesariasComentarios);
                            console.log("Líneas necesarias para nombre del evento: ", lineasNecesariasNombreEvento);
                            console.log("Espacio adicional calculado (sumarAposYTabla): ", sumarAposYTabla);

                            // Verificar si necesitamos agregar una nueva página
                            if (posYTabla + sumarAposYTabla > maxPosY) {
                                pdf.line(margenizq, posYTabla + sumarAposYTabla - 8, margender + 18, posYTabla + sumarAposYTabla - 8); // Línea horizontal
                                pdf.addPage(); // Agregar una nueva página al PDF
                                pdf.addImage(img, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
                                pdf.setFontSize(15);
                                pdf.text(`3. RESPUESTAS DE SATISFACCIÓN DEL ${fechaInicialPDF} AL ${fechaFinalPDF}`, margenizq, 22, { align: "justify", maxWidth: margender });

                                posYTabla = 20; // Reiniciar la posición vertical

                                console.log("Nueva página añadida debido a límite de espacio.");

                                // Añadir encabezados a la nueva página
                                pdf.setFontSize(7);
                                pdf.line(margenizq, posYTabla + 5, margender + 18, posYTabla + 5); // Línea horizontal
                                pdf.text("ESPACIO", margenizq + 7, posYTabla + 10);
                                pdf.text("DET.", margenizq + anchoEvento, posYTabla + 10, { align: "center", maxWidth: anchoEvento - 5 });
                                pdf.text("PAS.", margenizq + anchoEvento + anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
                                pdf.text("PRO.", margenizq + anchoEvento + 2 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
                                pdf.text("#RES.", margenizq + anchoEvento + 3 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
                                pdf.text("% RES.", margenizq + anchoEvento + 4 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
                                pdf.text("COMENTARIOS", margenizq + anchoEvento + 6 * anchoRespuestas - 4, posYTabla + 10, { align: "center", maxWidth: anchoRestante });

                                console.log("Encabezados añadidos en la nueva página.");
                                componenteComentarios = 1;
                            }

                            // Agregar contenido de la fila
                            posYTabla += 15;
                            pdf.text(nombreEvento, margenizq + 1, posYTabla, { align: "left", maxWidth: anchoEvento - 7 });
                            pdf.text(detractores.toString(), margenizq + anchoEvento, posYTabla, { align: "center", maxWidth: anchoRespuestas });
                            pdf.text(pasivos.toString(), margenizq + anchoEvento + anchoRespuestas, posYTabla, { align: "center", maxWidth: anchoRespuestas });
                            pdf.text(promotores.toString(), margenizq + anchoEvento + 2 * anchoRespuestas, posYTabla, { align: "center", maxWidth: anchoRespuestas });
                            pdf.text(respuestas.toString(), margenizq + anchoEvento + 3 * anchoRespuestas, posYTabla, { align: "center", maxWidth: anchoRespuestas });
                            pdf.text(porcentajeRespuestas, margenizq + anchoEvento + 4 * anchoRespuestas, posYTabla, { align: "center", maxWidth: anchoPorcentaje });
                            pdf.text(comentarios, margenizq + anchoEvento + 5 * anchoRespuestas - 4, posYTabla, { align: "left", maxWidth: anchoComentarios });

                            console.log("Contenido de la fila añadido:", {
                                nombreEvento,
                                detractores,
                                pasivos,
                                promotores,
                                respuestas,
                                porcentajeRespuestas,
                                comentarios
                            });

                            // Dibujar líneas horizontales y verticales
                            pdf.setDrawColor(0); // Establecer color de líneas en negro
                            pdf.setLineWidth(0.1); // Establecer ancho de línea
                            pdf.line(margenizq, posYTabla - 3, margender + 18, posYTabla - 3); // Línea horizontal

                            pdf.line(margenizq, posYTabla - 10, margenizq, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento - 5, posYTabla - 10, margenizq + anchoEvento - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 1 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 1 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 2 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 2 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 3 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 3 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 4 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 4 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 5 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 5 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margender + 2 * anchoRespuestas - 3, posYTabla - 10, margender + 2 * anchoRespuestas - 3, posYTabla + sumarAposYTabla);

                            console.log("Líneas horizontales y verticales dibujadas.");

                            posYTabla += sumarAposYTabla - 10;
                        }
                    }
                }

                // Línea horizontal final
                pdf.line(margenizq, posYTabla + 10, margender + 18, posYTabla + 10);

                console.log("Línea horizontal final añadida.");

                // Calcular satisfacción promedio
                const satisfaccionPromedioCapitular = totalSatisfaccion / eventosConSatisfaccion;
                const satisfaccionPromedioCapitularTexto = (satisfaccionPromedioCapitular * 100).toFixed(2) + "%";
              
                // Obtener el total de páginas del PDF
                const totalPages = pdf.internal.getNumberOfPages();

                // Añadir satisfacción promedio en la antepenúltima página
                pdf.setPage(totalPages - 1 - componenteComentarios); // Cambiar a la antepenúltima página
                pdf.setFontSize(12);
                pdf.text(`Satisfacción Promedio (Valor Agregado): ${satisfaccionPromedioCapitularTexto}`, margenizq, PosYParaSG, { align: "justify", maxWidth: margender });

                // Ajustes de la portada
                pdf.setTextColor("#32620E"); //Verde académico
                pdf.setFontSize(35);
                pdf.setPage(1); // Cambiar a la página 1
                pdf.text(capituloUsuario.toUpperCase(), 105, 200, { align: "center" });

                // Ajustes del pie de página
                pdf.setTextColor("#EDEDED"); //Blanco un poquitín agriseado por fines visuales
                pdf.setFontSize(11);
                const textoTelefono = telefonoCuenta; // Variable que contiene el texto del teléfono
                const x = 91; // Coordenada X
                const y = 291.5; // Coordenada Y

                // Bucle para recorrer todas las páginas y añadir el texto
                for (let i = 2; i <= totalPages; i++) {
                    pdf.setPage(i);
                    pdf.text(textoTelefono, x, y);
                }

                // Guardar el PDF con el nombre especificado
                // Función para obtener la abreviatura de un mes en español
                function obtenerAbreviaturaMes(mes) {
                    const meses = {
                        "01": "FEB", "02": "FEB", "03": "MAR", "04": "ABR", "05": "MAY", "06": "JUN",
                        "07": "JUL", "08": "AGO", "09": "SEP", "10": "OCT", "11": "NOV", "12": "DIC"
                    };
                    return meses[mes] || "";
                }

                // Extraer año y mes de las fechas
                let añoInicial = fechaInicialPDF.substring(0, 4);
                let mesInicial = obtenerAbreviaturaMes(fechaInicialPDF.substring(5, 7));
                let añoFinal = fechaFinalPDF.substring(0, 4);
                let mesFinal = obtenerAbreviaturaMes(fechaFinalPDF.substring(5, 7));

                // Determinar el nombre del periodo
                let nombrePeriodo = `${mesInicial}-${mesFinal}_${añoFinal}`;
                if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2024-11-30") {
                    nombrePeriodo = "ANUAL_2024";
                } else if (fechaInicialPDF === "2025-02-01" && fechaFinalPDF === "2025-11-30") {
                    nombrePeriodo = "ANUAL_2025";
                } else if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2025-11-30") {
                    nombrePeriodo = "TODOS_LOS_PERIODOS";
                }

                // Guardar el archivo con el nombre dinámico
                pdf.save(`Informe_Seguimiento_Formación_${capituloUsuario.toUpperCase()}_${nombrePeriodo}.pdf`);

                toggleVisualizarActualizarEspacios();

                // Abrir automáticamente el PDF después de descargarlo
                var pdfURL = pdf.output('bloburl');
                window.open(pdfURL, '_blank');
            }
        });
    }

    async function generarInformeIE(event) {
      /*
      Swal.fire({
          title: '¡TE ESPERAMOS EL MARTES 24 DE SEPTIEMBRE!',
          text: 'Esta función de SIEA se estrenará el 24 de septiembre, prepárate y actualiza la información de Integración con el Entorno (IE) para que puedas disfrutarla lo más antes posible. 💚',
          confirmButtonText: 'Aceptar',
          allowOutsideClick: true,
          backdrop: true,
          allowEscapeKey: true,
          imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
          imageWidth: 120, // Ancho de la imagen en píxeles
          imageHeight: 235, // Alto de la imagen en píxeles
          imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
      });
      return; // Detener el proceso de evaluación
      */
      if (capituloUsuario === "" || correoUsuario === "") {
        Swal.fire({
            icon: 'error',
            title: '¡DEBE INICIAR SESIÓN PARA GENERAR EL INFORME!',
            text: 'Debe iniciar sesión como DCA para poder generar el informe.',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
        });
        return; // Detener el proceso de evaluación
      }

      if (capituloUsuario === "" || correoUsuario === "") {
        Swal.fire({
            icon: 'error',
            title: '¡DEBE INICIAR SESIÓN PARA GENERAR EL INFORME!',
            text: 'Debe iniciar sesión como DCA para poder generar el informe.',
            confirmButtonText: 'Aceptar',
            allowOutsideClick: true,
            backdrop: true,
            allowEscapeKey: true,
            imageUrl: 'https://i.ibb.co/CBcrYmF/AVATAR-FALTANCAMPOS-removebg-preview.png', // URL de la imagen
            imageWidth: 120, // Ancho de la imagen en píxeles
            imageHeight: 235, // Alto de la imagen en píxeles
            imagePosition: 'top-start' // Posición de la imagen ('top-start', 'top', 'top-end', 'center', 'center-start', 'center-end', 'bottom-start', 'bottom', 'bottom-end')
        });
        return; // Detener el proceso de evaluación
      }

      // Opciones de periodos disponibles
      const periodosDisponibles = {
          "2024 Sem1": { inicio: "2024-02-01", fin: "2024-05-31" },
          "2024 Sem2": { inicio: "2024-08-01", fin: "2024-11-30" },
          "2024 Año": { inicio: "2024-02-01", fin: "2024-11-30" },
          "2025 Sem1": { inicio: "2025-02-01", fin: "2025-05-31" },
          "2025 Sem2": { inicio: "2025-08-01", fin: "2025-11-30" },
          "2025 Año": { inicio: "2025-02-01", fin: "2025-11-30" },
          "Todos los periodos": { inicio: "2024-02-01", fin: "2025-11-30" }
      };

      // Convertir las claves en opciones válidas para el menú desplegable
      const opcionesPeriodo = Object.keys(periodosDisponibles);

      // Mostrar el menú de selección de periodo con SweetAlert
      const { value: periodoSeleccionado } = await Swal.fire({
          title: 'Selecciona el periodo',
          input: 'select',
          inputOptions: opcionesPeriodo.reduce((obj, periodo) => {
              obj[periodo] = periodo; // Mostrar solo el nombre del periodo
              return obj;
          }, {}),
          inputPlaceholder: 'Selecciona un periodo',
          showCancelButton: true,
          confirmButtonText: 'Aceptar',
          cancelButtonText: 'Cancelar',
          allowOutsideClick: false,
          allowEscapeKey: false
      });

      // Si el usuario canceló la selección, detener la ejecución
      if (!periodoSeleccionado) {
          return;
      }

      // Asignar las fechas según el periodo seleccionado
      var fechaInicialPDF = periodosDisponibles[periodoSeleccionado].inicio;
      var fechaFinalPDF = periodosDisponibles[periodoSeleccionado].fin;

      console.log(`Periodo seleccionado: ${periodoSeleccionado}`);
      console.log(`Fecha Inicial: ${fechaInicialPDF}`);
      console.log(`Fecha Final: ${fechaFinalPDF}`);

      actualizarClavesInforme(capituloUsuario, correoUsuario, fechaInicialPDF, fechaFinalPDF)

      // Mostrar SweetAlert de espera personalizado
      Swal.fire({
          title: 'Generando informe',
          html: '<p>¡Estamos preparando tu informe!<br>Esto podría llevar hasta 30 segundos, si demora más de esto, entonces hay un error en la información de tus espacios, actualízala.</p><p>Mientras tanto, ¿por qué no tomas un pequeño descanso o preparas una taza de café?</p><p>El informe estará disponible en la carpeta de descargas cuando esté listo.</p>',
          timer: tiempoCarga*2, // Duración en milisegundos (60 segundos)
          showConfirmButton: false,
          allowOutsideClick: false,
          allowEscapeKey: false,
          allowEnterKey: false,
          didOpen: () => {
              Swal.showLoading();
          }
      });

      // Crear un nuevo objeto jsPDF
      var pdf = new jsPDF();
      var tiempoCarga = 3000;
      var margenizq = 15; //Margen izquierdo
      var margender = 180;//Margen derecho
      var coordenadaY = 35;
      // Añadir imagen de fondo a la primera página
      pdf.addImage(imgPortadaIE, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());

      pdf.addPage(); // Agrega una nueva página al documento actual
      // Añadir imagen de fondo a la segunda página
      pdf.addImage(img, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());

      // Preparación inicial de las funciones y la sección de actualización
      // Obtener datos necesarios para los gráficos desde Firebase
      document.getElementById("fecha-inicial").value = fechaInicialPDF;
      document.getElementById("fecha-final").value = fechaFinalPDF;

      // Función para obtener la abreviatura de un mes en español
      function obtenerAbreviaturaMes(mes) {
          const meses = {
              "01": "FEB", "02": "FEB", "03": "MAR", "04": "ABR", "05": "MAY", "06": "JUN",
              "07": "JUL", "08": "AGO", "09": "SEP", "10": "OCT", "11": "NOV", "12": "DIC"
          };
          return meses[mes] || "";
      }

      // Extraer año y mes de las fechas
      let añoInicial = fechaInicialPDF.substring(0, 4);
      let mesInicial = obtenerAbreviaturaMes(fechaInicialPDF.substring(5, 7));
      let añoFinal = fechaFinalPDF.substring(0, 4);
      let mesFinal = obtenerAbreviaturaMes(fechaFinalPDF.substring(5, 7));

      // Determinar el nombre del periodo
      let nombrePeriodo = `${mesInicial}-${mesFinal}_${añoFinal}`;
      if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2024-11-30") {
          nombrePeriodo = "ANUAL_2024";
      } else if (fechaInicialPDF === "2025-02-01" && fechaFinalPDF === "2025-11-30") {
          nombrePeriodo = "ANUAL_2025";
      } else if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2025-11-30") {
          nombrePeriodo = "TODOS_LOS_PERIODOS";
      }

      // Título del informe
      pdf.setFontSize(18);
      pdf.text("INFORME DE SEGUIMIENTO INTEGRACIÓN CON EL ENTORNO " + capituloUsuario.toUpperCase() + " " + nombrePeriodo,
      margenizq, 20, { align: "justify", maxWidth: margender });
      // Texto de introducción
      pdf.setFontSize(12);
      pdf.text("Este informe contiene un seguimiento detallado de la formación correspondiente al capítulo " + capituloUsuario.toUpperCase() + " del periodo académico " + nombrePeriodo + ".",
      margenizq, 35, { align: "justify", maxWidth: margender });

      // Sección: Dashboard y Metas
      pdf.setFontSize(12); pdf.setTextColor(0, 0, 0); // Color azul para resaltar la sección
      pdf.text("En esta sección, encontrarás un análisis detallado del progreso y los logros alcanzados en materia de integración con el entorno.\n\nEl Dashboard inicial proporciona una visión general de los objetivos establecidos y el avance realizado hasta la fecha. Aquí, podrás evaluar el cumplimiento de las metas acordadas. Además, se incluye un indicador del NPS (Net Promoter Score), que refleja la satisfacción de los participantes en los espacios de integración con el entorno.",
      margenizq, 50, { align: "justify", maxWidth: margender });

      pdf.setFontSize(15);
      pdf.text("1. GRÁFICO DE CUMPLIMIENTO DE METAS DE INTEGRACIÓN CON EL ENTORNO DEL CAPÍTULO",
      margenizq, 83, { align: "justify", maxWidth: margender });

      // Llama a la función para agregar el gráfico de cumplimiento
      console.log("tablaResumenPDFIE: " + tablaResumenPDFIE)
      agregarGraficoCumplimientoIE(pdf, margenizq, margender, fechaInicialPDF, fechaFinalPDF, correoUsuario);

        // Colocar el teléfono del DCA en cada pie de página
        pdf.setTextColor("#EDEDED"); //Blanco un poquitín agriseado por fines visuales
        pdf.setFontSize(11);
        const textoTelefono = telefonoCuenta; // Variable que contiene el texto del teléfono
        const x = 91; // Coordenada X
        const y = 291.5; // Coordenada Y

        // Obtener el total de páginas del PDF
        const totalPages = pdf.internal.getNumberOfPages();
        // Bucle para recorrer todas las páginas y añadir el texto
        for (let i = 2; i <= totalPages; i++) {
            pdf.setPage(i);
            pdf.text(textoTelefono, x, y);
        }

      // Obtener las imágenes de los gráficos después de un retraso
      setTimeout(function() {

        // Llamar a la función para agregar la tabla resumen siendo esta la 3ra página y a veces hasta 4ta página
        agregarTablaResumenIE(pdf, tablaResumenPDFIE, margenizq, margender, fechaInicialPDF, fechaFinalPDF);

        agregarSatisfaccionesYComentariosIE(pdf, img, margenizq, margender, correoUsuario, fechaInicialPDF, fechaFinalPDF)

        // Avisar que ya se generó el informe y que revise en descargas
        Swal.fire({
            title: 'Informe Generado',
            text: 'Su informe ha sido generado exitosamente, se debió abrir en una pestaña nueva y también guardar en tu carpeta de descargas, gracias por utilizar SIEA, un abrazo enorme.',
            icon: 'success',
            showConfirmButton: true,
            confirmButtonColor: '#3085d6',
            confirmButtonText: 'Aceptar',
            imageUrl: 'https://i.ibb.co/r31wpYT/AVATAR-EXITO-removebg-preview.png',
            imageWidth: 120,
            imageHeight: 235,
            imageAlt: 'Éxito',
        });
      }, tiempoCarga); // Espera 60 segundos antes de obtener los canvas y convertirlos en imágenes

    }

    function agregarGraficoCumplimientoIE(pdf, margenizq, margender, fechaInicialPDF, fechaFinalPDF, correoUsuario) {
        // Obtener la cantidad de elementos en tablaResumenIE desde Firebase
        var cuentasRef = firebase.firestore().collection("cuentas").doc(correoUsuario);

        cuentasRef.get().then((doc) => {
            if (!doc.exists) {
                console.error("❌ Error: El documento de usuario no existe en Firebase.");
                return;
            }

            // Asegurarse de que el campo 'tablaResumenIE' existe antes de acceder a su longitud
            var data = doc.data();
            if (!data || !data.tablaResumenIE) {
                console.error("⚠ Advertencia: 'tablaResumenIE' no está definido en el documento de Firebase.");
                return;
            }

            var totalEspacios = data.tablaResumenIE.length;

            // Determinar la meta en función del periodo seleccionado
            var meta = 0;
            if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2024-05-31") {
                meta = 2; // 2024 Semestre 1
            } else if (fechaInicialPDF === "2024-08-01" && fechaFinalPDF === "2024-11-30") {
                meta = 2; // 2024 Semestre 2
            } else if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2024-11-30") {
                meta = 4; // 2024 Año Completo
            } else if (fechaInicialPDF === "2025-02-01" && fechaFinalPDF === "2025-05-31") {
                meta = 3; // 2025 Semestre 1
            } else if (fechaInicialPDF === "2025-08-01" && fechaFinalPDF === "2025-11-30") {
                meta = 2; // 2025 Semestre 2
            } else if (fechaInicialPDF === "2025-02-01" && fechaFinalPDF === "2025-11-30") {
                meta = 6; // 2025 Año Completo (3 en el primer semestre + 3 en el segundo semestre)
            } else if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2025-11-30") {
                meta = 10; // Todos los periodos (4 de 2024 + 6 de 2025)
            } else {
                meta = 3; // Meta por defecto
            }

            var extra = totalEspacios > meta ? totalEspacios - meta : 0;

            // Posiciones para el gráfico en el PDF
            var posX = margenizq;
            var posY = 100; // Posición vertical
            var anchoBarra = margender - margenizq; // El ancho siempre será el mismo
            var altoBarra = 15; // Altura de la barra

            // La escala debe adaptarse al número de espacios realizados
            var escalaMax = totalEspacios > meta ? totalEspacios : meta;

            // Dibujar la escala (marcando desde 0 hasta el mayor valor entre meta y total de espacios)
            pdf.setTextColor(0, 0, 0);
            pdf.setFontSize(10);
            for (let i = 0; i <= escalaMax; i++) {
                let xPos = posX + (i / escalaMax) * anchoBarra;
                pdf.text(i.toString(), xPos, posY + altoBarra + 5);
            }

            // Dibujar la barra de fondo (gris para la parte no cumplida)
            var anchoGris = (meta / escalaMax) * anchoBarra; // Parte que corresponde a la meta
            pdf.setDrawColor(150); // Color del borde
            pdf.setFillColor(230); // Relleno gris claro
            pdf.rect(posX, posY, anchoGris, altoBarra, 'F'); // Dibujar el fondo hasta la meta

            // Dibujar la barra de cumplimiento (verde claro hasta la meta)
            var anchoCumplimiento = Math.min((totalEspacios / escalaMax) * anchoBarra, (meta / escalaMax) * anchoBarra);
            pdf.setFillColor(0, 200, 0); // Verde claro
            pdf.rect(posX, posY, anchoCumplimiento, altoBarra, 'F');

            // Si hay espacios extra, dibujar la parte adicional de la barra (verde oscuro)
            if (extra > 0) {
                var anchoExtra = ((extra / escalaMax) * anchoBarra);
                pdf.setFillColor(0, 100, 0); // Verde oscuro para extra
                pdf.rect(posX + anchoCumplimiento, posY, anchoExtra, altoBarra, 'F');
            }

            // Añadir etiquetas de cumplimiento
            pdf.setFontSize(12);
            pdf.text(`Cumplimiento: ${totalEspacios}/${meta}`, posX, posY + altoBarra + 20);

            // Añadir tabla con datos del análisis
            var tablaInicioY = posY + altoBarra + 40;
            pdf.text("Análisis de Cumplimiento:", posX, tablaInicioY);
            pdf.text(`Espacios realizados: ${totalEspacios}`, posX, tablaInicioY + 10);
            pdf.text(`Meta: ${meta} espacios`, posX, tablaInicioY + 20);
            if (extra > 0) {
                pdf.text(`Extras: ${extra} espacios adicionales`, posX, tablaInicioY + 30);
            }
        }).catch((error) => {
            console.error("❌ Error al obtener los datos de Firebase:", error);
        });
    }

    function agregarTablaResumenIE(pdf, tablaResumenPDF, margenizq, margender, fechaInicialPDF, fechaFinalPDF) {
      const anchoPorcentaje = {
        nombreEvento: 15,
        areaTrabajo: 15,
        fechaEvento: 10,
        nombrePonente: 15,
        planEvento: 37,
        totalAsistentes: 5,
        satisfaccion: 8,
        evidencia: 6
      };
      pdf.setTextColor(0, 0, 0); // Color negro

      const encabezados = ["Espacio", "Área Trabajo", "Fecha", "Ponente/Empresa", "Descripción del espacio", "#A", "% NPS", "Evid."];
      const anchoTotal = margender - margenizq;
      let maxRowsPerPage = 6; // Máximo de filas por página
      let currentPage = 0; // Página actual

      while (currentPage * maxRowsPerPage < tablaResumenPDF.length) {
        if (currentPage >= 0) {
          pdf.addPage(); // Agrega una nueva página al documento actual
          pdf.addImage(img, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
        }

        pdf.setFontSize(15);
        pdf.text(`2. TABLA RESUMEN DE EVENTOS I.E DEL ${fechaInicialPDF} AL ${fechaFinalPDF}`, margenizq, 22, { align: "justify", maxWidth: margender });
        agregarTelefonoPieDePagina(pdf, telefonoCuenta);

        var posY = 35; // Posición vertical inicial
        pdf.setFontSize(7);
        pdf.setDrawColor(0); // Establecer color de líneas en negro
        pdf.setLineWidth(0.1); // Establecer ancho de línea
        var posXEncabezados = margenizq + 12; // Posición horizontal inicial para los encabezados

        // Dibujar fila de encabezados
        pdf.line(margenizq, posY - 3, margender + 18, posY - 3);
        for (var i = 0; i <= maxRowsPerPage + currentPage; i++) {
          if (currentPage * maxRowsPerPage + i >= tablaResumenPDF.length + 1) break;
          pdf.line(margenizq, posY + 2, margender + 18, posY + 2);
          posY += 35; // Incrementar la posición vertical
        }
        var maxPosY = posY - 35 + 2; // Posición final de las líneas verticales
        posY = 35;

        // Iterar sobre cada encabezado y agregar texto al PDF
        pdf.line(posXEncabezados - 12, posY - 3, posXEncabezados - 12, maxPosY);
        encabezados.forEach(function(encabezado, index) {
          pdf.setFontSize(7)
          var anchoCampoEncabezado = (anchoTotal * anchoPorcentaje[Object.keys(anchoPorcentaje)[index]]) / 100;
          pdf.text(encabezado, posXEncabezados - 10, posY, { align: "justify", valign: "middle", maxWidth: anchoCampoEncabezado - 4 });
          if (index < encabezados.length) {
            pdf.line(posXEncabezados + anchoCampoEncabezado - 12, posY - 3, posXEncabezados + anchoCampoEncabezado - 12, maxPosY);
          }
          posXEncabezados += anchoCampoEncabezado; // Mover la posición horizontal al final del campo actual para los encabezados
        });

        posY = 41; // Reiniciar la posición vertical para el contenido de la tabla

        for (var i = 0; i < maxRowsPerPage; i++) {
          agregarTelefonoPieDePagina(pdf, telefonoCuenta);
          var rowIndex = currentPage * maxRowsPerPage + i;
          if (rowIndex >= tablaResumenPDF.length) break;
          var campos = tablaResumenPDF[rowIndex].split("|");
          var posX = margenizq;

          Object.keys(anchoPorcentaje).forEach(function(campo, index) {
            var anchoCampo = (anchoTotal * anchoPorcentaje[campo]) / 100;
            var restarValor;
            pdf.setFontSize(7)
            if (campo === 'nombreEvento') { restarValor = 6; }
            else if (campo === 'nombrePonente') { restarValor = 7; }
            else { restarValor = 4; }

            if (campo === 'evidencia') {
              pdf.setTextColor(0, 0, 255);
              pdf.textWithLink('click', posX + 2, posY, { url: campos[index], target: '_blank' });
              pdf.setDrawColor(0, 0, 255);
              pdf.line(posX + 2, posY + 1, posX + 2 + pdf.getTextWidth('click'), posY + 1);
              pdf.setTextColor(0, 0, 0);
            } else {
              var textoCampo = campos[index];
              pdf.text(textoCampo, posX + 2, posY, { align: "justify", valign: "middle", maxWidth: anchoCampo - restarValor });
            }
            posX += anchoCampo;
          });

          posY += 35; // Mover la posición vertical para el siguiente evento
        }

        currentPage++;
        PosYParaSG = posY + 3;
      }

    }

    // Función para agregar la tabla de satisfacciones y comentarios por espacio
    async function agregarSatisfaccionesYComentariosIE(pdf, img, margenizq, margender, correoUsuario, fechaInicialPDF, fechaFinalPDF) {
        var componenteComentarios = 0;
        var posY = 35; // Posición vertical inicial
        var maxPosY = 270; // Límite de posición vertical
        pdf.setTextColor(0, 0, 0); // Color negro
        // Punto 3: Respuestas de satisfacción por cada uno de los espacios
        pdf.addPage(); // Agregar una nueva página al PDF
        // Añadir imagen de fondo a la tercera página
        pdf.addImage(img, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());

        console.log("Página de satisfacciones y comentarios añadida.");

        pdf.setFontSize(15);
        pdf.text(`3. RESPUESTAS DE SATISFACCIÓN I.E DEL ${fechaInicialPDF} AL ${fechaFinalPDF}`, margenizq, 22, { align: "justify", maxWidth: margender });

        console.log("Título de la sección añadido.");

        // Definir tamaño de celdas de la tabla
        var anchoEvento = pdf.internal.pageSize.getWidth() * 0.15;
        var anchoRespuestas = pdf.internal.pageSize.getWidth() * 0.05;
        var anchoPorcentaje = pdf.internal.pageSize.getWidth() * 0.15;
        var anchoComentarios = pdf.internal.pageSize.getWidth() * 0.35;
        var anchoRestante = pdf.internal.pageSize.getWidth() * 0.25;

        var posYTabla = 20; // Posición vertical para la tabla en el PDF

        // Encabezados de la tabla de respuestas
        pdf.setFontSize(7);
        pdf.line(margenizq, posYTabla + 5, margender + 18, posYTabla + 5); // Línea horizontal
        pdf.text("ESPACIO", margenizq + 7, posYTabla + 10);
        pdf.text("DET.", margenizq + anchoEvento, posYTabla + 10, { align: "center", maxWidth: anchoEvento - 5 });
        pdf.text("PAS.", margenizq + anchoEvento + anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
        pdf.text("PRO.", margenizq + anchoEvento + 2 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
        pdf.text("#RES.", margenizq + anchoEvento + 3 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
        pdf.text("% RES.", margenizq + anchoEvento + 4 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
        pdf.text("COMENTARIOS", margenizq + anchoEvento + 6 * anchoRespuestas - 4, posYTabla + 10, { align: "center", maxWidth: anchoRestante });

        console.log("Encabezados de la tabla añadidos.");

        // Obtener las claves de los eventos del campo "clavesInforme" del documento correspondiente en la colección "cuentas"
        var cuentasRef = firebase.firestore().collection("cuentas").doc(correoUsuario);

        cuentasRef.get().then(async (docCuentas) => {
            if (docCuentas.exists) {
                var clavesInformeIE = docCuentas.data().clavesInformeIE.split("|");
                console.log("Claves del informe obtenidas: ", clavesInformeIE);

                let totalSatisfaccion = 0;
                let eventosConSatisfaccion = 0;
                for (const claveEvento of clavesInformeIE) {
                    if (claveEvento) {
                        var reservaRef = firebase.firestore().collection("reservas").doc(claveEvento);
                        var docReserva = await reservaRef.get();

                        if (docReserva.exists) {
                            var data = docReserva.data();
                            console.log("Datos del evento obtenidos: ", data);

                            var nombreEvento = data.nombreEvento || "";
                            var detractores = data.detractores || 0;
                            var pasivos = data.pasivos || 0;
                            var promotores = data.promotores || 0;
                            var respuestas = ((detractores + pasivos + promotores) / 3) || 0;
                            var porcentajeRespuestas = ((respuestas / data.totalAsistentes) * 100).toFixed(2) + "%";
                            var comentarios = data.comentarios ? data.comentarios.split(/\|/g).filter(comentario => comentario !== "Ninguno.").map(comentario => "«" + comentario.trim() + "»").join("_") : "";

                            if (data.tipoEvento === "integracion-entorno") {
                                totalSatisfaccion += parseFloat(data.satisfaccion || 0);
                                eventosConSatisfaccion++;
                            }

                            var anchoComentarios = margender - (margenizq + anchoEvento + 3 * anchoRespuestas);
                            console.log("anchoComentarios: " + anchoComentarios);
                            var longitudComentarios = 1.1 * pdf.getStringUnitWidth(comentarios) * pdf.getFontSize();
                            var longitudNombreEvento = 1.8 * pdf.getStringUnitWidth(nombreEvento) * pdf.getFontSize();
                            var lineasNecesariasComentarios = Math.ceil(longitudComentarios / (anchoComentarios));
                            var lineasNecesariasNombreEvento = Math.ceil(longitudNombreEvento / (anchoEvento - 7));
                            var sumarAposYTabla = Math.max(7, lineasNecesariasComentarios, lineasNecesariasNombreEvento);

                            console.log("Longitud de comentarios: ", longitudComentarios);
                            console.log("Longitud de nombre del evento: ", longitudNombreEvento);
                            console.log("Líneas necesarias para comentarios: ", lineasNecesariasComentarios);
                            console.log("Líneas necesarias para nombre del evento: ", lineasNecesariasNombreEvento);
                            console.log("Espacio adicional calculado (sumarAposYTabla): ", sumarAposYTabla);

                            // Verificar si necesitamos agregar una nueva página
                            if (posYTabla + sumarAposYTabla > maxPosY) {
                                pdf.line(margenizq, posYTabla + sumarAposYTabla - 8, margender + 18, posYTabla + sumarAposYTabla - 8); // Línea horizontal
                                pdf.addPage(); // Agregar una nueva página al PDF
                                pdf.addImage(img, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
                                pdf.setFontSize(15);
                                pdf.text(`3. RESPUESTAS DE SATISFACCIÓN I.E DEL ${fechaInicialPDF} AL ${fechaFinalPDF}`, margenizq, 22, { align: "justify", maxWidth: margender });

                                posYTabla = 20; // Reiniciar la posición vertical

                                console.log("Nueva página añadida debido a límite de espacio.");

                                // Añadir encabezados a la nueva página
                                pdf.setFontSize(7);
                                pdf.line(margenizq, posYTabla + 5, margender + 18, posYTabla + 5); // Línea horizontal
                                pdf.text("ESPACIO", margenizq + 7, posYTabla + 10);
                                pdf.text("DET.", margenizq + anchoEvento, posYTabla + 10, { align: "center", maxWidth: anchoEvento - 5 });
                                pdf.text("PAS.", margenizq + anchoEvento + anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
                                pdf.text("PRO.", margenizq + anchoEvento + 2 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
                                pdf.text("#RES.", margenizq + anchoEvento + 3 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
                                pdf.text("% RES.", margenizq + anchoEvento + 4 * anchoRespuestas, posYTabla + 10, { align: "center", maxWidth: anchoRespuestas });
                                pdf.text("COMENTARIOS", margenizq + anchoEvento + 6 * anchoRespuestas - 4, posYTabla + 10, { align: "center", maxWidth: anchoRestante });

                                console.log("Encabezados añadidos en la nueva página.");
                                componenteComentarios = 1;
                            }

                            // Agregar contenido de la fila
                            posYTabla += 15;
                            pdf.text(nombreEvento, margenizq + 1, posYTabla, { align: "left", maxWidth: anchoEvento - 7 });
                            pdf.text(detractores.toString(), margenizq + anchoEvento, posYTabla, { align: "center", maxWidth: anchoRespuestas });
                            pdf.text(pasivos.toString(), margenizq + anchoEvento + anchoRespuestas, posYTabla, { align: "center", maxWidth: anchoRespuestas });
                            pdf.text(promotores.toString(), margenizq + anchoEvento + 2 * anchoRespuestas, posYTabla, { align: "center", maxWidth: anchoRespuestas });
                            pdf.text(respuestas.toString(), margenizq + anchoEvento + 3 * anchoRespuestas, posYTabla, { align: "center", maxWidth: anchoRespuestas });
                            pdf.text(porcentajeRespuestas, margenizq + anchoEvento + 4 * anchoRespuestas, posYTabla, { align: "center", maxWidth: anchoPorcentaje });
                            pdf.text(comentarios, margenizq + anchoEvento + 5 * anchoRespuestas - 4, posYTabla, { align: "left", maxWidth: anchoComentarios });

                            console.log("Contenido de la fila añadido:", {
                                nombreEvento,
                                detractores,
                                pasivos,
                                promotores,
                                respuestas,
                                porcentajeRespuestas,
                                comentarios
                            });

                            // Dibujar líneas horizontales y verticales
                            pdf.setDrawColor(0); // Establecer color de líneas en negro
                            pdf.setLineWidth(0.1); // Establecer ancho de línea
                            pdf.line(margenizq, posYTabla - 3, margender + 18, posYTabla - 3); // Línea horizontal

                            pdf.line(margenizq, posYTabla - 10, margenizq, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento - 5, posYTabla - 10, margenizq + anchoEvento - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 1 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 1 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 2 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 2 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 3 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 3 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 4 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 4 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margenizq + anchoEvento + 5 * anchoRespuestas - 5, posYTabla - 10, margenizq + anchoEvento + 5 * anchoRespuestas - 5, posYTabla + sumarAposYTabla);
                            pdf.line(margender + 2 * anchoRespuestas - 3, posYTabla - 10, margender + 2 * anchoRespuestas - 3, posYTabla + sumarAposYTabla);

                            console.log("Líneas horizontales y verticales dibujadas.");

                            posYTabla += sumarAposYTabla - 10;
                        }
                    }
                }

                // Línea horizontal final
                pdf.line(margenizq, posYTabla + 10, margender + 18, posYTabla + 10);

                console.log("Línea horizontal final añadida.");

                // Calcular satisfacción promedio
                const satisfaccionPromedioCapitular = totalSatisfaccion / eventosConSatisfaccion;
                const satisfaccionPromedioCapitularTexto = (satisfaccionPromedioCapitular * 100).toFixed(2) + "%";
              
                // Obtener el total de páginas del PDF
                const totalPages = pdf.internal.getNumberOfPages();

                // Añadir satisfacción promedio en la antepenúltima página
                pdf.setPage(totalPages - 1 - componenteComentarios); // Cambiar a la antepenúltima página
                pdf.setFontSize(12);
                pdf.text(`Satisfacción Promedio (Integración con el Entorno): ${satisfaccionPromedioCapitularTexto}`, margenizq, PosYParaSG, { align: "justify", maxWidth: margender });

                // Ajustes de la portada
                pdf.setTextColor("#32620E"); //Verde académico
                pdf.setFontSize(35);
                pdf.setPage(1); // Cambiar a la página 1
                pdf.text(capituloUsuario.toUpperCase(), 105, 220, { align: "center" });

                // Ajustes del pie de página
                pdf.setTextColor("#EDEDED"); //Blanco un poquitín agriseado por fines visuales
                pdf.setFontSize(11);
                const textoTelefono = telefonoCuenta; // Variable que contiene el texto del teléfono
                const x = 91; // Coordenada X
                const y = 291.5; // Coordenada Y

                // Bucle para recorrer todas las páginas y añadir el texto
                for (let i = 2; i <= totalPages; i++) {
                    pdf.setPage(i);
                    pdf.text(textoTelefono, x, y);
                }

                // Función para obtener la abreviatura de un mes en español
                function obtenerAbreviaturaMes(mes) {
                    const meses = {
                        "01": "FEB", "02": "FEB", "03": "MAR", "04": "ABR", "05": "MAY", "06": "JUN",
                        "07": "JUL", "08": "AGO", "09": "SEP", "10": "OCT", "11": "NOV", "12": "DIC"
                    };
                    return meses[mes] || "";
                }

                // Extraer año y mes de las fechas
                let añoInicial = fechaInicialPDF.substring(0, 4);
                let mesInicial = obtenerAbreviaturaMes(fechaInicialPDF.substring(5, 7));
                let añoFinal = fechaFinalPDF.substring(0, 4);
                let mesFinal = obtenerAbreviaturaMes(fechaFinalPDF.substring(5, 7));

                // Determinar el nombre del periodo
                let nombrePeriodo = `${mesInicial}-${mesFinal}_${añoFinal}`;
                if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2024-11-30") {
                    nombrePeriodo = "ANUAL_2024";
                } else if (fechaInicialPDF === "2025-02-01" && fechaFinalPDF === "2025-11-30") {
                    nombrePeriodo = "ANUAL_2025";
                } else if (fechaInicialPDF === "2024-02-01" && fechaFinalPDF === "2025-11-30") {
                    nombrePeriodo = "TODOS_LOS_PERIODOS";
                }

                // Guardar el archivo con el nombre dinámico
                pdf.save(`Informe_Seguimiento_Integración_Entorno_${capituloUsuario.toUpperCase()}_${nombrePeriodo}.pdf`);

                toggleVisualizarActualizarEspacios();

                // Abrir automáticamente el PDF después de descargarlo
                var pdfURL = pdf.output('bloburl');
                window.open(pdfURL, '_blank');
            }
        });
    }

    async function actualizarClavesInforme(capituloUsuario, correoUsuario, fechaInicialPDF, fechaFinalPDF) {
        var reservasRef = firebase.firestore().collection("reservas");
        var consulta = reservasRef.where("capitulosOrganizadores", "array-contains", capituloUsuario)
            .where("fechaEvento", ">=", fechaInicialPDF)
            .where("fechaEvento", "<=", fechaFinalPDF)
            .orderBy("fechaEvento", "asc");

        consulta.get().then(function(querySnapshot) {
            // Filtrar los documentos por tipoEvento
            var documentosFiltrados = querySnapshot.docs.filter(function(doc) {
                var tipoEvento = doc.data().tipoEvento;
                var asistentes = doc.data().asistentes;
                return (tipoEvento === "valor-agregado" || tipoEvento === "entrenamiento-interno") &&
                    asistentes !== undefined && asistentes !== null && asistentes !== ""; // Filtrar por tipoEvento diferente de "undefined" y cadena vacía
            });

            var tablaResumen = [];
            var clavesInforme = "";

            // Iterar sobre los resultados de la consulta
            documentosFiltrados.forEach(function(doc) {
                var data = doc.data();
                // Construir la cadena de texto vectorial para este evento
                var eventoString = `${data.nombreEvento}|${data.areaTrabajo}|${data.tipoEvento}|${data.fechaEvento}|${data.nombrePonente}|${data.totalAsistentes}|${(data.satisfaccion * 100).toFixed(2)}%|${data.evidencia}`;
                // Agregar la cadena al array
                tablaResumen.push(eventoString);
                var claveEvento = data.claveEvento; // Obtener la clave del evento
                clavesInforme += `${claveEvento}|`; // Concatenar la clave del evento a clavesInforme
            });

            // Guardar el array en el campo "tablaResumen" de la colección "cuentas"
            var cuentasRef = firebase.firestore().collection("cuentas").doc(correoUsuario);
            cuentasRef.update({
                tablaResumen: tablaResumen,
                clavesInforme: clavesInforme
            }).then(function() {
                tablaResumenPDF = tablaResumen;
                console.log("Tabla resumen guardada exitosamente en la colección 'cuentas'.");
                console.log(tablaResumenPDF);
            }).catch(function(error) {
                console.error("Error al guardar la tabla resumen:", error);
            });

            // Realizar la consulta y filtrado adicional para "tablaResumenConEI"
            var documentosConEI = querySnapshot.docs.filter(function(doc) {
                var tipoEvento = doc.data().tipoEvento;
                var asistentes = doc.data().asistentes;
                return (tipoEvento === "entrenamiento-interno") ||
                    (tipoEvento === "valor-agregado" && asistentes !== undefined && asistentes !== null && asistentes !== "");
            });

            var tablaResumenConEI = [];
            documentosConEI.forEach(function(doc) {
                var data = doc.data();
                // Determinar el valor para satisfacción
                var satisfaccionValue = (data.asistentes && data.asistentes.length > 0) ? `${(data.satisfaccion * 100).toFixed(2)}%` : "N/A";
                // Determinar el valor para contactoPonente
                var contactoPonente = data.emailPonente || data.telefonoPonente || "No se tiene";
                // Construir la cadena de texto vectorial para este evento
                var eventoString = `${data.nombreEvento}|${data.areaTrabajo}|${data.tipoEvento}|${data.fechaEvento}|${data.nombrePonente}|${contactoPonente}|${data.totalAsistentes}|${satisfaccionValue}|${data.evidencia}`;
                // Agregar la cadena al array
                tablaResumenConEI.push(eventoString);
            });

            // Guardar el array en el nuevo campo "tablaResumenConEI" de la colección "cuentas"
            cuentasRef.update({
                tablaResumenConEI: tablaResumenConEI
            }).then(function() {
                tablaResumenPDF = tablaResumenConEI;
                console.log("Tabla resumen con EI guardada exitosamente en la colección 'cuentas'.");
                console.log(tablaResumenConEI);
            }).catch(function(error) {
                console.error("Error al guardar la tabla resumen con EI:", error);
            });

            // Filtrar los documentos por tipoEvento "integracion-entorno" y asistentes no vacíos
            var documentosIE = querySnapshot.docs.filter(function(doc) {
                var tipoEvento = doc.data().tipoEvento;
                var asistentes = doc.data().asistentes;
                return tipoEvento === "integracion-entorno" &&
                    asistentes !== undefined && asistentes !== null && asistentes !== "";
            });

            var tablaResumenIE = [];
            var clavesInformeIE = "";
            documentosIE.forEach(function(doc) {
                var data = doc.data();
                // Construir la cadena de texto vectorial para este evento
                var eventoString = `${data.nombreEvento}|${data.areaTrabajo}|${data.fechaEvento}|${data.nombrePonente}|${data.planEvento}|${data.totalAsistentes}|${(data.satisfaccion * 100).toFixed(2)}%|${data.evidencia}`;
                // Agregar la cadena al array
                tablaResumenIE.push(eventoString);
                var claveEvento = data.claveEvento; // Obtener la clave del evento
                clavesInformeIE += `${claveEvento}|`; // Concatenar la clave del evento a clavesInformeIE
            });

            // Guardar el array en el campo "tablaResumenIE" y las claves en "clavesInformeIE" de la colección "cuentas"
            cuentasRef.update({
                tablaResumenIE: tablaResumenIE,
                clavesInformeIE: clavesInformeIE
            }).then(function() {
                tablaResumenPDFIE = tablaResumenIE;
                console.log("Tabla resumen IE y claves guardadas exitosamente en la colección 'cuentas'.");
                console.log(tablaResumenIE);
                console.log(clavesInformeIE);
            }).catch(function(error) {
                console.error("Error al guardar la tabla resumen IE y claves:", error);
            });

        }).catch(function(error) {
            console.error("Error al obtener las reservas:", error);
        });
    }

    function agregarTelefonoPieDePagina(pdf, telefonoCuenta) {
        // Cambiar el color del texto a un blanco ligeramente gris
        pdf.setTextColor("#EDEDED"); // Blanco un poquitín agriseado por fines visuales
        pdf.setFontSize(11);

        const x = 91; // Coordenada X
        const y = 291.5; // Coordenada Y

        // Obtener la página actual del PDF
        const currentPage = pdf.internal.pageNumber;

        // Establecer la página actual donde quieres añadir el teléfono
        pdf.setPage(currentPage);

        // Agregar el texto del teléfono en la posición deseada
        pdf.text(telefonoCuenta, x, y);

        // Devolver el color del texto a negro para evitar afectar el resto del PDF
        pdf.setTextColor(0, 0, 0); // Color negro
    }

    function agregarTelefonoCRM(pdf, datosEvento) {
        // Obtener el teléfono del coordinador de mercadeo
        let telefono = datosEvento.telefonoCoordMercadeo || "TELÉFONO NO DISPONIBLE";

        // Cambiar el color del texto a un blanco ligeramente gris
        pdf.setTextColor("#EDEDED"); // Blanco agrisado para mejor visibilidad
        pdf.setFontSize(11);

        const x = 91; // Coordenada X
        const y = 301.5; // Coordenada Y

        // Obtener la página actual del PDF
        const currentPage = pdf.internal.pageNumber;

        // Establecer la página actual donde quieres añadir el teléfono
        pdf.setPage(currentPage);

        // Agregar el texto del teléfono en la posición deseada
        pdf.text(telefono, x, y);

        // Restaurar el color del texto a negro para evitar afectar el resto del PDF
        pdf.setTextColor(0, 0, 0);
    }

    async function generarAgendaFormativa() {
        const categorias = [
            { nombre: "Académico", color: "#4CAF50" },
            { nombre: "Comunicaciones", color: "#2196F3" },
            { nombre: "Desarrollo", color: "#FFC107" },
            { nombre: "Finanzas", color: "#9C27B0" },
            { nombre: "Mercadeo", color: "#F44336" },
            { nombre: "Habilidades duras", color: "#FF5722" },
            { nombre: "Habilidades blandas", color: "#607D8B" },
            { nombre: "Conocimiento ANEIAP", color: "#388E3C" },
            { nombre: "TODAS", color: "#3F51B5" }
        ];

        const { value: seleccion } = await Swal.fire({
            title: '¿Qué categoría desea consultar en la agenda formativa?',
            html: `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; text-align: left;">
                    ${categorias.slice(0, 8).map((cat, index) => `
                        <label style="color: ${cat.color}; font-weight: bold;">
                            ${cat.nombre}
                            <input type="radio" id="categoria${index}" name="categoria" value="${cat.nombre}" style="margin-left: 10px;">
                        </label>
                    `).join('')}
                    <label style="grid-column: span 2; text-align: center; color: ${categorias[8].color}; font-weight: bold;">
                        ${categorias[8].nombre}
                        <input type="radio" id="categoria8" name="categoria" value="${categorias[8].nombre}" style="margin-left: 10px;">
                    </label>
                </div>
            `,
            focusConfirm: false,
            showCancelButton: false,
            confirmButtonText: 'Consultar',
            width: '700px',
            preConfirm: () => {
                const selectedRadio = document.querySelector('input[name="categoria"]:checked');
                return selectedRadio ? selectedRadio.value : null;
            }
        });

        if (!seleccion) return;

        // Obtener datos desde Firebase según la selección del usuario
        const dbRef = firebase.firestore().collection("agendaformativa");
        let agendaData = [];

        if (seleccion === "TODAS") {
            const docNamesMap = {
                academico: "Académico",
                comunicaciones: "Comunicaciones",
                desarrollo: "Desarrollo",
                finanzas: "Finanzas",
                mercadeo: "Mercadeo",
                habilidadesduras: "Habilidades duras",
                habilidadesblandas: "Habilidades blandas",
                conocimientoaneiap: "Conocimiento ANEIAP"
            };

            const docNames = Object.keys(docNamesMap); // Lista de nombres limpios

            for (const docName of docNames) {
                const docRef = dbRef.doc(docName);
                const doc = await docRef.get();

                // Asumimos que los documentos siempre existen, por lo que no se verifica la existencia.
                const data = doc.data();
                agendaData.push({
                    categoria: docNamesMap[docName], // Usa el nombre específico del mapeo
                    valorAgregado: data.espacios_valoragregado || [],
                    entrenamientoInterno: data.espacios_entrenamientointerno || []
                });
            }
        } else {
            const docRef = dbRef.doc(normalizarNombre(seleccion));
            const doc = await docRef.get();
            if (doc.exists) {
                const data = doc.data();
                agendaData.push({
                    categoria: seleccion,
                    valorAgregado: data.espacios_valoragregado || [],
                    entrenamientoInterno: data.espacios_entrenamientointerno || []
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'No se encontraron datos para la categoría seleccionada.',
                });
                return;
            }
        }

        // Construir la tabla de resultados
        const tableContent = agendaData.map(({ categoria, valorAgregado, entrenamientoInterno }) => `
            <h3 style="color: ${categorias.find(cat => cat.nombre === categoria).color};">${categoria}</h3>
            <table style="width: 100%; table-layout: fixed; border-collapse: collapse; margin-bottom: 20px;">
                <thead>
                    <tr>
                        <th style="border-bottom: 2px solid #ddd; padding: 8px; text-align: left; width: 40%;">Nombre Espacio</th>
                        ${seleccion === "TODAS" ? '<th style="border-bottom: 2px solid #ddd; padding: 8px; text-align: left; width: 30%;">Área de Trabajo</th>' : ''}
                        <th style="border-bottom: 2px solid #ddd; padding: 8px; text-align: left; width: 30%;">Tipo Espacio</th>
                    </tr>
                </thead>
                <tbody>
                    ${valorAgregado.map(espacio => `
                        <tr>
                            <td style="border-bottom: 1px solid #ddd; padding: 8px; word-wrap: break-word;">${espacio}</td>
                            ${seleccion === "TODAS" ? `<td style="border-bottom: 1px solid #ddd; padding: 8px; word-wrap: break-word;">${categoria}</td>` : ''}
                            <td style="border-bottom: 1px solid #ddd; padding: 8px; word-wrap: break-word;">Valor agregado</td>
                        </tr>
                    `).join('')}
                    ${entrenamientoInterno.map(espacio => `
                        <tr>
                            <td style="border-bottom: 1px solid #ddd; padding: 8px; word-wrap: break-word;">${espacio}</td>
                            ${seleccion === "TODAS" ? `<td style="border-bottom: 1px solid #ddd; padding: 8px; word-wrap: break-word;">${categoria}</td>` : ''}
                            <td style="border-bottom: 1px solid #ddd; padding: 8px; word-wrap: break-word;">Entrenamiento interno</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `).join('');


        // Mostrar los datos en un nuevo modal con búsqueda en tiempo real
        Swal.fire({
            title: `Agenda Formativa - ${seleccion}`,
            html: `
                <input type="text" id="searchInput" placeholder="Buscar un espacio..." style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd;">
                <div id="tableContainer">${tableContent}</div>
            `,
            width: '1000px',
            showCloseButton: false,
            showCancelButton: true,
            cancelButtonText: 'Volver',
            confirmButtonText: 'Salir',
            didOpen: () => {
                const searchInput = document.getElementById('searchInput');
                const tableContainer = document.getElementById('tableContainer');
                
                searchInput.addEventListener('input', () => {
                    const filter = searchInput.value.toLowerCase();
                    const rows = tableContainer.querySelectorAll('tbody tr');
                    
                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(filter) ? '' : 'none';
                    });
                });
            }
        }).then((result) => {
            if (result.isDismissed) {
                // Volver a la interfaz de selección de categoría
                generarAgendaFormativa();
            }
        });
    }

    // Función para capitalizar el área de trabajo
    function capitalize(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }
    // Función para limpiar el nombre de la opción y tomar el documento de la agenda formativa
    function normalizarNombre(nombre) {
        return nombre
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "") // Remueve tildes
            .replace(/\s+/g, "") // Remueve espacios
            .toLowerCase();
    }

  </script>

</body>
</html>
